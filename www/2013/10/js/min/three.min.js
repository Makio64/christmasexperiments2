var THREE={REVISION:"63"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}};String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};THREE.extend=function(f,e){if(Object.keys){var d=Object.keys(e);for(var c=0,b=d.length;c<b;c++){var g=d[c];Object.defineProperty(f,g,Object.getOwnPropertyDescriptor(e,g))}}else{var a={}.hasOwnProperty;for(var g in e){if(a.call(e,g)){f[g]=e[g]}}}return f};(function(){var b=0;var c=["ms","moz","webkit","o"];for(var a=0;a<c.length&&!self.requestAnimationFrame;++a){self.requestAnimationFrame=self[c[a]+"RequestAnimationFrame"];self.cancelAnimationFrame=self[c[a]+"CancelAnimationFrame"]||self[c[a]+"CancelRequestAnimationFrame"]}if(self.requestAnimationFrame===undefined&&self.setTimeout!==undefined){self.requestAnimationFrame=function(g){var d=Date.now(),e=Math.max(0,16-(d-b));var f=self.setTimeout(function(){g(d+e)},e);b=d+e;return f}}if(self.cancelAnimationFrame===undefined&&self.clearTimeout!==undefined){self.cancelAnimationFrame=function(d){self.clearTimeout(d)}}}());THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=1000;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.Color=function(a){if(a!==undefined){this.set(a)}return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(a){if(a instanceof THREE.Color){this.copy(a)}else{if(typeof a==="number"){this.setHex(a)}else{if(typeof a==="string"){this.setStyle(a)}}}return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},setRGB:function(d,c,a){this.r=d;this.g=c;this.b=a;return this},setHSL:function(d,c,b){if(c===0){this.r=this.g=this.b=b}else{var a=function(i,h,g){if(g<0){g+=1}if(g>1){g-=1}if(g<1/6){return i+(h-i)*6*g}if(g<1/2){return h}if(g<2/3){return i+(h-i)*6*(2/3-g)}return i};var f=b<=0.5?b*(1+c):b+c-(b*c);var e=(2*b)-f;this.r=a(e,f,d+1/3);this.g=a(e,f,d);this.b=a(e,f,d-1/3)}return this},setStyle:function(b){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(b)){var a=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(b);this.r=Math.min(255,parseInt(a[1],10))/255;this.g=Math.min(255,parseInt(a[2],10))/255;this.b=Math.min(255,parseInt(a[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(b)){var a=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(b);this.r=Math.min(100,parseInt(a[1],10))/100;this.g=Math.min(100,parseInt(a[2],10))/100;this.b=Math.min(100,parseInt(a[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(b)){var a=/^\#([0-9a-f]{6})$/i.exec(b);this.setHex(parseInt(a[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(b)){var a=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(b);this.setHex(parseInt(a[1]+a[1]+a[2]+a[2]+a[3]+a[3],16));return this}if(/^(\w+)$/i.test(b)){this.setHex(THREE.ColorKeywords[b]);return this}},copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},copyGammaToLinear:function(a){this.r=a.r*a.r;this.g=a.g*a.g;this.b=a.b*a.b;return this},copyLinearToGamma:function(a){this.r=Math.sqrt(a.r);this.g=Math.sqrt(a.g);this.b=Math.sqrt(a.b);return this},convertGammaToLinear:function(){var d=this.r,c=this.g,a=this.b;this.r=d*d;this.g=c*c;this.b=a*a;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return(this.r*255)<<16^(this.g*255)<<8^(this.b*255)<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(){var a={h:0,s:0,l:0};return function(){var c=this.r,f=this.g,i=this.b;var j=Math.max(c,f,i);var d=Math.min(c,f,i);var h,e;var l=(d+j)/2;if(d===j){h=0;e=0}else{var k=j-d;e=l<=0.5?k/(j+d):k/(2-j-d);switch(j){case c:h=(f-i)/k+(f<i?6:0);break;case f:h=(i-c)/k+2;break;case i:h=(c-f)/k+4;break}h/=6}a.h=h;a.s=e;a.l=l;return a}}(),getStyle:function(){return"rgb("+((this.r*255)|0)+","+((this.g*255)|0)+","+((this.b*255)|0)+")"},offsetHSL:function(d,c,a){var b=this.getHSL();b.h+=d;b.s+=c;b.l+=a;this.setHSL(b.h,b.s,b.l);return this},add:function(a){this.r+=a.r;this.g+=a.g;this.b+=a.b;return this},addColors:function(b,a){this.r=b.r+a.r;this.g=b.g+a.g;this.b=b.b+a.b;return this},addScalar:function(a){this.r+=a;this.g+=a;this.b+=a;return this},multiply:function(a){this.r*=a.r;this.g*=a.g;this.b*=a.b;return this},multiplyScalar:function(a){this.r*=a;this.g*=a;this.b*=a;return this},lerp:function(a,b){this.r+=(a.r-this.r)*b;this.g+=(a.g-this.g)*b;this.b+=(a.b-this.b)*b;return this},equals:function(a){return(a.r===this.r)&&(a.g===this.g)&&(a.b===this.b)},fromArray:function(a){this.r=a[0];this.g=a[1];this.b=a[2];return this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return new THREE.Color().setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(a,d,c,b){this._x=a||0;this._y=d||0;this._z=c||0;this._w=(b!==undefined)?b:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:undefined,_updateEuler:function(a){if(this._euler!==undefined){this._euler.setFromQuaternion(this,undefined,false)}},get x(){return this._x},set x(a){this._x=a;this._updateEuler()},get y(){return this._y},set y(a){this._y=a;this._updateEuler()},get z(){return this._z},set z(a){this._z=a;this._updateEuler()},get w(){return this._w},set w(a){this._w=a;this._updateEuler()},set:function(a,d,c,b){this._x=a;this._y=d;this._z=c;this._w=b;this._updateEuler();return this},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._w=a._w;this._updateEuler();return this},setFromEuler:function(g,h){if(g instanceof THREE.Euler===false){throw new Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.")}var f=Math.cos(g._x/2);var e=Math.cos(g._y/2);var c=Math.cos(g._z/2);var d=Math.sin(g._x/2);var b=Math.sin(g._y/2);var a=Math.sin(g._z/2);if(g.order==="XYZ"){this._x=d*e*c+f*b*a;this._y=f*b*c-d*e*a;this._z=f*e*a+d*b*c;this._w=f*e*c-d*b*a}else{if(g.order==="YXZ"){this._x=d*e*c+f*b*a;this._y=f*b*c-d*e*a;this._z=f*e*a-d*b*c;this._w=f*e*c+d*b*a}else{if(g.order==="ZXY"){this._x=d*e*c-f*b*a;this._y=f*b*c+d*e*a;this._z=f*e*a+d*b*c;this._w=f*e*c-d*b*a}else{if(g.order==="ZYX"){this._x=d*e*c-f*b*a;this._y=f*b*c+d*e*a;this._z=f*e*a-d*b*c;this._w=f*e*c+d*b*a}else{if(g.order==="YZX"){this._x=d*e*c+f*b*a;this._y=f*b*c+d*e*a;this._z=f*e*a-d*b*c;this._w=f*e*c-d*b*a}else{if(g.order==="XZY"){this._x=d*e*c-f*b*a;this._y=f*b*c-d*e*a;this._z=f*e*a+d*b*c;this._w=f*e*c+d*b*a}}}}}}if(h!==false){this._updateEuler()}return this},setFromAxisAngle:function(c,d){var a=d/2,b=Math.sin(a);this._x=c.x*b;this._y=c.y*b;this._z=c.z*b;this._w=Math.cos(a);this._updateEuler();return this},setFromRotationMatrix:function(e){var d=e.elements,i=d[0],h=d[4],g=d[8],c=d[1],b=d[5],a=d[9],l=d[2],k=d[6],j=d[10],f=i+b+j,n;if(f>0){n=0.5/Math.sqrt(f+1);this._w=0.25/n;this._x=(k-a)*n;this._y=(g-l)*n;this._z=(c-h)*n}else{if(i>b&&i>j){n=2*Math.sqrt(1+i-b-j);this._w=(k-a)/n;this._x=0.25*n;this._y=(h+c)/n;this._z=(g+l)/n}else{if(b>j){n=2*Math.sqrt(1+b-i-j);this._w=(g-l)/n;this._x=(h+c)/n;this._y=0.25*n;this._z=(a+k)/n}else{n=2*Math.sqrt(1+j-i-b);this._w=(c-h)/n;this._x=(g+l)/n;this._y=(a+k)/n;this._z=0.25*n}}}this._updateEuler();return this},inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this._updateEuler();return this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();if(a===0){this._x=0;this._y=0;this._z=0;this._w=1}else{a=1/a;this._x=this._x*a;this._y=this._y*a;this._z=this._z*a;this._w=this._w*a}return this},multiply:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(a,b)}return this.multiplyQuaternions(this,a)},multiplyQuaternions:function(l,k){var i=l._x,h=l._y,g=l._z,j=l._w;var e=k._x,d=k._y,c=k._z,f=k._w;this._x=i*f+j*e+h*c-g*d;this._y=h*f+j*d+g*e-i*c;this._z=g*f+j*c+i*d-h*e;this._w=j*f-i*e-h*d-g*c;this._updateEuler();return this},multiplyVector3:function(a){console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return a.applyQuaternion(this)},slerp:function(c,k){var i=this._x,h=this._y,g=this._z,j=this._w;var b=j*c._w+i*c._x+h*c._y+g*c._z;if(b<0){this._w=-c._w;this._x=-c._x;this._y=-c._y;this._z=-c._z;b=-b}else{this.copy(c)}if(b>=1){this._w=j;this._x=i;this._y=h;this._z=g;return this}var d=Math.acos(b);var a=Math.sqrt(1-b*b);if(Math.abs(a)<0.001){this._w=0.5*(j+this._w);this._x=0.5*(i+this._x);this._y=0.5*(h+this._y);this._z=0.5*(g+this._z);return this}var f=Math.sin((1-k)*d)/a,e=Math.sin(k*d)/a;this._w=(j*f+this._w*e);this._x=(i*f+this._x*e);this._y=(h*f+this._y*e);this._z=(g*f+this._z*e);this._updateEuler();return this},equals:function(a){return(a._x===this._x)&&(a._y===this._y)&&(a._z===this._z)&&(a._w===this._w)},fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];this._w=a[3];this._updateEuler();return this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(d,c,b,a){return b.copy(d).slerp(c,a)};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(a,b){this.x=a;this.y=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},copy:function(a){this.x=a.x;this.y=a.y;return this},add:function(b,a){if(a!==undefined){console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(b,a)}this.x+=b.x;this.y+=b.y;return this},addVectors:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;return this},addScalar:function(a){this.x+=a;this.y+=a;return this},sub:function(b,a){if(a!==undefined){console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(b,a)}this.x-=b.x;this.y-=b.y;return this},subVectors:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;return this},divideScalar:function(b){if(b!==0){var a=1/b;this.x*=a;this.y*=a}else{this.x=0;this.y=0}return this},min:function(a){if(this.x>a.x){this.x=a.x}if(this.y>a.y){this.y=a.y}return this},max:function(a){if(this.x<a.x){this.x=a.x}if(this.y<a.y){this.y=a.y}return this},clamp:function(b,a){if(this.x<b.x){this.x=b.x}else{if(this.x>a.x){this.x=a.x}}if(this.y<b.y){this.y=b.y}else{if(this.y>a.y){this.y=a.y}}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(c){var b=this.x-c.x,a=this.y-c.y;return b*b+a*a},setLength:function(a){var b=this.length();if(b!==0&&a!==b){this.multiplyScalar(a/b)}return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;return this},equals:function(a){return((a.x===this.x)&&(a.y===this.y))},fromArray:function(a){this.x=a[0];this.y=a[1];return this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(a,c,b){this.x=a||0;this.y=c||0;this.z=b||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(a,c,b){this.x=a;this.y=c;this.z=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(b,a){if(a!==undefined){console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(b,a)}this.x+=b.x;this.y+=b.y;this.z+=b.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},addVectors:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;return this},sub:function(b,a){if(a!==undefined){console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(b,a)}this.x-=b.x;this.y-=b.y;this.z-=b.z;return this},subVectors:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;return this},multiply:function(b,a){if(a!==undefined){console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(b,a)}this.x*=b.x;this.y*=b.y;this.z*=b.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},multiplyVectors:function(d,c){this.x=d.x*c.x;this.y=d.y*c.y;this.z=d.z*c.z;return this},applyMatrix3:function(b){var a=this.x;var f=this.y;var d=this.z;var c=b.elements;this.x=c[0]*a+c[3]*f+c[6]*d;this.y=c[1]*a+c[4]*f+c[7]*d;this.z=c[2]*a+c[5]*f+c[8]*d;return this},applyMatrix4:function(b){var a=this.x,f=this.y,d=this.z;var c=b.elements;this.x=c[0]*a+c[4]*f+c[8]*d+c[12];this.y=c[1]*a+c[5]*f+c[9]*d+c[13];this.z=c[2]*a+c[6]*f+c[10]*d+c[14];return this},applyProjection:function(b){var a=this.x,h=this.y,g=this.z;var c=b.elements;var f=1/(c[3]*a+c[7]*h+c[11]*g+c[15]);this.x=(c[0]*a+c[4]*h+c[8]*g+c[12])*f;this.y=(c[1]*a+c[5]*h+c[9]*g+c[13])*f;this.z=(c[2]*a+c[6]*h+c[10]*g+c[14])*f;return this},applyQuaternion:function(a){var l=this.x;var k=this.y;var j=this.z;var h=a.x;var g=a.y;var f=a.z;var i=a.w;var d=i*l+g*j-f*k;var c=i*k+f*l-h*j;var b=i*j+h*k-g*l;var e=-h*l-g*k-f*j;this.x=d*i+e*-h+c*-f-b*-g;this.y=c*i+e*-g+b*-h-d*-f;this.z=b*i+e*-f+d*-g-c*-h;return this},transformDirection:function(b){var a=this.x,f=this.y,d=this.z;var c=b.elements;this.x=c[0]*a+c[4]*f+c[8]*d;this.y=c[1]*a+c[5]*f+c[9]*d;this.z=c[2]*a+c[6]*f+c[10]*d;this.normalize();return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(b){if(b!==0){var a=1/b;this.x*=a;this.y*=a;this.z*=a}else{this.x=0;this.y=0;this.z=0}return this},min:function(a){if(this.x>a.x){this.x=a.x}if(this.y>a.y){this.y=a.y}if(this.z>a.z){this.z=a.z}return this},max:function(a){if(this.x<a.x){this.x=a.x}if(this.y<a.y){this.y=a.y}if(this.z<a.z){this.z=a.z}return this},clamp:function(b,a){if(this.x<b.x){this.x=b.x}else{if(this.x>a.x){this.x=a.x}}if(this.y<b.y){this.y=b.y}else{if(this.y>a.y){this.y=a.y}}if(this.z<b.z){this.z=b.z}else{if(this.z>a.z){this.z=a.z}}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();if(b!==0&&a!==b){this.multiplyScalar(a/b)}return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},cross:function(c,b){if(b!==undefined){console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(c,b)}var a=this.x,e=this.y,d=this.z;this.x=e*c.z-d*c.y;this.y=d*c.x-a*c.z;this.z=a*c.y-e*c.x;return this},crossVectors:function(d,c){var h=d.x,f=d.y,e=d.z;var j=c.x,i=c.y,g=c.z;this.x=f*g-e*i;this.y=e*j-h*g;this.z=h*i-f*j;return this},angleTo:function(a){var b=this.dot(a)/(this.length()*a.length());return Math.acos(THREE.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(d){var c=this.x-d.x;var b=this.y-d.y;var a=this.z-d.z;return c*c+b*b+a*a},setEulerFromRotationMatrix:function(b,a){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(b,a){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(a){this.x=a.elements[12];this.y=a.elements[13];this.z=a.elements[14];return this},getScaleFromMatrix:function(a){var d=this.set(a.elements[0],a.elements[1],a.elements[2]).length();var c=this.set(a.elements[4],a.elements[5],a.elements[6]).length();var b=this.set(a.elements[8],a.elements[9],a.elements[10]).length();this.x=d;this.y=c;this.z=b;return this},getColumnFromMatrix:function(b,a){var d=b*4;var c=a.elements;this.x=c[d];this.y=c[d+1];this.z=c[d+2];return this},equals:function(a){return((a.x===this.x)&&(a.y===this.y)&&(a.z===this.z))},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];return this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.extend(THREE.Vector3.prototype,{applyEuler:function(){var a=new THREE.Quaternion();return function(b){if(b instanceof THREE.Euler===false){console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.")}this.applyQuaternion(a.setFromEuler(b));return this}}(),applyAxisAngle:function(){var a=new THREE.Quaternion();return function(b,c){this.applyQuaternion(a.setFromAxisAngle(b,c));return this}}(),projectOnVector:function(){var a=new THREE.Vector3();return function(b){a.copy(b).normalize();var c=this.dot(a);return this.copy(a).multiplyScalar(c)}}(),projectOnPlane:function(){var a=new THREE.Vector3();return function(b){a.copy(this).projectOnVector(b);return this.sub(a)}}(),reflect:function(){var a=new THREE.Vector3();return function(b){a.copy(this).projectOnVector(b).multiplyScalar(2);return this.subVectors(a,this)}}()});THREE.Vector4=function(a,d,c,b){this.x=a||0;this.y=d||0;this.z=c||0;this.w=(b!==undefined)?b:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(a,d,c,b){this.x=a;this.y=d;this.z=c;this.w=b;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},setW:function(a){this.w=a;return this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=(a.w!==undefined)?a.w:1;return this},add:function(b,a){if(a!==undefined){console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(b,a)}this.x+=b.x;this.y+=b.y;this.z+=b.z;this.w+=b.w;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;this.w+=a;return this},addVectors:function(d,c){this.x=d.x+c.x;this.y=d.y+c.y;this.z=d.z+c.z;this.w=d.w+c.w;return this},sub:function(b,a){if(a!==undefined){console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(b,a)}this.x-=b.x;this.y-=b.y;this.z-=b.z;this.w-=b.w;return this},subVectors:function(d,c){this.x=d.x-c.x;this.y=d.y-c.y;this.z=d.z-c.z;this.w=d.w-c.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},applyMatrix4:function(b){var a=this.x;var g=this.y;var f=this.z;var c=this.w;var d=b.elements;this.x=d[0]*a+d[4]*g+d[8]*f+d[12]*c;this.y=d[1]*a+d[5]*g+d[9]*f+d[13]*c;this.z=d[2]*a+d[6]*g+d[10]*f+d[14]*c;this.w=d[3]*a+d[7]*g+d[11]*f+d[15]*c;return this},divideScalar:function(b){if(b!==0){var a=1/b;this.x*=a;this.y*=a;this.z*=a;this.w*=a}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(b){this.w=2*Math.acos(b.w);var a=Math.sqrt(1-b.w*b.w);if(a<0.0001){this.x=1;this.y=0;this.z=0}else{this.x=b.x/a;this.y=b.y/a;this.z=b.z/a}return this},setAxisAngleFromRotationMatrix:function(t){var u,j,i,h,D=0.01,k=0.1,g=t.elements,C=g[0],A=g[4],v=g[8],e=g[1],c=g[5],a=g[9],r=g[2],p=g[6],n=g[10];if((Math.abs(A-e)<D)&&(Math.abs(v-r)<D)&&(Math.abs(a-p)<D)){if((Math.abs(A+e)<k)&&(Math.abs(v+r)<k)&&(Math.abs(a+p)<k)&&(Math.abs(C+c+n-3)<k)){this.set(1,0,0,0);return this}u=Math.PI;var f=(C+1)/2;var q=(c+1)/2;var B=(n+1)/2;var d=(A+e)/4;var b=(v+r)/4;var o=(a+p)/4;if((f>q)&&(f>B)){if(f<D){j=0;i=0.707106781;h=0.707106781}else{j=Math.sqrt(f);i=d/j;h=b/j}}else{if(q>B){if(q<D){j=0.707106781;i=0;h=0.707106781}else{i=Math.sqrt(q);j=d/i;h=o/i}}else{if(B<D){j=0.707106781;i=0.707106781;h=0}else{h=Math.sqrt(B);j=b/h;i=o/h}}}this.set(j,i,h,u);return this}var l=Math.sqrt((p-a)*(p-a)+(v-r)*(v-r)+(e-A)*(e-A));if(Math.abs(l)<0.001){l=1}this.x=(p-a)/l;this.y=(v-r)/l;this.z=(e-A)/l;this.w=Math.acos((C+c+n-1)/2);return this},min:function(a){if(this.x>a.x){this.x=a.x}if(this.y>a.y){this.y=a.y}if(this.z>a.z){this.z=a.z}if(this.w>a.w){this.w=a.w}return this},max:function(a){if(this.x<a.x){this.x=a.x}if(this.y<a.y){this.y=a.y}if(this.z<a.z){this.z=a.z}if(this.w<a.w){this.w=a.w}return this},clamp:function(b,a){if(this.x<b.x){this.x=b.x}else{if(this.x>a.x){this.x=a.x}}if(this.y<b.y){this.y=b.y}else{if(this.y>a.y){this.y=a.y}}if(this.z<b.z){this.z=b.z}else{if(this.z>a.z){this.z=a.z}}if(this.w<b.w){this.w=b.w}else{if(this.w>a.w){this.w=a.w}}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){var b=this.length();if(b!==0&&a!==b){this.multiplyScalar(a/b)}return this},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;this.w+=(a.w-this.w)*b;return this},equals:function(a){return((a.x===this.x)&&(a.y===this.y)&&(a.z===this.z)&&(a.w===this.w))},fromArray:function(a){this.x=a[0];this.y=a[1];this.z=a[2];this.w=a[3];return this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(b,d,c,a){this._x=b||0;this._y=d||0;this._z=c||0;this._order=a||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,_quaternion:undefined,_updateQuaternion:function(){if(this._quaternion!==undefined){this._quaternion.setFromEuler(this,false)}},get x(){return this._x},set x(a){this._x=a;this._updateQuaternion()},get y(){return this._y},set y(a){this._y=a;this._updateQuaternion()},get z(){return this._z},set z(a){this._z=a;this._updateQuaternion()},get order(){return this._order},set order(a){this._order=a;this._updateQuaternion()},set:function(b,d,c,a){this._x=b;this._y=d;this._z=c;this._order=a||this._order;this._updateQuaternion();return this},copy:function(a){this._x=a._x;this._y=a._y;this._z=a._z;this._order=a._order;this._updateQuaternion();return this},setFromRotationMatrix:function(e,f){function i(m){return Math.min(Math.max(m,-1),1)}var d=e.elements;var j=d[0],h=d[4],g=d[8];var c=d[1],b=d[5],a=d[9];var n=d[2],l=d[6],k=d[10];f=f||this._order;if(f==="XYZ"){this._y=Math.asin(i(g));if(Math.abs(g)<0.99999){this._x=Math.atan2(-a,k);this._z=Math.atan2(-h,j)}else{this._x=Math.atan2(l,b);this._z=0}}else{if(f==="YXZ"){this._x=Math.asin(-i(a));if(Math.abs(a)<0.99999){this._y=Math.atan2(g,k);this._z=Math.atan2(c,b)}else{this._y=Math.atan2(-n,j);this._z=0}}else{if(f==="ZXY"){this._x=Math.asin(i(l));if(Math.abs(l)<0.99999){this._y=Math.atan2(-n,k);this._z=Math.atan2(-h,b)}else{this._y=0;this._z=Math.atan2(c,j)}}else{if(f==="ZYX"){this._y=Math.asin(-i(n));if(Math.abs(n)<0.99999){this._x=Math.atan2(l,k);this._z=Math.atan2(c,j)}else{this._x=0;this._z=Math.atan2(-h,b)}}else{if(f==="YZX"){this._z=Math.asin(i(c));if(Math.abs(c)<0.99999){this._x=Math.atan2(-a,b);this._y=Math.atan2(-n,j)}else{this._x=0;this._y=Math.atan2(g,k)}}else{if(f==="XZY"){this._z=Math.asin(-i(h));if(Math.abs(h)<0.99999){this._x=Math.atan2(l,b);this._y=Math.atan2(g,j)}else{this._x=Math.atan2(-a,k);this._y=0}}else{console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+f)}}}}}}this._order=f;this._updateQuaternion();return this},setFromQuaternion:function(d,a,h){function g(i){return Math.min(Math.max(i,-1),1)}var e=d.x*d.x;var c=d.y*d.y;var b=d.z*d.z;var f=d.w*d.w;a=a||this._order;if(a==="XYZ"){this._x=Math.atan2(2*(d.x*d.w-d.y*d.z),(f-e-c+b));this._y=Math.asin(g(2*(d.x*d.z+d.y*d.w)));this._z=Math.atan2(2*(d.z*d.w-d.x*d.y),(f+e-c-b))}else{if(a==="YXZ"){this._x=Math.asin(g(2*(d.x*d.w-d.y*d.z)));this._y=Math.atan2(2*(d.x*d.z+d.y*d.w),(f-e-c+b));this._z=Math.atan2(2*(d.x*d.y+d.z*d.w),(f-e+c-b))}else{if(a==="ZXY"){this._x=Math.asin(g(2*(d.x*d.w+d.y*d.z)));this._y=Math.atan2(2*(d.y*d.w-d.z*d.x),(f-e-c+b));this._z=Math.atan2(2*(d.z*d.w-d.x*d.y),(f-e+c-b))}else{if(a==="ZYX"){this._x=Math.atan2(2*(d.x*d.w+d.z*d.y),(f-e-c+b));this._y=Math.asin(g(2*(d.y*d.w-d.x*d.z)));this._z=Math.atan2(2*(d.x*d.y+d.z*d.w),(f+e-c-b))}else{if(a==="YZX"){this._x=Math.atan2(2*(d.x*d.w-d.z*d.y),(f-e+c-b));this._y=Math.atan2(2*(d.y*d.w-d.x*d.z),(f+e-c-b));this._z=Math.asin(g(2*(d.x*d.y+d.z*d.w)))}else{if(a==="XZY"){this._x=Math.atan2(2*(d.x*d.w+d.y*d.z),(f-e+c-b));this._y=Math.atan2(2*(d.x*d.z+d.y*d.w),(f+e-c-b));this._z=Math.asin(g(2*(d.z*d.w-d.x*d.y)))}else{console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+a)}}}}}}this._order=a;if(h!==false){this._updateQuaternion()}return this},reorder:function(){var a=new THREE.Quaternion();return function(b){a.setFromEuler(this);this.setFromQuaternion(a,b)}}(),fromArray:function(a){this._x=a[0];this._y=a[1];this._z=a[2];if(a[3]!==undefined){this._order=a[3]}this._updateQuaternion();return this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(a){return(a._x===this._x)&&(a._y===this._y)&&(a._z===this._z)&&(a._order===this._order)},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(b,a){this.start=(b!==undefined)?b:new THREE.Vector3();this.end=(a!==undefined)?a:new THREE.Vector3()};THREE.Line3.prototype={constructor:THREE.Line3,set:function(b,a){this.start.copy(b);this.end.copy(a);return this},copy:function(a){this.start.copy(a.start);this.end.copy(a.end);return this},center:function(b){var a=b||new THREE.Vector3();return a.addVectors(this.start,this.end).multiplyScalar(0.5)},delta:function(b){var a=b||new THREE.Vector3();return a.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(c,b){var a=b||new THREE.Vector3();return this.delta(a).multiplyScalar(c).add(this.start)},closestPointToPointParameter:function(){var b=new THREE.Vector3();var a=new THREE.Vector3();return function(c,g){b.subVectors(c,this.start);a.subVectors(this.end,this.start);var f=a.dot(a);var e=a.dot(b);var d=e/f;if(g){d=THREE.Math.clamp(d,0,1)}return d}}(),closestPointToPoint:function(b,e,d){var c=this.closestPointToPointParameter(b,e);var a=d||new THREE.Vector3();return this.delta(a).multiplyScalar(c).add(this.start)},applyMatrix4:function(a){this.start.applyMatrix4(a);this.end.applyMatrix4(a);return this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)},clone:function(){return new THREE.Line3().copy(this)}};THREE.Box2=function(b,a){this.min=(b!==undefined)?b:new THREE.Vector2(Infinity,Infinity);this.max=(a!==undefined)?a:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(b,a){this.min.copy(b);this.max.copy(a);return this},setFromPoints:function(d){if(d.length>0){var a=d[0];this.min.copy(a);this.max.copy(a);for(var c=1,b=d.length;c<b;c++){a=d[c];if(a.x<this.min.x){this.min.x=a.x}else{if(a.x>this.max.x){this.max.x=a.x}}if(a.y<this.min.y){this.min.y=a.y}else{if(a.y>this.max.y){this.max.y=a.y}}}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var a=new THREE.Vector2();return function(b,d){var c=a.copy(d).multiplyScalar(0.5);this.min.copy(b).sub(c);this.max.copy(b).add(c);return this}}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return(this.max.x<this.min.x)||(this.max.y<this.min.y)},center:function(b){var a=b||new THREE.Vector2();return a.addVectors(this.min,this.max).multiplyScalar(0.5)},size:function(b){var a=b||new THREE.Vector2();return a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){if(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y){return false}return true},containsBox:function(a){if((this.min.x<=a.min.x)&&(a.max.x<=this.max.x)&&(this.min.y<=a.min.y)&&(a.max.y<=this.max.y)){return true}return false},getParameter:function(a){return new THREE.Vector2((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(a){if(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y){return false}return true},clampPoint:function(b,c){var a=c||new THREE.Vector2();return a.copy(b).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector2();return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length()}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return new THREE.Box2().copy(this)}};THREE.Box3=function(b,a){this.min=(b!==undefined)?b:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=(a!==undefined)?a:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(b,a){this.min.copy(b);this.max.copy(a);return this},addPoint:function(a){if(a.x<this.min.x){this.min.x=a.x}else{if(a.x>this.max.x){this.max.x=a.x}}if(a.y<this.min.y){this.min.y=a.y}else{if(a.y>this.max.y){this.max.y=a.y}}if(a.z<this.min.z){this.min.z=a.z}else{if(a.z>this.max.z){this.max.z=a.z}}},setFromPoints:function(d){if(d.length>0){var a=d[0];this.min.copy(a);this.max.copy(a);for(var c=1,b=d.length;c<b;c++){this.addPoint(d[c])}}else{this.makeEmpty()}return this},setFromCenterAndSize:function(){var a=new THREE.Vector3();return function(b,d){var c=a.copy(d).multiplyScalar(0.5);this.min.copy(b).sub(c);this.max.copy(b).add(c);return this}}(),setFromObject:function(){var a=new THREE.Vector3();return function(b){var c=this;b.updateMatrixWorld(true);this.makeEmpty();b.traverse(function(g){if(g.geometry!==undefined&&g.geometry.vertices!==undefined){var e=g.geometry.vertices;for(var f=0,d=e.length;f<d;f++){a.copy(e[f]);a.applyMatrix4(g.matrixWorld);c.expandByPoint(a)}}});return this}}(),copy:function(a){this.min.copy(a.min);this.max.copy(a.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return(this.max.x<this.min.x)||(this.max.y<this.min.y)||(this.max.z<this.min.z)},center:function(b){var a=b||new THREE.Vector3();return a.addVectors(this.min,this.max).multiplyScalar(0.5)},size:function(b){var a=b||new THREE.Vector3();return a.subVectors(this.max,this.min)},expandByPoint:function(a){this.min.min(a);this.max.max(a);return this},expandByVector:function(a){this.min.sub(a);this.max.add(a);return this},expandByScalar:function(a){this.min.addScalar(-a);this.max.addScalar(a);return this},containsPoint:function(a){if(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z){return false}return true},containsBox:function(a){if((this.min.x<=a.min.x)&&(a.max.x<=this.max.x)&&(this.min.y<=a.min.y)&&(a.max.y<=this.max.y)&&(this.min.z<=a.min.z)&&(a.max.z<=this.max.z)){return true}return false},getParameter:function(a){return new THREE.Vector3((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(a){if(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z){return false}return true},clampPoint:function(b,c){var a=c||new THREE.Vector3();return a.copy(b).clamp(this.min,this.max)},distanceToPoint:function(){var a=new THREE.Vector3();return function(b){var c=a.copy(b).clamp(this.min,this.max);return c.sub(b).length()}}(),getBoundingSphere:function(){var a=new THREE.Vector3();return function(c){var b=c||new THREE.Sphere();b.center=this.center();b.radius=this.size(a).length()*0.5;return b}}(),intersect:function(a){this.min.max(a.min);this.max.min(a.max);return this},union:function(a){this.min.min(a.min);this.max.max(a.max);return this},applyMatrix4:function(){var a=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];return function(b){a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b);a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b);a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b);a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b);a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b);a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b);a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b);a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b);this.makeEmpty();this.setFromPoints(a);return this}}(),translate:function(a){this.min.add(a);this.max.add(a);return this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)},clone:function(){return new THREE.Box3().copy(this)}};THREE.Matrix3=function(g,f,e,d,c,b,a,i,h){this.elements=new Float32Array(9);this.set((g!==undefined)?g:1,f||0,e||0,d||0,(c!==undefined)?c:1,b||0,a||0,i||0,(h!==undefined)?h:1)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(h,g,f,e,d,c,a,j,i){var b=this.elements;b[0]=h;b[3]=g;b[6]=f;b[1]=e;b[4]=d;b[7]=c;b[2]=a;b[5]=j;b[8]=i;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(a){var b=a.elements;this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);return this},multiplyVector3:function(a){console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return a.applyMatrix3(this)},multiplyVector3Array:function(){var a=new THREE.Vector3();return function(b){for(var d=0,c=b.length;d<c;d+=3){a.x=b[d];a.y=b[d+1];a.z=b[d+2];a.applyMatrix3(this);b[d]=a.x;b[d+1]=a.y;b[d+2]=a.z}return b}}(),multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[3]*=a;b[6]*=a;b[1]*=a;b[4]*=a;b[7]*=a;b[2]*=a;b[5]*=a;b[8]*=a;return this},determinant:function(){var j=this.elements;var s=j[0],r=j[1],q=j[2],p=j[3],o=j[4],n=j[5],m=j[6],l=j[7],k=j[8];return s*o*k-s*n*l-r*p*k+r*n*m+q*p*l-q*o*m},getInverse:function(b,a){var d=b.elements;var f=this.elements;f[0]=d[10]*d[5]-d[6]*d[9];f[1]=-d[10]*d[1]+d[2]*d[9];f[2]=d[6]*d[1]-d[2]*d[5];f[3]=-d[10]*d[4]+d[6]*d[8];f[4]=d[10]*d[0]-d[2]*d[8];f[5]=-d[6]*d[0]+d[2]*d[4];f[6]=d[9]*d[4]-d[5]*d[8];f[7]=-d[9]*d[0]+d[1]*d[8];f[8]=d[5]*d[0]-d[1]*d[4];var c=d[0]*f[0]+d[1]*f[3]+d[2]*f[6];if(c===0){var e="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(a||false){throw new Error(e)}else{console.warn(e)}this.identity();return this}this.multiplyScalar(1/c);return this},transpose:function(){var b,a=this.elements;b=a[1];a[1]=a[3];a[3]=b;b=a[2];a[2]=a[6];a[6]=b;b=a[5];a[5]=a[7];a[7]=b;return this},getNormalMatrix:function(a){this.getInverse(a).transpose();return this},transposeIntoArray:function(b){var a=this.elements;b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return this},clone:function(){var a=this.elements;return new THREE.Matrix3(a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8])}};THREE.Matrix4=function(n,m,k,i,f,e,d,c,a,q,p,o,l,j,h,g){this.elements=new Float32Array(16);var b=this.elements;b[0]=(n!==undefined)?n:1;b[4]=m||0;b[8]=k||0;b[12]=i||0;b[1]=f||0;b[5]=(e!==undefined)?e:1;b[9]=d||0;b[13]=c||0;b[2]=a||0;b[6]=q||0;b[10]=(p!==undefined)?p:1;b[14]=o||0;b[3]=l||0;b[7]=j||0;b[11]=h||0;b[15]=(g!==undefined)?g:1};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n,m,k,i,f,e,d,c,a,q,p,o,l,j,h,g){var b=this.elements;b[0]=n;b[4]=m;b[8]=k;b[12]=i;b[1]=f;b[5]=e;b[9]=d;b[13]=c;b[2]=a;b[6]=q;b[10]=p;b[14]=o;b[3]=l;b[7]=j;b[11]=h;b[15]=g;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(a){this.elements.set(a.elements);return this},extractPosition:function(a){console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(a)},copyPosition:function(a){var c=this.elements;var b=a.elements;c[12]=b[12];c[13]=b[13];c[14]=b[14];return this},extractRotation:function(){var a=new THREE.Vector3();return function(b){var g=this.elements;var f=b.elements;var e=1/a.set(f[0],f[1],f[2]).length();var d=1/a.set(f[4],f[5],f[6]).length();var c=1/a.set(f[8],f[9],f[10]).length();g[0]=f[0]*e;g[1]=f[1]*e;g[2]=f[2]*e;g[4]=f[4]*d;g[5]=f[5]*d;g[6]=f[6]*d;g[8]=f[8]*c;g[9]=f[9]*c;g[10]=f[10]*c;return this}}(),makeRotationFromEuler:function(o){if(o instanceof THREE.Euler===false){console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.")}var k=this.elements;var n=o.x,m=o.y,l=o.z;var G=Math.cos(n),F=Math.sin(n);var D=Math.cos(m),A=Math.sin(m);var t=Math.cos(l),r=Math.sin(l);if(o.order==="XYZ"){var v=G*t,s=G*r,h=F*t,g=F*r;k[0]=D*t;k[4]=-D*r;k[8]=A;k[1]=s+h*A;k[5]=v-g*A;k[9]=-F*D;k[2]=g-v*A;k[6]=h+s*A;k[10]=G*D}else{if(o.order==="YXZ"){var q=D*t,p=D*r,C=A*t,u=A*r;k[0]=q+u*F;k[4]=C*F-p;k[8]=G*A;k[1]=G*r;k[5]=G*t;k[9]=-F;k[2]=p*F-C;k[6]=u+q*F;k[10]=G*D}else{if(o.order==="ZXY"){var q=D*t,p=D*r,C=A*t,u=A*r;k[0]=q-u*F;k[4]=-G*r;k[8]=C+p*F;k[1]=p+C*F;k[5]=G*t;k[9]=u-q*F;k[2]=-G*A;k[6]=F;k[10]=G*D}else{if(o.order==="ZYX"){var v=G*t,s=G*r,h=F*t,g=F*r;k[0]=D*t;k[4]=h*A-s;k[8]=v*A+g;k[1]=D*r;k[5]=g*A+v;k[9]=s*A-h;k[2]=-A;k[6]=F*D;k[10]=G*D}else{if(o.order==="YZX"){var E=G*D,B=G*A,j=F*D,i=F*A;k[0]=D*t;k[4]=i-E*r;k[8]=j*r+B;k[1]=r;k[5]=G*t;k[9]=-F*t;k[2]=-A*t;k[6]=B*r+j;k[10]=E-i*r}else{if(o.order==="XZY"){var E=G*D,B=G*A,j=F*D,i=F*A;k[0]=D*t;k[4]=-r;k[8]=A*t;k[1]=E*r+i;k[5]=G*t;k[9]=B*r-j;k[2]=j*r-B;k[6]=F*t;k[10]=i*r+E}}}}}}k[3]=0;k[7]=0;k[11]=0;k[12]=0;k[13]=0;k[14]=0;k[15]=1;return this},setRotationFromQuaternion:function(a){console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code.");return this.makeRotationFromQuaternion(a)},makeRotationFromQuaternion:function(l){var e=this.elements;var h=l.x,g=l.y,f=l.z,i=l.w;var n=h+h,a=g+g,j=f+f;var d=h*n,c=h*a,b=h*j;var m=g*a,k=g*j,r=f*j;var s=i*n,p=i*a,o=i*j;e[0]=1-(m+r);e[4]=c-o;e[8]=b+p;e[1]=c+o;e[5]=1-(d+r);e[9]=k-s;e[2]=b-p;e[6]=k+s;e[10]=1-(d+m);e[3]=0;e[7]=0;e[11]=0;e[12]=0;e[13]=0;e[14]=0;e[15]=1;return this},lookAt:function(){var a=new THREE.Vector3();var c=new THREE.Vector3();var b=new THREE.Vector3();return function(e,f,d){var g=this.elements;b.subVectors(e,f).normalize();if(b.length()===0){b.z=1}a.crossVectors(d,b).normalize();if(a.length()===0){b.x+=0.0001;a.crossVectors(d,b).normalize()}c.crossVectors(b,a);g[0]=a.x;g[4]=c.x;g[8]=b.x;g[1]=a.y;g[5]=c.y;g[9]=b.y;g[2]=a.z;g[6]=c.z;g[10]=b.z;return this}}(),multiply:function(a,b){if(b!==undefined){console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(a,b)}return this.multiplyMatrices(this,a)},multiplyMatrices:function(Q,P){var s=Q.elements;var O=P.elements;var c=this.elements;var p=s[0],n=s[4],m=s[8],l=s[12];var N=s[1],M=s[5],L=s[9],K=s[13];var F=s[2],E=s[6],D=s[10],C=s[14];var t=s[3],r=s[7],q=s[11],o=s[15];var i=O[0],g=O[4],e=O[8],d=O[12];var J=O[1],I=O[5],H=O[9],G=O[13];var B=O[2],A=O[6],v=O[10],u=O[14];var k=O[3],j=O[7],h=O[11],f=O[15];c[0]=p*i+n*J+m*B+l*k;c[4]=p*g+n*I+m*A+l*j;c[8]=p*e+n*H+m*v+l*h;c[12]=p*d+n*G+m*u+l*f;c[1]=N*i+M*J+L*B+K*k;c[5]=N*g+M*I+L*A+K*j;c[9]=N*e+M*H+L*v+K*h;c[13]=N*d+M*G+L*u+K*f;c[2]=F*i+E*J+D*B+C*k;c[6]=F*g+E*I+D*A+C*j;c[10]=F*e+E*H+D*v+C*h;c[14]=F*d+E*G+D*u+C*f;c[3]=t*i+r*J+q*B+o*k;c[7]=t*g+r*I+q*A+o*j;c[11]=t*e+r*H+q*v+o*h;c[15]=t*d+r*G+q*u+o*f;return this},multiplyToArray:function(d,c,e){var f=this.elements;this.multiplyMatrices(d,c);e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[3];e[4]=f[4];e[5]=f[5];e[6]=f[6];e[7]=f[7];e[8]=f[8];e[9]=f[9];e[10]=f[10];e[11]=f[11];e[12]=f[12];e[13]=f[13];e[14]=f[14];e[15]=f[15];return this},multiplyScalar:function(a){var b=this.elements;b[0]*=a;b[4]*=a;b[8]*=a;b[12]*=a;b[1]*=a;b[5]*=a;b[9]*=a;b[13]*=a;b[2]*=a;b[6]*=a;b[10]*=a;b[14]*=a;b[3]*=a;b[7]*=a;b[11]*=a;b[15]*=a;return this},multiplyVector3:function(a){console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return a.applyProjection(this)},multiplyVector4:function(a){console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},multiplyVector3Array:function(){var a=new THREE.Vector3();return function(b){for(var d=0,c=b.length;d<c;d+=3){a.x=b[d];a.y=b[d+1];a.z=b[d+2];a.applyProjection(this);b[d]=a.x;b[d+1]=a.y;b[d+2]=a.z}return b}}(),rotateAxis:function(a){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");a.transformDirection(this)},crossVector:function(a){console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return a.applyMatrix4(this)},determinant:function(){var c=this.elements;var n=c[0],m=c[4],k=c[8],i=c[12];var f=c[1],e=c[5],d=c[9],b=c[13];var a=c[2],q=c[6],p=c[10],o=c[14];var l=c[3],j=c[7],h=c[11],g=c[15];return(l*(+i*d*q-k*b*q-i*e*p+m*b*p+k*e*o-m*d*o)+j*(+n*d*o-n*b*p+i*f*p-k*f*o+k*b*a-i*d*a)+h*(+n*b*q-n*e*o-i*f*q+m*f*o+i*e*a-m*b*a)+g*(-k*e*a-n*d*q+n*e*p+k*f*q-m*f*p+m*d*a))},transpose:function(){var b=this.elements;var a;a=b[1];b[1]=b[4];b[4]=a;a=b[2];b[2]=b[8];b[8]=a;a=b[6];b[6]=b[9];b[9]=a;a=b[3];b[3]=b[12];b[12]=a;a=b[7];b[7]=b[13];b[13]=a;a=b[11];b[11]=b[14];b[14]=a;return this},flattenToArray:function(b){var a=this.elements;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},flattenToArrayOffset:function(c,b){var a=this.elements;c[b]=a[0];c[b+1]=a[1];c[b+2]=a[2];c[b+3]=a[3];c[b+4]=a[4];c[b+5]=a[5];c[b+6]=a[6];c[b+7]=a[7];c[b+8]=a[8];c[b+9]=a[9];c[b+10]=a[10];c[b+11]=a[11];c[b+12]=a[12];c[b+13]=a[13];c[b+14]=a[14];c[b+15]=a[15];return c},getPosition:function(){var a=new THREE.Vector3();return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var b=this.elements;return a.set(b[12],b[13],b[14])}}(),setPosition:function(a){var b=this.elements;b[12]=a.x;b[13]=a.y;b[14]=a.z;return this},getInverse:function(r,h){var g=this.elements;var A=r.elements;var p=A[0],n=A[4],k=A[8],i=A[12];var v=A[1],u=A[5],t=A[9],s=A[13];var d=A[2],c=A[6],b=A[10],a=A[14];var q=A[3],o=A[7],l=A[11],j=A[15];g[0]=t*a*o-s*b*o+s*c*l-u*a*l-t*c*j+u*b*j;g[4]=i*b*o-k*a*o-i*c*l+n*a*l+k*c*j-n*b*j;g[8]=k*s*o-i*t*o+i*u*l-n*s*l-k*u*j+n*t*j;g[12]=i*t*c-k*s*c-i*u*b+n*s*b+k*u*a-n*t*a;g[1]=s*b*q-t*a*q-s*d*l+v*a*l+t*d*j-v*b*j;g[5]=k*a*q-i*b*q+i*d*l-p*a*l-k*d*j+p*b*j;g[9]=i*t*q-k*s*q-i*v*l+p*s*l+k*v*j-p*t*j;g[13]=k*s*d-i*t*d+i*v*b-p*s*b-k*v*a+p*t*a;g[2]=u*a*q-s*c*q+s*d*o-v*a*o-u*d*j+v*c*j;g[6]=i*c*q-n*a*q-i*d*o+p*a*o+n*d*j-p*c*j;g[10]=n*s*q-i*u*q+i*v*o-p*s*o-n*v*j+p*u*j;g[14]=i*u*d-n*s*d-i*v*c+p*s*c+n*v*a-p*u*a;g[3]=t*c*q-u*b*q-t*d*o+v*b*o+u*d*l-v*c*l;g[7]=n*b*q-k*c*q+k*d*o-p*b*o-n*d*l+p*c*l;g[11]=k*u*q-n*t*q-k*v*o+p*t*o+n*v*l-p*u*l;g[15]=n*t*d-k*u*d+k*v*c-p*t*c-n*v*b+p*u*b;var e=p*g[0]+v*g[4]+d*g[8]+q*g[12];if(e==0){var f="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(h||false){throw new Error(f)}else{console.warn(f)}this.identity();return this}this.multiplyScalar(1/e);return this},translate:function(a){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(a){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(a){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(a){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(a,b){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(b){var d=this.elements;var a=b.x,e=b.y,c=b.z;d[0]*=a;d[4]*=e;d[8]*=c;d[1]*=a;d[5]*=e;d[9]*=c;d[2]*=a;d[6]*=e;d[10]*=c;d[3]*=a;d[7]*=e;d[11]*=c;return this},getMaxScaleOnAxis:function(){var c=this.elements;var d=c[0]*c[0]+c[1]*c[1]+c[2]*c[2];var b=c[4]*c[4]+c[5]*c[5]+c[6]*c[6];var a=c[8]*c[8]+c[9]*c[9]+c[10]*c[10];return Math.sqrt(Math.max(d,Math.max(b,a)))},makeTranslation:function(a,c,b){this.set(1,0,0,a,0,1,0,c,0,0,1,b,0,0,0,1);return this},makeRotationX:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(1,0,0,0,0,d,-b,0,0,b,d,0,0,0,0,1);return this},makeRotationY:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(d,0,b,0,0,1,0,0,-b,0,d,0,0,0,0,1);return this},makeRotationZ:function(a){var d=Math.cos(a),b=Math.sin(a);this.set(d,-b,0,0,b,d,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(a,b){var f=Math.cos(b);var k=Math.sin(b);var j=1-f;var i=a.x,h=a.y,g=a.z;var e=j*i,d=j*h;this.set(e*i+f,e*h-k*g,e*g+k*h,0,e*h+k*g,d*h+f,d*g-k*i,0,e*g-k*h,d*g+k*i,j*g*g+f,0,0,0,0,1);return this},makeScale:function(a,c,b){this.set(a,0,0,0,0,c,0,0,0,0,b,0,0,0,0,1);return this},compose:function(a,b,c){this.makeRotationFromQuaternion(b);this.scale(c);this.setPosition(a);return this},decompose:function(){var a=new THREE.Vector3();var b=new THREE.Matrix4();return function(i,h,g){var f=this.elements;var l=a.set(f[0],f[1],f[2]).length();var k=a.set(f[4],f[5],f[6]).length();var j=a.set(f[8],f[9],f[10]).length();i.x=f[12];i.y=f[13];i.z=f[14];b.elements.set(this.elements);var e=1/l;var d=1/k;var c=1/j;b.elements[0]*=e;b.elements[1]*=e;b.elements[2]*=e;b.elements[4]*=d;b.elements[5]*=d;b.elements[6]*=d;b.elements[8]*=c;b.elements[9]*=c;b.elements[10]*=c;h.setFromRotationMatrix(b);g.x=l;g.y=k;g.z=j;return this}}(),makeFrustum:function(g,q,e,n,i,h){var f=this.elements;var p=2*i/(q-g);var m=2*i/(n-e);var o=(q+g)/(q-g);var l=(n+e)/(n-e);var k=-(h+i)/(h-i);var j=-2*h*i/(h-i);f[0]=p;f[4]=0;f[8]=o;f[12]=0;f[1]=0;f[5]=m;f[9]=l;f[13]=0;f[2]=0;f[6]=0;f[10]=k;f[14]=j;f[3]=0;f[7]=0;f[11]=-1;f[15]=0;return this},makePerspective:function(e,c,g,b){var a=g*Math.tan(THREE.Math.degToRad(e*0.5));var f=-a;var h=f*c;var d=a*c;return this.makeFrustum(h,d,f,a,g,b)},makeOrthographic:function(d,n,k,a,g,f){var c=this.elements;var m=n-d;var e=k-a;var b=f-g;var l=(n+d)/m;var j=(k+a)/e;var i=(f+g)/b;c[0]=2/m;c[4]=0;c[8]=0;c[12]=-l;c[1]=0;c[5]=2/e;c[9]=0;c[13]=-j;c[2]=0;c[6]=0;c[10]=-2/b;c[14]=-i;c[3]=0;c[7]=0;c[11]=0;c[15]=1;return this},fromArray:function(a){this.elements.set(a);return this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}};THREE.Ray=function(a,b){this.origin=(a!==undefined)?a:new THREE.Vector3();this.direction=(b!==undefined)?b:new THREE.Vector3()};THREE.Ray.prototype={constructor:THREE.Ray,set:function(a,b){this.origin.copy(a);this.direction.copy(b);return this},copy:function(a){this.origin.copy(a.origin);this.direction.copy(a.direction);return this},at:function(c,b){var a=b||new THREE.Vector3();return a.copy(this.direction).multiplyScalar(c).add(this.origin)},recast:function(){var a=new THREE.Vector3();return function(b){this.origin.copy(this.at(b,a));return this}}(),closestPointToPoint:function(b,c){var a=c||new THREE.Vector3();a.subVectors(b,this.origin);var d=a.dot(this.direction);if(d<0){return a.copy(this.origin)}return a.copy(this.direction).multiplyScalar(d).add(this.origin)},distanceToPoint:function(){var a=new THREE.Vector3();return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);if(c<0){return this.origin.distanceTo(b)}a.copy(this.direction).multiplyScalar(c).add(this.origin);return a.distanceTo(b)}}(),distanceSqToSegment:function(f,e,l,i){var m=f.clone().add(e).multiplyScalar(0.5);var p=e.clone().sub(f).normalize();var a=f.distanceTo(e)*0.5;var n=this.origin.clone().sub(m);var s=-this.direction.dot(p);var k=n.dot(this.direction);var j=-n.dot(p);var r=n.lengthSq();var h=Math.abs(1-s*s);var d,b,o,g;if(h>=0){d=s*j-k;b=s*k-j;g=a*h;if(d>=0){if(b>=-g){if(b<=g){var q=1/h;d*=q;b*=q;o=d*(d+s*b+2*k)+b*(s*d+b+2*j)+r}else{b=a;d=Math.max(0,-(s*b+k));o=-d*d+b*(b+2*j)+r}}else{b=-a;d=Math.max(0,-(s*b+k));o=-d*d+b*(b+2*j)+r}}else{if(b<=-g){d=Math.max(0,-(-s*a+k));b=(d>0)?-a:Math.min(Math.max(-a,-j),a);o=-d*d+b*(b+2*j)+r}else{if(b<=g){d=0;b=Math.min(Math.max(-a,-j),a);o=b*(b+2*j)+r}else{d=Math.max(0,-(s*a+k));b=(d>0)?a:Math.min(Math.max(-a,-j),a);o=-d*d+b*(b+2*j)+r}}}}else{b=(s>0)?-a:a;d=Math.max(0,-(s*b+k));o=-d*d+b*(b+2*j)+r}if(l){l.copy(this.direction.clone().multiplyScalar(d).add(this.origin))}if(i){i.copy(p.clone().multiplyScalar(b).add(m))}return o},isIntersectionSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},isIntersectionPlane:function(a){var b=a.distanceToPoint(this.origin);if(b===0){return true}var c=a.normal.dot(this.direction);if(c*b<0){return true}return false},distanceToPlane:function(a){var c=a.normal.dot(this.direction);if(c==0){if(a.distanceToPoint(this.origin)==0){return 0}return null}var b=-(this.origin.dot(a.normal)+a.constant)/c;return b>=0?b:null},intersectPlane:function(a,c){var b=this.distanceToPlane(a);if(b===null){return null}return this.at(b,c)},isIntersectionBox:function(){var a=new THREE.Vector3();return function(b){return this.intersectBox(b,a)!==null}}(),intersectBox:function(f,l){var c,g,i,a,h,k;var e=1/this.direction.x,d=1/this.direction.y,b=1/this.direction.z;var j=this.origin;if(e>=0){c=(f.min.x-j.x)*e;g=(f.max.x-j.x)*e}else{c=(f.max.x-j.x)*e;g=(f.min.x-j.x)*e}if(d>=0){i=(f.min.y-j.y)*d;a=(f.max.y-j.y)*d}else{i=(f.max.y-j.y)*d;a=(f.min.y-j.y)*d}if((c>a)||(i>g)){return null}if(i>c||c!==c){c=i}if(a<g||g!==g){g=a}if(b>=0){h=(f.min.z-j.z)*b;k=(f.max.z-j.z)*b}else{h=(f.max.z-j.z)*b;k=(f.min.z-j.z)*b}if((c>k)||(h>g)){return null}if(h>c||c!==c){c=h}if(k<g||g!==g){g=k}if(g<0){return null}return this.at(c>=0?c:g,l)},intersectTriangle:function(){var d=new THREE.Vector3();var b=new THREE.Vector3();var a=new THREE.Vector3();var c=new THREE.Vector3();return function(m,k,j,e,n){b.subVectors(k,m);a.subVectors(j,m);c.crossVectors(b,a);var i=this.direction.dot(c);var f;if(i>0){if(e){return null}f=1}else{if(i<0){f=-1;i=-i}else{return null}}d.subVectors(this.origin,m);var l=f*this.direction.dot(a.crossVectors(d,a));if(l<0){return null}var g=f*this.direction.dot(b.cross(d));if(g<0){return null}if(l+g>i){return null}var h=-f*d.dot(c);if(h<0){return null}return this.at(h/i,n)}}(),applyMatrix4:function(a){this.direction.add(this.origin).applyMatrix4(a);this.origin.applyMatrix4(a);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)},clone:function(){return new THREE.Ray().copy(this)}};THREE.Sphere=function(b,a){this.center=(b!==undefined)?b:new THREE.Vector3();this.radius=(a!==undefined)?a:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(b,a){this.center.copy(b);this.radius=a;return this},setFromPoints:function(){var a=new THREE.Box3();return function(f,g){var b=this.center;if(g!==undefined){b.copy(g)}else{a.setFromPoints(f).center(b)}var c=0;for(var e=0,d=f.length;e<d;e++){c=Math.max(c,b.distanceToSquared(f[e]))}this.radius=Math.sqrt(c);return this}}(),copy:function(a){this.center.copy(a.center);this.radius=a.radius;return this},empty:function(){return(this.radius<=0)},containsPoint:function(a){return(a.distanceToSquared(this.center)<=(this.radius*this.radius))},distanceToPoint:function(a){return(a.distanceTo(this.center)-this.radius)},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=(b*b)},clampPoint:function(b,d){var c=this.center.distanceToSquared(b);var a=d||new THREE.Vector3();a.copy(b);if(c>(this.radius*this.radius)){a.sub(this.center).normalize();a.multiplyScalar(this.radius).add(this.center)}return a},getBoundingBox:function(a){var b=a||new THREE.Box3();b.set(this.center,this.center);b.expandByScalar(this.radius);return b},applyMatrix4:function(a){this.center.applyMatrix4(a);this.radius=this.radius*a.getMaxScaleOnAxis();return this},translate:function(a){this.center.add(a);return this},equals:function(a){return a.center.equals(this.center)&&(a.radius===this.radius)},clone:function(){return new THREE.Sphere().copy(this)}};THREE.Frustum=function(f,e,d,c,b,a){this.planes=[(f!==undefined)?f:new THREE.Plane(),(e!==undefined)?e:new THREE.Plane(),(d!==undefined)?d:new THREE.Plane(),(c!==undefined)?c:new THREE.Plane(),(b!==undefined)?b:new THREE.Plane(),(a!==undefined)?a:new THREE.Plane()]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(g,f,e,d,c,b){var a=this.planes;a[0].copy(g);a[1].copy(f);a[2].copy(e);a[3].copy(d);a[4].copy(c);a[5].copy(b);return this},copy:function(c){var a=this.planes;for(var b=0;b<6;b++){a[b].copy(c.planes[b])}return this},setFromMatrix:function(o){var h=this.planes;var t=o.elements;var l=t[0],j=t[1],i=t[2],g=t[3];var f=t[4],e=t[5],d=t[6],c=t[7];var b=t[8],a=t[9],s=t[10],r=t[11];var q=t[12],p=t[13],n=t[14],k=t[15];h[0].setComponents(g-l,c-f,r-b,k-q).normalize();h[1].setComponents(g+l,c+f,r+b,k+q).normalize();h[2].setComponents(g+j,c+e,r+a,k+p).normalize();h[3].setComponents(g-j,c-e,r-a,k-p).normalize();h[4].setComponents(g-i,c-d,r-s,k-n).normalize();h[5].setComponents(g+i,c+d,r+s,k+n).normalize();return this},intersectsObject:function(){var a=new THREE.Sphere();return function(b){var c=b.geometry;if(c.boundingSphere===null){c.computeBoundingSphere()}a.copy(c.boundingSphere);a.applyMatrix4(b.matrixWorld);return this.intersectsSphere(a)}}(),intersectsSphere:function(c){var d=this.planes;var a=c.center;var b=-c.radius;for(var e=0;e<6;e++){var f=d[e].distanceToPoint(a);if(f<b){return false}}return true},intersectsBox:function(){var b=new THREE.Vector3(),a=new THREE.Vector3();return function(g){var d=this.planes;for(var e=0;e<6;e++){var c=d[e];b.x=c.normal.x>0?g.min.x:g.max.x;a.x=c.normal.x>0?g.max.x:g.min.x;b.y=c.normal.y>0?g.min.y:g.max.y;a.y=c.normal.y>0?g.max.y:g.min.y;b.z=c.normal.z>0?g.min.z:g.max.z;a.z=c.normal.z>0?g.max.z:g.min.z;var h=c.distanceToPoint(b);var f=c.distanceToPoint(a);if(h<0&&f<0){return false}}return true}}(),containsPoint:function(a){var b=this.planes;for(var c=0;c<6;c++){if(b[c].distanceToPoint(a)<0){return false}}return true},clone:function(){return new THREE.Frustum().copy(this)}};THREE.Plane=function(b,a){this.normal=(b!==undefined)?b:new THREE.Vector3(1,0,0);this.constant=(a!==undefined)?a:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(b,a){this.normal.copy(b);this.constant=a;return this},setComponents:function(a,d,c,b){this.normal.set(a,d,c);this.constant=b;return this},setFromNormalAndCoplanarPoint:function(b,a){this.normal.copy(b);this.constant=-a.dot(this.normal);return this},setFromCoplanarPoints:function(){var b=new THREE.Vector3();var a=new THREE.Vector3();return function(e,d,g){var f=b.subVectors(g,d).cross(a.subVectors(e,d)).normalize();this.setFromNormalAndCoplanarPoint(f,e);return this}}(),copy:function(a){this.normal.copy(a.normal);this.constant=a.constant;return this},normalize:function(){var a=1/this.normal.length();this.normal.multiplyScalar(a);this.constant*=a;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(b,d){var c=this.distanceToPoint(b);var a=d||new THREE.Vector3();return a.copy(this.normal).multiplyScalar(c)},isIntersectionLine:function(a){var c=this.distanceToPoint(a.start);var b=this.distanceToPoint(a.end);return(c<0&&b>0)||(b<0&&c>0)},intersectLine:function(){var a=new THREE.Vector3();return function(c,e){var b=e||new THREE.Vector3();var f=c.delta(a);var g=this.normal.dot(f);if(g==0){if(this.distanceToPoint(c.start)==0){return b.copy(c.start)}return undefined}var d=-(c.start.dot(this.normal)+this.constant)/g;if(d<0||d>1){return undefined}return b.copy(f).multiplyScalar(d).add(c.start)}}(),coplanarPoint:function(b){var a=b||new THREE.Vector3();return a.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var b=new THREE.Vector3();var a=new THREE.Vector3();return function(d,e){e=e||new THREE.Matrix3().getNormalMatrix(d);var f=b.copy(this.normal).applyMatrix3(e);var c=this.coplanarPoint(a);c.applyMatrix4(d);this.setFromNormalAndCoplanarPoint(f,c);return this}}(),translate:function(a){this.constant=this.constant-a.dot(this.normal);return this},equals:function(a){return a.normal.equals(this.normal)&&(a.constant==this.constant)},clone:function(){return new THREE.Plane().copy(this)}};THREE.Math={PI2:Math.PI*2,generateUUID:function(){var d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var b=new Array(36);var a=0,c;return function(){for(var e=0;e<36;e++){if(e==8||e==13||e==18||e==23){b[e]="-"}else{if(e==14){b[e]="4"}else{if(a<=2){a=33554432+(Math.random()*16777216)|0}c=a&15;a=a>>4;b[e]=d[(e==19)?(c&3)|8:c]}}}return b.join("")}}(),clamp:function(d,e,c){return(d<e)?e:((d>c)?c:d)},clampBottom:function(b,c){return b<c?c:b},mapLinear:function(b,c,a,e,d){return e+(b-c)*(d-e)/(a-c)},smoothstep:function(b,c,a){if(b<=c){return 0}if(b>=a){return 1}b=(b-c)/(a-c);return b*b*(3-2*b)},smootherstep:function(b,c,a){if(b<=c){return 0}if(b>=a){return 1}b=(b-c)/(a-c);return b*b*b*(b*(b*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(0.5-Math.random())},sign:function(a){return(a<0)?-1:((a>0)?1:0)},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}()};THREE.Spline=function(n){this.points=n;var h=[],j={x:0,y:0,z:0},m,a,e,d,b,l,k,i,g;this.initFromArray=function(c){this.points=[];for(var o=0;o<c.length;o++){this.points[o]={x:c[o][0],y:c[o][1],z:c[o][2]}}};this.getPoint=function(c){m=(this.points.length-1)*c;a=Math.floor(m);e=m-a;h[0]=a===0?a:a-1;h[1]=a;h[2]=a>this.points.length-2?this.points.length-1:a+1;h[3]=a>this.points.length-3?this.points.length-1:a+2;l=this.points[h[0]];k=this.points[h[1]];i=this.points[h[2]];g=this.points[h[3]];d=e*e;b=e*d;j.x=f(l.x,k.x,i.x,g.x,e,d,b);j.y=f(l.y,k.y,i.y,g.y,e,d,b);j.z=f(l.z,k.z,i.z,g.z,e,d,b);return j};this.getControlPointsArray=function(){var o,r,c=this.points.length,q=[];for(o=0;o<c;o++){r=this.points[o];q[o]=[r.x,r.y,r.z]}return q};this.getLength=function(p){var r,t,u,s,B=0,c=0,q=0,A=new THREE.Vector3(),o=new THREE.Vector3(),v=[],C=0;v[0]=0;if(!p){p=100}u=this.points.length*p;A.copy(this.points[0]);for(r=1;r<u;r++){t=r/u;s=this.getPoint(t);o.copy(s);C+=o.distanceTo(A);A.copy(s);B=(this.points.length-1)*t;c=Math.floor(B);if(c!=q){v[c]=C;q=c}}v[v.length]=C;return{chunks:v,total:C}};this.reparametrizeByArcLength=function(p){var t,s,A,B,q,o,C,v,u,D=[],c=new THREE.Vector3(),r=this.getLength();D.push(c.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){C=r.chunks[t]-r.chunks[t-1];v=Math.ceil(p*C/r.total);B=(t-1)/(this.points.length-1);q=t/(this.points.length-1);for(s=1;s<v-1;s++){A=B+s*(1/v)*(q-B);u=this.getPoint(A);D.push(c.copy(u).clone())}D.push(c.copy(this.points[t]).clone())}this.points=D};function f(v,u,r,q,A,o,c){var s=(r-v)*0.5,p=(q-u)*0.5;return(2*(u-r)+s+p)*c+(-3*(u-r)-2*s-p)*o+s*A+u}};THREE.Triangle=function(e,d,f){this.a=(e!==undefined)?e:new THREE.Vector3();this.b=(d!==undefined)?d:new THREE.Vector3();this.c=(f!==undefined)?f:new THREE.Vector3()};THREE.Triangle.normal=function(){var a=new THREE.Vector3();return function(g,e,i,h){var d=h||new THREE.Vector3();d.subVectors(i,e);a.subVectors(g,e);d.cross(a);var f=d.lengthSq();if(f>0){return d.multiplyScalar(1/Math.sqrt(f))}return d.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var a=new THREE.Vector3();var c=new THREE.Vector3();var b=new THREE.Vector3();return function(n,m,k,h,r){a.subVectors(h,m);c.subVectors(k,m);b.subVectors(n,m);var l=a.dot(a);var j=a.dot(c);var i=a.dot(b);var f=c.dot(c);var d=c.dot(b);var g=(l*f-j*j);var q=r||new THREE.Vector3();if(g==0){return q.set(-2,-1,-1)}var e=1/g;var p=(f*i-j*d)*e;var o=(l*d-j*i)*e;return q.set(1-p-o,o,p)}}();THREE.Triangle.containsPoint=function(){var a=new THREE.Vector3();return function(f,g,e,h){var d=THREE.Triangle.barycoordFromPoint(f,g,e,h,a);return(d.x>=0)&&(d.y>=0)&&((d.x+d.y)<=1)}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,d,f){this.a.copy(e);this.b.copy(d);this.c.copy(f);return this},setFromPointsAndIndices:function(b,d,c,a){this.a.copy(b[d]);this.b.copy(b[c]);this.c.copy(b[a]);return this},copy:function(a){this.a.copy(a.a);this.b.copy(a.b);this.c.copy(a.c);return this},area:function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(){a.subVectors(this.c,this.b);b.subVectors(this.a,this.b);return a.cross(b).length()*0.5}}(),midpoint:function(b){var a=b||new THREE.Vector3();return a.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return THREE.Triangle.normal(this.a,this.b,this.c,a)},plane:function(b){var a=b||new THREE.Plane();return a.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return THREE.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return THREE.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)},clone:function(){return new THREE.Triangle().copy(this)}};THREE.Vertex=function(a){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.");return a};THREE.UV=function(b,a){console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead.");return new THREE.Vector2(b,a)};THREE.Clock=function(a){this.autoStart=(a!==undefined)?a:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var b=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var a=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();b=0.001*(a-this.oldTime);this.oldTime=a;this.elapsedTime+=b}return b}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(a){a.addEventListener=THREE.EventDispatcher.prototype.addEventListener;a.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;a.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;a.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(b,c){if(this._listeners===undefined){this._listeners={}}var a=this._listeners;if(a[b]===undefined){a[b]=[]}if(a[b].indexOf(c)===-1){a[b].push(c)}},hasEventListener:function(b,c){if(this._listeners===undefined){return false}var a=this._listeners;if(a[b]!==undefined&&a[b].indexOf(c)!==-1){return true}return false},removeEventListener:function(c,d){if(this._listeners===undefined){return}var b=this._listeners;var a=b[c].indexOf(d);if(a!==-1){b[c].splice(a,1)}},dispatchEvent:function(){var a=[];return function(f){if(this._listeners===undefined){return}var d=this._listeners;var b=d[f.type];if(b!==undefined){f.target=this;var e=b.length;for(var c=0;c<e;c++){a[c]=b[c]}for(var c=0;c<e;c++){a[c].call(this,f)}}}}()};(function(i){i.Raycaster=function(o,q,p,n){this.ray=new i.Ray(o,q);this.near=p||0;this.far=n||Infinity};var e=new i.Sphere();var f=new i.Ray();var j=new i.Plane();var l=new i.Vector3();var h=new i.Vector3();var k=new i.Matrix4();var d=function(o,n){return o.distance-n.distance};var c=new i.Vector3();var b=new i.Vector3();var a=new i.Vector3();var g=function(Y,K,n){if(Y instanceof i.Sprite){h.getPositionFromMatrix(Y.matrixWorld);var q=K.ray.distanceToPoint(h);if(q>Y.scale.x){return n}n.push({distance:q,point:Y.position,face:null,object:Y})}else{if(Y instanceof i.LOD){h.getPositionFromMatrix(Y.matrixWorld);var q=K.ray.origin.distanceTo(h);g(Y.getObjectForDistance(q),K,n)}else{if(Y instanceof i.Mesh){var t=Y.geometry;if(t.boundingSphere===null){t.computeBoundingSphere()}e.copy(t.boundingSphere);e.applyMatrix4(Y.matrixWorld);if(K.ray.isIntersectionSphere(e)===false){return n}k.getInverse(Y.matrixWorld);f.copy(K.ray).applyMatrix4(k);if(t.boundingBox!==null){if(f.isIntersectionBox(t.boundingBox)===false){return n}}if(t instanceof i.BufferGeometry){var I=Y.material;if(I===undefined){return n}if(t.dynamic===false){return n}var V,U,T;var P=K.precision;if(t.attributes.index!==undefined){var v=t.offsets;var u=t.attributes.index.array;var E=t.attributes.position.array;var S=t.offsets.length;var G=t.attributes.index.array.length/3;for(var J=0;J<S;++J){var r=v[J].start;var D=v[J].count;var C=v[J].index;for(var O=r,H=r+D;O<H;O+=3){V=C+u[O];U=C+u[O+1];T=C+u[O+2];c.set(E[V*3],E[V*3+1],E[V*3+2]);b.set(E[U*3],E[U*3+1],E[U*3+2]);a.set(E[T*3],E[T*3+1],E[T*3+2]);if(I.side===i.BackSide){var N=f.intersectTriangle(a,b,c,true)}else{var N=f.intersectTriangle(c,b,a,I.side!==i.DoubleSide)}if(N===null){continue}N.applyMatrix4(Y.matrixWorld);var q=K.ray.origin.distanceTo(N);if(q<P||q<K.near||q>K.far){continue}n.push({distance:q,point:N,face:null,faceIndex:null,object:Y})}}}else{var v=t.offsets;var E=t.attributes.position.array;var S=t.offsets.length;var G=t.attributes.position.array.length;for(var O=0;O<G;O+=3){V=O;U=O+1;T=O+2;c.set(E[V*3],E[V*3+1],E[V*3+2]);b.set(E[U*3],E[U*3+1],E[U*3+2]);a.set(E[T*3],E[T*3+1],E[T*3+2]);if(I.side===i.BackSide){var N=f.intersectTriangle(a,b,c,true)}else{var N=f.intersectTriangle(c,b,a,I.side!==i.DoubleSide)}if(N===null){continue}N.applyMatrix4(Y.matrixWorld);var q=K.ray.origin.distanceTo(N);if(q<P||q<K.near||q>K.far){continue}n.push({distance:q,point:N,face:null,faceIndex:null,object:Y})}}}else{if(t instanceof i.Geometry){var p=Y.material instanceof i.MeshFaceMaterial;var M=p===true?Y.material.materials:null;var V,U,T,R;var P=K.precision;var B=t.vertices;for(var Q=0,G=t.faces.length;Q<G;Q++){var F=t.faces[Q];var I=p===true?M[F.materialIndex]:Y.material;if(I===undefined){continue}V=B[F.a];U=B[F.b];T=B[F.c];if(I.side===i.BackSide){var N=f.intersectTriangle(T,U,V,true)}else{var N=f.intersectTriangle(V,U,T,I.side!==i.DoubleSide)}if(N===null){continue}N.applyMatrix4(Y.matrixWorld);var q=K.ray.origin.distanceTo(N);if(q<P||q<K.near||q>K.far){continue}n.push({distance:q,point:N,face:F,faceIndex:Q,object:Y})}}}}else{if(Y instanceof i.Line){var P=K.linePrecision;var X=P*P;var t=Y.geometry;if(t.boundingSphere===null){t.computeBoundingSphere()}e.copy(t.boundingSphere);e.applyMatrix4(Y.matrixWorld);if(K.ray.isIntersectionSphere(e)===false){return n}k.getInverse(Y.matrixWorld);f.copy(K.ray).applyMatrix4(k);if(t instanceof i.Geometry){var B=t.vertices;var W=B.length;var s=new i.Vector3();var L=new i.Vector3();var A=Y.type===i.LineStrip?1:2;for(var O=0;O<W-1;O=O+A){var o=f.distanceSqToSegment(B[O],B[O+1],L,s);if(o>X){continue}var q=f.origin.distanceTo(L);if(q<K.near||q>K.far){continue}n.push({distance:q,point:s.clone().applyMatrix4(Y.matrixWorld),face:null,faceIndex:null,object:Y})}}}}}}};var m=function(p,o,r){var s=p.getDescendants();for(var q=0,n=s.length;q<n;q++){g(s[q],o,r)}};i.Raycaster.prototype.precision=0.0001;i.Raycaster.prototype.linePrecision=1;i.Raycaster.prototype.set=function(n,o){this.ray.set(n,o)};i.Raycaster.prototype.intersectObject=function(o,n){var p=[];if(n===true){m(o,this,p)}g(o,this,p);p.sort(d);return p};i.Raycaster.prototype.intersectObjects=function(r,o){var q=[];for(var p=0,n=r.length;p<n;p++){g(r[p],this,q);if(o===true){m(r[p],this,q)}}q.sort(d);return q}}(THREE));THREE.Object3D=function(){this.id=THREE.Object3DIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3();this._rotation=new THREE.Euler();this._quaternion=new THREE.Quaternion();this.scale=new THREE.Vector3(1,1,1);this._rotation._quaternion=this.quaternion;this._quaternion._euler=this.rotation;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4();this.matrixWorld=new THREE.Matrix4();this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.userData={}};THREE.Object3D.prototype={constructor:THREE.Object3D,get rotation(){return this._rotation},set rotation(a){this._rotation=a;this._rotation._quaternion=this._quaternion;this._quaternion._euler=this._rotation;this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(a){this._quaternion=a;this._quaternion._euler=this._rotation;this._rotation._quaternion=this._quaternion;this._quaternion._updateEuler()},get eulerOrder(){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order.");return this.rotation.order},set eulerOrder(a){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order.");this.rotation.order=a},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(a){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(){var a=new THREE.Matrix4();return function(b){this.matrix.multiplyMatrices(b,this.matrix);this.position.getPositionFromMatrix(this.matrix);this.scale.getScaleFromMatrix(this.matrix);a.extractRotation(this.matrix);this.quaternion.setFromRotationMatrix(a)}}(),setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,true)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new THREE.Quaternion();return function(b,c){a.setFromAxisAngle(b,c);this.quaternion.multiply(a);return this}}(),rotateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new THREE.Vector3();return function(b,c){a.copy(b);a.applyQuaternion(this.quaternion);this.position.add(a.multiplyScalar(c));return this}}(),translate:function(b,a){console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed.");return this.translateOnAxis(a,b)},translateX:function(){var a=new THREE.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new THREE.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new THREE.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new THREE.Matrix4();return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new THREE.Matrix4();return function(b){a.lookAt(b,this.position,this.up);this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(a===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(a instanceof THREE.Object3D){if(a.parent!==undefined){a.parent.remove(a)}a.parent=this;a.dispatchEvent({type:"added"});this.children.push(a);var b=this;while(b.parent!==undefined){b=b.parent}if(b!==undefined&&b instanceof THREE.Scene){b.__addObject(a)}}},remove:function(b){var a=this.children.indexOf(b);if(a!==-1){b.parent=undefined;b.dispatchEvent({type:"removed"});this.children.splice(a,1);var c=this;while(c.parent!==undefined){c=c.parent}if(c!==undefined&&c instanceof THREE.Scene){c.__removeObject(b)}}},traverse:function(c){c(this);for(var b=0,a=this.children.length;b<a;b++){this.children[b].traverse(c)}},getObjectById:function(e,b){for(var c=0,a=this.children.length;c<a;c++){var d=this.children[c];if(d.id===e){return d}if(b===true){d=d.getObjectById(e,b);if(d!==undefined){return d}}}return undefined},getObjectByName:function(c,b){for(var d=0,a=this.children.length;d<a;d++){var e=this.children[d];if(e.name===c){return e}if(b===true){e=e.getObjectByName(c,b);if(e!==undefined){return e}}}return undefined},getChildByName:function(b,a){console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(b,a)},getDescendants:function(c){if(c===undefined){c=[]}Array.prototype.push.apply(c,this.children);for(var b=0,a=this.children.length;b<a;b++){this.children[b].getDescendants(c)}return c},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(c){if(this.matrixAutoUpdate===true){this.updateMatrix()}if(this.matrixWorldNeedsUpdate===true||c===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;c=true}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(c)}},clone:function(b,a){if(b===undefined){b=new THREE.Object3D()}if(a===undefined){a=true}b.name=this.name;b.up.copy(this.up);b.position.copy(this.position);b.quaternion.copy(this.quaternion);b.scale.copy(this.scale);b.renderDepth=this.renderDepth;b.rotationAutoUpdate=this.rotationAutoUpdate;b.matrix.copy(this.matrix);b.matrixWorld.copy(this.matrixWorld);b.matrixAutoUpdate=this.matrixAutoUpdate;b.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;b.visible=this.visible;b.castShadow=this.castShadow;b.receiveShadow=this.receiveShadow;b.frustumCulled=this.frustumCulled;b.userData=JSON.parse(JSON.stringify(this.userData));if(a===true){for(var c=0;c<this.children.length;c++){var d=this.children[c];b.add(d.clone())}}return b}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Projector=function(){var X,I,O=[],p=0,C,c,f=[],b=0,l,Q,N=[],j=0,i,T,V=[],A=0,E,t,e=[],W=0,L={objects:[],sprites:[],lights:[],elements:[]},M=new THREE.Vector3(),K=new THREE.Vector4(),u=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),Y=new THREE.Box3(),S=new Array(3),R=new Array(4),a=new THREE.Matrix4(),g=new THREE.Matrix4(),F,H=new THREE.Matrix4(),r=new THREE.Matrix3(),q=new THREE.Matrix3(),d=new THREE.Vector3(),U=new THREE.Frustum(),v=new THREE.Vector4(),h=new THREE.Vector4();this.projectVector=function(Z,aa){aa.matrixWorldInverse.getInverse(aa.matrixWorld);g.multiplyMatrices(aa.projectionMatrix,aa.matrixWorldInverse);return Z.applyProjection(g)};this.unprojectVector=function(Z,aa){aa.projectionMatrixInverse.getInverse(aa.projectionMatrix);g.multiplyMatrices(aa.matrixWorld,aa.projectionMatrixInverse);return Z.applyProjection(g)};this.pickingRay=function(aa,ab){aa.z=-1;var Z=new THREE.Vector3(aa.x,aa.y,1);this.unprojectVector(aa,ab);this.unprojectVector(Z,ab);Z.sub(aa).normalize();return new THREE.Raycaster(aa,Z)};var o=function(Z){X=n();X.id=Z.id;X.object=Z;if(Z.renderDepth!==null){X.z=Z.renderDepth}else{M.getPositionFromMatrix(Z.matrixWorld);M.applyProjection(g);X.z=M.z}return X};var G=function(aa){if(aa.visible===false){return}if(aa instanceof THREE.Light){L.lights.push(aa)}else{if(aa instanceof THREE.Mesh||aa instanceof THREE.Line){if(aa.frustumCulled===false||U.intersectsObject(aa)===true){L.objects.push(o(aa))}}else{if(aa instanceof THREE.Sprite){L.sprites.push(o(aa))}}}for(var ab=0,Z=aa.children.length;ab<Z;ab++){G(aa.children[ab])}};var P=function(Z,aa){I=0;L.objects.length=0;L.sprites.length=0;L.lights.length=0;G(Z);if(aa===true){L.objects.sort(s)}};this.projectScene=function(al,ai,ao,aa){var ak=false,ay,aq,aw,ag,aC,an,az,aH,aF,am,ax,ar,av,af,Z,ae,ad,ab,at,au,aK,aI,aG,aE,ac,aj;Q=0;T=0;t=0;L.elements.length=0;if(al.autoUpdate===true){al.updateMatrixWorld()}if(ai.parent===undefined){ai.updateMatrixWorld()}a.copy(ai.matrixWorldInverse.getInverse(ai.matrixWorld));g.multiplyMatrices(ai.projectionMatrix,a);q.getNormalMatrix(a);U.setFromMatrix(g);P(al,ao);for(ay=0,aq=L.objects.length;ay<aq;ay++){av=L.objects[ay].object;F=av.matrixWorld;c=0;if(av instanceof THREE.Mesh){af=av.geometry;Z=af.vertices;ae=af.faces;at=af.faceVertexUvs;r.getNormalMatrix(F);ac=av.material instanceof THREE.MeshFaceMaterial;aj=ac===true?av.material:null;for(aw=0,ag=Z.length;aw<ag;aw++){C=B();C.positionWorld.copy(Z[aw]).applyMatrix4(F);C.positionScreen.copy(C.positionWorld).applyMatrix4(g);var aD=1/C.positionScreen.w;C.positionScreen.x*=aD;C.positionScreen.y*=aD;C.positionScreen.z*=aD;C.visible=!(C.positionScreen.x<-1||C.positionScreen.x>1||C.positionScreen.y<-1||C.positionScreen.y>1||C.positionScreen.z<-1||C.positionScreen.z>1)}for(aC=0,an=ae.length;aC<an;aC++){ad=ae[aC];var aA=ac===true?aj.materials[ad.materialIndex]:av.material;if(aA===undefined){continue}var ah=aA.side;aK=f[ad.a];aI=f[ad.b];aG=f[ad.c];S[0]=aK.positionScreen;S[1]=aI.positionScreen;S[2]=aG.positionScreen;if(aK.visible===true||aI.visible===true||aG.visible===true||u.isIntersectionBox(Y.setFromPoints(S))){ak=((aG.positionScreen.x-aK.positionScreen.x)*(aI.positionScreen.y-aK.positionScreen.y)-(aG.positionScreen.y-aK.positionScreen.y)*(aI.positionScreen.x-aK.positionScreen.x))<0;if(ah===THREE.DoubleSide||ak===(ah===THREE.FrontSide)){l=m();l.id=av.id;l.v1.copy(aK);l.v2.copy(aI);l.v3.copy(aG)}else{continue}}else{continue}l.normalModel.copy(ad.normal);if(ak===false&&(ah===THREE.BackSide||ah===THREE.DoubleSide)){l.normalModel.negate()}l.normalModel.applyMatrix3(r).normalize();l.normalModelView.copy(l.normalModel).applyMatrix3(q);l.centroidModel.copy(ad.centroid).applyMatrix4(F);ab=ad.vertexNormals;for(az=0,aH=Math.min(ab.length,3);az<aH;az++){var aJ=l.vertexNormalsModel[az];aJ.copy(ab[az]);if(ak===false&&(ah===THREE.BackSide||ah===THREE.DoubleSide)){aJ.negate()}aJ.applyMatrix3(r).normalize();var aB=l.vertexNormalsModelView[az];aB.copy(aJ).applyMatrix3(q)}l.vertexNormalsLength=ab.length;for(aF=0,am=Math.min(at.length,3);aF<am;aF++){au=at[aF][aC];if(au===undefined){continue}for(ax=0,ar=au.length;ax<ar;ax++){l.uvs[aF][ax]=au[ax]}}l.color=ad.color;l.material=aA;d.copy(l.centroidModel).applyProjection(g);l.z=d.z;L.elements.push(l)}}else{if(av instanceof THREE.Line){H.multiplyMatrices(g,F);Z=av.geometry.vertices;aK=B();aK.positionScreen.copy(Z[0]).applyMatrix4(H);var ap=av.type===THREE.LinePieces?2:1;for(aw=1,ag=Z.length;aw<ag;aw++){aK=B();aK.positionScreen.copy(Z[aw]).applyMatrix4(H);if((aw+1)%ap>0){continue}aI=f[c-2];v.copy(aK.positionScreen);h.copy(aI.positionScreen);if(D(v,h)===true){v.multiplyScalar(1/v.w);h.multiplyScalar(1/h.w);i=J();i.id=av.id;i.v1.positionScreen.copy(v);i.v2.positionScreen.copy(h);i.z=Math.max(v.z,h.z);i.material=av.material;if(av.material.vertexColors===THREE.VertexColors){i.vertexColors[0].copy(av.geometry.colors[aw]);i.vertexColors[1].copy(av.geometry.colors[aw-1])}L.elements.push(i)}}}}}for(ay=0,aq=L.sprites.length;ay<aq;ay++){av=L.sprites[ay].object;F=av.matrixWorld;if(av instanceof THREE.Sprite){K.set(F.elements[12],F.elements[13],F.elements[14],1);K.applyMatrix4(g);var aD=1/K.w;K.z*=aD;if(K.z>-1&&K.z<1){E=k();E.id=av.id;E.x=K.x*aD;E.y=K.y*aD;E.z=K.z;E.object=av;E.rotation=av.rotation;E.scale.x=av.scale.x*Math.abs(E.x-(K.x+ai.projectionMatrix.elements[0])/(K.w+ai.projectionMatrix.elements[12]));E.scale.y=av.scale.y*Math.abs(E.y-(K.y+ai.projectionMatrix.elements[5])/(K.w+ai.projectionMatrix.elements[13]));E.material=av.material;L.elements.push(E)}}}if(aa===true){L.elements.sort(s)}return L};function n(){if(I===p){var Z=new THREE.RenderableObject();O.push(Z);p++;I++;return Z}return O[I++]}function B(){if(c===b){var Z=new THREE.RenderableVertex();f.push(Z);b++;c++;return Z}return f[c++]}function m(){if(Q===j){var Z=new THREE.RenderableFace3();N.push(Z);j++;Q++;return Z}return N[Q++]}function J(){if(T===A){var Z=new THREE.RenderableLine();V.push(Z);A++;T++;return Z}return V[T++]}function k(){if(t===W){var Z=new THREE.RenderableSprite();e.push(Z);W++;t++;return Z}return e[t++]}function s(aa,Z){if(aa.z!==Z.z){return Z.z-aa.z}else{if(aa.id!==Z.id){return aa.id-Z.id}else{return 0}}}function D(ad,ac){var ab=0,ag=1,ae=ad.z+ad.w,aa=ac.z+ac.w,Z=-ad.z+ad.w,af=-ac.z+ac.w;if(ae>=0&&aa>=0&&Z>=0&&af>=0){return true}else{if((ae<0&&aa<0)||(Z<0&&af<0)){return false}else{if(ae<0){ab=Math.max(ab,ae/(ae-aa))}else{if(aa<0){ag=Math.min(ag,ae/(ae-aa))}}if(Z<0){ab=Math.max(ab,Z/(Z-af))}else{if(af<0){ag=Math.min(ag,Z/(Z-af))}}if(ag<ab){return false}else{ad.lerp(ac,ab);ac.lerp(ad,1-ag);return true}}}}};THREE.Face3=function(f,e,i,h,g,d){this.a=f;this.b=e;this.c=i;this.normal=h instanceof THREE.Vector3?h:new THREE.Vector3();this.vertexNormals=h instanceof Array?h:[];this.color=g instanceof THREE.Color?g:new THREE.Color();this.vertexColors=g instanceof Array?g:[];this.vertexTangents=[];this.materialIndex=d!==undefined?d:0;this.centroid=new THREE.Vector3()};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var c=new THREE.Face3(this.a,this.b,this.c);c.normal.copy(this.normal);c.color.copy(this.color);c.centroid.copy(this.centroid);c.materialIndex=this.materialIndex;var b,a;for(b=0,a=this.vertexNormals.length;b<a;b++){c.vertexNormals[b]=this.vertexNormals[b].clone()}for(b=0,a=this.vertexColors.length;b<a;b++){c.vertexColors[b]=this.vertexColors[b].clone()}for(b=0,a=this.vertexTangents.length;b<a;b++){c.vertexTangents[b]=this.vertexTangents[b].clone()}return c}};THREE.Face4=function(g,f,k,j,i,h,e){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(g,f,k,i,h,e)};THREE.Geometry=function(){this.id=THREE.GeometryIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.buffersNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(b){var h=new THREE.Matrix3().getNormalMatrix(b);for(var e=0,a=this.vertices.length;e<a;e++){var g=this.vertices[e];g.applyMatrix4(b)}for(var e=0,a=this.faces.length;e<a;e++){var f=this.faces[e];f.normal.applyMatrix3(h).normalize();for(var c=0,d=f.vertexNormals.length;c<d;c++){f.vertexNormals[c].applyMatrix3(h).normalize()}f.centroid.applyMatrix4(b)}if(this.boundingBox instanceof THREE.Box3){this.computeBoundingBox()}if(this.boundingSphere instanceof THREE.Sphere){this.computeBoundingSphere()}},computeCentroids:function(){var c,b,a;for(c=0,b=this.faces.length;c<b;c++){a=this.faces[c];a.centroid.set(0,0,0);a.centroid.add(this.vertices[a.a]);a.centroid.add(this.vertices[a.b]);a.centroid.add(this.vertices[a.c]);a.centroid.divideScalar(3)}},computeFaceNormals:function(){var a=new THREE.Vector3(),i=new THREE.Vector3();for(var h=0,g=this.faces.length;h<g;h++){var e=this.faces[h];var d=this.vertices[e.a];var c=this.vertices[e.b];var b=this.vertices[e.c];a.subVectors(b,c);i.subVectors(d,c);a.cross(i);a.normalize();e.normal.copy(a)}},computeVertexNormals:function(g){var m,d,h,l,k,j;if(this.__tmpVertices===undefined){this.__tmpVertices=new Array(this.vertices.length);j=this.__tmpVertices;for(m=0,d=this.vertices.length;m<d;m++){j[m]=new THREE.Vector3()}for(h=0,l=this.faces.length;h<l;h++){k=this.faces[h];k.vertexNormals=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()]}}else{j=this.__tmpVertices;for(m=0,d=this.vertices.length;m<d;m++){j[m].set(0,0,0)}}if(g){var c,b,a,q;var e=new THREE.Vector3(),p=new THREE.Vector3(),o=new THREE.Vector3(),n=new THREE.Vector3(),i=new THREE.Vector3();for(h=0,l=this.faces.length;h<l;h++){k=this.faces[h];c=this.vertices[k.a];b=this.vertices[k.b];a=this.vertices[k.c];e.subVectors(a,b);p.subVectors(c,b);e.cross(p);j[k.a].add(e);j[k.b].add(e);j[k.c].add(e)}}else{for(h=0,l=this.faces.length;h<l;h++){k=this.faces[h];j[k.a].add(k.normal);j[k.b].add(k.normal);j[k.c].add(k.normal)}}for(m=0,d=this.vertices.length;m<d;m++){j[m].normalize()}for(h=0,l=this.faces.length;h<l;h++){k=this.faces[h];k.vertexNormals[0].copy(j[k.a]);k.vertexNormals[1].copy(j[k.b]);k.vertexNormals[2].copy(j[k.c])}},computeMorphNormals:function(){var e,l,g,m,h;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];if(!h.__originalFaceNormal){h.__originalFaceNormal=h.normal.clone()}else{h.__originalFaceNormal.copy(h.normal)}if(!h.__originalVertexNormals){h.__originalVertexNormals=[]}for(e=0,l=h.vertexNormals.length;e<l;e++){if(!h.__originalVertexNormals[e]){h.__originalVertexNormals[e]=h.vertexNormals[e].clone()}else{h.__originalVertexNormals[e].copy(h.vertexNormals[e])}}}var c=new THREE.Geometry();c.faces=this.faces;for(e=0,l=this.morphTargets.length;e<l;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var d=this.morphNormals[e].faceNormals;var a=this.morphNormals[e].vertexNormals;var k,b;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];k=new THREE.Vector3();b={a:new THREE.Vector3(),b:new THREE.Vector3(),c:new THREE.Vector3()};d.push(k);a.push(b)}}var j=this.morphNormals[e];c.vertices=this.morphTargets[e].vertices;c.computeFaceNormals();c.computeVertexNormals();var k,b;for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];k=j.faceNormals[g];b=j.vertexNormals[g];k.copy(h.normal);b.a.copy(h.vertexNormals[0]);b.b.copy(h.vertexNormals[1]);b.c.copy(h.vertexNormals[2])}}for(g=0,m=this.faces.length;g<m;g++){h=this.faces[g];h.normal=h.__originalFaceNormal;h.vertexNormals=h.__originalVertexNormals}},computeTangents:function(){var O,m,E,k,N,p,C,g,o,K,H,G,e,d,c,j,h,V,U,A,u,R,Q,s,q,I,F,b,T=[],S=[],a=new THREE.Vector3(),l=new THREE.Vector3(),L=new THREE.Vector3(),P=new THREE.Vector3(),M=new THREE.Vector3(),D;for(E=0,k=this.vertices.length;E<k;E++){T[E]=new THREE.Vector3();S[E]=new THREE.Vector3()}function B(v,i,f,W,t,r,n){K=v.vertices[i];H=v.vertices[f];G=v.vertices[W];e=o[t];d=o[r];c=o[n];j=H.x-K.x;h=G.x-K.x;V=H.y-K.y;U=G.y-K.y;A=H.z-K.z;u=G.z-K.z;R=d.x-e.x;Q=c.x-e.x;s=d.y-e.y;q=c.y-e.y;I=1/(R*q-Q*s);a.set((q*j-s*h)*I,(q*V-s*U)*I,(q*A-s*u)*I);l.set((R*h-Q*j)*I,(R*U-Q*V)*I,(R*u-Q*A)*I);T[i].add(a);T[f].add(a);T[W].add(a);S[i].add(l);S[f].add(l);S[W].add(l)}for(O=0,m=this.faces.length;O<m;O++){g=this.faces[O];o=this.faceVertexUvs[0][O];B(this,g.a,g.b,g.c,0,1,2)}var J=["a","b","c","d"];for(O=0,m=this.faces.length;O<m;O++){g=this.faces[O];for(N=0;N<Math.min(g.vertexNormals.length,3);N++){M.copy(g.vertexNormals[N]);C=g[J[N]];F=T[C];L.copy(F);L.sub(M.multiplyScalar(M.dot(F))).normalize();P.crossVectors(g.vertexNormals[N],F);b=P.dot(S[C]);D=(b<0)?-1:1;g.vertexTangents[N]=new THREE.Vector4(L.x,L.y,L.z,D)}}this.hasTangents=true},computeLineDistances:function(){var e=0;var b=this.vertices;for(var c=0,a=b.length;c<a;c++){if(c>0){e+=b[c].distanceTo(b[c-1])}this.lineDistances[c]=e}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3()}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere()}this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var b={};var a=[],C=[];var f,D;var h=4;var B=Math.pow(10,h);var t,e,d;var c,r,s,A,g;this.__tmpVertices=undefined;for(t=0,e=this.vertices.length;t<e;t++){f=this.vertices[t];D=Math.round(f.x*B)+"_"+Math.round(f.y*B)+"_"+Math.round(f.z*B);if(b[D]===undefined){b[D]=t;a.push(this.vertices[t]);C[t]=a.length-1}else{C[t]=C[b[D]]}}var o=[];for(t=0,e=this.faces.length;t<e;t++){d=this.faces[t];d.a=C[d.a];d.b=C[d.b];d.c=C[d.c];c=[d.a,d.b,d.c];var q=-1;for(var p=0;p<3;p++){if(c[p]==c[(p+1)%3]){q=p;o.push(t);break}}}for(t=o.length-1;t>=0;t--){var m=o[t];this.faces.splice(m,1);for(s=0,A=this.faceVertexUvs.length;s<A;s++){this.faceVertexUvs[s].splice(m,1)}}var l=this.vertices.length-a.length;this.vertices=a;return l},clone:function(){var k=new THREE.Geometry();var h=this.vertices;for(var g=0,l=h.length;g<l;g++){k.vertices.push(h[g].clone())}var c=this.faces;for(var g=0,l=c.length;g<l;g++){k.faces.push(c[g].clone())}var e=this.faceVertexUvs[0];for(var g=0,l=e.length;g<l;g++){var b=e[g],a=[];for(var d=0,f=b.length;d<f;d++){a.push(new THREE.Vector2(b[d].x,b[d].y))}k.faceVertexUvs[0].push(a)}return k},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.attributes={};this.dynamic=true;this.offsets=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.morphTargets=[]};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(a,c,b,d){this.attributes[a]={itemSize:d,array:new c(b*d)}},applyMatrix:function(b){var a;var c;if(this.attributes.position){a=this.attributes.position.array}if(this.attributes.normal){c=this.attributes.normal.array}if(a!==undefined){b.multiplyVector3Array(a);this.verticesNeedUpdate=true}if(c!==undefined){var d=new THREE.Matrix3().getNormalMatrix(b);d.multiplyVector3Array(c);this.normalizeNormals();this.normalsNeedUpdate=true}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3()}var b=this.attributes.position.array;if(b){var f=this.boundingBox;var a,g,e;if(b.length>=3){f.min.x=f.max.x=b[0];f.min.y=f.max.y=b[1];f.min.z=f.max.z=b[2]}for(var d=3,c=b.length;d<c;d+=3){a=b[d];g=b[d+1];e=b[d+2];if(a<f.min.x){f.min.x=a}else{if(a>f.max.x){f.max.x=a}}if(g<f.min.y){f.min.y=g}else{if(g>f.max.y){f.max.y=g}}if(e<f.min.z){f.min.z=e}else{if(e>f.max.z){f.max.z=e}}}}if(b===undefined||b.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){var b=new THREE.Box3();var a=new THREE.Vector3();return function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere()}var e=this.attributes.position.array;if(e){var c=this.boundingSphere.center;for(var g=0,f=e.length;g<f;g+=3){a.set(e[g],e[g+1],e[g+2]);b.addPoint(a)}b.center(c);var d=0;for(var g=0,f=e.length;g<f;g+=3){a.set(e[g],e[g+1],e[g+2]);d=Math.max(d,c.distanceToSquared(a))}this.boundingSphere.radius=Math.sqrt(d)}}}(),computeVertexNormals:function(){if(this.attributes.position){var t,k;var q,v;var B=this.attributes.position.array.length;if(this.attributes.normal===undefined){this.attributes.normal={itemSize:3,array:new Float32Array(B)}}else{for(t=0,k=this.attributes.normal.array.length;t<k;t++){this.attributes.normal.array[t]=0}}var f=this.attributes.position.array;var m=this.attributes.normal.array;var A,u,s,l,h,g,r=new THREE.Vector3(),p=new THREE.Vector3(),o=new THREE.Vector3(),n=new THREE.Vector3(),C=new THREE.Vector3();if(this.attributes.index){var c=this.attributes.index.array;var b=this.offsets;for(q=0,v=b.length;q<v;++q){var a=b[q].start;var e=b[q].count;var d=b[q].index;for(t=a,k=a+e;t<k;t+=3){A=d+c[t];u=d+c[t+1];s=d+c[t+2];l=f[A*3];h=f[A*3+1];g=f[A*3+2];r.set(l,h,g);l=f[u*3];h=f[u*3+1];g=f[u*3+2];p.set(l,h,g);l=f[s*3];h=f[s*3+1];g=f[s*3+2];o.set(l,h,g);n.subVectors(o,p);C.subVectors(r,p);n.cross(C);m[A*3]+=n.x;m[A*3+1]+=n.y;m[A*3+2]+=n.z;m[u*3]+=n.x;m[u*3+1]+=n.y;m[u*3+2]+=n.z;m[s*3]+=n.x;m[s*3+1]+=n.y;m[s*3+2]+=n.z}}}else{for(t=0,k=f.length;t<k;t+=9){l=f[t];h=f[t+1];g=f[t+2];r.set(l,h,g);l=f[t+3];h=f[t+4];g=f[t+5];p.set(l,h,g);l=f[t+6];h=f[t+7];g=f[t+8];o.set(l,h,g);n.subVectors(o,p);C.subVectors(r,p);n.cross(C);m[t]=n.x;m[t+1]=n.y;m[t+2]=n.z;m[t+3]=n.x;m[t+4]=n.y;m[t+5]=n.z;m[t+6]=n.x;m[t+7]=n.y;m[t+8]=n.z}}this.normalizeNormals();this.normalsNeedUpdate=true}},normalizeNormals:function(){var d=this.attributes.normal.array;var a,g,e,f;for(var c=0,b=d.length;c<b;c+=3){a=d[c];g=d[c+1];e=d[c+2];f=1/Math.sqrt(a*a+g*g+e*e);d[c]*=f;d[c+1]*=f;d[c+2]*=f}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var f=this.attributes.index.array;var s=this.attributes.position.array;var B=this.attributes.normal.array;var T=this.attributes.uv.array;var A=s.length/3;if(this.attributes.tangent===undefined){var C=4*A;this.attributes.tangent={itemSize:4,array:new Float32Array(C)}}var J=this.attributes.tangent.array;var an=[],am=[];for(var ag=0;ag<A;ag++){an[ag]=new THREE.Vector3();am[ag]=new THREE.Vector3()}var m,ae,I,l,ad,H,h,ab,F,g,aa,e,Y,d,W,v,u,ap,ao,R,Q,al,ak,P,O,X;var o=new THREE.Vector3(),L=new THREE.Vector3();function S(j,i,k){m=s[j*3];ae=s[j*3+1];I=s[j*3+2];l=s[i*3];ad=s[i*3+1];H=s[i*3+2];h=s[k*3];ab=s[k*3+1];F=s[k*3+2];g=T[j*2];aa=T[j*2+1];e=T[i*2];Y=T[i*2+1];d=T[k*2];W=T[k*2+1];v=l-m;u=h-m;ap=ad-ae;ao=ab-ae;R=H-I;Q=F-I;al=e-g;ak=d-g;P=Y-aa;O=W-aa;X=1/(al*O-ak*P);o.set((O*v-P*u)*X,(O*ap-P*ao)*X,(O*R-P*Q)*X);L.set((al*u-ak*v)*X,(al*ao-ak*ap)*X,(al*Q-ak*R)*X);an[j].add(o);an[i].add(o);an[k].add(o);am[j].add(L);am[i].add(L);am[k].add(L)}var ai,M;var ah,q;var c,b,a;var E=this.offsets;for(ah=0,q=E.length;ah<q;++ah){var G=E[ah].start;var Z=E[ah].count;var N=E[ah].index;for(ai=G,M=G+Z;ai<M;ai+=3){c=N+f[ai];b=N+f[ai+1];a=N+f[ai+2];S(c,b,a)}}var ac=new THREE.Vector3(),aj=new THREE.Vector3();var af=new THREE.Vector3(),K=new THREE.Vector3();var U,V,p;function D(i){af.x=B[i*3];af.y=B[i*3+1];af.z=B[i*3+2];K.copy(af);V=an[i];ac.copy(V);ac.sub(af.multiplyScalar(af.dot(V))).normalize();aj.crossVectors(K,V);p=aj.dot(am[i]);U=(p<0)?-1:1;J[i*4]=ac.x;J[i*4+1]=ac.y;J[i*4+2]=ac.z;J[i*4+3]=U}for(ah=0,q=E.length;ah<q;++ah){var G=E[ah].start;var Z=E[ah].count;var N=E[ah].index;for(ai=G,M=G+Z;ai<M;ai+=3){c=N+f[ai];b=N+f[ai+1];a=N+f[ai+2];D(c);D(b);D(a)}}this.hasTangents=true;this.tangentsNeedUpdate=true},clone:function(){var j=new THREE.BufferGeometry();var d=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var f in this.attributes){var g=this.attributes[f];var e=g.array;var a={itemSize:g.itemSize,numItems:g.numItems,array:null};for(var c=0,k=d.length;c<k;c++){var h=d[c];if(e instanceof h){a.array=new h(e);break}}j.attributes[f]=a}for(var c=0,k=this.offsets.length;c<k;c++){var b=this.offsets[c];j.offsets.push({start:b.start,index:b.index,count:b.count})}return j},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4();this.projectionMatrix=new THREE.Matrix4();this.projectionMatrixInverse=new THREE.Matrix4()};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.lookAt=function(){var a=new THREE.Matrix4();return function(b){a.lookAt(this.position,b,this.up);this.quaternion.setFromRotationMatrix(a)}}();THREE.Camera.prototype.clone=function(a){if(a===undefined){a=new THREE.Camera()}THREE.Object3D.prototype.clone.call(this,a);a.matrixWorldInverse.copy(this.matrixWorldInverse);a.projectionMatrix.copy(this.projectionMatrix);a.projectionMatrixInverse.copy(this.projectionMatrixInverse);return a};THREE.OrthographicCamera=function(f,c,e,b,d,a){THREE.Camera.call(this);this.left=f;this.right=c;this.top=e;this.bottom=b;this.near=(d!==undefined)?d:0.1;this.far=(a!==undefined)?a:2000;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var a=new THREE.OrthographicCamera();THREE.Camera.prototype.clone.call(this,a);a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;return a};THREE.PerspectiveCamera=function(c,b,d,a){THREE.Camera.call(this);this.fov=c!==undefined?c:50;this.aspect=b!==undefined?b:1;this.near=d!==undefined?d:0.1;this.far=a!==undefined?a:2000;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.setLens=function(b,a){if(a===undefined){a=24}this.fov=2*THREE.Math.radToDeg(Math.atan(a/(b*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(e,c,b,f,d,a){this.fullWidth=e;this.fullHeight=c;this.x=b;this.y=f;this.width=d;this.height=a;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var c=this.fullWidth/this.fullHeight;var g=Math.tan(THREE.Math.degToRad(this.fov*0.5))*this.near;var b=-g;var f=c*b;var d=c*g;var e=Math.abs(d-f);var a=Math.abs(g-b);this.projectionMatrix.makeFrustum(f+this.x*e/this.fullWidth,f+(this.x+this.width)*e/this.fullWidth,g-(this.y+this.height)*a/this.fullHeight,g-this.y*a/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.clone=function(){var a=new THREE.PerspectiveCamera();THREE.Camera.prototype.clone.call(this,a);a.fov=this.fov;a.aspect=this.aspect;a.near=this.near;a.far=this.far;return a};THREE.Light=function(a){THREE.Object3D.call(this);this.color=new THREE.Color(a)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.clone=function(a){if(a===undefined){a=new THREE.Light()}THREE.Object3D.prototype.clone.call(this,a);a.color.copy(this.color);return a};THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.clone=function(){var a=new THREE.AmbientLight();THREE.Light.prototype.clone.call(this,a);return a};THREE.AreaLight=function(b,a){THREE.Light.call(this,b);this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=(a!==undefined)?a:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=0.5;this.quadraticAttenuation=0.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight=function(b,a){THREE.Light.call(this,b);this.position.set(0,1,0);this.target=new THREE.Object3D();this.intensity=(a!==undefined)?a:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1000);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,0.99,0.998];this.shadowCascadeFarZ=[0.99,0.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.clone=function(){var a=new THREE.DirectionalLight();THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;return a};THREE.HemisphereLight=function(b,c,a){THREE.Light.call(this,b);this.position.set(0,100,0);this.groundColor=new THREE.Color(c);this.intensity=(a!==undefined)?a:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.clone=function(){var a=new THREE.HemisphereLight();THREE.Light.prototype.clone.call(this,a);a.groundColor.copy(this.groundColor);a.intensity=this.intensity;return a};THREE.PointLight=function(b,a,c){THREE.Light.call(this,b);this.intensity=(a!==undefined)?a:1;this.distance=(c!==undefined)?c:0};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.clone=function(){var a=new THREE.PointLight();THREE.Light.prototype.clone.call(this,a);a.intensity=this.intensity;a.distance=this.distance;return a};THREE.SpotLight=function(b,a,e,d,c){THREE.Light.call(this,b);this.position.set(0,1,0);this.target=new THREE.Object3D();this.intensity=(a!==undefined)?a:1;this.distance=(e!==undefined)?e:0;this.angle=(d!==undefined)?d:Math.PI/3;this.exponent=(c!==undefined)?c:10;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5000;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=0.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.clone=function(){var a=new THREE.SpotLight();THREE.Light.prototype.clone.call(this,a);a.target=this.target.clone();a.intensity=this.intensity;a.distance=this.distance;a.angle=this.angle;a.exponent=this.exponent;a.castShadow=this.castShadow;a.onlyShadow=this.onlyShadow;return a};THREE.Loader=function(a){this.showStatus=a;this.statusDomElement=a?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var a=document.createElement("div");a.style.position="absolute";a.style.right="0px";a.style.top="0px";a.style.fontSize="0.8em";a.style.textAlign="left";a.style.background="rgba(0,0,0,0.25)";a.style.color="#fff";a.style.width="120px";a.style.padding="0.5em 0.5em 0.5em 0.5em";a.style.zIndex=1000;a.innerHTML="Loading ...";return a},updateProgress:function(a){var b="Loaded ";if(a.total){b+=(100*a.loaded/a.total).toFixed(0)+"%"}else{b+=(a.loaded/1000).toFixed(2)+" KB"}this.statusDomElement.innerHTML=b},extractUrlBase:function(a){var b=a.split("/");b.pop();return(b.length<1?".":b.join("/"))+"/"},initMaterials:function(a,c){var d=[];for(var b=0;b<a.length;++b){d[b]=THREE.Loader.prototype.createMaterial(a[b],c)}return d},needsTangents:function(b){for(var d=0,c=b.length;d<c;d++){var a=b[d];if(a instanceof THREE.ShaderMaterial){return true}}return false},createMaterial:function(f,c){var h=this;function e(q){var m=Math.log(q)/Math.LN2;return Math.floor(m)==m}function a(q){var m=Math.log(q)/Math.LN2;return Math.pow(2,Math.round(m))}function n(q,m){var r=new Image();r.onload=function(){if(!e(this.width)||!e(this.height)){var t=a(this.width);var s=a(this.height);q.image.width=t;q.image.height=s;q.image.getContext("2d").drawImage(this,0,0,t,s)}else{q.image=this}q.needsUpdate=true};r.crossOrigin=h.crossOrigin;r.src=m}function j(B,q,v,r,A,s,m){var u=/\.dds$/i.test(v);var t=c+"/"+v;if(u){var C=THREE.ImageUtils.loadCompressedTexture(t);B[q]=C}else{var C=document.createElement("canvas");B[q]=new THREE.Texture(C)}B[q].sourceFile=v;if(r){B[q].repeat.set(r[0],r[1]);if(r[0]!==1){B[q].wrapS=THREE.RepeatWrapping}if(r[1]!==1){B[q].wrapT=THREE.RepeatWrapping}}if(A){B[q].offset.set(A[0],A[1])}if(s){var D={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(D[s[0]]!==undefined){B[q].wrapS=D[s[0]]}if(D[s[1]]!==undefined){B[q].wrapT=D[s[1]]}}if(m){B[q].anisotropy=m}if(!u){n(B[q],t)}}function b(m){return(m[0]*255<<16)+(m[1]*255<<8)+m[2]*255}var d="MeshLambertMaterial";var l={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(f.shading){var k=f.shading.toLowerCase();if(k==="phong"){d="MeshPhongMaterial"}else{if(k==="basic"){d="MeshBasicMaterial"}}}if(f.blending!==undefined&&THREE[f.blending]!==undefined){l.blending=THREE[f.blending]}if(f.transparent!==undefined||f.opacity<1){l.transparent=f.transparent}if(f.depthTest!==undefined){l.depthTest=f.depthTest}if(f.depthWrite!==undefined){l.depthWrite=f.depthWrite}if(f.visible!==undefined){l.visible=f.visible}if(f.flipSided!==undefined){l.side=THREE.BackSide}if(f.doubleSided!==undefined){l.side=THREE.DoubleSide}if(f.wireframe!==undefined){l.wireframe=f.wireframe}if(f.vertexColors!==undefined){if(f.vertexColors==="face"){l.vertexColors=THREE.FaceColors}else{if(f.vertexColors){l.vertexColors=THREE.VertexColors}}}if(f.colorDiffuse){l.color=b(f.colorDiffuse)}else{if(f.DbgColor){l.color=f.DbgColor}}if(f.colorSpecular){l.specular=b(f.colorSpecular)}if(f.colorAmbient){l.ambient=b(f.colorAmbient)}if(f.transparency){l.opacity=f.transparency}if(f.specularCoef){l.shininess=f.specularCoef}if(f.mapDiffuse&&c){j(l,"map",f.mapDiffuse,f.mapDiffuseRepeat,f.mapDiffuseOffset,f.mapDiffuseWrap,f.mapDiffuseAnisotropy)}if(f.mapLight&&c){j(l,"lightMap",f.mapLight,f.mapLightRepeat,f.mapLightOffset,f.mapLightWrap,f.mapLightAnisotropy)}if(f.mapBump&&c){j(l,"bumpMap",f.mapBump,f.mapBumpRepeat,f.mapBumpOffset,f.mapBumpWrap,f.mapBumpAnisotropy)}if(f.mapNormal&&c){j(l,"normalMap",f.mapNormal,f.mapNormalRepeat,f.mapNormalOffset,f.mapNormalWrap,f.mapNormalAnisotropy)}if(f.mapSpecular&&c){j(l,"specularMap",f.mapSpecular,f.mapSpecularRepeat,f.mapSpecularOffset,f.mapSpecularWrap,f.mapSpecularAnisotropy)}if(f.mapBumpScale){l.bumpScale=f.mapBumpScale}if(f.mapNormal){var g=THREE.ShaderLib.normalmap;var o=THREE.UniformsUtils.clone(g.uniforms);o.tNormal.value=l.normalMap;if(f.mapNormalFactor){o.uNormalScale.value.set(f.mapNormalFactor,f.mapNormalFactor)}if(l.map){o.tDiffuse.value=l.map;o.enableDiffuse.value=true}if(l.specularMap){o.tSpecular.value=l.specularMap;o.enableSpecular.value=true}if(l.lightMap){o.tAO.value=l.lightMap;o.enableAO.value=true}o.uDiffuseColor.value.setHex(l.color);o.uSpecularColor.value.setHex(l.specular);o.uAmbientColor.value.setHex(l.ambient);o.uShininess.value=l.shininess;if(l.opacity!==undefined){o.uOpacity.value=l.opacity}var p={fragmentShader:g.fragmentShader,vertexShader:g.vertexShader,uniforms:o,lights:true,fog:true};var i=new THREE.ShaderMaterial(p);if(l.transparent){i.transparent=true}}else{var i=new THREE[d](l)}if(f.DbgName!==undefined){i.name=f.DbgName}return i}};THREE.XHRLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(a,c,f,e){var b=this;var d=new XMLHttpRequest();if(c!==undefined){d.addEventListener("load",function(g){c(g.target.responseText);b.manager.itemEnd(a)},false)}if(f!==undefined){d.addEventListener("progress",function(g){f(g)},false)}if(e!==undefined){d.addEventListener("error",function(g){e(g)},false)}if(this.crossOrigin!==undefined){d.crossOrigin=this.crossOrigin}d.open("GET",a,true);d.send(null);b.manager.itemStart(a)},setCrossOrigin:function(a){this.crossOrigin=a}};THREE.ImageLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(a,c,f,d){var b=this;var e=document.createElement("img");if(c!==undefined){e.addEventListener("load",function(g){b.manager.itemEnd(a);c(this)},false)}if(f!==undefined){e.addEventListener("progress",function(g){f(g)},false)}if(d!==undefined){e.addEventListener("error",function(g){d(g)},false)}if(this.crossOrigin!==undefined){e.crossOrigin=this.crossOrigin}e.src=a;b.manager.itemStart(a);return e},setCrossOrigin:function(a){this.crossOrigin=a}};THREE.JSONLoader=function(a){THREE.Loader.call(this,a);this.withCredentials=false};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.load=function(a,d,c){var b=this;c=c&&(typeof c==="string")?c:this.extractUrlBase(a);this.onLoadStart();this.loadAjaxJSON(this,a,d,c)};THREE.JSONLoader.prototype.loadAjaxJSON=function(b,a,g,e,d){var f=new XMLHttpRequest();var c=0;f.onreadystatechange=function(){if(f.readyState===f.DONE){if(f.status===200||f.status===0){if(f.responseText){var i=JSON.parse(f.responseText);var h=b.parse(i,e);g(h.geometry,h.materials)}else{console.warn("THREE.JSONLoader: ["+a+"] seems to be unreachable or file there is empty")}b.onLoadComplete()}else{console.error("THREE.JSONLoader: Couldn't load ["+a+"] ["+f.status+"]")}}else{if(f.readyState===f.LOADING){if(d){if(c===0){c=f.getResponseHeader("Content-Length")}d({total:c,loaded:f.responseText.length})}}else{if(f.readyState===f.HEADERS_RECEIVED){if(d!==undefined){c=f.getResponseHeader("Content-Length")}}}}};f.open("GET",a,true);f.withCredentials=this.withCredentials;f.send(null)};THREE.JSONLoader.prototype.parse=function(i,c){var h=this,e=new THREE.Geometry(),d=(i.scale!==undefined)?1/i.scale:1;a(d);f();b(d);e.computeCentroids();e.computeFaceNormals();e.computeBoundingSphere();function a(X){function B(u,j){return u&(1<<j)}var S,R,H,s,r,q,V,K,D,o,I,L,k,U,Q,O,M,T,E,n,m,P,C,W,p,A,J,G,l=i.faces,t=i.vertices,N=i.normals,F=i.colors,Y=0;if(i.uvs!==undefined){for(S=0;S<i.uvs.length;S++){if(i.uvs[S].length){Y++}}for(S=0;S<Y;S++){e.faceVertexUvs[S]=[]}}s=0;r=t.length;while(s<r){T=new THREE.Vector3();T.x=t[s++]*X;T.y=t[s++]*X;T.z=t[s++]*X;e.vertices.push(T)}s=0;r=l.length;while(s<r){o=l[s++];I=B(o,0);L=B(o,1);k=B(o,3);U=B(o,4);Q=B(o,5);O=B(o,6);M=B(o,7);if(I){n=new THREE.Face3();n.a=l[s];n.b=l[s+1];n.c=l[s+3];m=new THREE.Face3();m.a=l[s+1];m.b=l[s+2];m.c=l[s+3];s+=4;if(L){D=l[s++];n.materialIndex=D;m.materialIndex=D}H=e.faces.length;if(k){for(S=0;S<Y;S++){p=i.uvs[S];e.faceVertexUvs[S][H]=[];e.faceVertexUvs[S][H+1]=[];for(R=0;R<4;R++){K=l[s++];J=p[K*2];G=p[K*2+1];A=new THREE.Vector2(J,G);if(R!==2){e.faceVertexUvs[S][H].push(A)}if(R!==0){e.faceVertexUvs[S][H+1].push(A)}}}}if(U){V=l[s++]*3;n.normal.set(N[V++],N[V++],N[V]);m.normal.copy(n.normal)}if(Q){for(S=0;S<4;S++){V=l[s++]*3;W=new THREE.Vector3(N[V++],N[V++],N[V]);if(S!==2){n.vertexNormals.push(W)}if(S!==0){m.vertexNormals.push(W)}}}if(O){q=l[s++];C=F[q];n.color.setHex(C);m.color.setHex(C)}if(M){for(S=0;S<4;S++){q=l[s++];C=F[q];if(S!==2){n.vertexColors.push(new THREE.Color(C))}if(S!==0){m.vertexColors.push(new THREE.Color(C))}}}e.faces.push(n);e.faces.push(m)}else{E=new THREE.Face3();E.a=l[s++];E.b=l[s++];E.c=l[s++];if(L){D=l[s++];E.materialIndex=D}H=e.faces.length;if(k){for(S=0;S<Y;S++){p=i.uvs[S];e.faceVertexUvs[S][H]=[];for(R=0;R<3;R++){K=l[s++];J=p[K*2];G=p[K*2+1];A=new THREE.Vector2(J,G);e.faceVertexUvs[S][H].push(A)}}}if(U){V=l[s++]*3;E.normal.set(N[V++],N[V++],N[V])}if(Q){for(S=0;S<3;S++){V=l[s++]*3;W=new THREE.Vector3(N[V++],N[V++],N[V]);E.vertexNormals.push(W)}}if(O){q=l[s++];E.color.setHex(F[q])}if(M){for(S=0;S<3;S++){q=l[s++];E.vertexColors.push(new THREE.Color(F[q]))}}e.faces.push(E)}}}function f(){var k,j,s,p,o,t,r,q,n,m;if(i.skinWeights){for(k=0,j=i.skinWeights.length;k<j;k+=2){s=i.skinWeights[k];p=i.skinWeights[k+1];o=0;t=0;e.skinWeights.push(new THREE.Vector4(s,p,o,t))}}if(i.skinIndices){for(k=0,j=i.skinIndices.length;k<j;k+=2){r=i.skinIndices[k];q=i.skinIndices[k+1];n=0;m=0;e.skinIndices.push(new THREE.Vector4(r,q,n,m))}}e.bones=i.bones;e.animation=i.animation;e.animations=i.animations}function b(m){if(i.morphTargets!==undefined){var p,n,A,k,r,B;for(p=0,n=i.morphTargets.length;p<n;p++){e.morphTargets[p]={};e.morphTargets[p].name=i.morphTargets[p].name;e.morphTargets[p].vertices=[];r=e.morphTargets[p].vertices;B=i.morphTargets[p].vertices;for(A=0,k=B.length;A<k;A+=3){var q=new THREE.Vector3();q.x=B[A]*m;q.y=B[A+1]*m;q.z=B[A+2]*m;r.push(q)}}}if(i.morphColors!==undefined){var p,n,s,u,t,j,o;for(p=0,n=i.morphColors.length;p<n;p++){e.morphColors[p]={};e.morphColors[p].name=i.morphColors[p].name;e.morphColors[p].colors=[];t=e.morphColors[p].colors;j=i.morphColors[p].colors;for(s=0,u=j.length;s<u;s+=3){o=new THREE.Color(16755200);o.setRGB(j[s],j[s+1],j[s+2]);t.push(o)}}}}if(i.materials===undefined){return{geometry:e}}else{var g=this.initMaterials(i.materials,c);if(this.needsTangents(g)){e.computeTangents()}return{geometry:e,materials:g}}};THREE.LoadingManager=function(c,f,e){var b=this;var a=0,d=0;this.onLoad=c;this.onProgress=f;this.onError=e;this.itemStart=function(g){d++};this.itemEnd=function(g){a++;if(b.onProgress!==undefined){b.onProgress(g,a,d)}if(a===d&&b.onLoad!==undefined){b.onLoad()}}};THREE.DefaultLoadingManager=new THREE.LoadingManager();THREE.BufferGeometryLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader();a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){d(c.parse(JSON.parse(g)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(c){var g=new THREE.BufferGeometry();var a=c.attributes;var f=c.offsets;var d=c.boundingSphere;for(var b in a){var e=a[b];g.attributes[b]={itemSize:e.itemSize,array:new self[e.type](e.array)}}if(f!==undefined){g.offsets=JSON.parse(JSON.stringify(f))}if(d!==undefined){g.boundingSphere=new THREE.Sphere(new THREE.Vector3().fromArray(d.center!==undefined?d.center:[0,0,0]),d.radius)}return g}};THREE.GeometryLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader();a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){d(c.parse(JSON.parse(g)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a){}};THREE.MaterialLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader();a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){d(c.parse(JSON.parse(g)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(c){var d=new THREE[c.type];if(c.color!==undefined){d.color.setHex(c.color)}if(c.ambient!==undefined){d.ambient.setHex(c.ambient)}if(c.emissive!==undefined){d.emissive.setHex(c.emissive)}if(c.specular!==undefined){d.specular.setHex(c.specular)}if(c.shininess!==undefined){d.shininess=c.shininess}if(c.vertexColors!==undefined){d.vertexColors=c.vertexColors}if(c.blending!==undefined){d.blending=c.blending}if(c.side!==undefined){d.side=c.side}if(c.opacity!==undefined){d.opacity=c.opacity}if(c.transparent!==undefined){d.transparent=c.transparent}if(c.wireframe!==undefined){d.wireframe=c.wireframe}if(c.materials!==undefined){for(var b=0,a=c.materials.length;b<a;b++){d.materials.push(this.parse(c.materials[b]))}}return d}};THREE.ObjectLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){d(c.parse(JSON.parse(g)))})},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(c){var d=this.parseGeometries(c.geometries);var a=this.parseMaterials(c.materials);var b=this.parseObject(c.object,d,a);return b},parseGeometries:function(d){var e={};if(d!==undefined){var b=new THREE.JSONLoader();var g=new THREE.BufferGeometryLoader();for(var c=0,a=d.length;c<a;c++){var h;var f=d[c];switch(f.type){case"PlaneGeometry":h=new THREE.PlaneGeometry(f.width,f.height,f.widthSegments,f.heightSegments);break;case"CircleGeometry":h=new THREE.CircleGeometry(f.radius,f.segments);break;case"CubeGeometry":h=new THREE.CubeGeometry(f.width,f.height,f.depth,f.widthSegments,f.heightSegments,f.depthSegments);break;case"CylinderGeometry":h=new THREE.CylinderGeometry(f.radiusTop,f.radiusBottom,f.height,f.radialSegments,f.heightSegments,f.openEnded);break;case"SphereGeometry":h=new THREE.SphereGeometry(f.radius,f.widthSegments,f.heightSegments,f.phiStart,f.phiLength,f.thetaStart,f.thetaLength);break;case"IcosahedronGeometry":h=new THREE.IcosahedronGeometry(f.radius,f.detail);break;case"TorusGeometry":h=new THREE.TorusGeometry(f.radius,f.tube,f.radialSegments,f.tubularSegments,f.arc);break;case"TorusKnotGeometry":h=new THREE.TorusKnotGeometry(f.radius,f.tube,f.radialSegments,f.tubularSegments,f.p,f.q,f.heightScale);break;case"BufferGeometry":h=g.parse(f.data);break;case"Geometry":h=b.parse(f.data).geometry;break}h.uuid=f.uuid;if(f.name!==undefined){h.name=f.name}e[f.uuid]=h}}return e},parseMaterials:function(e){var c={};if(e!==undefined){var a=new THREE.MaterialLoader();for(var d=0,b=e.length;d<b;d++){var g=e[d];var f=a.parse(g);f.uuid=g.uuid;if(g.name!==undefined){f.name=g.name}c[g.uuid]=f}}return c},parseObject:function(){var a=new THREE.Matrix4();return function(f,e,b){var c;switch(f.type){case"Scene":c=new THREE.Scene();break;case"PerspectiveCamera":c=new THREE.PerspectiveCamera(f.fov,f.aspect,f.near,f.far);break;case"OrthographicCamera":c=new THREE.OrthographicCamera(f.left,f.right,f.top,f.bottom,f.near,f.far);break;case"AmbientLight":c=new THREE.AmbientLight(f.color);break;case"DirectionalLight":c=new THREE.DirectionalLight(f.color,f.intensity);break;case"PointLight":c=new THREE.PointLight(f.color,f.intensity,f.distance);break;case"SpotLight":c=new THREE.SpotLight(f.color,f.intensity,f.distance,f.angle,f.exponent);break;case"HemisphereLight":c=new THREE.HemisphereLight(f.color,f.groundColor,f.intensity);break;case"Mesh":var g=e[f.geometry];var d=b[f.material];if(g===undefined){console.error("THREE.ObjectLoader: Undefined geometry "+f.geometry)}if(d===undefined){console.error("THREE.ObjectLoader: Undefined material "+f.material)}c=new THREE.Mesh(g,d);break;case"Sprite":var d=b[f.material];if(d===undefined){console.error("THREE.ObjectLoader: Undefined material "+f.material)}c=new THREE.Sprite(d);break;default:c=new THREE.Object3D()}c.uuid=f.uuid;if(f.name!==undefined){c.name=f.name}if(f.matrix!==undefined){a.fromArray(f.matrix);a.decompose(c.position,c.quaternion,c.scale)}else{if(f.position!==undefined){c.position.fromArray(f.position)}if(f.rotation!==undefined){c.rotation.fromArray(f.rotation)}if(f.scale!==undefined){c.scale.fromArray(f.scale)}}if(f.visible!==undefined){c.visible=f.visible}if(f.userData!==undefined){c.userData=f.userData}if(f.children!==undefined){for(var h in f.children){c.add(this.parseObject(f.children[h],e,b))}}return c}}()};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){};this.geometryHandlers={};this.hierarchyHandlers={};this.addGeometryHandler("ascii",THREE.JSONLoader)};THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(b,d,f,e){var c=this;var a=new THREE.XHRLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.load(b,function(g){c.parse(JSON.parse(g),d,b)})},setCrossOrigin:function(a){this.crossOrigin=a},addGeometryHandler:function(a,b){this.geometryHandlers[a]={loaderClass:b}},addHierarchyHandler:function(a,b){this.hierarchyHandlers[a]={loaderClass:b}},parse:function(Z,a,E){var al=this;var d=THREE.Loader.prototype.extractUrlBase(E);var am,aB,av,B,ap,p,C,aj,ak,f,e,ax,t,S,aC;var af=[];var v=Z;for(var aw in this.geometryHandlers){var g=this.geometryHandlers[aw]["loaderClass"];this.geometryHandlers[aw]["loaderObject"]=new g()}for(var aw in this.hierarchyHandlers){var g=this.hierarchyHandlers[aw]["loaderClass"];this.hierarchyHandlers[aw]["loaderObject"]=new g()}e=0;ax=0;aC={scene:new THREE.Scene(),geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}};if(v.transform){var an=v.transform.position,O=v.transform.rotation,at=v.transform.scale;if(an){aC.scene.position.fromArray(an)}if(O){aC.scene.rotation.fromArray(O)}if(at){aC.scene.scale.fromArray(at)}if(an||O||at){aC.scene.updateMatrix();aC.scene.updateMatrixWorld()}}function I(i,n){if(n=="relativeToHTML"){return i}else{return d+"/"+i}}function az(){ah(aC.scene,v.objects)}function ah(aR,aJ){var aX,a1,aM,aP,n,aF;for(var aG in aJ){var aZ=aC.objects[aG];var aN=aJ[aG];if(aZ===undefined){if(aN.type&&(aN.type in al.hierarchyHandlers)){if(aN.loading===undefined){var aH={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var aQ={};for(var aO in aN){if(!(aO in aH)){aQ[aO]=aN[aO]}}aB=aC.materials[aN.material];aN.loading=true;var aS=al.hierarchyHandlers[aN.type]["loaderObject"];if(aS.options){aS.load(I(aN.url,v.urlBaseType),T(aG,aR,aB,aN))}else{aS.load(I(aN.url,v.urlBaseType),T(aG,aR,aB,aN),aQ)}}}else{if(aN.geometry!==undefined){am=aC.geometries[aN.geometry];if(am){var aK=false;aB=aC.materials[aN.material];aK=aB instanceof THREE.ShaderMaterial;aM=aN.position;aP=aN.rotation;n=aN.scale;aX=aN.matrix;aF=aN.quaternion;if(!aN.material){aB=new THREE.MeshFaceMaterial(aC.face_materials[aN.geometry])}if((aB instanceof THREE.MeshFaceMaterial)&&aB.materials.length===0){aB=new THREE.MeshFaceMaterial(aC.face_materials[aN.geometry])}if(aB instanceof THREE.MeshFaceMaterial){for(var aW=0;aW<aB.materials.length;aW++){aK=aK||(aB.materials[aW] instanceof THREE.ShaderMaterial)}}if(aK){am.computeTangents()}if(aN.skin){aZ=new THREE.SkinnedMesh(am,aB)}else{if(aN.morph){aZ=new THREE.MorphAnimMesh(am,aB);if(aN.duration!==undefined){aZ.duration=aN.duration}if(aN.time!==undefined){aZ.time=aN.time}if(aN.mirroredLoop!==undefined){aZ.mirroredLoop=aN.mirroredLoop}if(aB.morphNormals){am.computeMorphNormals()}}else{aZ=new THREE.Mesh(am,aB)}}aZ.name=aG;if(aX){aZ.matrixAutoUpdate=false;aZ.matrix.set(aX[0],aX[1],aX[2],aX[3],aX[4],aX[5],aX[6],aX[7],aX[8],aX[9],aX[10],aX[11],aX[12],aX[13],aX[14],aX[15])}else{aZ.position.fromArray(aM);if(aF){aZ.quaternion.fromArray(aF)}else{aZ.rotation.fromArray(aP)}aZ.scale.fromArray(n)}aZ.visible=aN.visible;aZ.castShadow=aN.castShadow;aZ.receiveShadow=aN.receiveShadow;aR.add(aZ);aC.objects[aG]=aZ}}else{if(aN.type==="AmbientLight"||aN.type==="PointLight"||aN.type==="DirectionalLight"||aN.type==="SpotLight"||aN.type==="HemisphereLight"||aN.type==="AreaLight"){var aV=aN.color;var aL=aN.intensity;var aI=aN.distance;var aY=aN.position;var aU=aN.rotation;switch(aN.type){case"AmbientLight":aj=new THREE.AmbientLight(aV);break;case"PointLight":aj=new THREE.PointLight(aV,aL,aI);aj.position.fromArray(aY);break;case"DirectionalLight":aj=new THREE.DirectionalLight(aV,aL);aj.position.fromArray(aN.direction);break;case"SpotLight":aj=new THREE.SpotLight(aV,aL,aI,1);aj.angle=aN.angle;aj.position.fromArray(aY);aj.target.set(aY[0],aY[1]-aI,aY[2]);aj.target.applyEuler(new THREE.Euler(aU[0],aU[1],aU[2],"XYZ"));break;case"HemisphereLight":aj=new THREE.DirectionalLight(aV,aL,aI);aj.target.set(aY[0],aY[1]-aI,aY[2]);aj.target.applyEuler(new THREE.Euler(aU[0],aU[1],aU[2],"XYZ"));break;case"AreaLight":aj=new THREE.AreaLight(aV,aL);aj.position.fromArray(aY);aj.width=aN.size;aj.height=aN.size_y;break}aR.add(aj);aj.name=aG;aC.lights[aG]=aj;aC.objects[aG]=aj}else{if(aN.type==="PerspectiveCamera"||aN.type==="OrthographicCamera"){aM=aN.position;aP=aN.rotation;aF=aN.quaternion;if(aN.type==="PerspectiveCamera"){av=new THREE.PerspectiveCamera(aN.fov,aN.aspect,aN.near,aN.far)}else{if(aN.type==="OrthographicCamera"){av=new THREE.OrthographicCamera(aN.left,aN.right,aN.top,aN.bottom,aN.near,aN.far)}}av.name=aG;av.position.fromArray(aM);if(aF!==undefined){av.quaternion.fromArray(aF)}else{if(aP!==undefined){av.rotation.fromArray(aP)}}aR.add(av);aC.cameras[aG]=av;aC.objects[aG]=av}else{aM=aN.position;aP=aN.rotation;n=aN.scale;aF=aN.quaternion;aZ=new THREE.Object3D();aZ.name=aG;aZ.position.fromArray(aM);if(aF){aZ.quaternion.fromArray(aF)}else{aZ.rotation.fromArray(aP)}aZ.scale.fromArray(n);aZ.visible=(aN.visible!==undefined)?aN.visible:false;aR.add(aZ);aC.objects[aG]=aZ;aC.empties[aG]=aZ}}}}if(aZ){if(aN.userData!==undefined){for(var a0 in aN.userData){var aT=aN.userData[a0];aZ.userData[a0]=aT}}if(aN.groups!==undefined){for(var aW=0;aW<aN.groups.length;aW++){var aE=aN.groups[aW];if(aC.groups[aE]===undefined){aC.groups[aE]=[]}aC.groups[aE].push(aG)}}}}if(aZ!==undefined&&aN.children!==undefined){ah(aZ,aN.children)}}}function ai(n,i,aE){aC.geometries[aE]=n;aC.face_materials[aE]=i;az()}function ad(aH,aE,aK,aJ,aI){var aF=aI.position;var i=aI.rotation;var n=aI.quaternion;var aL=aI.scale;aH.position.fromArray(aF);if(n){aH.quaternion.fromArray(n)}else{aH.rotation.fromArray(i)}aH.scale.fromArray(aL);if(aJ){aH.traverse(function(aM){aM.material=aJ})}var aG=(aI.visible!==undefined)?aI.visible:true;aH.traverse(function(aM){aM.visible=aG});aK.add(aH);aH.name=aE;aC.objects[aE]=aH;az()}function k(i){return function(aE,n){aE.name=i;ai(aE,n,i);e-=1;al.onLoadComplete();Y()}}function T(aF,n,i,aE){return function(aH){var aG;if(aH.content){aG=aH.content}else{if(aH.dae){aG=aH.scene}else{aG=aH}}ad(aG,aF,n,i,aE);e-=1;al.onLoadComplete();Y()}}function H(i){return function(aE,n){aE.name=i;aC.geometries[i]=aE;aC.face_materials[i]=n}}function Y(){var i={totalModels:t,totalTextures:S,loadedModels:t-e,loadedTextures:S-ax};al.callbackProgress(i,aC);al.onLoadProgress();if(e===0&&ax===0){aD();a(aC)}}function aD(){for(var aE=0;aE<af.length;aE++){var n=af[aE];var aF=aC.objects[n.targetName];if(aF){n.object.target=aF}else{n.object.target=new THREE.Object3D();aC.scene.add(n.object.target)}n.object.target.userData.targetInverse=n.object}}var ag=function(i){ax-=i;Y();al.onLoadComplete()};var r=function(i){return function(){ag(i)}};function N(i,aE){aE(i);if(i.children!==undefined){for(var n in i.children){N(i.children[n],aE)}}}var D,au;for(D in v.fogs){au=v.fogs[D];if(au.type==="linear"){B=new THREE.Fog(0,au.near,au.far)}else{if(au.type==="exp2"){B=new THREE.FogExp2(0,au.density)}}C=au.color;B.color.setRGB(C[0],C[1],C[2]);aC.fogs[D]=B}var X,ac;for(X in v.geometries){ac=v.geometries[X];if(ac.type in this.geometryHandlers){e+=1;al.onLoadStart()}}for(var j in v.objects){N(v.objects[j],function(i){if(i.type&&(i.type in al.hierarchyHandlers)){e+=1;al.onLoadStart()}})}t=e;for(X in v.geometries){ac=v.geometries[X];if(ac.type==="cube"){am=new THREE.CubeGeometry(ac.width,ac.height,ac.depth,ac.widthSegments,ac.heightSegments,ac.depthSegments);am.name=X;aC.geometries[X]=am}else{if(ac.type==="plane"){am=new THREE.PlaneGeometry(ac.width,ac.height,ac.widthSegments,ac.heightSegments);am.name=X;aC.geometries[X]=am}else{if(ac.type==="sphere"){am=new THREE.SphereGeometry(ac.radius,ac.widthSegments,ac.heightSegments);am.name=X;aC.geometries[X]=am}else{if(ac.type==="cylinder"){am=new THREE.CylinderGeometry(ac.topRad,ac.botRad,ac.height,ac.radSegs,ac.heightSegs);am.name=X;aC.geometries[X]=am}else{if(ac.type==="torus"){am=new THREE.TorusGeometry(ac.radius,ac.tube,ac.segmentsR,ac.segmentsT);am.name=X;aC.geometries[X]=am}else{if(ac.type==="icosahedron"){am=new THREE.IcosahedronGeometry(ac.radius,ac.subdivisions);am.name=X;aC.geometries[X]=am}else{if(ac.type in this.geometryHandlers){var V={};for(var L in ac){if(L!=="type"&&L!=="url"){V[L]=ac[L]}}var J=this.geometryHandlers[ac.type]["loaderObject"];J.load(I(ac.url,v.urlBaseType),k(X),V)}else{if(ac.type==="embedded"){var m=v.embeds[ac.id],b="";m.metadata=v.metadata;if(m){var Q=this.geometryHandlers.ascii["loaderObject"];var F=Q.parse(m,b);H(X)(F.geometry,F.materials)}}}}}}}}}}var ao,ab;for(ao in v.textures){ab=v.textures[ao];if(ab.url instanceof Array){ax+=ab.url.length;for(var P=0;P<ab.url.length;P++){al.onLoadStart()}}else{ax+=1;al.onLoadStart()}}S=ax;for(ao in v.textures){ab=v.textures[ao];if(ab.mapping!==undefined&&THREE[ab.mapping]!==undefined){ab.mapping=new THREE[ab.mapping]()}if(ab.url instanceof Array){var h=ab.url.length;var M=[];for(var R=0;R<h;R++){M[R]=I(ab.url[R],v.urlBaseType)}var l=/\.dds$/i.test(M[0]);if(l){ap=THREE.ImageUtils.loadCompressedTextureCube(M,ab.mapping,r(h))}else{ap=THREE.ImageUtils.loadTextureCube(M,ab.mapping,r(h))}}else{var l=/\.dds$/i.test(ab.url);var ar=I(ab.url,v.urlBaseType);var aA=r(1);if(l){ap=THREE.ImageUtils.loadCompressedTexture(ar,ab.mapping,aA)}else{ap=THREE.ImageUtils.loadTexture(ar,ab.mapping,aA)}if(THREE[ab.minFilter]!==undefined){ap.minFilter=THREE[ab.minFilter]}if(THREE[ab.magFilter]!==undefined){ap.magFilter=THREE[ab.magFilter]}if(ab.anisotropy){ap.anisotropy=ab.anisotropy}if(ab.repeat){ap.repeat.set(ab.repeat[0],ab.repeat[1]);if(ab.repeat[0]!==1){ap.wrapS=THREE.RepeatWrapping}if(ab.repeat[1]!==1){ap.wrapT=THREE.RepeatWrapping}}if(ab.offset){ap.offset.set(ab.offset[0],ab.offset[1])}if(ab.wrap){var U={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(U[ab.wrap[0]]!==undefined){ap.wrapS=U[ab.wrap[0]]}if(U[ab.wrap[1]]!==undefined){ap.wrapT=U[ab.wrap[1]]}}}aC.textures[ao]=ap}var s,ay;var ae;for(s in v.materials){ay=v.materials[s];for(ae in ay.parameters){if(ae==="envMap"||ae==="map"||ae==="lightMap"||ae==="bumpMap"){ay.parameters[ae]=aC.textures[ay.parameters[ae]]}else{if(ae==="shading"){ay.parameters[ae]=(ay.parameters[ae]==="flat")?THREE.FlatShading:THREE.SmoothShading}else{if(ae==="side"){if(ay.parameters[ae]=="double"){ay.parameters[ae]=THREE.DoubleSide}else{if(ay.parameters[ae]=="back"){ay.parameters[ae]=THREE.BackSide}else{ay.parameters[ae]=THREE.FrontSide}}}else{if(ae==="blending"){ay.parameters[ae]=ay.parameters[ae] in THREE?THREE[ay.parameters[ae]]:THREE.NormalBlending}else{if(ae==="combine"){ay.parameters[ae]=ay.parameters[ae] in THREE?THREE[ay.parameters[ae]]:THREE.MultiplyOperation}else{if(ae==="vertexColors"){if(ay.parameters[ae]=="face"){ay.parameters[ae]=THREE.FaceColors}else{if(ay.parameters[ae]){ay.parameters[ae]=THREE.VertexColors}}}else{if(ae==="wrapRGB"){var aa=ay.parameters[ae];ay.parameters[ae]=new THREE.Vector3(aa[0],aa[1],aa[2])}}}}}}}}if(ay.parameters.opacity!==undefined&&ay.parameters.opacity<1){ay.parameters.transparent=true}if(ay.parameters.normalMap){var aq=THREE.ShaderLib.normalmap;var u=THREE.UniformsUtils.clone(aq.uniforms);var o=ay.parameters.color;var c=ay.parameters.specular;var K=ay.parameters.ambient;var W=ay.parameters.shininess;u.tNormal.value=aC.textures[ay.parameters.normalMap];if(ay.parameters.normalScale){u.uNormalScale.value.set(ay.parameters.normalScale[0],ay.parameters.normalScale[1])}if(ay.parameters.map){u.tDiffuse.value=ay.parameters.map;u.enableDiffuse.value=true}if(ay.parameters.envMap){u.tCube.value=ay.parameters.envMap;u.enableReflection.value=true;u.uReflectivity.value=ay.parameters.reflectivity}if(ay.parameters.lightMap){u.tAO.value=ay.parameters.lightMap;u.enableAO.value=true}if(ay.parameters.specularMap){u.tSpecular.value=aC.textures[ay.parameters.specularMap];u.enableSpecular.value=true}if(ay.parameters.displacementMap){u.tDisplacement.value=aC.textures[ay.parameters.displacementMap];u.enableDisplacement.value=true;u.uDisplacementBias.value=ay.parameters.displacementBias;u.uDisplacementScale.value=ay.parameters.displacementScale}u.uDiffuseColor.value.setHex(o);u.uSpecularColor.value.setHex(c);u.uAmbientColor.value.setHex(K);u.uShininess.value=W;if(ay.parameters.opacity){u.uOpacity.value=ay.parameters.opacity}var G={fragmentShader:aq.fragmentShader,vertexShader:aq.vertexShader,uniforms:u,lights:true,fog:true};aB=new THREE.ShaderMaterial(G)}else{aB=new THREE[ay.type](ay.parameters)}aB.name=s;aC.materials[s]=aB}for(s in v.materials){ay=v.materials[s];if(ay.parameters.materials){var A=[];for(var R=0;R<ay.parameters.materials.length;R++){var q=ay.parameters.materials[R];A.push(aC.materials[q])}aC.materials[s].materials=A}}az();if(aC.cameras&&v.defaults.camera){aC.currentCamera=aC.cameras[v.defaults.camera]}if(aC.fogs&&v.defaults.fog){aC.scene.fog=aC.fogs[v.defaults.fog]}al.callbackSync(aC);Y()}};THREE.TextureLoader=function(a){this.manager=(a!==undefined)?a:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(b,d,f,e){var c=this;var a=new THREE.ImageLoader(c.manager);a.setCrossOrigin(this.crossOrigin);a.load(b,function(h){var g=new THREE.Texture(h);g.needsUpdate=true;if(d!==undefined){d(g)}})},setCrossOrigin:function(a){this.crossOrigin=a}};THREE.Material=function(){this.id=THREE.MaterialIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.depthTest=true;this.depthWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this.needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,setValues:function(a){if(a===undefined){return}for(var b in a){var d=a[b];if(d===undefined){console.warn("THREE.Material: '"+b+"' parameter is undefined.");continue}if(b in this){var c=this[b];if(c instanceof THREE.Color){c.set(d)}else{if(c instanceof THREE.Vector3&&d instanceof THREE.Vector3){c.copy(d)}else{if(b=="overdraw"){this[b]=Number(d)}else{this[b]=d}}}}}},clone:function(a){if(a===undefined){a=new THREE.Material()}a.name=this.name;a.side=this.side;a.opacity=this.opacity;a.transparent=this.transparent;a.blending=this.blending;a.blendSrc=this.blendSrc;a.blendDst=this.blendDst;a.blendEquation=this.blendEquation;a.depthTest=this.depthTest;a.depthWrite=this.depthWrite;a.polygonOffset=this.polygonOffset;a.polygonOffsetFactor=this.polygonOffsetFactor;a.polygonOffsetUnits=this.polygonOffsetUnits;a.alphaTest=this.alphaTest;a.overdraw=this.overdraw;a.visible=this.visible;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.clone=function(){var a=new THREE.LineBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.linecap=this.linecap;a.linejoin=this.linejoin;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.LineDashedMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.clone=function(){var a=new THREE.LineDashedMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.linewidth=this.linewidth;a.scale=this.scale;a.dashSize=this.dashSize;a.gapSize=this.gapSize;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.MeshBasicMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(a)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.clone=function(){var a=new THREE.MeshBasicMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;return a};THREE.MeshLambertMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.clone=function(){var a=new THREE.MeshLambertMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.MeshPhongMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.ambient=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.perPixel=true;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=0.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(a)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.clone=function(){var a=new THREE.MeshPhongMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.ambient.copy(this.ambient);a.emissive.copy(this.emissive);a.specular.copy(this.specular);a.shininess=this.shininess;a.metal=this.metal;a.perPixel=this.perPixel;a.wrapAround=this.wrapAround;a.wrapRGB.copy(this.wrapRGB);a.map=this.map;a.lightMap=this.lightMap;a.bumpMap=this.bumpMap;a.bumpScale=this.bumpScale;a.normalMap=this.normalMap;a.normalScale.copy(this.normalScale);a.specularMap=this.specularMap;a.envMap=this.envMap;a.combine=this.combine;a.reflectivity=this.reflectivity;a.refractionRatio=this.refractionRatio;a.fog=this.fog;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.wireframeLinecap=this.wireframeLinecap;a.wireframeLinejoin=this.wireframeLinejoin;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.MeshDepthMaterial=function(a){THREE.Material.call(this);this.wireframe=false;this.wireframeLinewidth=1;this.setValues(a)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.clone=function(){var a=new THREE.MeshDepthMaterial();THREE.Material.prototype.clone.call(this,a);a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);this.shading=THREE.FlatShading;this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(a)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.clone=function(){var a=new THREE.MeshNormalMaterial();THREE.Material.prototype.clone.call(this,a);a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;return a};THREE.MeshFaceMaterial=function(a){this.materials=a instanceof Array?a:[]};THREE.MeshFaceMaterial.prototype.clone=function(){var b=new THREE.MeshFaceMaterial();for(var a=0;a<this.materials.length;a++){b.materials.push(this.materials[a].clone())}return b};THREE.ParticleSystemMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=false;this.fog=true;this.setValues(a)};THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ParticleSystemMaterial.prototype.clone=function(){var a=new THREE.ParticleSystemMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.size=this.size;a.sizeAttenuation=this.sizeAttenuation;a.vertexColors=this.vertexColors;a.fog=this.fog;return a};THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial;THREE.ShaderMaterial=function(a){THREE.Material.call(this);this.fragmentShader="void main() {}";this.vertexShader="void main() {}";this.uniforms={};this.defines={};this.attributes=null;this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName="position";this.setValues(a)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.clone=function(){var a=new THREE.ShaderMaterial();THREE.Material.prototype.clone.call(this,a);a.fragmentShader=this.fragmentShader;a.vertexShader=this.vertexShader;a.uniforms=THREE.UniformsUtils.clone(this.uniforms);a.attributes=this.attributes;a.defines=this.defines;a.shading=this.shading;a.wireframe=this.wireframe;a.wireframeLinewidth=this.wireframeLinewidth;a.fog=this.fog;a.lights=this.lights;a.vertexColors=this.vertexColors;a.skinning=this.skinning;a.morphTargets=this.morphTargets;a.morphNormals=this.morphNormals;return a};THREE.SpriteMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1);this.setValues(a)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.clone=function(){var a=new THREE.SpriteMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.map=this.map;a.rotation=this.rotation;a.uvOffset.copy(this.uvOffset);a.uvScale.copy(this.uvScale);a.fog=this.fog;return a};THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.color=new THREE.Color(16777215);this.program=function(c,b){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial();THREE.Material.prototype.clone.call(this,a);a.color.copy(this.color);a.program=this.program;return a};THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial;THREE.Texture=function(d,b,f,e,i,c,h,g,a){this.id=THREE.TextureIdCount++;this.uuid=THREE.Math.generateUUID();this.name="";this.image=d;this.mipmaps=[];this.mapping=b!==undefined?b:new THREE.UVMapping();this.wrapS=f!==undefined?f:THREE.ClampToEdgeWrapping;this.wrapT=e!==undefined?e:THREE.ClampToEdgeWrapping;this.magFilter=i!==undefined?i:THREE.LinearFilter;this.minFilter=c!==undefined?c:THREE.LinearMipMapLinearFilter;this.anisotropy=a!==undefined?a:1;this.format=h!==undefined?h:THREE.RGBAFormat;this.type=g!==undefined?g:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this.needsUpdate=false;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(a){if(a===undefined){a=new THREE.Texture()}a.image=this.image;a.mipmaps=this.mipmaps.slice(0);a.mapping=this.mapping;a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.format=this.format;a.type=this.type;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.generateMipmaps=this.generateMipmaps;a.premultiplyAlpha=this.premultiplyAlpha;a.flipY=this.flipY;a.unpackAlignment=this.unpackAlignment;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CompressedTexture=function(e,d,k,i,h,b,g,f,j,c,a){THREE.Texture.call(this,null,b,g,f,j,c,i,h,a);this.image={width:d,height:k};this.mipmaps=e;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.clone=function(){var a=new THREE.CompressedTexture();THREE.Texture.prototype.clone.call(this,a);return a};THREE.DataTexture=function(f,d,k,i,h,b,g,e,j,c,a){THREE.Texture.call(this,null,b,g,e,j,c,i,h,a);this.image={data:f,width:d,height:k}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture();THREE.Texture.prototype.clone.call(this,a);return a};THREE.ParticleSystem=function(b,a){THREE.Object3D.call(this);this.geometry=b!==undefined?b:new THREE.Geometry();this.material=a!==undefined?a:new THREE.ParticleSystemMaterial({color:Math.random()*16777215});this.sortParticles=false;this.frustumCulled=false};THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype);THREE.ParticleSystem.prototype.clone=function(a){if(a===undefined){a=new THREE.ParticleSystem(this.geometry,this.material)}a.sortParticles=this.sortParticles;THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Line=function(c,b,a){THREE.Object3D.call(this);this.geometry=c!==undefined?c:new THREE.Geometry();this.material=b!==undefined?b:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.type=(a!==undefined)?a:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.clone=function(a){if(a===undefined){a=new THREE.Line(this.geometry,this.material,this.type)}THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Mesh=function(b,a){THREE.Object3D.call(this);this.geometry=b!==undefined?b:new THREE.Geometry();this.material=a!==undefined?a:new THREE.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(a){if(this.morphTargetDictionary[a]!==undefined){return this.morphTargetDictionary[a]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.clone=function(a){if(a===undefined){a=new THREE.Mesh(this.geometry,this.material)}THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Bone=function(a){THREE.Object3D.call(this);this.skin=a;this.skinMatrix=new THREE.Matrix4()};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.update=function(d,b){if(this.matrixAutoUpdate){b|=this.updateMatrix()}if(b||this.matrixWorldNeedsUpdate){if(d){this.skinMatrix.multiplyMatrices(d,this.matrix)}else{this.skinMatrix.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;b=true}var e,c,a=this.children.length;for(c=0;c<a;c++){this.children[c].update(this.skinMatrix,b)}};THREE.SkinnedMesh=function(f,e,d){THREE.Mesh.call(this,f,e);this.useVertexTexture=d!==undefined?d:true;this.identityMatrix=new THREE.Matrix4();this.bones=[];this.boneMatrices=[];var g,i,j,c,a,l;if(this.geometry&&this.geometry.bones!==undefined){for(g=0;g<this.geometry.bones.length;g++){j=this.geometry.bones[g];c=j.pos;a=j.rotq;l=j.scl;i=this.addBone();i.name=j.name;i.position.set(c[0],c[1],c[2]);i.quaternion.set(a[0],a[1],a[2],a[3]);if(l!==undefined){i.scale.set(l[0],l[1],l[2])}else{i.scale.set(1,1,1)}}for(g=0;g<this.bones.length;g++){j=this.geometry.bones[g];i=this.bones[g];if(j.parent===-1){this.add(i)}else{this.bones[j.parent].add(i)}}var h=this.bones.length;if(this.useVertexTexture){var k;if(h>256){k=64}else{if(h>64){k=32}else{if(h>16){k=16}else{k=8}}}this.boneTextureWidth=k;this.boneTextureHeight=k;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*h)}this.pose()}};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.addBone=function(a){if(a===undefined){a=new THREE.Bone(this)}this.bones.push(a);return a};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var a=new THREE.Matrix4();return function(g){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||g){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;g=true}for(var f=0,e=this.children.length;f<e;f++){var j=this.children[f];if(j instanceof THREE.Bone){j.update(this.identityMatrix,false)}else{j.updateMatrixWorld(true)}}if(this.boneInverses==undefined){this.boneInverses=[];for(var c=0,h=this.bones.length;c<h;c++){var d=new THREE.Matrix4();d.getInverse(this.bones[c].skinMatrix);this.boneInverses.push(d)}}for(var c=0,h=this.bones.length;c<h;c++){a.multiplyMatrices(this.bones[c].skinMatrix,this.boneInverses[c]);a.flattenToArrayOffset(this.boneMatrices,c*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);this.normalizeSkinWeights()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var b=0;b<this.geometry.skinIndices.length;b++){var a=this.geometry.skinWeights[b];var c=1/a.lengthManhattan();if(c!==Infinity){a.multiplyScalar(c)}else{a.set(1)}}}else{}};THREE.SkinnedMesh.prototype.clone=function(a){if(a===undefined){a=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}THREE.Mesh.prototype.clone.call(this,a);return a};THREE.MorphAnimMesh=function(b,a){THREE.Mesh.call(this,b,a);this.duration=1000;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.setFrameRange=function(b,a){this.startKeyframe=b;this.endKeyframe=a;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var g=this.geometry;if(!g.animations){g.animations={}}var a,l=g.animations;var f=/([a-z]+)(\d+)/;for(var d=0,j=g.morphTargets.length;d<j;d++){var k=g.morphTargets[d];var c=k.name.match(f);if(c&&c.length>1){var h=c[1];var e=c[2];if(!l[h]){l[h]={start:Infinity,end:-Infinity}}var b=l[h];if(d<b.start){b.start=d}if(d>b.end){b.end=d}if(!a){a=h}}}g.firstAnimation=a};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(b,c,a){if(!this.geometry.animations){this.geometry.animations={}}this.geometry.animations[b]={start:c,end:a}};THREE.MorphAnimMesh.prototype.playAnimation=function(a,c){var b=this.geometry.animations[a];if(b){this.setFrameRange(b.start,b.end);this.duration=1000*((b.end-b.start)/c);this.time=0}else{console.warn("animation["+a+"] undefined")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(d){var c=this.duration/this.length;this.time+=this.direction*d;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0){this.time+=this.duration}}var a=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/c),0,this.length-1);if(a!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[a]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=a}var b=(this.time%c)/c;if(this.directionBackwards){b=1-b}this.morphTargetInfluences[this.currentKeyframe]=b;this.morphTargetInfluences[this.lastKeyframe]=1-b};THREE.MorphAnimMesh.prototype.clone=function(a){if(a===undefined){a=new THREE.MorphAnimMesh(this.geometry,this.material)}a.duration=this.duration;a.mirroredLoop=this.mirroredLoop;a.time=this.time;a.lastKeyframe=this.lastKeyframe;a.currentKeyframe=this.currentKeyframe;a.direction=this.direction;a.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,a);return a};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.addLevel=function(b,c){if(c===undefined){c=0}c=Math.abs(c);for(var a=0;a<this.objects.length;a++){if(c<this.objects[a].distance){break}}this.objects.splice(a,0,{distance:c,object:b});this.add(b)};THREE.LOD.prototype.getObjectForDistance=function(c){for(var b=1,a=this.objects.length;b<a;b++){if(c<this.objects[b].distance){break}}return this.objects[b-1].object};THREE.LOD.prototype.update=function(){var b=new THREE.Vector3();var a=new THREE.Vector3();return function(e){if(this.objects.length>1){b.getPositionFromMatrix(e.matrixWorld);a.getPositionFromMatrix(this.matrixWorld);var f=b.distanceTo(a);this.objects[0].object.visible=true;for(var d=1,c=this.objects.length;d<c;d++){if(f>=this.objects[d].distance){this.objects[d-1].object.visible=false;this.objects[d].object.visible=true}else{break}}for(;d<c;d++){this.objects[d].object.visible=false}}}}();THREE.LOD.prototype.clone=function(){};THREE.Sprite=function(a){THREE.Object3D.call(this);this.material=(a!==undefined)?a:new THREE.SpriteMaterial()};THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true};THREE.Sprite.prototype.clone=function(a){if(a===undefined){a=new THREE.Sprite(this.material)}THREE.Object3D.prototype.clone.call(this,a);return a};THREE.Particle=THREE.Sprite;THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.autoUpdate=true;this.matrixAutoUpdate=false;this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.__addObject=function(a){if(a instanceof THREE.Light){if(this.__lights.indexOf(a)===-1){this.__lights.push(a)}if(a.target&&a.target.parent===undefined){this.add(a.target)}}else{if(!(a instanceof THREE.Camera||a instanceof THREE.Bone)){this.__objectsAdded.push(a);var b=this.__objectsRemoved.indexOf(a);if(b!==-1){this.__objectsRemoved.splice(b,1)}}}for(var d=0;d<a.children.length;d++){this.__addObject(a.children[d])}};THREE.Scene.prototype.__removeObject=function(b){if(b instanceof THREE.Light){var d=this.__lights.indexOf(b);if(d!==-1){this.__lights.splice(d,1)}if(b.shadowCascadeArray){for(var a=0;a<b.shadowCascadeArray.length;a++){this.__removeObject(b.shadowCascadeArray[a])}}}else{if(!(b instanceof THREE.Camera)){this.__objectsRemoved.push(b);var d=this.__objectsAdded.indexOf(b);if(d!==-1){this.__objectsAdded.splice(d,1)}}}for(var e=0;e<b.children.length;e++){this.__removeObject(b.children[e])}};THREE.Scene.prototype.clone=function(a){if(a===undefined){a=new THREE.Scene()}THREE.Object3D.prototype.clone.call(this,a);if(this.fog!==null){a.fog=this.fog.clone()}if(this.overrideMaterial!==null){a.overrideMaterial=this.overrideMaterial.clone()}a.autoUpdate=this.autoUpdate;a.matrixAutoUpdate=this.matrixAutoUpdate;return a};THREE.Fog=function(c,b,a){this.name="";this.color=new THREE.Color(c);this.near=(b!==undefined)?b:1;this.far=(a!==undefined)?a:1000};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(b,a){this.name="";this.color=new THREE.Color(b);this.density=(a!==undefined)?a:0.00025};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.CanvasRenderer=function(H){console.log("THREE.CanvasRenderer",THREE.REVISION);var aI=THREE.Math.smoothstep;H=H||{};var A=this,E,J,m,a=new THREE.Projector(),i=H.canvas!==undefined?H.canvas:document.createElement("canvas"),C=i.width,aH=i.height,ao=Math.floor(C/2),M=Math.floor(aH/2),e=i.getContext("2d"),K=new THREE.Color(0),aD=0,aJ=1,aF=0,B=null,aE=null,P=null,k=null,aA=null,N=null,av=0,aT,an,al,aj,ai,ah=new THREE.RenderableVertex(),af=new THREE.RenderableVertex(),v,u,d,b,aR,aO,aC,aB,ab,Z,S,R,f=new THREE.Color(),r=new THREE.Color(),q=new THREE.Color(),p=new THREE.Color(),o=new THREE.Color(),ad=new THREE.Color(),s=new THREE.Color(),ax=new THREE.Color(),L={},W={},V,aW,ae,j,aQ,aM,az,aw,aa,Y,aV=new THREE.Box2(),t=new THREE.Box2(),D=new THREE.Box2(),aL=new THREE.Color(),G=new THREE.Color(),ak=new THREE.Color(),l=new THREE.Vector3(),aP,h,aS,U,Q,T,am=16;aP=document.createElement("canvas");aP.width=aP.height=2;h=aP.getContext("2d");h.fillStyle="rgba(0,0,0,1)";h.fillRect(0,0,2,2);aS=h.getImageData(0,0,2,2);U=aS.data;Q=document.createElement("canvas");Q.width=Q.height=am;T=Q.getContext("2d");T.translate(-am/2,-am/2);T.scale(am,am);am--;if(e.setLineDash===undefined){if(e.mozDash!==undefined){e.setLineDash=function(aY){e.mozDash=aY[0]!==null?aY:null}}else{e.setLineDash=function(){}}}this.domElement=i;this.devicePixelRatio=H.devicePixelRatio!==undefined?H.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.setSize=function(aZ,aY,a0){C=aZ*this.devicePixelRatio;aH=aY*this.devicePixelRatio;ao=Math.floor(C/2);M=Math.floor(aH/2);i.width=C;i.height=aH;if(this.devicePixelRatio!==1&&a0!==false){i.style.width=aZ+"px";i.style.height=aY+"px"}aV.set(new THREE.Vector2(-ao,-M),new THREE.Vector2(ao,M));t.set(new THREE.Vector2(-ao,-M),new THREE.Vector2(ao,M));aJ=1;aF=0;B=null;aE=null;P=null;k=null;aA=null};this.setClearColor=function(aY,aZ){K.set(aY);aD=aZ!==undefined?aZ:1;t.set(new THREE.Vector2(-ao,-M),new THREE.Vector2(ao,M))};this.setClearColorHex=function(aY,aZ){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(aY,aZ)};this.getMaxAnisotropy=function(){return 0};this.clear=function(){e.setTransform(1,0,0,-1,ao,M);if(t.empty()===false){t.intersect(aV);t.expandByScalar(2);if(aD<1){e.clearRect(t.min.x|0,t.min.y|0,(t.max.x-t.min.x)|0,(t.max.y-t.min.y)|0)}if(aD>0){ar(THREE.NormalBlending);F(1);ap("rgba("+Math.floor(K.r*255)+","+Math.floor(K.g*255)+","+Math.floor(K.b*255)+","+aD+")");e.fillRect(t.min.x|0,t.min.y|0,(t.max.x-t.min.x)|0,(t.max.y-t.min.y)|0)}t.makeEmpty()}};this.render=function(a3,a1){if(a1 instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}if(this.autoClear===true){this.clear()}e.setTransform(1,0,0,-1,ao,M);A.info.render.vertices=0;A.info.render.faces=0;E=a.projectScene(a3,a1,this.sortObjects,this.sortElements);J=E.elements;m=E.lights;aT=a1;au();for(var a2=0,a0=J.length;a2<a0;a2++){var aY=J[a2];var aZ=aY.material;if(aZ===undefined||aZ.visible===false){continue}D.makeEmpty();if(aY instanceof THREE.RenderableSprite){an=aY;an.x*=ao;an.y*=M;n(an,aY,aZ)}else{if(aY instanceof THREE.RenderableLine){an=aY.v1;al=aY.v2;an.positionScreen.x*=ao;an.positionScreen.y*=M;al.positionScreen.x*=ao;al.positionScreen.y*=M;D.setFromPoints([an.positionScreen,al.positionScreen]);if(aV.isIntersectionBox(D)===true){ay(an,al,aY,aZ)}}else{if(aY instanceof THREE.RenderableFace3){an=aY.v1;al=aY.v2;aj=aY.v3;if(an.positionScreen.z<-1||an.positionScreen.z>1){continue}if(al.positionScreen.z<-1||al.positionScreen.z>1){continue}if(aj.positionScreen.z<-1||aj.positionScreen.z>1){continue}an.positionScreen.x*=ao;an.positionScreen.y*=M;al.positionScreen.x*=ao;al.positionScreen.y*=M;aj.positionScreen.x*=ao;aj.positionScreen.y*=M;if(aZ.overdraw>0){aq(an.positionScreen,al.positionScreen,aZ.overdraw);aq(al.positionScreen,aj.positionScreen,aZ.overdraw);aq(aj.positionScreen,an.positionScreen,aZ.overdraw)}D.setFromPoints([an.positionScreen,al.positionScreen,aj.positionScreen]);if(aV.isIntersectionBox(D)===true){aX(an,al,aj,0,1,2,aY,aZ)}}}}t.union(D)}e.setTransform(1,0,0,1,0,0)};function au(){aL.setRGB(0,0,0);G.setRGB(0,0,0);ak.setRGB(0,0,0);for(var a0=0,a1=m.length;a0<a1;a0++){var aZ=m[a0];var aY=aZ.color;if(aZ instanceof THREE.AmbientLight){aL.add(aY)}else{if(aZ instanceof THREE.DirectionalLight){G.add(aY)}else{if(aZ instanceof THREE.PointLight){ak.add(aY)}}}}}function c(aY,a5,a2){for(var a1=0,a4=m.length;a1<a4;a1++){var a0=m[a1];ax.copy(a0.color);if(a0 instanceof THREE.DirectionalLight){var aZ=l.getPositionFromMatrix(a0.matrixWorld).normalize();var a3=a5.dot(aZ);if(a3<=0){continue}a3*=a0.intensity;a2.add(ax.multiplyScalar(a3))}else{if(a0 instanceof THREE.PointLight){var aZ=l.getPositionFromMatrix(a0.matrixWorld);var a3=a5.dot(l.subVectors(aZ,aY).normalize());if(a3<=0){continue}a3*=a0.distance==0?1:1-Math.min(aY.distanceTo(aZ)/a0.distance,1);if(a3==0){continue}a3*=a0.intensity;a2.add(ax.multiplyScalar(a3))}}}}function n(a3,a0,a1){F(a1.opacity);ar(a1.blending);var aZ=a0.scale.x*ao;var aY=a0.scale.y*M;D.min.set(a3.x-(aZ*0.5),a3.y-(aY*0.5));D.max.set(a3.x+(aZ*0.5),a3.y+(aY*0.5));if(aV.isIntersectionBox(D)===false){D.makeEmpty();return}if(a1 instanceof THREE.SpriteMaterial||a1 instanceof THREE.ParticleSystemMaterial){if(a1.map!==null){var a2=a1.map.image;e.save();e.translate(a3.x,a3.y);e.rotate(-a1.rotation);e.scale(aZ,-aY);e.drawImage(a2,0,0,a2.width,a2.height,-0.5,-0.5,1,1);e.restore()}else{ap(a1.color.getStyle());e.save();e.translate(a3.x,a3.y);e.rotate(-a0.rotation);e.scale(aZ,aY);e.fillRect(-0.5,-0.5,1,1);e.restore()}}else{if(a1 instanceof THREE.SpriteCanvasMaterial){aG(a1.color.getStyle());ap(a1.color.getStyle());e.save();e.translate(a3.x,a3.y);e.rotate(-a0.rotation);e.scale(aZ,aY);a1.program(e);e.restore()}}}function ay(a5,a3,a1,a2){F(a2.opacity);ar(a2.blending);e.beginPath();e.moveTo(a5.positionScreen.x,a5.positionScreen.y);e.lineTo(a3.positionScreen.x,a3.positionScreen.y);if(a2 instanceof THREE.LineBasicMaterial){O(a2.linewidth);ag(a2.linecap);aN(a2.linejoin);if(a2.vertexColors!==THREE.VertexColors){aG(a2.color.getStyle())}else{var a0=a1.vertexColors[0].getStyle();var aY=a1.vertexColors[1].getStyle();if(a0===aY){aG(a0)}else{try{var a4=e.createLinearGradient(a5.positionScreen.x,a5.positionScreen.y,a3.positionScreen.x,a3.positionScreen.y);a4.addColorStop(0,a0);a4.addColorStop(1,aY)}catch(aZ){a4=a0}aG(a4)}}e.stroke();D.expandByScalar(a2.linewidth*2)}else{if(a2 instanceof THREE.LineDashedMaterial){O(a2.linewidth);ag(a2.linecap);aN(a2.linejoin);aG(a2.color.getStyle());ac(a2.dashSize,a2.gapSize);e.stroke();D.expandByScalar(a2.linewidth*2);ac(null,null)}}}function aX(a6,a5,a4,a0,aZ,aY,a1,a3){A.info.render.vertices+=3;A.info.render.faces++;F(a3.opacity);ar(a3.blending);v=a6.positionScreen.x;u=a6.positionScreen.y;d=a5.positionScreen.x;b=a5.positionScreen.y;aR=a4.positionScreen.x;aO=a4.positionScreen.y;X(v,u,d,b,aR,aO);if((a3 instanceof THREE.MeshLambertMaterial||a3 instanceof THREE.MeshPhongMaterial)&&a3.map===null){ad.copy(a3.color);s.copy(a3.emissive);if(a3.vertexColors===THREE.FaceColors){ad.multiply(a1.color)}if(a3.wireframe===false&&a3.shading===THREE.SmoothShading&&a1.vertexNormalsLength===3){r.copy(aL);q.copy(aL);p.copy(aL);c(a1.v1.positionWorld,a1.vertexNormalsModel[0],r);c(a1.v2.positionWorld,a1.vertexNormalsModel[1],q);c(a1.v3.positionWorld,a1.vertexNormalsModel[2],p);r.multiply(ad).add(s);q.multiply(ad).add(s);p.multiply(ad).add(s);o.addColors(q,p).multiplyScalar(0.5);ae=aK(r,q,p,o);I(v,u,d,b,aR,aO,0,0,1,0,0,1,ae)}else{f.copy(aL);c(a1.centroidModel,a1.normalModel,f);f.multiply(ad).add(s);a3.wireframe===true?aU(f,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):g(f)}}else{if(a3 instanceof THREE.MeshBasicMaterial||a3 instanceof THREE.MeshLambertMaterial||a3 instanceof THREE.MeshPhongMaterial){if(a3.map!==null){if(a3.map.mapping instanceof THREE.UVMapping){j=a1.uvs[0];at(v,u,d,b,aR,aO,j[a0].x,j[a0].y,j[aZ].x,j[aZ].y,j[aY].x,j[aY].y,a3.map)}}else{if(a3.envMap!==null){if(a3.envMap.mapping instanceof THREE.SphericalReflectionMapping){l.copy(a1.vertexNormalsModelView[a0]);aQ=0.5*l.x+0.5;aM=0.5*l.y+0.5;l.copy(a1.vertexNormalsModelView[aZ]);az=0.5*l.x+0.5;aw=0.5*l.y+0.5;l.copy(a1.vertexNormalsModelView[aY]);aa=0.5*l.x+0.5;Y=0.5*l.y+0.5;at(v,u,d,b,aR,aO,aQ,aM,az,aw,aa,Y,a3.envMap)}}else{f.copy(a3.color);if(a3.vertexColors===THREE.FaceColors){f.multiply(a1.color)}a3.wireframe===true?aU(f,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):g(f)}}}else{if(a3 instanceof THREE.MeshDepthMaterial){V=aT.near;aW=aT.far;r.r=r.g=r.b=1-aI(a6.positionScreen.z*a6.positionScreen.w,V,aW);q.r=q.g=q.b=1-aI(a5.positionScreen.z*a5.positionScreen.w,V,aW);p.r=p.g=p.b=1-aI(a4.positionScreen.z*a4.positionScreen.w,V,aW);o.addColors(q,p).multiplyScalar(0.5);ae=aK(r,q,p,o);I(v,u,d,b,aR,aO,0,0,1,0,0,1,ae)}else{if(a3 instanceof THREE.MeshNormalMaterial){var a2;if(a3.shading===THREE.FlatShading){a2=a1.normalModelView;f.setRGB(a2.x,a2.y,a2.z).multiplyScalar(0.5).addScalar(0.5);a3.wireframe===true?aU(f,a3.wireframeLinewidth,a3.wireframeLinecap,a3.wireframeLinejoin):g(f)}else{if(a3.shading===THREE.SmoothShading){a2=a1.vertexNormalsModelView[a0];r.setRGB(a2.x,a2.y,a2.z).multiplyScalar(0.5).addScalar(0.5);a2=a1.vertexNormalsModelView[aZ];q.setRGB(a2.x,a2.y,a2.z).multiplyScalar(0.5).addScalar(0.5);a2=a1.vertexNormalsModelView[aY];p.setRGB(a2.x,a2.y,a2.z).multiplyScalar(0.5).addScalar(0.5);o.addColors(q,p).multiplyScalar(0.5);ae=aK(r,q,p,o);I(v,u,d,b,aR,aO,0,0,1,0,0,1,ae)}}}}}}}function X(a1,a3,aZ,a2,aY,a0){e.beginPath();e.moveTo(a1,a3);e.lineTo(aZ,a2);e.lineTo(aY,a0);e.closePath()}function aU(aY,a1,a0,aZ){O(a1);ag(a0);aN(aZ);aG(aY.getStyle());e.stroke();D.expandByScalar(a1*2)}function g(aY){ap(aY.getStyle());e.fill()}function at(bi,a5,bf,a3,bd,a1,be,a2,bc,a0,bb,aY,a8){if(a8 instanceof THREE.DataTexture||a8.image===undefined||a8.image.width===0){return}if(a8.needsUpdate===true){var bq=a8.wrapS===THREE.RepeatWrapping;var bo=a8.wrapT===THREE.RepeatWrapping;L[a8.id]=e.createPattern(a8.image,bq===true&&bo===true?"repeat":bq===true&&bo===false?"repeat-x":bq===false&&bo===true?"repeat-y":"no-repeat");a8.needsUpdate=false}L[a8.id]===undefined?ap("rgba(0,0,0,1)"):ap(L[a8.id]);var br,bp,bn,bm,bk,bh,a6,bl,bj=a8.offset.x/a8.repeat.x,bg=a8.offset.y/a8.repeat.y,ba=a8.image.width*a8.repeat.x,a9=a8.image.height*a8.repeat.y;be=(be+bj)*ba;a2=(1-a2+bg)*a9;bc=(bc+bj)*ba;a0=(1-a0+bg)*a9;bb=(bb+bj)*ba;aY=(1-aY+bg)*a9;bf-=bi;a3-=a5;bd-=bi;a1-=a5;bc-=be;a0-=a2;bb-=be;aY-=a2;a6=bc*aY-bb*a0;if(a6===0){if(W[a8.id]===undefined){var a4=document.createElement("canvas");a4.width=a8.image.width;a4.height=a8.image.height;var aZ=a4.getContext("2d");aZ.drawImage(a8.image,0,0);W[a8.id]=aZ.getImageData(0,0,a8.image.width,a8.image.height).data}var bs=W[a8.id];var a7=(Math.floor(be)+Math.floor(a2)*a8.image.width)*4;f.setRGB(bs[a7]/255,bs[a7+1]/255,bs[a7+2]/255);g(f);return}bl=1/a6;br=(aY*bf-a0*bd)*bl;bp=(aY*a3-a0*a1)*bl;bn=(bc*bd-bb*bf)*bl;bm=(bc*a1-bb*a3)*bl;bk=bi-br*be-bn*a2;bh=a5-bp*be-bm*a2;e.save();e.transform(br,bp,bn,bm,bk,bh);e.fill();e.restore()}function I(be,a3,bc,a2,ba,a0,bb,a1,a9,aZ,a8,aY,a6){var bk,bj,bi,bh,bf,bd,a4,bg,a7=a6.width-1,a5=a6.height-1;bb*=a7;a1*=a5;a9*=a7;aZ*=a5;a8*=a7;aY*=a5;bc-=be;a2-=a3;ba-=be;a0-=a3;a9-=bb;aZ-=a1;a8-=bb;aY-=a1;a4=a9*aY-a8*aZ;bg=1/a4;bk=(aY*bc-aZ*ba)*bg;bj=(aY*a2-aZ*a0)*bg;bi=(a9*ba-a8*bc)*bg;bh=(a9*a0-a8*a2)*bg;bf=be-bk*bb-bi*a1;bd=a3-bj*bb-bh*a1;e.save();e.transform(bk,bj,bi,bh,bf,bd);e.clip();e.drawImage(a6,0,0);e.restore()}function aK(aZ,aY,a1,a0){U[0]=(aZ.r*255)|0;U[1]=(aZ.g*255)|0;U[2]=(aZ.b*255)|0;U[4]=(aY.r*255)|0;U[5]=(aY.g*255)|0;U[6]=(aY.b*255)|0;U[8]=(a1.r*255)|0;U[9]=(a1.g*255)|0;U[10]=(a1.b*255)|0;U[12]=(a0.r*255)|0;U[13]=(a0.g*255)|0;U[14]=(a0.b*255)|0;h.putImageData(aS,0,0);T.drawImage(aP,0,0);return Q}function aq(a4,a1,a3){var aY=a1.x-a4.x,a2=a1.y-a4.y,aZ=aY*aY+a2*a2,a0;if(aZ===0){return}a0=a3/Math.sqrt(aZ);aY*=a0;a2*=a0;a1.x+=aY;a1.y+=a2;a4.x-=aY;a4.y-=a2}function F(aY){if(aJ!==aY){e.globalAlpha=aY;aJ=aY}}function ar(aY){if(aF!==aY){if(aY===THREE.NormalBlending){e.globalCompositeOperation="source-over"}else{if(aY===THREE.AdditiveBlending){e.globalCompositeOperation="lighter"}else{if(aY===THREE.SubtractiveBlending){e.globalCompositeOperation="darker"}}}aF=aY}}function O(aY){if(P!==aY){e.lineWidth=aY;P=aY}}function ag(aY){if(k!==aY){e.lineCap=aY;k=aY}}function aN(aY){if(aA!==aY){e.lineJoin=aY;aA=aY}}function aG(aY){if(B!==aY){e.strokeStyle=aY;B=aY}}function ap(aY){if(aE!==aY){e.fillStyle=aY;aE=aY}}function ac(aY,aZ){if(N!==aY||av!==aZ){e.setLineDash([aY,aZ]);N=aY;av=aZ}}};THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")};THREE.UniformsUtils={merge:function(b){var c,e,d,a={};for(c=0;c<b.length;c++){d=this.clone(b[c]);for(e in d){a[e]=d[e]}}return a},clone:function(a){var d,e,f,c,b={};for(d in a){b[d]={};for(e in a[d]){c=a[d][e];if(c instanceof THREE.Color||c instanceof THREE.Vector2||c instanceof THREE.Vector3||c instanceof THREE.Vector4||c instanceof THREE.Matrix4||c instanceof THREE.Texture){b[d][e]=c.clone()}else{if(c instanceof Array){b[d][e]=c.slice()}else{b[d][e]=c}}}}return b}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:0.98},uReflectivity:{type:"f",value:0.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}};THREE.WebGLRenderer=function(aN){console.log("THREE.WebGLRenderer",THREE.REVISION);aN=aN||{};var aY=aN.canvas!==undefined?aN.canvas:document.createElement("canvas"),j=aN.precision!==undefined?aN.precision:"highp",bD=aN.alpha!==undefined?aN.alpha:false,a1=aN.premultipliedAlpha!==undefined?aN.premultipliedAlpha:true,bY=aN.antialias!==undefined?aN.antialias:false,e=aN.stencil!==undefined?aN.stencil:true,Y=aN.preserveDrawingBuffer!==undefined?aN.preserveDrawingBuffer:false,bs=new THREE.Color(0),X=0;this.domElement=aY;this.context=null;this.devicePixelRatio=aN.devicePixelRatio!==undefined?aN.devicePixelRatio:self.devicePixelRatio!==undefined?self.devicePixelRatio:1;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.autoUpdateObjects=true;this.gammaInput=false;this.gammaOutput=false;this.physicallyBasedShading=false;this.shadowMapEnabled=false;this.shadowMapAutoUpdate=true;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var aO=this,bE=[],aB=0,am=null,bG=null,a2=-1,F=null,aL=null,V=0,bf=0,bl=-1,k=-1,i=-1,aj=-1,bQ=-1,au=-1,a=-1,bz=-1,aK=null,bO=null,bb=null,bn=null,a4=0,a3=0,bS=aY.width,aV=aY.height,D=0,aU=0,N={},bt=new THREE.Frustum(),a0=new THREE.Matrix4(),G=new THREE.Matrix4(),W=new THREE.Vector3(),aM=new THREE.Vector3(),bZ=true,bq={ambient:[0,0,0],directional:{length:0,colors:new Array(),positions:new Array()},point:{length:0,colors:new Array(),positions:new Array(),distances:new Array()},spot:{length:0,colors:new Array(),positions:new Array(),distances:new Array(),directions:new Array(),anglesCos:new Array(),exponents:new Array()},hemi:{length:0,skyColors:new Array(),groundColors:new Array(),positions:new Array()}};var c;var m;var A;var be;var q;var aF;br();bd();this.context=c;var bJ=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS);var b=c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var C=c.getParameter(c.MAX_TEXTURE_SIZE);var ao=c.getParameter(c.MAX_CUBE_MAP_TEXTURE_SIZE);var bC=q?c.getParameter(q.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;var aW=(b>0);var Z=aW&&m;var bA=aF?c.getParameter(c.COMPRESSED_TEXTURE_FORMATS):[];var bx=c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.HIGH_FLOAT);var bR=c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.MEDIUM_FLOAT);var bN=c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.LOW_FLOAT);var an=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_FLOAT);var bF=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.MEDIUM_FLOAT);var az=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.LOW_FLOAT);var l=c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.HIGH_INT);var aG=c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.MEDIUM_INT);var Q=c.getShaderPrecisionFormat(c.VERTEX_SHADER,c.LOW_INT);var bv=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.HIGH_INT);var t=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.MEDIUM_INT);var bk=c.getShaderPrecisionFormat(c.FRAGMENT_SHADER,c.LOW_INT);var bT=bx.precision>0&&an.precision>0;var bj=bR.precision>0&&bF.precision>0;if(j==="highp"&&!bT){if(bj){j="mediump";console.warn("WebGLRenderer: highp not supported, using mediump")}else{j="lowp";console.warn("WebGLRenderer: highp and mediump not supported, using lowp")}}if(j==="mediump"&&!bj){j="lowp";console.warn("WebGLRenderer: mediump not supported, using lowp")}this.getContext=function(){return c};this.supportsVertexTextures=function(){return aW};this.supportsFloatTextures=function(){return m};this.supportsStandardDerivatives=function(){return be};this.supportsCompressedTextureS3TC=function(){return aF};this.getMaxAnisotropy=function(){return bC};this.getPrecision=function(){return j};this.setSize=function(b1,b0,b2){aY.width=b1*this.devicePixelRatio;aY.height=b0*this.devicePixelRatio;if(this.devicePixelRatio!==1&&b2!==false){aY.style.width=b1+"px";aY.style.height=b0+"px"}this.setViewport(0,0,aY.width,aY.height)};this.setViewport=function(b1,b3,b2,b0){a4=b1!==undefined?b1:0;a3=b3!==undefined?b3:0;bS=b2!==undefined?b2:aY.width;aV=b0!==undefined?b0:aY.height;c.viewport(a4,a3,bS,aV)};this.setScissor=function(b1,b3,b2,b0){c.scissor(b1,b3,b2,b0)};this.enableScissorTest=function(b0){b0?c.enable(c.SCISSOR_TEST):c.disable(c.SCISSOR_TEST)};this.setClearColor=function(b0,b1){bs.set(b0);X=b1!==undefined?b1:1;c.clearColor(bs.r,bs.g,bs.b,X)};this.setClearColorHex=function(b0,b1){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(b0,b1)};this.getClearColor=function(){return bs};this.getClearAlpha=function(){return X};this.clear=function(b0,b3,b1){var b2=0;if(b0===undefined||b0){b2|=c.COLOR_BUFFER_BIT}if(b3===undefined||b3){b2|=c.DEPTH_BUFFER_BIT}if(b1===undefined||b1){b2|=c.STENCIL_BUFFER_BIT}c.clear(b2)};this.clearTarget=function(b2,b0,b3,b1){this.setRenderTarget(b2);this.clear(b0,b3,b1)};this.addPostPlugin=function(b0){b0.init(this);this.renderPluginsPost.push(b0)};this.addPrePlugin=function(b0){b0.init(this);this.renderPluginsPre.push(b0)};this.updateShadowMap=function(b1,b0){am=null;i=-1;a=-1;bz=-1;F=-1;a2=-1;bZ=true;bl=-1;k=-1;this.shadowMapPlugin.update(b1,b0)};function H(b0){b0.__webglVertexBuffer=c.createBuffer();b0.__webglColorBuffer=c.createBuffer();aO.info.memory.geometries++}function ae(b0){b0.__webglVertexBuffer=c.createBuffer();b0.__webglColorBuffer=c.createBuffer();b0.__webglLineDistanceBuffer=c.createBuffer();aO.info.memory.geometries++}function aE(b1){b1.__webglVertexBuffer=c.createBuffer();b1.__webglNormalBuffer=c.createBuffer();b1.__webglTangentBuffer=c.createBuffer();b1.__webglColorBuffer=c.createBuffer();b1.__webglUVBuffer=c.createBuffer();b1.__webglUV2Buffer=c.createBuffer();b1.__webglSkinIndicesBuffer=c.createBuffer();b1.__webglSkinWeightsBuffer=c.createBuffer();b1.__webglFaceBuffer=c.createBuffer();b1.__webglLineBuffer=c.createBuffer();var b0,b2;if(b1.numMorphTargets){b1.__webglMorphTargetsBuffers=[];for(b0=0,b2=b1.numMorphTargets;b0<b2;b0++){b1.__webglMorphTargetsBuffers.push(c.createBuffer())}}if(b1.numMorphNormals){b1.__webglMorphNormalsBuffers=[];for(b0=0,b2=b1.numMorphNormals;b0<b2;b0++){b1.__webglMorphNormalsBuffers.push(c.createBuffer())}}aO.info.memory.geometries++}var aZ=function(b0){var b1=b0.target;b1.removeEventListener("dispose",aZ);bU(b1)};var ah=function(b1){var b0=b1.target;b0.removeEventListener("dispose",ah);J(b0);aO.info.memory.textures--};var T=function(b0){var b1=b0.target;b1.removeEventListener("dispose",T);aC(b1);aO.info.memory.textures--};var bi=function(b1){var b0=b1.target;b0.removeEventListener("dispose",bi);S(b0)};var o=function(b0){if(b0.__webglVertexBuffer!==undefined){c.deleteBuffer(b0.__webglVertexBuffer)}if(b0.__webglNormalBuffer!==undefined){c.deleteBuffer(b0.__webglNormalBuffer)}if(b0.__webglTangentBuffer!==undefined){c.deleteBuffer(b0.__webglTangentBuffer)}if(b0.__webglColorBuffer!==undefined){c.deleteBuffer(b0.__webglColorBuffer)}if(b0.__webglUVBuffer!==undefined){c.deleteBuffer(b0.__webglUVBuffer)}if(b0.__webglUV2Buffer!==undefined){c.deleteBuffer(b0.__webglUV2Buffer)}if(b0.__webglSkinIndicesBuffer!==undefined){c.deleteBuffer(b0.__webglSkinIndicesBuffer)}if(b0.__webglSkinWeightsBuffer!==undefined){c.deleteBuffer(b0.__webglSkinWeightsBuffer)}if(b0.__webglFaceBuffer!==undefined){c.deleteBuffer(b0.__webglFaceBuffer)}if(b0.__webglLineBuffer!==undefined){c.deleteBuffer(b0.__webglLineBuffer)}if(b0.__webglLineDistanceBuffer!==undefined){c.deleteBuffer(b0.__webglLineDistanceBuffer)}if(b0.__webglCustomAttributesList!==undefined){for(var b1 in b0.__webglCustomAttributesList){c.deleteBuffer(b0.__webglCustomAttributesList[b1].buffer)}}aO.info.memory.geometries--};var bU=function(b5){b5.__webglInit=undefined;if(b5 instanceof THREE.BufferGeometry){var b2=b5.attributes;for(var b3 in b2){if(b2[b3].buffer!==undefined){c.deleteBuffer(b2[b3].buffer)}}aO.info.memory.geometries--}else{if(b5.geometryGroups!==undefined){for(var b4 in b5.geometryGroups){var b1=b5.geometryGroups[b4];if(b1.numMorphTargets!==undefined){for(var b0=0,b6=b1.numMorphTargets;b0<b6;b0++){c.deleteBuffer(b1.__webglMorphTargetsBuffers[b0])}}if(b1.numMorphNormals!==undefined){for(var b0=0,b6=b1.numMorphNormals;b0<b6;b0++){c.deleteBuffer(b1.__webglMorphNormalsBuffers[b0])}}o(b1)}}else{o(b5)}}};var J=function(b0){if(b0.image&&b0.image.__webglTextureCube){c.deleteTexture(b0.image.__webglTextureCube)}else{if(!b0.__webglInit){return}b0.__webglInit=false;c.deleteTexture(b0.__webglTexture)}};var aC=function(b1){if(!b1||!b1.__webglTexture){return}c.deleteTexture(b1.__webglTexture);if(b1 instanceof THREE.WebGLRenderTargetCube){for(var b0=0;b0<6;b0++){c.deleteFramebuffer(b1.__webglFramebuffer[b0]);c.deleteRenderbuffer(b1.__webglRenderbuffer[b0])}}else{c.deleteFramebuffer(b1.__webglFramebuffer);c.deleteRenderbuffer(b1.__webglRenderbuffer)}};var S=function(b6){var b2=b6.program;if(b2===undefined){return}b6.program=undefined;var b3,b1,b5;var b4=false;for(b3=0,b1=bE.length;b3<b1;b3++){b5=bE[b3];if(b5.program===b2){b5.usedTimes--;if(b5.usedTimes===0){b4=true}break}}if(b4===true){var b0=[];for(b3=0,b1=bE.length;b3<b1;b3++){b5=bE[b3];if(b5.program!==b2){b0.push(b5)}}bE=b0;c.deleteProgram(b2);aO.info.memory.programs--}};function bV(b6,b1){var b3=b6.vertices.length;var b4=b1.material;if(b4.attributes){if(b6.__webglCustomAttributesList===undefined){b6.__webglCustomAttributesList=[]}for(var b0 in b4.attributes){var b5=b4.attributes[b0];if(!b5.__webglInitialized||b5.createUniqueBuffers){b5.__webglInitialized=true;var b2=1;if(b5.type==="v2"){b2=2}else{if(b5.type==="v3"){b2=3}else{if(b5.type==="v4"){b2=4}else{if(b5.type==="c"){b2=3}}}}b5.size=b2;b5.array=new Float32Array(b3*b2);b5.buffer=c.createBuffer();b5.buffer.belongsToAttribute=b0;b5.needsUpdate=true}b6.__webglCustomAttributesList.push(b5)}}}function bK(b2,b0){var b1=b2.vertices.length;b2.__vertexArray=new Float32Array(b1*3);b2.__colorArray=new Float32Array(b1*3);b2.__sortArray=[];b2.__webglParticleCount=b1;bV(b2,b0)}function K(b2,b0){var b1=b2.vertices.length;b2.__vertexArray=new Float32Array(b1*3);b2.__colorArray=new Float32Array(b1*3);b2.__lineDistanceArray=new Float32Array(b1*1);b2.__webglLineCount=b1;bV(b2,b0)}function al(b8,cg){var b0=cg.geometry,ch=b8.faces3,cb=ch.length*3,b3=ch.length*1,b5=ch.length*3,b2=L(cg,b8),b7=bu(b2),b9=aR(b2),ce=bM(b2);b8.__vertexArray=new Float32Array(cb*3);if(b9){b8.__normalArray=new Float32Array(cb*3)}if(b0.hasTangents){b8.__tangentArray=new Float32Array(cb*4)}if(ce){b8.__colorArray=new Float32Array(cb*3)}if(b7){if(b0.faceVertexUvs.length>0){b8.__uvArray=new Float32Array(cb*2)}if(b0.faceVertexUvs.length>1){b8.__uv2Array=new Float32Array(cb*2)}}if(cg.geometry.skinWeights.length&&cg.geometry.skinIndices.length){b8.__skinIndexArray=new Float32Array(cb*4);b8.__skinWeightArray=new Float32Array(cb*4)}b8.__faceArray=new Uint16Array(b3*3);b8.__lineArray=new Uint16Array(b5*2);var ca,cd;if(b8.numMorphTargets){b8.__morphTargetsArrays=[];for(ca=0,cd=b8.numMorphTargets;ca<cd;ca++){b8.__morphTargetsArrays.push(new Float32Array(cb*3))}}if(b8.numMorphNormals){b8.__morphNormalsArrays=[];for(ca=0,cd=b8.numMorphNormals;ca<cd;ca++){b8.__morphNormalsArrays.push(new Float32Array(cb*3))}}b8.__webglFaceCount=b3*3;b8.__webglLineCount=b5*2;if(b2.attributes){if(b8.__webglCustomAttributesList===undefined){b8.__webglCustomAttributesList=[]}for(var cf in b2.attributes){var cc=b2.attributes[cf];var b4={};for(var b1 in cc){b4[b1]=cc[b1]}if(!b4.__webglInitialized||b4.createUniqueBuffers){b4.__webglInitialized=true;var b6=1;if(b4.type==="v2"){b6=2}else{if(b4.type==="v3"){b6=3}else{if(b4.type==="v4"){b6=4}else{if(b4.type==="c"){b6=3}}}}b4.size=b6;b4.array=new Float32Array(cb*b6);b4.buffer=c.createBuffer();b4.buffer.belongsToAttribute=cf;cc.needsUpdate=true;b4.__original=cc}b8.__webglCustomAttributesList.push(b4)}}b8.__inittedArrays=true}function L(b1,b0){return b1.material instanceof THREE.MeshFaceMaterial?b1.material.materials[b0.materialIndex]:b1.material}function bB(b0){return b0&&b0.shading!==undefined&&b0.shading===THREE.SmoothShading}function aR(b0){if((b0 instanceof THREE.MeshBasicMaterial&&!b0.envMap)||b0 instanceof THREE.MeshDepthMaterial){return false}if(bB(b0)){return THREE.SmoothShading}else{return THREE.FlatShading}}function bM(b0){if(b0.vertexColors){return b0.vertexColors}return false}function bu(b0){if(b0.map||b0.lightMap||b0.bumpMap||b0.normalMap||b0.specularMap||b0 instanceof THREE.ShaderMaterial){return true}return false}function E(b3){var b0,b2,b1;for(b0 in b3.attributes){if(b0==="index"){b1=c.ELEMENT_ARRAY_BUFFER}else{b1=c.ARRAY_BUFFER}b2=b3.attributes[b0];if(b2.numItems===undefined){b2.numItems=b2.array.length}b2.buffer=c.createBuffer();c.bindBuffer(b1,b2.buffer);c.bufferData(b1,b2.array,c.STATIC_DRAW)}}function a7(b1,ce,cs){var cc,cq,co,b3,b6,ck,b4=b1.vertices,cp=b4.length,b8=b1.colors,b7=b8.length,cd=b1.__vertexArray,b0=b1.__colorArray,b2=b1.__sortArray,ci=b1.verticesNeedUpdate,b5=b1.elementsNeedUpdate,cf=b1.colorsNeedUpdate,ch=b1.__webglCustomAttributesList,cm,b9,cr,cg,cb,cj,cn;if(cs.sortParticles){G.copy(a0);G.multiply(cs.matrixWorld);for(cc=0;cc<cp;cc++){co=b4[cc];W.copy(co);W.applyProjection(G);b2[cc]=[W.z,cc]}b2.sort(ac);for(cc=0;cc<cp;cc++){co=b4[b2[cc][1]];b3=cc*3;cd[b3]=co.x;cd[b3+1]=co.y;cd[b3+2]=co.z}for(cq=0;cq<b7;cq++){b3=cq*3;ck=b8[b2[cq][1]];b0[b3]=ck.r;b0[b3+1]=ck.g;b0[b3+2]=ck.b}if(ch){for(cm=0,b9=ch.length;cm<b9;cm++){cn=ch[cm];if(!(cn.boundTo===undefined||cn.boundTo==="vertices")){continue}b3=0;cb=cn.value.length;if(cn.size===1){for(cg=0;cg<cb;cg++){b6=b2[cg][1];cn.array[cg]=cn.value[b6]}}else{if(cn.size===2){for(cg=0;cg<cb;cg++){b6=b2[cg][1];cj=cn.value[b6];cn.array[b3]=cj.x;cn.array[b3+1]=cj.y;b3+=2}}else{if(cn.size===3){if(cn.type==="c"){for(cg=0;cg<cb;cg++){b6=b2[cg][1];cj=cn.value[b6];cn.array[b3]=cj.r;cn.array[b3+1]=cj.g;cn.array[b3+2]=cj.b;b3+=3}}else{for(cg=0;cg<cb;cg++){b6=b2[cg][1];cj=cn.value[b6];cn.array[b3]=cj.x;cn.array[b3+1]=cj.y;cn.array[b3+2]=cj.z;b3+=3}}}else{if(cn.size===4){for(cg=0;cg<cb;cg++){b6=b2[cg][1];cj=cn.value[b6];cn.array[b3]=cj.x;cn.array[b3+1]=cj.y;cn.array[b3+2]=cj.z;cn.array[b3+3]=cj.w;b3+=4}}}}}}}}else{if(ci){for(cc=0;cc<cp;cc++){co=b4[cc];b3=cc*3;cd[b3]=co.x;cd[b3+1]=co.y;cd[b3+2]=co.z}}if(cf){for(cq=0;cq<b7;cq++){ck=b8[cq];b3=cq*3;b0[b3]=ck.r;b0[b3+1]=ck.g;b0[b3+2]=ck.b}}if(ch){for(cm=0,b9=ch.length;cm<b9;cm++){cn=ch[cm];if(cn.needsUpdate&&(cn.boundTo===undefined||cn.boundTo==="vertices")){cb=cn.value.length;b3=0;if(cn.size===1){for(cg=0;cg<cb;cg++){cn.array[cg]=cn.value[cg]}}else{if(cn.size===2){for(cg=0;cg<cb;cg++){cj=cn.value[cg];cn.array[b3]=cj.x;cn.array[b3+1]=cj.y;b3+=2}}else{if(cn.size===3){if(cn.type==="c"){for(cg=0;cg<cb;cg++){cj=cn.value[cg];cn.array[b3]=cj.r;cn.array[b3+1]=cj.g;cn.array[b3+2]=cj.b;b3+=3}}else{for(cg=0;cg<cb;cg++){cj=cn.value[cg];cn.array[b3]=cj.x;cn.array[b3+1]=cj.y;cn.array[b3+2]=cj.z;b3+=3}}}else{if(cn.size===4){for(cg=0;cg<cb;cg++){cj=cn.value[cg];cn.array[b3]=cj.x;cn.array[b3+1]=cj.y;cn.array[b3+2]=cj.z;cn.array[b3+3]=cj.w;b3+=4}}}}}}}}}if(ci||cs.sortParticles){c.bindBuffer(c.ARRAY_BUFFER,b1.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,cd,ce)}if(cf||cs.sortParticles){c.bindBuffer(c.ARRAY_BUFFER,b1.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,b0,ce)}if(ch){for(cm=0,b9=ch.length;cm<b9;cm++){cn=ch[cm];if(cn.needsUpdate||cs.sortParticles){c.bindBuffer(c.ARRAY_BUFFER,cn.buffer);c.bufferData(c.ARRAY_BUFFER,cn.array,ce)}}}}function bo(b3,ce){var cb,cs,cq,cp,b4,ck,b5=b3.vertices,b7=b3.colors,cd=b3.lineDistances,cr=b5.length,b6=b7.length,cm=cd.length,cc=b3.__vertexArray,b2=b3.__colorArray,b0=b3.__lineDistanceArray,ci=b3.verticesNeedUpdate,cf=b3.colorsNeedUpdate,b1=b3.lineDistancesNeedUpdate,ch=b3.__webglCustomAttributesList,cn,b8,ct,cg,b9,cj,co;if(ci){for(cb=0;cb<cr;cb++){cp=b5[cb];b4=cb*3;cc[b4]=cp.x;cc[b4+1]=cp.y;cc[b4+2]=cp.z}c.bindBuffer(c.ARRAY_BUFFER,b3.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,cc,ce)}if(cf){for(cs=0;cs<b6;cs++){ck=b7[cs];b4=cs*3;b2[b4]=ck.r;b2[b4+1]=ck.g;b2[b4+2]=ck.b}c.bindBuffer(c.ARRAY_BUFFER,b3.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,b2,ce)}if(b1){for(cq=0;cq<cm;cq++){b0[cq]=cd[cq]}c.bindBuffer(c.ARRAY_BUFFER,b3.__webglLineDistanceBuffer);c.bufferData(c.ARRAY_BUFFER,b0,ce)}if(ch){for(cn=0,b8=ch.length;cn<b8;cn++){co=ch[cn];if(co.needsUpdate&&(co.boundTo===undefined||co.boundTo==="vertices")){b4=0;b9=co.value.length;if(co.size===1){for(cg=0;cg<b9;cg++){co.array[cg]=co.value[cg]}}else{if(co.size===2){for(cg=0;cg<b9;cg++){cj=co.value[cg];co.array[b4]=cj.x;co.array[b4+1]=cj.y;b4+=2}}else{if(co.size===3){if(co.type==="c"){for(cg=0;cg<b9;cg++){cj=co.value[cg];co.array[b4]=cj.r;co.array[b4+1]=cj.g;co.array[b4+2]=cj.b;b4+=3}}else{for(cg=0;cg<b9;cg++){cj=co.value[cg];co.array[b4]=cj.x;co.array[b4+1]=cj.y;co.array[b4+2]=cj.z;b4+=3}}}else{if(co.size===4){for(cg=0;cg<b9;cg++){cj=co.value[cg];co.array[b4]=cj.x;co.array[b4+1]=cj.y;co.array[b4+2]=cj.z;co.array[b4+3]=cj.w;b4+=4}}}}}c.bindBuffer(c.ARRAY_BUFFER,co.buffer);c.bufferData(c.ARRAY_BUFFER,co.array,ce)}}}}function n(dj,dq,dT,ce,dR){if(!dj.__inittedArrays){return}var cL=aR(dR),cb=bM(dR),di=bu(dR),cA=(cL===THREE.SmoothShading);var cR,dC,dI,b1,ci,b6,cW,cj,cK,b2,cJ,dO,c9,c8,c7,c6,dP,dN,dL,dJ,dH,dE,dD,dB,dg,df,dd,dc,dx,dw,dt,ds,ca,b9,b8,b7,cG,cE,cD,cC,co,cn,cl,ck,cN,dm,cQ,cI,ct,db,dh,cu,cB,cM,de,cS,da,cV,cq=0,cg=0,dl=0,dM=0,cO=0,cz=0,ch=0,c5=0,cf=0,cP=0,b0=0,cc=0,cm=0,cF,b5=dj.__vertexArray,cy=dj.__uvArray,cd=dj.__uv2Array,dr=dj.__normalArray,dv=dj.__tangentArray,cY=dj.__colorArray,dp=dj.__skinIndexArray,dG=dj.__skinWeightArray,dF=dj.__morphTargetsArrays,cv=dj.__morphNormalsArrays,cx=dj.__webglCustomAttributesList,b4,dK=dj.__faceArray,cU=dj.__lineArray,dk=dq.geometry,cs=dk.verticesNeedUpdate,cT=dk.elementsNeedUpdate,cZ=dk.uvsNeedUpdate,b3=dk.normalsNeedUpdate,dQ=dk.tangentsNeedUpdate,du=dk.colorsNeedUpdate,dU=dk.morphTargetsNeedUpdate,c0=dk.vertices,cp=dj.faces3,dy=dk.faces,cX=dk.faceVertexUvs[0],cw=dk.faceVertexUvs[1],dz=dk.colors,cH=dk.skinIndices,dA=dk.skinWeights,dS=dk.morphTargets,dn=dk.morphNormals;if(cs){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];c9=c0[b1.a];c8=c0[b1.b];c7=c0[b1.c];b5[cg]=c9.x;b5[cg+1]=c9.y;b5[cg+2]=c9.z;b5[cg+3]=c8.x;b5[cg+4]=c8.y;b5[cg+5]=c8.z;b5[cg+6]=c7.x;b5[cg+7]=c7.y;b5[cg+8]=c7.z;cg+=9}c.bindBuffer(c.ARRAY_BUFFER,dj.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,b5,dT)}if(dU){for(cu=0,cB=dS.length;cu<cB;cu++){b0=0;for(cR=0,dC=cp.length;cR<dC;cR++){cS=cp[cR];b1=dy[cS];c9=dS[cu].vertices[b1.a];c8=dS[cu].vertices[b1.b];c7=dS[cu].vertices[b1.c];cM=dF[cu];cM[b0]=c9.x;cM[b0+1]=c9.y;cM[b0+2]=c9.z;cM[b0+3]=c8.x;cM[b0+4]=c8.y;cM[b0+5]=c8.z;cM[b0+6]=c7.x;cM[b0+7]=c7.y;cM[b0+8]=c7.z;if(dR.morphNormals){if(cA){da=dn[cu].vertexNormals[cS];dH=da.a;dE=da.b;dD=da.c}else{dH=dn[cu].faceNormals[cS];dE=dH;dD=dH}de=cv[cu];de[b0]=dH.x;de[b0+1]=dH.y;de[b0+2]=dH.z;de[b0+3]=dE.x;de[b0+4]=dE.y;de[b0+5]=dE.z;de[b0+6]=dD.x;de[b0+7]=dD.y;de[b0+8]=dD.z}b0+=9}c.bindBuffer(c.ARRAY_BUFFER,dj.__webglMorphTargetsBuffers[cu]);c.bufferData(c.ARRAY_BUFFER,dF[cu],dT);if(dR.morphNormals){c.bindBuffer(c.ARRAY_BUFFER,dj.__webglMorphNormalsBuffers[cu]);c.bufferData(c.ARRAY_BUFFER,cv[cu],dT)}}}if(dA.length){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];dx=dA[b1.a];dw=dA[b1.b];dt=dA[b1.c];dG[cP]=dx.x;dG[cP+1]=dx.y;dG[cP+2]=dx.z;dG[cP+3]=dx.w;dG[cP+4]=dw.x;dG[cP+5]=dw.y;dG[cP+6]=dw.z;dG[cP+7]=dw.w;dG[cP+8]=dt.x;dG[cP+9]=dt.y;dG[cP+10]=dt.z;dG[cP+11]=dt.w;ca=cH[b1.a];b9=cH[b1.b];b8=cH[b1.c];dp[cP]=ca.x;dp[cP+1]=ca.y;dp[cP+2]=ca.z;dp[cP+3]=ca.w;dp[cP+4]=b9.x;dp[cP+5]=b9.y;dp[cP+6]=b9.z;dp[cP+7]=b9.w;dp[cP+8]=b8.x;dp[cP+9]=b8.y;dp[cP+10]=b8.z;dp[cP+11]=b8.w;cP+=12}if(cP>0){c.bindBuffer(c.ARRAY_BUFFER,dj.__webglSkinIndicesBuffer);c.bufferData(c.ARRAY_BUFFER,dp,dT);c.bindBuffer(c.ARRAY_BUFFER,dj.__webglSkinWeightsBuffer);c.bufferData(c.ARRAY_BUFFER,dG,dT)}}if(du&&cb){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];cj=b1.vertexColors;cK=b1.color;if(cj.length===3&&cb===THREE.VertexColors){dg=cj[0];df=cj[1];dd=cj[2]}else{dg=cK;df=cK;dd=cK}cY[cf]=dg.r;cY[cf+1]=dg.g;cY[cf+2]=dg.b;cY[cf+3]=df.r;cY[cf+4]=df.g;cY[cf+5]=df.b;cY[cf+6]=dd.r;cY[cf+7]=dd.g;cY[cf+8]=dd.b;cf+=9}if(cf>0){c.bindBuffer(c.ARRAY_BUFFER,dj.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,cY,dT)}}if(dQ&&dk.hasTangents){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];b2=b1.vertexTangents;dP=b2[0];dN=b2[1];dL=b2[2];dv[ch]=dP.x;dv[ch+1]=dP.y;dv[ch+2]=dP.z;dv[ch+3]=dP.w;dv[ch+4]=dN.x;dv[ch+5]=dN.y;dv[ch+6]=dN.z;dv[ch+7]=dN.w;dv[ch+8]=dL.x;dv[ch+9]=dL.y;dv[ch+10]=dL.z;dv[ch+11]=dL.w;ch+=12}c.bindBuffer(c.ARRAY_BUFFER,dj.__webglTangentBuffer);c.bufferData(c.ARRAY_BUFFER,dv,dT)}if(b3&&cL){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];ci=b1.vertexNormals;b6=b1.normal;if(ci.length===3&&cA){for(cQ=0;cQ<3;cQ++){ct=ci[cQ];dr[cz]=ct.x;dr[cz+1]=ct.y;dr[cz+2]=ct.z;cz+=3}}else{for(cQ=0;cQ<3;cQ++){dr[cz]=b6.x;dr[cz+1]=b6.y;dr[cz+2]=b6.z;cz+=3}}}c.bindBuffer(c.ARRAY_BUFFER,dj.__webglNormalBuffer);c.bufferData(c.ARRAY_BUFFER,dr,dT)}if(cZ&&cX&&di){for(cR=0,dC=cp.length;cR<dC;cR++){dI=cp[cR];cJ=cX[dI];if(cJ===undefined){continue}for(cQ=0;cQ<3;cQ++){db=cJ[cQ];cy[dl]=db.x;cy[dl+1]=db.y;dl+=2}}if(dl>0){c.bindBuffer(c.ARRAY_BUFFER,dj.__webglUVBuffer);c.bufferData(c.ARRAY_BUFFER,cy,dT)}}if(cZ&&cw&&di){for(cR=0,dC=cp.length;cR<dC;cR++){dI=cp[cR];dO=cw[dI];if(dO===undefined){continue}for(cQ=0;cQ<3;cQ++){dh=dO[cQ];cd[dM]=dh.x;cd[dM+1]=dh.y;dM+=2}}if(dM>0){c.bindBuffer(c.ARRAY_BUFFER,dj.__webglUV2Buffer);c.bufferData(c.ARRAY_BUFFER,cd,dT)}}if(cT){for(cR=0,dC=cp.length;cR<dC;cR++){dK[cO]=cq;dK[cO+1]=cq+1;dK[cO+2]=cq+2;cO+=3;cU[c5]=cq;cU[c5+1]=cq+1;cU[c5+2]=cq;cU[c5+3]=cq+2;cU[c5+4]=cq+1;cU[c5+5]=cq+2;c5+=6;cq+=3}c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,dj.__webglFaceBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,dK,dT);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,dj.__webglLineBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,cU,dT)}if(cx){for(cQ=0,cI=cx.length;cQ<cI;cQ++){b4=cx[cQ];if(!b4.__original.needsUpdate){continue}cc=0;cm=0;if(b4.size===1){if(b4.boundTo===undefined||b4.boundTo==="vertices"){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];b4.array[cc]=b4.value[b1.a];b4.array[cc+1]=b4.value[b1.b];b4.array[cc+2]=b4.value[b1.c];cc+=3}}else{if(b4.boundTo==="faces"){for(cR=0,dC=cp.length;cR<dC;cR++){cF=b4.value[cp[cR]];b4.array[cc]=cF;b4.array[cc+1]=cF;b4.array[cc+2]=cF;cc+=3}}}}else{if(b4.size===2){if(b4.boundTo===undefined||b4.boundTo==="vertices"){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];c9=b4.value[b1.a];c8=b4.value[b1.b];c7=b4.value[b1.c];b4.array[cc]=c9.x;b4.array[cc+1]=c9.y;b4.array[cc+2]=c8.x;b4.array[cc+3]=c8.y;b4.array[cc+4]=c7.x;b4.array[cc+5]=c7.y;cc+=6}}else{if(b4.boundTo==="faces"){for(cR=0,dC=cp.length;cR<dC;cR++){cF=b4.value[cp[cR]];c9=cF;c8=cF;c7=cF;b4.array[cc]=c9.x;b4.array[cc+1]=c9.y;b4.array[cc+2]=c8.x;b4.array[cc+3]=c8.y;b4.array[cc+4]=c7.x;b4.array[cc+5]=c7.y;cc+=6}}}}else{if(b4.size===3){var cr;if(b4.type==="c"){cr=["r","g","b"]}else{cr=["x","y","z"]}if(b4.boundTo===undefined||b4.boundTo==="vertices"){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];c9=b4.value[b1.a];c8=b4.value[b1.b];c7=b4.value[b1.c];b4.array[cc]=c9[cr[0]];b4.array[cc+1]=c9[cr[1]];b4.array[cc+2]=c9[cr[2]];b4.array[cc+3]=c8[cr[0]];b4.array[cc+4]=c8[cr[1]];b4.array[cc+5]=c8[cr[2]];b4.array[cc+6]=c7[cr[0]];b4.array[cc+7]=c7[cr[1]];b4.array[cc+8]=c7[cr[2]];cc+=9}}else{if(b4.boundTo==="faces"){for(cR=0,dC=cp.length;cR<dC;cR++){cF=b4.value[cp[cR]];c9=cF;c8=cF;c7=cF;b4.array[cc]=c9[cr[0]];b4.array[cc+1]=c9[cr[1]];b4.array[cc+2]=c9[cr[2]];b4.array[cc+3]=c8[cr[0]];b4.array[cc+4]=c8[cr[1]];b4.array[cc+5]=c8[cr[2]];b4.array[cc+6]=c7[cr[0]];b4.array[cc+7]=c7[cr[1]];b4.array[cc+8]=c7[cr[2]];cc+=9}}else{if(b4.boundTo==="faceVertices"){for(cR=0,dC=cp.length;cR<dC;cR++){cF=b4.value[cp[cR]];c9=cF[0];c8=cF[1];c7=cF[2];b4.array[cc]=c9[cr[0]];b4.array[cc+1]=c9[cr[1]];b4.array[cc+2]=c9[cr[2]];b4.array[cc+3]=c8[cr[0]];b4.array[cc+4]=c8[cr[1]];b4.array[cc+5]=c8[cr[2]];b4.array[cc+6]=c7[cr[0]];b4.array[cc+7]=c7[cr[1]];b4.array[cc+8]=c7[cr[2]];cc+=9}}}}}else{if(b4.size===4){if(b4.boundTo===undefined||b4.boundTo==="vertices"){for(cR=0,dC=cp.length;cR<dC;cR++){b1=dy[cp[cR]];c9=b4.value[b1.a];c8=b4.value[b1.b];c7=b4.value[b1.c];b4.array[cc]=c9.x;b4.array[cc+1]=c9.y;b4.array[cc+2]=c9.z;b4.array[cc+3]=c9.w;b4.array[cc+4]=c8.x;b4.array[cc+5]=c8.y;b4.array[cc+6]=c8.z;b4.array[cc+7]=c8.w;b4.array[cc+8]=c7.x;b4.array[cc+9]=c7.y;b4.array[cc+10]=c7.z;b4.array[cc+11]=c7.w;cc+=12}}else{if(b4.boundTo==="faces"){for(cR=0,dC=cp.length;cR<dC;cR++){cF=b4.value[cp[cR]];c9=cF;c8=cF;c7=cF;b4.array[cc]=c9.x;b4.array[cc+1]=c9.y;b4.array[cc+2]=c9.z;b4.array[cc+3]=c9.w;b4.array[cc+4]=c8.x;b4.array[cc+5]=c8.y;b4.array[cc+6]=c8.z;b4.array[cc+7]=c8.w;b4.array[cc+8]=c7.x;b4.array[cc+9]=c7.y;b4.array[cc+10]=c7.z;b4.array[cc+11]=c7.w;cc+=12}}else{if(b4.boundTo==="faceVertices"){for(cR=0,dC=cp.length;cR<dC;cR++){cF=b4.value[cp[cR]];c9=cF[0];c8=cF[1];c7=cF[2];b4.array[cc]=c9.x;b4.array[cc+1]=c9.y;b4.array[cc+2]=c9.z;b4.array[cc+3]=c9.w;b4.array[cc+4]=c8.x;b4.array[cc+5]=c8.y;b4.array[cc+6]=c8.z;b4.array[cc+7]=c8.w;b4.array[cc+8]=c7.x;b4.array[cc+9]=c7.y;b4.array[cc+10]=c7.z;b4.array[cc+11]=c7.w;cc+=12}}}}}}}}c.bindBuffer(c.ARRAY_BUFFER,b4.buffer);c.bufferData(c.ARRAY_BUFFER,b4.array,dT)}}if(ce){delete dj.__inittedArrays;delete dj.__colorArray;delete dj.__normalArray;delete dj.__tangentArray;delete dj.__uvArray;delete dj.__uv2Array;delete dj.__faceArray;delete dj.__vertexArray;delete dj.__lineArray;delete dj.__skinIndexArray;delete dj.__skinWeightArray}}function ax(b5,b4,b3){var b0=b5.attributes;var b1,b2;for(b1 in b0){b2=b0[b1];if(b2.needsUpdate){if(b1==="index"){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,b2.buffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,b2.array,b4)}else{c.bindBuffer(c.ARRAY_BUFFER,b2.buffer);c.bufferData(c.ARRAY_BUFFER,b2.array,b4)}b2.needsUpdate=false}if(b3&&!b2.dynamic){b2.array=null}}}this.renderBufferImmediate=function(cf,b3,b5){if(cf.hasPositions&&!cf.__webglVertexBuffer){cf.__webglVertexBuffer=c.createBuffer()}if(cf.hasNormals&&!cf.__webglNormalBuffer){cf.__webglNormalBuffer=c.createBuffer()}if(cf.hasUvs&&!cf.__webglUvBuffer){cf.__webglUvBuffer=c.createBuffer()}if(cf.hasColors&&!cf.__webglColorBuffer){cf.__webglColorBuffer=c.createBuffer()}if(cf.hasPositions){c.bindBuffer(c.ARRAY_BUFFER,cf.__webglVertexBuffer);c.bufferData(c.ARRAY_BUFFER,cf.positionArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(b3.attributes.position);c.vertexAttribPointer(b3.attributes.position,3,c.FLOAT,false,0,0)}if(cf.hasNormals){c.bindBuffer(c.ARRAY_BUFFER,cf.__webglNormalBuffer);if(b5.shading===THREE.FlatShading){var cd,cc,ca,b2,b8,ch,b1,b7,cg,b0,b6,ce,cb,b9,b4=cf.count*3;for(b9=0;b9<b4;b9+=9){cb=cf.normalArray;b2=cb[b9];b1=cb[b9+1];b0=cb[b9+2];b8=cb[b9+3];b7=cb[b9+4];b6=cb[b9+5];ch=cb[b9+6];cg=cb[b9+7];ce=cb[b9+8];cd=(b2+b8+ch)/3;cc=(b1+b7+cg)/3;ca=(b0+b6+ce)/3;cb[b9]=cd;cb[b9+1]=cc;cb[b9+2]=ca;cb[b9+3]=cd;cb[b9+4]=cc;cb[b9+5]=ca;cb[b9+6]=cd;cb[b9+7]=cc;cb[b9+8]=ca}}c.bufferData(c.ARRAY_BUFFER,cf.normalArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(b3.attributes.normal);c.vertexAttribPointer(b3.attributes.normal,3,c.FLOAT,false,0,0)}if(cf.hasUvs&&b5.map){c.bindBuffer(c.ARRAY_BUFFER,cf.__webglUvBuffer);c.bufferData(c.ARRAY_BUFFER,cf.uvArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(b3.attributes.uv);c.vertexAttribPointer(b3.attributes.uv,2,c.FLOAT,false,0,0)}if(cf.hasColors&&b5.vertexColors!==THREE.NoColors){c.bindBuffer(c.ARRAY_BUFFER,cf.__webglColorBuffer);c.bufferData(c.ARRAY_BUFFER,cf.colorArray,c.DYNAMIC_DRAW);c.enableVertexAttribArray(b3.attributes.color);c.vertexAttribPointer(b3.attributes.color,3,c.FLOAT,false,0,0)}c.drawArrays(c.TRIANGLES,0,cf.count);cf.count=0};this.renderBufferDirect=function(ci,cn,b0,ca,b3,cp){if(ca.visible===false){return}var ch,cm,cb;var b9,cc,cd,b1;var b7=aQ(ci,cn,b0,ca,cp);var ck=b7.attributes;var b5=b3.attributes;var ce=false,cg=ca.wireframe?1:0,cl=(b3.id*16777215)+(b7.id*2)+cg;if(cl!==F){F=cl;ce=true}if(ce){by()}if(cp instanceof THREE.Mesh){var b6=b5.index;if(b6){var b4=b3.offsets;if(b4.length>1){ce=true}for(var cf=0,b8=b4.length;cf<b8;cf++){var b2=b4[cf].index;if(ce){for(cc in ck){cd=ck[cc];b9=b5[cc];if(cd>=0){if(b9){b1=b9.itemSize;c.bindBuffer(c.ARRAY_BUFFER,b9.buffer);ai(cd);c.vertexAttribPointer(cd,b1,c.FLOAT,false,0,b2*b1*4)}else{if(ca.defaultAttributeValues){if(ca.defaultAttributeValues[cc].length===2){c.vertexAttrib2fv(cd,ca.defaultAttributeValues[cc])}else{if(ca.defaultAttributeValues[cc].length===3){c.vertexAttrib3fv(cd,ca.defaultAttributeValues[cc])}}}}}}c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,b6.buffer)}c.drawElements(c.TRIANGLES,b4[cf].count,c.UNSIGNED_SHORT,b4[cf].start*2);aO.info.render.calls++;aO.info.render.vertices+=b4[cf].count;aO.info.render.faces+=b4[cf].count/3}}else{if(ce){for(cc in ck){if(cc==="index"){continue}cd=ck[cc];b9=b5[cc];if(cd>=0){if(b9){b1=b9.itemSize;c.bindBuffer(c.ARRAY_BUFFER,b9.buffer);ai(cd);c.vertexAttribPointer(cd,b1,c.FLOAT,false,0,0)}else{if(ca.defaultAttributeValues&&ca.defaultAttributeValues[cc]){if(ca.defaultAttributeValues[cc].length===2){c.vertexAttrib2fv(cd,ca.defaultAttributeValues[cc])}else{if(ca.defaultAttributeValues[cc].length===3){c.vertexAttrib3fv(cd,ca.defaultAttributeValues[cc])}}}}}}}var co=b3.attributes.position;c.drawArrays(c.TRIANGLES,0,co.numItems/3);aO.info.render.calls++;aO.info.render.vertices+=co.numItems/3;aO.info.render.faces+=co.numItems/3/3}}else{if(cp instanceof THREE.ParticleSystem){if(ce){for(cc in ck){cd=ck[cc];b9=b5[cc];if(cd>=0){if(b9){b1=b9.itemSize;c.bindBuffer(c.ARRAY_BUFFER,b9.buffer);ai(cd);c.vertexAttribPointer(cd,b1,c.FLOAT,false,0,0)}else{if(ca.defaultAttributeValues&&ca.defaultAttributeValues[cc]){if(ca.defaultAttributeValues[cc].length===2){c.vertexAttrib2fv(cd,ca.defaultAttributeValues[cc])}else{if(ca.defaultAttributeValues[cc].length===3){c.vertexAttrib3fv(cd,ca.defaultAttributeValues[cc])}}}}}}var co=b5.position;c.drawArrays(c.POINTS,0,co.numItems/3);aO.info.render.calls++;aO.info.render.points+=co.numItems/3}}else{if(cp instanceof THREE.Line){if(ce){for(cc in ck){cd=ck[cc];b9=b5[cc];if(cd>=0){if(b9){b1=b9.itemSize;c.bindBuffer(c.ARRAY_BUFFER,b9.buffer);ai(cd);c.vertexAttribPointer(cd,b1,c.FLOAT,false,0,0)}else{if(ca.defaultAttributeValues&&ca.defaultAttributeValues[cc]){if(ca.defaultAttributeValues[cc].length===2){c.vertexAttrib2fv(cd,ca.defaultAttributeValues[cc])}else{if(ca.defaultAttributeValues[cc].length===3){c.vertexAttrib3fv(cd,ca.defaultAttributeValues[cc])}}}}}}var cj=(cp.type===THREE.LineStrip)?c.LINE_STRIP:c.LINES;aI(ca.linewidth);var co=b5.position;c.drawArrays(cj,0,co.numItems/3);aO.info.render.calls++;aO.info.render.points+=co.numItems}}}}};this.renderBuffer=function(ca,b7,b0,cb,b4,b3){if(cb.visible===false){return}var cd,cf,b1,b9,ce;var b8=aQ(ca,b7,b0,cb,b3);var b6=b8.attributes;var b2=false,cc=cb.wireframe?1:0,b5=(b4.id*16777215)+(b8.id*2)+cc;if(b5!==F){F=b5;b2=true}if(b2){by()}if(!cb.morphTargets&&b6.position>=0){if(b2){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglVertexBuffer);ai(b6.position);c.vertexAttribPointer(b6.position,3,c.FLOAT,false,0,0)}}else{if(b3.morphTargetBase){v(cb,b4,b3)}}if(b2){if(b4.__webglCustomAttributesList){for(b9=0,ce=b4.__webglCustomAttributesList.length;b9<ce;b9++){b1=b4.__webglCustomAttributesList[b9];if(b6[b1.buffer.belongsToAttribute]>=0){c.bindBuffer(c.ARRAY_BUFFER,b1.buffer);ai(b6[b1.buffer.belongsToAttribute]);c.vertexAttribPointer(b6[b1.buffer.belongsToAttribute],b1.size,c.FLOAT,false,0,0)}}}if(b6.color>=0){if(b3.geometry.colors.length>0||b3.geometry.faces.length>0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglColorBuffer);ai(b6.color);c.vertexAttribPointer(b6.color,3,c.FLOAT,false,0,0)}else{if(cb.defaultAttributeValues){c.vertexAttrib3fv(b6.color,cb.defaultAttributeValues.color)}}}if(b6.normal>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglNormalBuffer);ai(b6.normal);c.vertexAttribPointer(b6.normal,3,c.FLOAT,false,0,0)}if(b6.tangent>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglTangentBuffer);ai(b6.tangent);c.vertexAttribPointer(b6.tangent,4,c.FLOAT,false,0,0)}if(b6.uv>=0){if(b3.geometry.faceVertexUvs[0]){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglUVBuffer);ai(b6.uv);c.vertexAttribPointer(b6.uv,2,c.FLOAT,false,0,0)}else{if(cb.defaultAttributeValues){c.vertexAttrib2fv(b6.uv,cb.defaultAttributeValues.uv)}}}if(b6.uv2>=0){if(b3.geometry.faceVertexUvs[1]){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglUV2Buffer);ai(b6.uv2);c.vertexAttribPointer(b6.uv2,2,c.FLOAT,false,0,0)}else{if(cb.defaultAttributeValues){c.vertexAttrib2fv(b6.uv2,cb.defaultAttributeValues.uv2)}}}if(cb.skinning&&b6.skinIndex>=0&&b6.skinWeight>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglSkinIndicesBuffer);ai(b6.skinIndex);c.vertexAttribPointer(b6.skinIndex,4,c.FLOAT,false,0,0);c.bindBuffer(c.ARRAY_BUFFER,b4.__webglSkinWeightsBuffer);ai(b6.skinWeight);c.vertexAttribPointer(b6.skinWeight,4,c.FLOAT,false,0,0)}if(b6.lineDistance>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglLineDistanceBuffer);ai(b6.lineDistance);c.vertexAttribPointer(b6.lineDistance,1,c.FLOAT,false,0,0)}}if(b3 instanceof THREE.Mesh){if(cb.wireframe){aI(cb.wireframeLinewidth);if(b2){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,b4.__webglLineBuffer)}c.drawElements(c.LINES,b4.__webglLineCount,c.UNSIGNED_SHORT,0)}else{if(b2){c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,b4.__webglFaceBuffer)}c.drawElements(c.TRIANGLES,b4.__webglFaceCount,c.UNSIGNED_SHORT,0)}aO.info.render.calls++;aO.info.render.vertices+=b4.__webglFaceCount;aO.info.render.faces+=b4.__webglFaceCount/3}else{if(b3 instanceof THREE.Line){var cg=(b3.type===THREE.LineStrip)?c.LINE_STRIP:c.LINES;aI(cb.linewidth);c.drawArrays(cg,0,b4.__webglLineCount);aO.info.render.calls++}else{if(b3 instanceof THREE.ParticleSystem){c.drawArrays(c.POINTS,0,b4.__webglParticleCount);aO.info.render.calls++;aO.info.render.points+=b4.__webglParticleCount}}}};function ai(b0){if(!N[b0]){c.enableVertexAttribArray(b0);N[b0]=true}}function by(){for(var b0 in N){if(N[b0]){c.disableVertexAttribArray(b0);N[b0]=false}}}function v(b8,b4,b3){var b6=b8.program.attributes;if(b3.morphTargetBase!==-1&&b6.position>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglMorphTargetsBuffers[b3.morphTargetBase]);ai(b6.position);c.vertexAttribPointer(b6.position,3,c.FLOAT,false,0,0)}else{if(b6.position>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglVertexBuffer);ai(b6.position);c.vertexAttribPointer(b6.position,3,c.FLOAT,false,0,0)}}if(b3.morphTargetForcedOrder.length){var b0=0;var b1=b3.morphTargetForcedOrder;var ca=b3.morphTargetInfluences;while(b0<b8.numSupportedMorphTargets&&b0<b1.length){if(b6["morphTarget"+b0]>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglMorphTargetsBuffers[b1[b0]]);ai(b6["morphTarget"+b0]);c.vertexAttribPointer(b6["morphTarget"+b0],3,c.FLOAT,false,0,0)}if(b6["morphNormal"+b0]>=0&&b8.morphNormals){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglMorphNormalsBuffers[b1[b0]]);ai(b6["morphNormal"+b0]);c.vertexAttribPointer(b6["morphNormal"+b0],3,c.FLOAT,false,0,0)}b3.__webglMorphTargetInfluences[b0]=ca[b1[b0]];b0++}}else{var b9,b2=[];var ca=b3.morphTargetInfluences;var b7,cb=ca.length;for(b7=0;b7<cb;b7++){b9=ca[b7];if(b9>0){b2.push([b9,b7])}}if(b2.length>b8.numSupportedMorphTargets){b2.sort(ac);b2.length=b8.numSupportedMorphTargets}else{if(b2.length>b8.numSupportedMorphNormals){b2.sort(ac)}else{if(b2.length===0){b2.push([0,0])}}}var b5,b0=0;while(b0<b8.numSupportedMorphTargets){if(b2[b0]){b5=b2[b0][1];if(b6["morphTarget"+b0]>=0){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglMorphTargetsBuffers[b5]);ai(b6["morphTarget"+b0]);c.vertexAttribPointer(b6["morphTarget"+b0],3,c.FLOAT,false,0,0)}if(b6["morphNormal"+b0]>=0&&b8.morphNormals){c.bindBuffer(c.ARRAY_BUFFER,b4.__webglMorphNormalsBuffers[b5]);ai(b6["morphNormal"+b0]);c.vertexAttribPointer(b6["morphNormal"+b0],3,c.FLOAT,false,0,0)}b3.__webglMorphTargetInfluences[b0]=ca[b5]}else{b3.__webglMorphTargetInfluences[b0]=0}b0++}}if(b8.program.uniforms.morphTargetInfluences!==null){c.uniform1fv(b8.program.uniforms.morphTargetInfluences,b3.__webglMorphTargetInfluences)}}function aH(b1,b0){if(b1.z!==b0.z){return b0.z-b1.z}else{return b1.id-b0.id}}function ac(b1,b0){return b0[0]-b1[0]}this.render=function(b6,ca,b7,b8){if(ca instanceof THREE.Camera===false){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var b4,cb,b5,b2,b0,b3=b6.__lights,b1=b6.fog;a2=-1;bZ=true;if(b6.autoUpdate===true){b6.updateMatrixWorld()}if(ca.parent===undefined){ca.updateMatrixWorld()}ca.matrixWorldInverse.getInverse(ca.matrixWorld);a0.multiplyMatrices(ca.projectionMatrix,ca.matrixWorldInverse);bt.setFromMatrix(a0);if(this.autoUpdateObjects){this.initWebGLObjects(b6)}p(this.renderPluginsPre,b6,ca);aO.info.render.calls=0;aO.info.render.vertices=0;aO.info.render.faces=0;aO.info.render.points=0;this.setRenderTarget(b7);if(this.autoClear||b8){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}b0=b6.__webglObjects;for(b4=0,cb=b0.length;b4<cb;b4++){b5=b0[b4];b2=b5.object;b5.id=b4;b5.render=false;if(b2.visible){if(!(b2 instanceof THREE.Mesh||b2 instanceof THREE.ParticleSystem)||!(b2.frustumCulled)||bt.intersectsObject(b2)){bh(b2,ca);ap(b5);b5.render=true;if(this.sortObjects===true){if(b2.renderDepth!==null){b5.z=b2.renderDepth}else{W.getPositionFromMatrix(b2.matrixWorld);W.applyProjection(a0);b5.z=W.z}}}}}if(this.sortObjects){b0.sort(aH)}b0=b6.__webglObjectsImmediate;for(b4=0,cb=b0.length;b4<cb;b4++){b5=b0[b4];b2=b5.object;if(b2.visible){bh(b2,ca);aS(b5)}}if(b6.overrideMaterial){var b9=b6.overrideMaterial;this.setBlending(b9.blending,b9.blendEquation,b9.blendSrc,b9.blendDst);this.setDepthTest(b9.depthTest);this.setDepthWrite(b9.depthWrite);bW(b9.polygonOffset,b9.polygonOffsetFactor,b9.polygonOffsetUnits);bw(b6.__webglObjects,false,"",ca,b3,b1,true,b9);bL(b6.__webglObjectsImmediate,"",ca,b3,b1,false,b9)}else{var b9=null;this.setBlending(THREE.NoBlending);bw(b6.__webglObjects,true,"opaque",ca,b3,b1,false,b9);bL(b6.__webglObjectsImmediate,"opaque",ca,b3,b1,false,b9);bw(b6.__webglObjects,false,"transparent",ca,b3,b1,true,b9);bL(b6.__webglObjectsImmediate,"transparent",ca,b3,b1,true,b9)}p(this.renderPluginsPost,b6,ca);if(b7&&b7.generateMipmaps&&b7.minFilter!==THREE.NearestFilter&&b7.minFilter!==THREE.LinearFilter){aX(b7)}this.setDepthTest(true);this.setDepthWrite(true)};function p(b0,b4,b3){if(!b0.length){return}for(var b2=0,b1=b0.length;b2<b1;b2++){am=null;aL=null;i=-1;a=-1;bz=-1;bl=-1;k=-1;F=-1;a2=-1;bZ=true;b0[b2].render(b4,b3,D,aU);am=null;aL=null;i=-1;a=-1;bz=-1;bl=-1;k=-1;F=-1;a2=-1;bZ=true}}function bw(b0,cd,b9,cc,b6,b1,ca,ce){var b8,b4,b5,cb,b2,b3,cf;if(cd){b2=b0.length-1;b3=-1;cf=-1}else{b2=0;b3=b0.length;cf=1}for(var b7=b2;b7!==b3;b7+=cf){b8=b0[b7];if(b8.render){b4=b8.object;b5=b8.buffer;if(ce){cb=ce}else{cb=b8[b9];if(!cb){continue}if(ca){aO.setBlending(cb.blending,cb.blendEquation,cb.blendSrc,cb.blendDst)}aO.setDepthTest(cb.depthTest);aO.setDepthWrite(cb.depthWrite);bW(cb.polygonOffset,cb.polygonOffsetFactor,cb.polygonOffsetUnits)}aO.setMaterialFaces(cb);if(b5 instanceof THREE.BufferGeometry){aO.renderBufferDirect(cc,b6,b1,cb,b5,b4)}else{aO.renderBuffer(cc,b6,b1,cb,b5,b4)}}}}function bL(b0,b7,ca,b3,b1,b8,cb){var b6,b2,b9,b5;for(var b4=0,cc=b0.length;b4<cc;b4++){b6=b0[b4];b2=b6.object;if(b2.visible){if(cb){b9=cb}else{b9=b6[b7];if(!b9){continue}if(b8){aO.setBlending(b9.blending,b9.blendEquation,b9.blendSrc,b9.blendDst)}aO.setDepthTest(b9.depthTest);aO.setDepthWrite(b9.depthWrite);bW(b9.polygonOffset,b9.polygonOffsetFactor,b9.polygonOffsetUnits)}aO.renderImmediateObject(ca,b3,b1,b9,b2)}}}this.renderImmediateObject=function(b4,b2,b5,b3,b1){var b0=aQ(b4,b2,b5,b3,b1);F=-1;aO.setMaterialFaces(b3);if(b1.immediateRenderCallback){b1.immediateRenderCallback(b0,c,bt)}else{b1.render(function(b6){aO.renderBufferImmediate(b6,b0,b3)})}};function aS(b2){var b0=b2.object,b1=b0.material;if(b1.transparent){b2.transparent=b1;b2.opaque=null}else{b2.opaque=b1;b2.transparent=null}}function ap(b5){var b3=b5.object,b2=b5.buffer,b4,b1,b0;b0=b3.material;if(b0 instanceof THREE.MeshFaceMaterial){b1=b2.materialIndex;b4=b0.materials[b1];if(b4.transparent){b5.transparent=b4;b5.opaque=null}else{b5.opaque=b4;b5.transparent=null}}else{b4=b0;if(b4){if(b4.transparent){b5.transparent=b4;b5.opaque=null}else{b5.opaque=b4;b5.transparent=null}}}}function ay(b8,b5){var b3,ca,b7,cb,b6,b1,b4={};var b9=b8.morphTargets.length;var b0=b8.morphNormals.length;var cc=b5 instanceof THREE.MeshFaceMaterial;b8.geometryGroups={};for(b3=0,ca=b8.faces.length;b3<ca;b3++){b7=b8.faces[b3];cb=cc?b7.materialIndex:0;if(b4[cb]===undefined){b4[cb]={hash:cb,counter:0}}b1=b4[cb].hash+"_"+b4[cb].counter;if(b8.geometryGroups[b1]===undefined){b8.geometryGroups[b1]={faces3:[],materialIndex:cb,vertices:0,numMorphTargets:b9,numMorphNormals:b0}}b6=3;if(b8.geometryGroups[b1].vertices+b6>65535){b4[cb].counter+=1;b1=b4[cb].hash+"_"+b4[cb].counter;if(b8.geometryGroups[b1]===undefined){b8.geometryGroups[b1]={faces3:[],materialIndex:cb,vertices:0,numMorphTargets:b9,numMorphNormals:b0}}}b8.geometryGroups[b1].faces3.push(b3);b8.geometryGroups[b1].vertices+=b6}b8.geometryGroupsList=[];for(var b2 in b8.geometryGroups){b8.geometryGroups[b2].id=V++;b8.geometryGroupsList.push(b8.geometryGroups[b2])}}this.initWebGLObjects=function(b2){if(!b2.__webglObjects){b2.__webglObjects=[];b2.__webglObjectsImmediate=[];b2.__webglSprites=[];b2.__webglFlares=[]}while(b2.__objectsAdded.length){at(b2.__objectsAdded[0],b2);b2.__objectsAdded.splice(0,1)}while(b2.__objectsRemoved.length){O(b2.__objectsRemoved[0],b2);b2.__objectsRemoved.splice(0,1)}for(var b3=0,b1=b2.__webglObjects.length;b3<b1;b3++){var b0=b2.__webglObjects[b3].object;if(b0.__webglInit===undefined){if(b0.__webglActive!==undefined){O(b0,b2)}at(b0,b2)}M(b0)}};function at(b1,b4){var b3,b5,b2,b0;if(b1.__webglInit===undefined){b1.__webglInit=true;b1._modelViewMatrix=new THREE.Matrix4();b1._normalMatrix=new THREE.Matrix3();if(b1.geometry!==undefined&&b1.geometry.__webglInit===undefined){b1.geometry.__webglInit=true;b1.geometry.addEventListener("dispose",aZ)}b5=b1.geometry;if(b5===undefined){}else{if(b5 instanceof THREE.BufferGeometry){E(b5)}else{if(b1 instanceof THREE.Mesh){b2=b1.material;if(b5.geometryGroups===undefined){ay(b5,b2)}for(b3 in b5.geometryGroups){b0=b5.geometryGroups[b3];if(!b0.__webglVertexBuffer){aE(b0);al(b0,b1);b5.verticesNeedUpdate=true;b5.morphTargetsNeedUpdate=true;b5.elementsNeedUpdate=true;b5.uvsNeedUpdate=true;b5.normalsNeedUpdate=true;b5.tangentsNeedUpdate=true;b5.colorsNeedUpdate=true}}}else{if(b1 instanceof THREE.Line){if(!b5.__webglVertexBuffer){ae(b5);K(b5,b1);b5.verticesNeedUpdate=true;b5.colorsNeedUpdate=true;b5.lineDistancesNeedUpdate=true}}else{if(b1 instanceof THREE.ParticleSystem){if(!b5.__webglVertexBuffer){H(b5);bK(b5,b1);b5.verticesNeedUpdate=true;b5.colorsNeedUpdate=true}}}}}}}if(b1.__webglActive===undefined){if(b1 instanceof THREE.Mesh){b5=b1.geometry;if(b5 instanceof THREE.BufferGeometry){I(b4.__webglObjects,b5,b1)}else{if(b5 instanceof THREE.Geometry){for(b3 in b5.geometryGroups){b0=b5.geometryGroups[b3];I(b4.__webglObjects,b0,b1)}}}}else{if(b1 instanceof THREE.Line||b1 instanceof THREE.ParticleSystem){b5=b1.geometry;I(b4.__webglObjects,b5,b1)}else{if(b1 instanceof THREE.ImmediateRenderObject||b1.immediateRenderCallback){aD(b4.__webglObjectsImmediate,b1)}else{if(b1 instanceof THREE.Sprite){b4.__webglSprites.push(b1)}else{if(b1 instanceof THREE.LensFlare){b4.__webglFlares.push(b1)}}}}}b1.__webglActive=true}}function I(b2,b0,b1){b2.push({id:null,buffer:b0,object:b1,opaque:null,transparent:null,z:0})}function aD(b1,b0){b1.push({id:null,object:b0,opaque:null,transparent:null,z:0})}function M(b2){var b6=b2.geometry,b0,b4,b5;if(b6 instanceof THREE.BufferGeometry){ax(b6,c.DYNAMIC_DRAW,!b6.dynamic)}else{if(b2 instanceof THREE.Mesh){for(var b3=0,b1=b6.geometryGroupsList.length;b3<b1;b3++){b0=b6.geometryGroupsList[b3];b5=L(b2,b0);if(b6.buffersNeedUpdate){al(b0,b2)}b4=b5.attributes&&h(b5);if(b6.verticesNeedUpdate||b6.morphTargetsNeedUpdate||b6.elementsNeedUpdate||b6.uvsNeedUpdate||b6.normalsNeedUpdate||b6.colorsNeedUpdate||b6.tangentsNeedUpdate||b4){n(b0,b2,c.DYNAMIC_DRAW,!b6.dynamic,b5)}}b6.verticesNeedUpdate=false;b6.morphTargetsNeedUpdate=false;b6.elementsNeedUpdate=false;b6.uvsNeedUpdate=false;b6.normalsNeedUpdate=false;b6.colorsNeedUpdate=false;b6.tangentsNeedUpdate=false;b6.buffersNeedUpdate=false;b5.attributes&&av(b5)}else{if(b2 instanceof THREE.Line){b5=L(b2,b6);b4=b5.attributes&&h(b5);if(b6.verticesNeedUpdate||b6.colorsNeedUpdate||b6.lineDistancesNeedUpdate||b4){bo(b6,c.DYNAMIC_DRAW)}b6.verticesNeedUpdate=false;b6.colorsNeedUpdate=false;b6.lineDistancesNeedUpdate=false;b5.attributes&&av(b5)}else{if(b2 instanceof THREE.ParticleSystem){b5=L(b2,b6);b4=b5.attributes&&h(b5);if(b6.verticesNeedUpdate||b6.colorsNeedUpdate||b2.sortParticles||b4){a7(b6,c.DYNAMIC_DRAW,b2)}b6.verticesNeedUpdate=false;b6.colorsNeedUpdate=false;b5.attributes&&av(b5)}}}}}function h(b1){for(var b0 in b1.attributes){if(b1.attributes[b0].needsUpdate){return true}}return false}function av(b1){for(var b0 in b1.attributes){b1.attributes[b0].needsUpdate=false}}function O(b0,b1){if(b0 instanceof THREE.Mesh||b0 instanceof THREE.ParticleSystem||b0 instanceof THREE.Line){bX(b1.__webglObjects,b0)}else{if(b0 instanceof THREE.Sprite){aA(b1.__webglSprites,b0)}else{if(b0 instanceof THREE.LensFlare){aA(b1.__webglFlares,b0)}else{if(b0 instanceof THREE.ImmediateRenderObject||b0.immediateRenderCallback){bX(b1.__webglObjectsImmediate,b0)}}}}delete b0.__webglActive}function bX(b1,b0){for(var b2=b1.length-1;b2>=0;b2--){if(b1[b2].object===b0){b1.splice(b2,1)}}}function aA(b1,b0){for(var b2=b1.length-1;b2>=0;b2--){if(b1[b2]===b0){b1.splice(b2,1)}}}this.initMaterial=function(ca,b8,b1,b6){ca.addEventListener("dispose",bi);var cf,cc,cb,b9,ce,b4,b0,b5,cd;if(ca instanceof THREE.MeshDepthMaterial){cd="depth"}else{if(ca instanceof THREE.MeshNormalMaterial){cd="normal"}else{if(ca instanceof THREE.MeshBasicMaterial){cd="basic"}else{if(ca instanceof THREE.MeshLambertMaterial){cd="lambert"}else{if(ca instanceof THREE.MeshPhongMaterial){cd="phong"}else{if(ca instanceof THREE.LineBasicMaterial){cd="basic"}else{if(ca instanceof THREE.LineDashedMaterial){cd="dashed"}else{if(ca instanceof THREE.ParticleSystemMaterial){cd="particle_basic"}}}}}}}}if(cd){aq(ca,THREE.ShaderLib[cd])}b4=bg(b8);b5=aa(b8);b0=aJ(b6);ce={map:!!ca.map,envMap:!!ca.envMap,lightMap:!!ca.lightMap,bumpMap:!!ca.bumpMap,normalMap:!!ca.normalMap,specularMap:!!ca.specularMap,vertexColors:ca.vertexColors,fog:b1,useFog:ca.fog,fogExp:b1 instanceof THREE.FogExp2,sizeAttenuation:ca.sizeAttenuation,skinning:ca.skinning,maxBones:b0,useVertexTexture:Z&&b6&&b6.useVertexTexture,morphTargets:ca.morphTargets,morphNormals:ca.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:b4.directional,maxPointLights:b4.point,maxSpotLights:b4.spot,maxHemiLights:b4.hemi,maxShadows:b5,shadowMapEnabled:this.shadowMapEnabled&&b6.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:ca.alphaTest,metal:ca.metal,perPixel:ca.perPixel,wrapAround:ca.wrapAround,doubleSided:ca.side===THREE.DoubleSide,flipSided:ca.side===THREE.BackSide};ca.program=g(cd,ca.fragmentShader,ca.vertexShader,ca.uniforms,ca.attributes,ca.defines,ce,ca.index0AttributeName);var b7=ca.program.attributes;if(ca.morphTargets){ca.numSupportedMorphTargets=0;var b3,b2="morphTarget";for(b9=0;b9<this.maxMorphTargets;b9++){b3=b2+b9;if(b7[b3]>=0){ca.numSupportedMorphTargets++}}}if(ca.morphNormals){ca.numSupportedMorphNormals=0;var b3,b2="morphNormal";for(b9=0;b9<this.maxMorphNormals;b9++){b3=b2+b9;if(b7[b3]>=0){ca.numSupportedMorphNormals++}}}ca.uniformsList=[];for(cf in ca.uniforms){ca.uniformsList.push([ca.uniforms[cf],cf])}};function aq(b1,b0){b1.uniforms=THREE.UniformsUtils.clone(b0.uniforms);b1.vertexShader=b0.vertexShader;b1.fragmentShader=b0.fragmentShader}function aQ(b5,b2,b0,b6,b1){bf=0;if(b6.needsUpdate){if(b6.program){S(b6)}aO.initMaterial(b6,b2,b0,b1);b6.needsUpdate=false}if(b6.morphTargets){if(!b1.__webglMorphTargetInfluences){b1.__webglMorphTargetInfluences=new Float32Array(aO.maxMorphTargets)}}var b4=false;var b3=b6.program,b9=b3.uniforms,b7=b6.uniforms;if(b3!==am){c.useProgram(b3);am=b3;b4=true}if(b6.id!==a2){a2=b6.id;b4=true}if(b4||b5!==aL){c.uniformMatrix4fv(b9.projectionMatrix,false,b5.projectionMatrix.elements);if(b5!==aL){aL=b5}}if(b6.skinning){if(Z&&b1.useVertexTexture){if(b9.boneTexture!==null){var b8=aw();c.uniform1i(b9.boneTexture,b8);aO.setTexture(b1.boneTexture,b8)}if(b9.boneTextureWidth!==null){c.uniform1i(b9.boneTextureWidth,b1.boneTextureWidth)}if(b9.boneTextureHeight!==null){c.uniform1i(b9.boneTextureHeight,b1.boneTextureHeight)}}else{if(b9.boneGlobalMatrices!==null){c.uniformMatrix4fv(b9.boneGlobalMatrices,false,b1.boneMatrices)}}}if(b4){if(b0&&b6.fog){ab(b7,b0)}if(b6 instanceof THREE.MeshPhongMaterial||b6 instanceof THREE.MeshLambertMaterial||b6.lights){if(bZ){f(b3,b2);bZ=false}bc(b7,bq)}if(b6 instanceof THREE.MeshBasicMaterial||b6 instanceof THREE.MeshLambertMaterial||b6 instanceof THREE.MeshPhongMaterial){bH(b7,b6)}if(b6 instanceof THREE.LineBasicMaterial){ar(b7,b6)}else{if(b6 instanceof THREE.LineDashedMaterial){ar(b7,b6);ag(b7,b6)}else{if(b6 instanceof THREE.ParticleSystemMaterial){bp(b7,b6)}else{if(b6 instanceof THREE.MeshPhongMaterial){P(b7,b6)}else{if(b6 instanceof THREE.MeshLambertMaterial){bI(b7,b6)}else{if(b6 instanceof THREE.MeshDepthMaterial){b7.mNear.value=b5.near;b7.mFar.value=b5.far;b7.opacity.value=b6.opacity}else{if(b6 instanceof THREE.MeshNormalMaterial){b7.opacity.value=b6.opacity}}}}}}}if(b1.receiveShadow&&!b6._shadowPass){bP(b7,b2)}U(b3,b6.uniformsList);if(b6 instanceof THREE.ShaderMaterial||b6 instanceof THREE.MeshPhongMaterial||b6.envMap){if(b9.cameraPosition!==null){W.getPositionFromMatrix(b5.matrixWorld);c.uniform3f(b9.cameraPosition,W.x,W.y,W.z)}}if(b6 instanceof THREE.MeshPhongMaterial||b6 instanceof THREE.MeshLambertMaterial||b6 instanceof THREE.ShaderMaterial||b6.skinning){if(b9.viewMatrix!==null){c.uniformMatrix4fv(b9.viewMatrix,false,b5.matrixWorldInverse.elements)}}}u(b9,b1);if(b9.modelMatrix!==null){c.uniformMatrix4fv(b9.modelMatrix,false,b1.matrixWorld.elements)}return b3}function bH(b1,b2){b1.opacity.value=b2.opacity;if(aO.gammaInput){b1.diffuse.value.copyGammaToLinear(b2.color)}else{b1.diffuse.value=b2.color}b1.map.value=b2.map;b1.lightMap.value=b2.lightMap;b1.specularMap.value=b2.specularMap;if(b2.bumpMap){b1.bumpMap.value=b2.bumpMap;b1.bumpScale.value=b2.bumpScale}if(b2.normalMap){b1.normalMap.value=b2.normalMap;b1.normalScale.value.copy(b2.normalScale)}var b0;if(b2.map){b0=b2.map}else{if(b2.specularMap){b0=b2.specularMap}else{if(b2.normalMap){b0=b2.normalMap}else{if(b2.bumpMap){b0=b2.bumpMap}}}}if(b0!==undefined){var b4=b0.offset;var b3=b0.repeat;b1.offsetRepeat.value.set(b4.x,b4.y,b3.x,b3.y)}b1.envMap.value=b2.envMap;b1.flipEnvMap.value=(b2.envMap instanceof THREE.WebGLRenderTargetCube)?1:-1;if(aO.gammaInput){b1.reflectivity.value=b2.reflectivity}else{b1.reflectivity.value=b2.reflectivity}b1.refractionRatio.value=b2.refractionRatio;b1.combine.value=b2.combine;b1.useRefract.value=b2.envMap&&b2.envMap.mapping instanceof THREE.CubeRefractionMapping}function ar(b0,b1){b0.diffuse.value=b1.color;b0.opacity.value=b1.opacity}function ag(b0,b1){b0.dashSize.value=b1.dashSize;b0.totalSize.value=b1.dashSize+b1.gapSize;b0.scale.value=b1.scale}function bp(b0,b1){b0.psColor.value=b1.color;b0.opacity.value=b1.opacity;b0.size.value=b1.size;b0.scale.value=aY.height/2;b0.map.value=b1.map}function ab(b0,b1){b0.fogColor.value=b1.color;if(b1 instanceof THREE.Fog){b0.fogNear.value=b1.near;b0.fogFar.value=b1.far}else{if(b1 instanceof THREE.FogExp2){b0.fogDensity.value=b1.density}}}function P(b0,b1){b0.shininess.value=b1.shininess;if(aO.gammaInput){b0.ambient.value.copyGammaToLinear(b1.ambient);b0.emissive.value.copyGammaToLinear(b1.emissive);b0.specular.value.copyGammaToLinear(b1.specular)}else{b0.ambient.value=b1.ambient;b0.emissive.value=b1.emissive;b0.specular.value=b1.specular}if(b1.wrapAround){b0.wrapRGB.value.copy(b1.wrapRGB)}}function bI(b0,b1){if(aO.gammaInput){b0.ambient.value.copyGammaToLinear(b1.ambient);b0.emissive.value.copyGammaToLinear(b1.emissive)}else{b0.ambient.value=b1.ambient;b0.emissive.value=b1.emissive}if(b1.wrapAround){b0.wrapRGB.value.copy(b1.wrapRGB)}}function bc(b0,b1){b0.ambientLightColor.value=b1.ambient;b0.directionalLightColor.value=b1.directional.colors;b0.directionalLightDirection.value=b1.directional.positions;b0.pointLightColor.value=b1.point.colors;b0.pointLightPosition.value=b1.point.positions;b0.pointLightDistance.value=b1.point.distances;b0.spotLightColor.value=b1.spot.colors;b0.spotLightPosition.value=b1.spot.positions;b0.spotLightDistance.value=b1.spot.distances;b0.spotLightDirection.value=b1.spot.directions;b0.spotLightAngleCos.value=b1.spot.anglesCos;b0.spotLightExponent.value=b1.spot.exponents;b0.hemisphereLightSkyColor.value=b1.hemi.skyColors;b0.hemisphereLightGroundColor.value=b1.hemi.groundColors;b0.hemisphereLightDirection.value=b1.hemi.positions}function bP(b0,b4){if(b0.shadowMatrix){var b3=0;for(var b5=0,b2=b4.length;b5<b2;b5++){var b1=b4[b5];if(!b1.castShadow){continue}if(b1 instanceof THREE.SpotLight||(b1 instanceof THREE.DirectionalLight&&!b1.shadowCascade)){b0.shadowMap.value[b3]=b1.shadowMap;b0.shadowMapSize.value[b3]=b1.shadowMapSize;b0.shadowMatrix.value[b3]=b1.shadowMatrix;b0.shadowDarkness.value[b3]=b1.shadowDarkness;b0.shadowBias.value[b3]=b1.shadowBias;b3++}}}}function u(b0,b1){c.uniformMatrix4fv(b0.modelViewMatrix,false,b1._modelViewMatrix.elements);if(b0.normalMatrix){c.uniformMatrix3fv(b0.normalMatrix,false,b1._normalMatrix.elements)}}function aw(){var b0=bf;if(b0>=bJ){console.warn("WebGLRenderer: trying to use "+b0+" texture units while this GPU supports only "+bJ)}bf+=1;return b0}function U(b5,cb){var b0,b9,b7,ca,b6,cc,b4,b8,b2,b3,b1;for(b2=0,b3=cb.length;b2<b3;b2++){ca=b5.uniforms[cb[b2][1]];if(!ca){continue}b0=cb[b2][0];b7=b0.type;b9=b0.value;if(b7==="i"){c.uniform1i(ca,b9)}else{if(b7==="f"){c.uniform1f(ca,b9)}else{if(b7==="v2"){c.uniform2f(ca,b9.x,b9.y)}else{if(b7==="v3"){c.uniform3f(ca,b9.x,b9.y,b9.z)}else{if(b7==="v4"){c.uniform4f(ca,b9.x,b9.y,b9.z,b9.w)}else{if(b7==="c"){c.uniform3f(ca,b9.r,b9.g,b9.b)}else{if(b7==="iv1"){c.uniform1iv(ca,b9)}else{if(b7==="iv"){c.uniform3iv(ca,b9)}else{if(b7==="fv1"){c.uniform1fv(ca,b9)}else{if(b7==="fv"){c.uniform3fv(ca,b9)}else{if(b7==="v2v"){if(b0._array===undefined){b0._array=new Float32Array(2*b9.length)}for(b4=0,b8=b9.length;b4<b8;b4++){b1=b4*2;b0._array[b1]=b9[b4].x;b0._array[b1+1]=b9[b4].y}c.uniform2fv(ca,b0._array)}else{if(b7==="v3v"){if(b0._array===undefined){b0._array=new Float32Array(3*b9.length)}for(b4=0,b8=b9.length;b4<b8;b4++){b1=b4*3;b0._array[b1]=b9[b4].x;b0._array[b1+1]=b9[b4].y;b0._array[b1+2]=b9[b4].z}c.uniform3fv(ca,b0._array)}else{if(b7==="v4v"){if(b0._array===undefined){b0._array=new Float32Array(4*b9.length)}for(b4=0,b8=b9.length;b4<b8;b4++){b1=b4*4;b0._array[b1]=b9[b4].x;b0._array[b1+1]=b9[b4].y;b0._array[b1+2]=b9[b4].z;b0._array[b1+3]=b9[b4].w}c.uniform4fv(ca,b0._array)}else{if(b7==="m4"){if(b0._array===undefined){b0._array=new Float32Array(16)}b9.flattenToArray(b0._array);c.uniformMatrix4fv(ca,false,b0._array)}else{if(b7==="m4v"){if(b0._array===undefined){b0._array=new Float32Array(16*b9.length)}for(b4=0,b8=b9.length;b4<b8;b4++){b9[b4].flattenToArrayOffset(b0._array,b4*16)}c.uniformMatrix4fv(ca,false,b0._array)}else{if(b7==="t"){b6=b9;cc=aw();c.uniform1i(ca,cc);if(!b6){continue}if(b6.image instanceof Array&&b6.image.length===6){bm(b6,cc)}else{if(b6 instanceof THREE.WebGLRenderTargetCube){ba(b6,cc)}else{aO.setTexture(b6,cc)}}}else{if(b7==="tv"){if(b0._array===undefined){b0._array=[]}for(b4=0,b8=b0.value.length;b4<b8;b4++){b0._array[b4]=aw()}c.uniform1iv(ca,b0._array);for(b4=0,b8=b0.value.length;b4<b8;b4++){b6=b0.value[b4];cc=b0._array[b4];if(!b6){continue}aO.setTexture(b6,cc)}}else{console.warn("THREE.WebGLRenderer: Unknown uniform type: "+b7)}}}}}}}}}}}}}}}}}}}function bh(b0,b1){b0._modelViewMatrix.multiplyMatrices(b1.matrixWorldInverse,b0.matrixWorld);b0._normalMatrix.getNormalMatrix(b0._modelViewMatrix)}function a5(b3,b2,b0,b1){b3[b2]=b0.r*b0.r*b1;b3[b2+1]=b0.g*b0.g*b1;b3[b2+2]=b0.b*b0.b*b1}function a6(b3,b2,b1,b0){b3[b2]=b1.r*b0;b3[b2+1]=b1.g*b0;b3[b2+2]=b1.b*b0}function f(b0,b5){var cD,cr,ci,cz,cu=0,cE=0,cF=0,cp,b2,b9,cq,b8,ct,cg,cm=bq,ce=cm.directional.colors,b3=cm.directional.positions,cA=cm.point.colors,cw=cm.point.positions,co=cm.point.distances,cB=cm.spot.colors,b4=cm.spot.positions,cx=cm.spot.distances,cd=cm.spot.directions,b6=cm.spot.anglesCos,cf=cm.spot.exponents,b1=cm.hemi.skyColors,cC=cm.hemi.groundColors,cc=cm.hemi.positions,cG=0,cl=0,ch=0,ca=0,cn=0,ck=0,cj=0,b7=0,cb=0,cy=0,cv=0,cs=0;for(cD=0,cr=b5.length;cD<cr;cD++){ci=b5[cD];if(ci.onlyShadow){continue}cp=ci.color;cq=ci.intensity;cg=ci.distance;if(ci instanceof THREE.AmbientLight){if(!ci.visible){continue}if(aO.gammaInput){cu+=cp.r*cp.r;cE+=cp.g*cp.g;cF+=cp.b*cp.b}else{cu+=cp.r;cE+=cp.g;cF+=cp.b}}else{if(ci instanceof THREE.DirectionalLight){cn+=1;if(!ci.visible){continue}aM.getPositionFromMatrix(ci.matrixWorld);W.getPositionFromMatrix(ci.target.matrixWorld);aM.sub(W);aM.normalize();if(aM.x===0&&aM.y===0&&aM.z===0){continue}cb=cG*3;b3[cb]=aM.x;b3[cb+1]=aM.y;b3[cb+2]=aM.z;if(aO.gammaInput){a5(ce,cb,cp,cq*cq)}else{a6(ce,cb,cp,cq)}cG+=1}else{if(ci instanceof THREE.PointLight){ck+=1;if(!ci.visible){continue}cy=cl*3;if(aO.gammaInput){a5(cA,cy,cp,cq*cq)}else{a6(cA,cy,cp,cq)}W.getPositionFromMatrix(ci.matrixWorld);cw[cy]=W.x;cw[cy+1]=W.y;cw[cy+2]=W.z;co[cl]=cg;cl+=1}else{if(ci instanceof THREE.SpotLight){cj+=1;if(!ci.visible){continue}cv=ch*3;if(aO.gammaInput){a5(cB,cv,cp,cq*cq)}else{a6(cB,cv,cp,cq)}W.getPositionFromMatrix(ci.matrixWorld);b4[cv]=W.x;b4[cv+1]=W.y;b4[cv+2]=W.z;cx[ch]=cg;aM.copy(W);W.getPositionFromMatrix(ci.target.matrixWorld);aM.sub(W);aM.normalize();cd[cv]=aM.x;cd[cv+1]=aM.y;cd[cv+2]=aM.z;b6[ch]=Math.cos(ci.angle);cf[ch]=ci.exponent;ch+=1}else{if(ci instanceof THREE.HemisphereLight){b7+=1;if(!ci.visible){continue}aM.getPositionFromMatrix(ci.matrixWorld);aM.normalize();if(aM.x===0&&aM.y===0&&aM.z===0){continue}cs=ca*3;cc[cs]=aM.x;cc[cs+1]=aM.y;cc[cs+2]=aM.z;b2=ci.color;b9=ci.groundColor;if(aO.gammaInput){b8=cq*cq;a5(b1,cs,b2,b8);a5(cC,cs,b9,b8)}else{a6(b1,cs,b2,cq);a6(cC,cs,b9,cq)}ca+=1}}}}}}for(cD=cG*3,cr=Math.max(ce.length,cn*3);cD<cr;cD++){ce[cD]=0}for(cD=cl*3,cr=Math.max(cA.length,ck*3);cD<cr;cD++){cA[cD]=0}for(cD=ch*3,cr=Math.max(cB.length,cj*3);cD<cr;cD++){cB[cD]=0}for(cD=ca*3,cr=Math.max(b1.length,b7*3);cD<cr;cD++){b1[cD]=0}for(cD=ca*3,cr=Math.max(cC.length,b7*3);cD<cr;cD++){cC[cD]=0}cm.directional.length=cG;cm.point.length=cl;cm.spot.length=ch;cm.hemi.length=ca;cm.ambient[0]=cu;cm.ambient[1]=cE;cm.ambient[2]=cF}this.setFaceCulling=function(b1,b0){if(b1===THREE.CullFaceNone){c.disable(c.CULL_FACE)}else{if(b0===THREE.FrontFaceDirectionCW){c.frontFace(c.CW)}else{c.frontFace(c.CCW)}if(b1===THREE.CullFaceBack){c.cullFace(c.BACK)}else{if(b1===THREE.CullFaceFront){c.cullFace(c.FRONT)}else{c.cullFace(c.FRONT_AND_BACK)}}c.enable(c.CULL_FACE)}};this.setMaterialFaces=function(b2){var b0=b2.side===THREE.DoubleSide;var b1=b2.side===THREE.BackSide;if(bl!==b0){if(b0){c.disable(c.CULL_FACE)}else{c.enable(c.CULL_FACE)}bl=b0}if(k!==b1){if(b1){c.frontFace(c.CW)}else{c.frontFace(c.CCW)}k=b1}};this.setDepthTest=function(b0){if(a!==b0){if(b0){c.enable(c.DEPTH_TEST)}else{c.disable(c.DEPTH_TEST)}a=b0}};this.setDepthWrite=function(b0){if(bz!==b0){c.depthMask(b0);bz=b0}};function aI(b0){if(b0!==bn){c.lineWidth(b0);bn=b0}}function bW(b2,b1,b0){if(aK!==b2){if(b2){c.enable(c.POLYGON_OFFSET_FILL)}else{c.disable(c.POLYGON_OFFSET_FILL)}aK=b2}if(b2&&(bO!==b1||bb!==b0)){c.polygonOffset(b1,b0);bO=b1;bb=b0}}this.setBlending=function(b1,b0,b2,b3){if(b1!==i){if(b1===THREE.NoBlending){c.disable(c.BLEND)}else{if(b1===THREE.AdditiveBlending){c.enable(c.BLEND);c.blendEquation(c.FUNC_ADD);c.blendFunc(c.SRC_ALPHA,c.ONE)}else{if(b1===THREE.SubtractiveBlending){c.enable(c.BLEND);c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ZERO,c.ONE_MINUS_SRC_COLOR)}else{if(b1===THREE.MultiplyBlending){c.enable(c.BLEND);c.blendEquation(c.FUNC_ADD);c.blendFunc(c.ZERO,c.SRC_COLOR)}else{if(b1===THREE.CustomBlending){c.enable(c.BLEND)}else{c.enable(c.BLEND);c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD);c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)}}}}}i=b1}if(b1===THREE.CustomBlending){if(b0!==aj){c.blendEquation(aT(b0));aj=b0}if(b2!==bQ||b3!==au){c.blendFunc(aT(b2),aT(b3));bQ=b2;au=b3}}else{aj=null;bQ=null;au=null}};function R(b1){var b2,b0,b4=[];for(var b3 in b1){b2=b1[b3];if(b2===false){continue}b0="#define "+b3+" "+b2;b4.push(b0)}return b4.join("\n")}function g(b9,b0,b5,cn,cd,cj,cb,ck){var cg,cl,cm,cc,b1;var cf=[];if(b9){cf.push(b9)}else{cf.push(b0);cf.push(b5)}for(cm in cj){cf.push(cm);cf.push(cj[cm])}for(cg in cb){cf.push(cg);cf.push(cb[cg])}b1=cf.join();for(cg=0,cl=bE.length;cg<cl;cg++){var b8=bE[cg];if(b8.code===b1){b8.usedTimes++;return b8.program}}var b2="SHADOWMAP_TYPE_BASIC";if(cb.shadowMapType===THREE.PCFShadowMap){b2="SHADOWMAP_TYPE_PCF"}else{if(cb.shadowMapType===THREE.PCFSoftShadowMap){b2="SHADOWMAP_TYPE_PCF_SOFT"}}var b4=R(cj);cc=c.createProgram();var b3=["precision "+j+" float;","precision "+j+" int;",b4,aW?"#define VERTEX_TEXTURES":"",aO.gammaInput?"#define GAMMA_INPUT":"",aO.gammaOutput?"#define GAMMA_OUTPUT":"",aO.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+cb.maxDirLights,"#define MAX_POINT_LIGHTS "+cb.maxPointLights,"#define MAX_SPOT_LIGHTS "+cb.maxSpotLights,"#define MAX_HEMI_LIGHTS "+cb.maxHemiLights,"#define MAX_SHADOWS "+cb.maxShadows,"#define MAX_BONES "+cb.maxBones,cb.map?"#define USE_MAP":"",cb.envMap?"#define USE_ENVMAP":"",cb.lightMap?"#define USE_LIGHTMAP":"",cb.bumpMap?"#define USE_BUMPMAP":"",cb.normalMap?"#define USE_NORMALMAP":"",cb.specularMap?"#define USE_SPECULARMAP":"",cb.vertexColors?"#define USE_COLOR":"",cb.skinning?"#define USE_SKINNING":"",cb.useVertexTexture?"#define BONE_TEXTURE":"",cb.morphTargets?"#define USE_MORPHTARGETS":"",cb.morphNormals?"#define USE_MORPHNORMALS":"",cb.perPixel?"#define PHONG_PER_PIXEL":"",cb.wrapAround?"#define WRAP_AROUND":"",cb.doubleSided?"#define DOUBLE_SIDED":"",cb.flipSided?"#define FLIP_SIDED":"",cb.shadowMapEnabled?"#define USE_SHADOWMAP":"",cb.shadowMapEnabled?"#define "+b2:"",cb.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",cb.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",cb.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n");var b7=["precision "+j+" float;","precision "+j+" int;",(cb.bumpMap||cb.normalMap)?"#extension GL_OES_standard_derivatives : enable":"",b4,"#define MAX_DIR_LIGHTS "+cb.maxDirLights,"#define MAX_POINT_LIGHTS "+cb.maxPointLights,"#define MAX_SPOT_LIGHTS "+cb.maxSpotLights,"#define MAX_HEMI_LIGHTS "+cb.maxHemiLights,"#define MAX_SHADOWS "+cb.maxShadows,cb.alphaTest?"#define ALPHATEST "+cb.alphaTest:"",aO.gammaInput?"#define GAMMA_INPUT":"",aO.gammaOutput?"#define GAMMA_OUTPUT":"",aO.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",(cb.useFog&&cb.fog)?"#define USE_FOG":"",(cb.useFog&&cb.fogExp)?"#define FOG_EXP2":"",cb.map?"#define USE_MAP":"",cb.envMap?"#define USE_ENVMAP":"",cb.lightMap?"#define USE_LIGHTMAP":"",cb.bumpMap?"#define USE_BUMPMAP":"",cb.normalMap?"#define USE_NORMALMAP":"",cb.specularMap?"#define USE_SPECULARMAP":"",cb.vertexColors?"#define USE_COLOR":"",cb.metal?"#define METAL":"",cb.perPixel?"#define PHONG_PER_PIXEL":"",cb.wrapAround?"#define WRAP_AROUND":"",cb.doubleSided?"#define DOUBLE_SIDED":"",cb.flipSided?"#define FLIP_SIDED":"",cb.shadowMapEnabled?"#define USE_SHADOWMAP":"",cb.shadowMapEnabled?"#define "+b2:"",cb.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",cb.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n");var b6=d("vertex",b3+b5);var ch=d("fragment",b7+b0);c.attachShader(cc,b6);c.attachShader(cc,ch);if(ck){c.bindAttribLocation(cc,0,ck)}c.linkProgram(cc);if(!c.getProgramParameter(cc,c.LINK_STATUS)){console.error("Could not initialise shader\nVALIDATE_STATUS: "+c.getProgramParameter(cc,c.VALIDATE_STATUS)+", gl error ["+c.getError()+"]");console.error("Program Info Log: "+c.getProgramInfoLog(cc))}c.deleteShader(ch);c.deleteShader(b6);cc.uniforms={};cc.attributes={};var ca,ce,co,ci;ca=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"];if(cb.useVertexTexture){ca.push("boneTexture");ca.push("boneTextureWidth");ca.push("boneTextureHeight")}else{ca.push("boneGlobalMatrices")}for(ce in cn){ca.push(ce)}af(cc,ca);ca=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(ci=0;ci<cb.maxMorphTargets;ci++){ca.push("morphTarget"+ci)}for(ci=0;ci<cb.maxMorphNormals;ci++){ca.push("morphNormal"+ci)}for(co in cd){ca.push(co)}B(cc,ca);cc.id=aB++;bE.push({program:cc,code:b1,usedTimes:1});aO.info.memory.programs=bE.length;return cc}function af(b2,b0){var b3,b1,b4;for(b3=0,b1=b0.length;b3<b1;b3++){b4=b0[b3];b2.uniforms[b4]=c.getUniformLocation(b2,b4)}}function B(b2,b0){var b3,b1,b4;for(b3=0,b1=b0.length;b3<b1;b3++){b4=b0[b3];b2.attributes[b4]=c.getAttribLocation(b2,b4)}}function ad(b1){var b3=b1.split("\n");for(var b2=0,b0=b3.length;b2<b0;b2++){b3[b2]=(b2+1)+": "+b3[b2]}return b3.join("\n")}function d(b1,b0){var b2;if(b1==="fragment"){b2=c.createShader(c.FRAGMENT_SHADER)}else{if(b1==="vertex"){b2=c.createShader(c.VERTEX_SHADER)}}c.shaderSource(b2,b0);c.compileShader(b2);if(!c.getShaderParameter(b2,c.COMPILE_STATUS)){console.error(c.getShaderInfoLog(b2));console.error(ad(b0));return null}return b2}function a8(b0){return(b0&(b0-1))===0}function ak(b0,b1,b2){if(b2){c.texParameteri(b0,c.TEXTURE_WRAP_S,aT(b1.wrapS));c.texParameteri(b0,c.TEXTURE_WRAP_T,aT(b1.wrapT));c.texParameteri(b0,c.TEXTURE_MAG_FILTER,aT(b1.magFilter));c.texParameteri(b0,c.TEXTURE_MIN_FILTER,aT(b1.minFilter))}else{c.texParameteri(b0,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(b0,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(b0,c.TEXTURE_MAG_FILTER,aP(b1.magFilter));c.texParameteri(b0,c.TEXTURE_MIN_FILTER,aP(b1.minFilter))}if(q&&b1.type!==THREE.FloatType){if(b1.anisotropy>1||b1.__oldAnisotropy){c.texParameterf(b0,q.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b1.anisotropy,bC));b1.__oldAnisotropy=b1.anisotropy}}}this.setTexture=function(b7,b9){if(b7.needsUpdate){if(!b7.__webglInit){b7.__webglInit=true;b7.addEventListener("dispose",ah);b7.__webglTexture=c.createTexture();aO.info.memory.textures++}c.activeTexture(c.TEXTURE0+b9);c.bindTexture(c.TEXTURE_2D,b7.__webglTexture);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,b7.flipY);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b7.premultiplyAlpha);c.pixelStorei(c.UNPACK_ALIGNMENT,b7.unpackAlignment);var b3=b7.image,b6=a8(b3.width)&&a8(b3.height),b0=aT(b7.format),b2=aT(b7.type);ak(c.TEXTURE_2D,b7,b6);var b1,b4=b7.mipmaps;if(b7 instanceof THREE.DataTexture){if(b4.length>0&&b6){for(var b5=0,b8=b4.length;b5<b8;b5++){b1=b4[b5];c.texImage2D(c.TEXTURE_2D,b5,b0,b1.width,b1.height,0,b0,b2,b1.data)}b7.generateMipmaps=false}else{c.texImage2D(c.TEXTURE_2D,0,b0,b3.width,b3.height,0,b0,b2,b3.data)}}else{if(b7 instanceof THREE.CompressedTexture){for(var b5=0,b8=b4.length;b5<b8;b5++){b1=b4[b5];if(b7.format!==THREE.RGBAFormat){c.compressedTexImage2D(c.TEXTURE_2D,b5,b0,b1.width,b1.height,0,b1.data)}else{c.texImage2D(c.TEXTURE_2D,b5,b0,b1.width,b1.height,0,b0,b2,b1.data)}}}else{if(b4.length>0&&b6){for(var b5=0,b8=b4.length;b5<b8;b5++){b1=b4[b5];c.texImage2D(c.TEXTURE_2D,b5,b0,b0,b2,b1)}b7.generateMipmaps=false}else{c.texImage2D(c.TEXTURE_2D,0,b0,b0,b2,b7.image)}}}if(b7.generateMipmaps&&b6){c.generateMipmap(c.TEXTURE_2D)}b7.needsUpdate=false;if(b7.onUpdate){b7.onUpdate()}}else{c.activeTexture(c.TEXTURE0+b9);c.bindTexture(c.TEXTURE_2D,b7.__webglTexture)}};function s(b5,b6){if(b5.width<=b6&&b5.height<=b6){return b5}var b4=Math.max(b5.width,b5.height);var b3=Math.floor(b5.width*b6/b4);var b1=Math.floor(b5.height*b6/b4);var b2=document.createElement("canvas");b2.width=b3;b2.height=b1;var b0=b2.getContext("2d");b0.drawImage(b5,0,0,b5.width,b5.height,0,0,b3,b1);return b2}function bm(cb,cc){if(cb.image.length===6){if(cb.needsUpdate){if(!cb.image.__webglTextureCube){cb.addEventListener("dispose",ah);cb.image.__webglTextureCube=c.createTexture();aO.info.memory.textures++}c.activeTexture(c.TEXTURE0+cc);c.bindTexture(c.TEXTURE_CUBE_MAP,cb.image.__webglTextureCube);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,cb.flipY);var b3=cb instanceof THREE.CompressedTexture;var b0=[];for(var b9=0;b9<6;b9++){if(aO.autoScaleCubemaps&&!b3){b0[b9]=s(cb.image[b9],ao)}else{b0[b9]=cb.image[b9]}}var b6=b0[0],ca=a8(b6.width)&&a8(b6.height),b1=aT(cb.format),b4=aT(cb.type);ak(c.TEXTURE_CUBE_MAP,cb,ca);for(var b9=0;b9<6;b9++){if(!b3){c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+b9,0,b1,b1,b4,b0[b9])}else{var b2,b5=b0[b9].mipmaps;for(var b7=0,b8=b5.length;b7<b8;b7++){b2=b5[b7];if(cb.format!==THREE.RGBAFormat){c.compressedTexImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+b9,b7,b1,b2.width,b2.height,0,b2.data)}else{c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+b9,b7,b1,b2.width,b2.height,0,b1,b4,b2.data)}}}}if(cb.generateMipmaps&&ca){c.generateMipmap(c.TEXTURE_CUBE_MAP)}cb.needsUpdate=false;if(cb.onUpdate){cb.onUpdate()}}else{c.activeTexture(c.TEXTURE0+cc);c.bindTexture(c.TEXTURE_CUBE_MAP,cb.image.__webglTextureCube)}}}function ba(b0,b1){c.activeTexture(c.TEXTURE0+b1);c.bindTexture(c.TEXTURE_CUBE_MAP,b0.__webglTexture)}function a9(b2,b1,b0){c.bindFramebuffer(c.FRAMEBUFFER,b2);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,b0,b1.__webglTexture,0)}function r(b0,b1){c.bindRenderbuffer(c.RENDERBUFFER,b0);if(b1.depthBuffer&&!b1.stencilBuffer){c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,b1.width,b1.height);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,b0)}else{if(b1.depthBuffer&&b1.stencilBuffer){c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,b1.width,b1.height);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,b0)}else{c.renderbufferStorage(c.RENDERBUFFER,c.RGBA4,b1.width,b1.height)}}}this.setRenderTarget=function(b4){var b6=(b4 instanceof THREE.WebGLRenderTargetCube);if(b4&&!b4.__webglFramebuffer){if(b4.depthBuffer===undefined){b4.depthBuffer=true}if(b4.stencilBuffer===undefined){b4.stencilBuffer=true}b4.addEventListener("dispose",T);b4.__webglTexture=c.createTexture();aO.info.memory.textures++;var b7=a8(b4.width)&&a8(b4.height),b0=aT(b4.format),b2=aT(b4.type);if(b6){b4.__webglFramebuffer=[];b4.__webglRenderbuffer=[];c.bindTexture(c.TEXTURE_CUBE_MAP,b4.__webglTexture);ak(c.TEXTURE_CUBE_MAP,b4,b7);for(var b3=0;b3<6;b3++){b4.__webglFramebuffer[b3]=c.createFramebuffer();b4.__webglRenderbuffer[b3]=c.createRenderbuffer();c.texImage2D(c.TEXTURE_CUBE_MAP_POSITIVE_X+b3,0,b0,b4.width,b4.height,0,b0,b2,null);a9(b4.__webglFramebuffer[b3],b4,c.TEXTURE_CUBE_MAP_POSITIVE_X+b3);r(b4.__webglRenderbuffer[b3],b4)}if(b7){c.generateMipmap(c.TEXTURE_CUBE_MAP)}}else{b4.__webglFramebuffer=c.createFramebuffer();if(b4.shareDepthFrom){b4.__webglRenderbuffer=b4.shareDepthFrom.__webglRenderbuffer}else{b4.__webglRenderbuffer=c.createRenderbuffer()}c.bindTexture(c.TEXTURE_2D,b4.__webglTexture);ak(c.TEXTURE_2D,b4,b7);c.texImage2D(c.TEXTURE_2D,0,b0,b4.width,b4.height,0,b0,b2,null);a9(b4.__webglFramebuffer,b4,c.TEXTURE_2D);if(b4.shareDepthFrom){if(b4.depthBuffer&&!b4.stencilBuffer){c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,b4.__webglRenderbuffer)}else{if(b4.depthBuffer&&b4.stencilBuffer){c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,b4.__webglRenderbuffer)}}}else{r(b4.__webglRenderbuffer,b4)}if(b7){c.generateMipmap(c.TEXTURE_2D)}}if(b6){c.bindTexture(c.TEXTURE_CUBE_MAP,null)}else{c.bindTexture(c.TEXTURE_2D,null)}c.bindRenderbuffer(c.RENDERBUFFER,null);c.bindFramebuffer(c.FRAMEBUFFER,null)}var b9,b1,ca,b8,b5;if(b4){if(b6){b9=b4.__webglFramebuffer[b4.activeCubeFace]}else{b9=b4.__webglFramebuffer}b1=b4.width;ca=b4.height;b8=0;b5=0}else{b9=null;b1=bS;ca=aV;b8=a4;b5=a3}if(b9!==bG){c.bindFramebuffer(c.FRAMEBUFFER,b9);c.viewport(b8,b5,b1,ca);bG=b9}D=b1;aU=ca};function aX(b0){if(b0 instanceof THREE.WebGLRenderTargetCube){c.bindTexture(c.TEXTURE_CUBE_MAP,b0.__webglTexture);c.generateMipmap(c.TEXTURE_CUBE_MAP);c.bindTexture(c.TEXTURE_CUBE_MAP,null)}else{c.bindTexture(c.TEXTURE_2D,b0.__webglTexture);c.generateMipmap(c.TEXTURE_2D);c.bindTexture(c.TEXTURE_2D,null)}}function aP(b0){if(b0===THREE.NearestFilter||b0===THREE.NearestMipMapNearestFilter||b0===THREE.NearestMipMapLinearFilter){return c.NEAREST}return c.LINEAR}function aT(b0){if(b0===THREE.RepeatWrapping){return c.REPEAT}if(b0===THREE.ClampToEdgeWrapping){return c.CLAMP_TO_EDGE}if(b0===THREE.MirroredRepeatWrapping){return c.MIRRORED_REPEAT}if(b0===THREE.NearestFilter){return c.NEAREST}if(b0===THREE.NearestMipMapNearestFilter){return c.NEAREST_MIPMAP_NEAREST}if(b0===THREE.NearestMipMapLinearFilter){return c.NEAREST_MIPMAP_LINEAR}if(b0===THREE.LinearFilter){return c.LINEAR}if(b0===THREE.LinearMipMapNearestFilter){return c.LINEAR_MIPMAP_NEAREST}if(b0===THREE.LinearMipMapLinearFilter){return c.LINEAR_MIPMAP_LINEAR}if(b0===THREE.UnsignedByteType){return c.UNSIGNED_BYTE}if(b0===THREE.UnsignedShort4444Type){return c.UNSIGNED_SHORT_4_4_4_4}if(b0===THREE.UnsignedShort5551Type){return c.UNSIGNED_SHORT_5_5_5_1}if(b0===THREE.UnsignedShort565Type){return c.UNSIGNED_SHORT_5_6_5}if(b0===THREE.ByteType){return c.BYTE}if(b0===THREE.ShortType){return c.SHORT}if(b0===THREE.UnsignedShortType){return c.UNSIGNED_SHORT}if(b0===THREE.IntType){return c.INT}if(b0===THREE.UnsignedIntType){return c.UNSIGNED_INT}if(b0===THREE.FloatType){return c.FLOAT}if(b0===THREE.AlphaFormat){return c.ALPHA}if(b0===THREE.RGBFormat){return c.RGB}if(b0===THREE.RGBAFormat){return c.RGBA}if(b0===THREE.LuminanceFormat){return c.LUMINANCE}if(b0===THREE.LuminanceAlphaFormat){return c.LUMINANCE_ALPHA}if(b0===THREE.AddEquation){return c.FUNC_ADD}if(b0===THREE.SubtractEquation){return c.FUNC_SUBTRACT}if(b0===THREE.ReverseSubtractEquation){return c.FUNC_REVERSE_SUBTRACT}if(b0===THREE.ZeroFactor){return c.ZERO}if(b0===THREE.OneFactor){return c.ONE}if(b0===THREE.SrcColorFactor){return c.SRC_COLOR}if(b0===THREE.OneMinusSrcColorFactor){return c.ONE_MINUS_SRC_COLOR}if(b0===THREE.SrcAlphaFactor){return c.SRC_ALPHA}if(b0===THREE.OneMinusSrcAlphaFactor){return c.ONE_MINUS_SRC_ALPHA}if(b0===THREE.DstAlphaFactor){return c.DST_ALPHA}if(b0===THREE.OneMinusDstAlphaFactor){return c.ONE_MINUS_DST_ALPHA}if(b0===THREE.DstColorFactor){return c.DST_COLOR}if(b0===THREE.OneMinusDstColorFactor){return c.ONE_MINUS_DST_COLOR}if(b0===THREE.SrcAlphaSaturateFactor){return c.SRC_ALPHA_SATURATE}if(aF!==undefined){if(b0===THREE.RGB_S3TC_DXT1_Format){return aF.COMPRESSED_RGB_S3TC_DXT1_EXT}if(b0===THREE.RGBA_S3TC_DXT1_Format){return aF.COMPRESSED_RGBA_S3TC_DXT1_EXT}if(b0===THREE.RGBA_S3TC_DXT3_Format){return aF.COMPRESSED_RGBA_S3TC_DXT3_EXT}if(b0===THREE.RGBA_S3TC_DXT5_Format){return aF.COMPRESSED_RGBA_S3TC_DXT5_EXT}}return 0}function aJ(b3){if(Z&&b3&&b3.useVertexTexture){return 1024}else{var b1=c.getParameter(c.MAX_VERTEX_UNIFORM_VECTORS);var b2=Math.floor((b1-20)/4);var b0=b2;if(b3!==undefined&&b3 instanceof THREE.SkinnedMesh){b0=Math.min(b3.bones.length,b0);if(b0<b3.bones.length){console.warn("WebGLRenderer: too many bones - "+b3.bones.length+", this GPU supports just "+b0+" (try OpenGL instead of ANGLE)")}}return b0}}function bg(b2){var b3=0;var b7=0;var b5=0;var b6=0;for(var b1=0,b4=b2.length;b1<b4;b1++){var b0=b2[b1];if(b0.onlyShadow){continue}if(b0 instanceof THREE.DirectionalLight){b3++}if(b0 instanceof THREE.PointLight){b7++}if(b0 instanceof THREE.SpotLight){b5++}if(b0 instanceof THREE.HemisphereLight){b6++}}return{directional:b3,point:b7,spot:b5,hemi:b6}}function aa(b2){var b3=0;for(var b1=0,b4=b2.length;b1<b4;b1++){var b0=b2[b1];if(!b0.castShadow){continue}if(b0 instanceof THREE.SpotLight){b3++}if(b0 instanceof THREE.DirectionalLight&&!b0.shadowCascade){b3++}}return b3}function br(){try{var b0={alpha:bD,premultipliedAlpha:a1,antialias:bY,stencil:e,preserveDrawingBuffer:Y};c=aY.getContext("webgl",b0)||aY.getContext("experimental-webgl",b0);if(c===null){throw"Error creating WebGL context."}}catch(b1){console.error(b1)}m=c.getExtension("OES_texture_float");A=c.getExtension("OES_texture_float_linear");be=c.getExtension("OES_standard_derivatives");q=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic");aF=c.getExtension("WEBGL_compressed_texture_s3tc")||c.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||c.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");if(!m){console.log("THREE.WebGLRenderer: Float textures not supported.")}if(!be){console.log("THREE.WebGLRenderer: Standard derivatives not supported.")}if(!q){console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported.")}if(!aF){console.log("THREE.WebGLRenderer: S3TC compressed textures not supported.")}if(c.getShaderPrecisionFormat===undefined){c.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}function bd(){c.clearColor(0,0,0,1);c.clearDepth(1);c.clearStencil(0);c.enable(c.DEPTH_TEST);c.depthFunc(c.LEQUAL);c.frontFace(c.CCW);c.cullFace(c.BACK);c.enable(c.CULL_FACE);c.enable(c.BLEND);c.blendEquation(c.FUNC_ADD);c.blendFunc(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA);c.viewport(a4,a3,bS,aV);c.clearColor(bs.r,bs.g,bs.b,X)}this.shadowMapPlugin=new THREE.ShadowMapPlugin();this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin());this.addPostPlugin(new THREE.LensFlarePlugin())};THREE.WebGLRenderTarget=function(c,a,b){this.width=c;this.height=a;b=b||{};this.wrapS=b.wrapS!==undefined?b.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=b.wrapT!==undefined?b.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=b.magFilter!==undefined?b.magFilter:THREE.LinearFilter;this.minFilter=b.minFilter!==undefined?b.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=b.anisotropy!==undefined?b.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=b.format!==undefined?b.format:THREE.RGBAFormat;this.type=b.type!==undefined?b.type:THREE.UnsignedByteType;this.depthBuffer=b.depthBuffer!==undefined?b.depthBuffer:true;this.stencilBuffer=b.stencilBuffer!==undefined?b.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var a=new THREE.WebGLRenderTarget(this.width,this.height);a.wrapS=this.wrapS;a.wrapT=this.wrapT;a.magFilter=this.magFilter;a.minFilter=this.minFilter;a.anisotropy=this.anisotropy;a.offset.copy(this.offset);a.repeat.copy(this.repeat);a.format=this.format;a.type=this.type;a.depthBuffer=this.depthBuffer;a.stencilBuffer=this.stencilBuffer;a.generateMipmaps=this.generateMipmaps;a.shareDepthFrom=this.shareDepthFrom;return a},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(c,a,b){THREE.WebGLRenderTarget.call(this,c,a,b);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3();this.positionScreen=new THREE.Vector4();this.visible=true};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableFace3=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.v3=new THREE.RenderableVertex();this.centroidModel=new THREE.Vector3();this.normalModel=new THREE.Vector3();this.normalModelView=new THREE.Vector3();this.vertexNormalsLength=0;this.vertexNormalsModel=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.vertexNormalsModelView=[new THREE.Vector3(),new THREE.Vector3(),new THREE.Vector3()];this.color=null;this.material=null;this.uvs=[[]];this.z=0};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2();this.material=null};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex();this.v2=new THREE.RenderableVertex();this.vertexColors=[new THREE.Color(),new THREE.Color()];this.material=null;this.z=0};THREE.GeometryUtils={merge:function(o,k,H){var v,h,n=o.vertices.length,s=o.faceVertexUvs[0].length,m=k instanceof THREE.Mesh?k.geometry:k,d=o.vertices,c=m.vertices,b=o.faces,a=m.faces,E=o.faceVertexUvs[0],D=m.faceVertexUvs[0];if(H===undefined){H=0}if(k instanceof THREE.Mesh){k.matrixAutoUpdate&&k.updateMatrix();v=k.matrix;h=new THREE.Matrix3().getNormalMatrix(v)}for(var A=0,l=c.length;A<l;A++){var F=c[A];var r=F.clone();if(v){r.applyMatrix4(v)}d.push(r)}for(A=0,l=a.length;A<l;A++){var g=a[A],q,G,t,p=g.vertexNormals,C=g.vertexColors;q=new THREE.Face3(g.a+n,g.b+n,g.c+n);q.normal.copy(g.normal);if(h){q.normal.applyMatrix3(h).normalize()}for(var u=0,B=p.length;u<B;u++){G=p[u].clone();if(h){G.applyMatrix3(h).normalize()}q.vertexNormals.push(G)}q.color.copy(g.color);for(var u=0,B=C.length;u<B;u++){t=C[u];q.vertexColors.push(t.clone())}q.materialIndex=g.materialIndex+H;q.centroid.copy(g.centroid);if(v){q.centroid.applyMatrix4(v)}b.push(q)}for(A=0,l=D.length;A<l;A++){var f=D[A],e=[];for(var u=0,B=f.length;u<B;u++){e.push(new THREE.Vector2(f[u].x,f[u].y))}E.push(e)}},randomPointInTriangle:function(){var a=new THREE.Vector3();return function(h,f,j){var e=new THREE.Vector3();var g=THREE.Math.random16();var d=THREE.Math.random16();if((g+d)>1){g=1-g;d=1-d}var i=1-g-d;e.copy(h);e.multiplyScalar(g);a.copy(f);a.multiplyScalar(d);e.add(a);a.copy(j);a.multiplyScalar(i);e.add(a);return e}}(),randomPointInFace:function(e,g,f){var d,c,b,a;d=g.vertices[e.a];c=g.vertices[e.b];b=g.vertices[e.c];return THREE.GeometryUtils.randomPointInTriangle(d,c,b)},randomPointsInGeometry:function(b,k){var e,o,a=b.faces,c=b.vertices,f=a.length,q=0,t=[],s,p,m,l;for(o=0;o<f;o++){e=a[o];s=c[e.a];p=c[e.b];m=c[e.c];e._area=THREE.GeometryUtils.triangleArea(s,p,m);q+=e._area;t[o]=q}function h(n){function r(B,v){if(v<B){return B}var A=B+Math.floor((v-B)/2);if(t[A]>n){return r(B,A-1)}else{if(t[A]<n){return r(A+1,v)}else{return A}}}var i=r(0,t.length-1);return i}var j,d,g=[];var u={};for(o=0;o<k;o++){j=THREE.Math.random16()*q;d=h(j);g[o]=THREE.GeometryUtils.randomPointInFace(a[d],b,true);if(!u[d]){u[d]=1}else{u[d]+=1}}return g},triangleArea:function(){var b=new THREE.Vector3();var a=new THREE.Vector3();return function(d,c,e){b.subVectors(c,d);a.subVectors(e,d);b.cross(a);return 0.5*b.length()}}(),center:function(c){c.computeBoundingBox();var b=c.boundingBox;var a=new THREE.Vector3();a.addVectors(b.min,b.max);a.multiplyScalar(-0.5);c.applyMatrix(new THREE.Matrix4().makeTranslation(a.x,a.y,a.z));c.computeBoundingBox();return a},triangulateQuads:function(h){var e,b,c,d;var a=[];var g=[];for(e=0,b=h.faceVertexUvs.length;e<b;e++){g[e]=[]}for(e=0,b=h.faces.length;e<b;e++){var f=h.faces[e];a.push(f);for(c=0,d=h.faceVertexUvs.length;c<d;c++){g[c].push(h.faceVertexUvs[c][e])}}h.faces=a;h.faceVertexUvs=g;h.computeCentroids();h.computeFaceNormals();h.computeVertexNormals();if(h.hasTangents){h.computeTangents()}}};THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(c,b,d,f){var a=new THREE.ImageLoader();a.crossOrigin=this.crossOrigin;var e=new THREE.Texture(undefined,b);var g=a.load(c,function(){e.needsUpdate=true;if(d){d(e)}});e.image=g;e.sourceFile=c;return e},loadCompressedTexture:function(b,a,c,f){var e=new THREE.CompressedTexture();e.mapping=a;var d=new XMLHttpRequest();d.onload=function(){var g=d.response;var h=THREE.ImageUtils.parseDDS(g,true);e.format=h.format;e.mipmaps=h.mipmaps;e.image.width=h.width;e.image.height=h.height;e.generateMipmaps=false;e.needsUpdate=true;if(c){c(e)}};d.onerror=f;d.open("GET",b,true);d.responseType="arraybuffer";d.send(null);return e},loadTextureCube:function(e,b,g,d){var h=[];h.loadCount=0;var f=new THREE.Texture();f.image=h;if(b!==undefined){f.mapping=b}f.flipY=false;for(var c=0,j=e.length;c<j;++c){var a=new Image();h[c]=a;a.onload=function(){h.loadCount+=1;if(h.loadCount===6){f.needsUpdate=true;if(g){g(f)}}};a.onerror=d;a.crossOrigin=this.crossOrigin;a.src=e[c]}return f},loadCompressedTextureCube:function(h,b,k,g){var l=[];l.loadCount=0;var j=new THREE.CompressedTexture();j.image=l;if(b!==undefined){j.mapping=b}j.flipY=false;j.generateMipmaps=false;var d=function(n,i){return function(){var o=n.response;var p=THREE.ImageUtils.parseDDS(o,true);i.format=p.format;i.mipmaps=p.mipmaps;i.width=p.width;i.height=p.height;l.loadCount+=1;if(l.loadCount===6){j.format=p.format;j.needsUpdate=true;if(k){k(j)}}}};if(h instanceof Array){for(var f=0,m=h.length;f<m;++f){var a={};l[f]=a;var e=new XMLHttpRequest();e.onload=d(e,a);e.onerror=g;var c=h[f];e.open("GET",c,true);e.responseType="arraybuffer";e.send(null)}}else{var c=h;var e=new XMLHttpRequest();e.onload=function(){var o=e.response;var p=THREE.ImageUtils.parseDDS(o,true);if(p.isCubemap){var n=p.mipmaps.length/p.mipmapCount;for(var r=0;r<n;r++){l[r]={mipmaps:[]};for(var q=0;q<p.mipmapCount;q++){l[r].mipmaps.push(p.mipmaps[r*p.mipmapCount+q]);l[r].format=p.format;l[r].width=p.width;l[r].height=p.height}}j.format=p.format;j.needsUpdate=true;if(k){k(j)}}};e.onerror=g;e.open("GET",c,true);e.responseType="arraybuffer";e.send(null)}return j},loadDDSTexture:function(c,b,d,g){var a=[];a.loadCount=0;var f=new THREE.CompressedTexture();f.image=a;if(b!==undefined){f.mapping=b}f.flipY=false;f.generateMipmaps=false;var e=new XMLHttpRequest();e.onload=function(){var j=e.response;var k=THREE.ImageUtils.parseDDS(j,true);if(k.isCubemap){var h=k.mipmaps.length/k.mipmapCount;for(var m=0;m<h;m++){a[m]={mipmaps:[]};for(var l=0;l<k.mipmapCount;l++){a[m].mipmaps.push(k.mipmaps[m*k.mipmapCount+l]);a[m].format=k.format;a[m].width=k.width;a[m].height=k.height}}}else{f.image.width=k.width;f.image.height=k.height;f.mipmaps=k.mipmaps}f.format=k.format;f.needsUpdate=true;if(d){d(f)}};e.onerror=g;e.open("GET",c,true);e.responseType="arraybuffer";e.send(null);return f},parseDDS:function(L,am){var W={mipmaps:[],width:0,height:0,format:null,mipmapCount:1};var J=542327876;var aa=1,I=2,ap=4,O=8,ac=4096,Y=131072,E=524288,f=8388608;var af=8,o=4194304,n=4096;var ae=512,X=1024,ak=2048,V=4096,aj=8192,U=16384,ag=32768,s=2097152;var H=1,P=2,at=4,v=64,ad=512,F=131072;function ar(i){return i.charCodeAt(0)+(i.charCodeAt(1)<<8)+(i.charCodeAt(2)<<16)+(i.charCodeAt(3)<<24)}function D(i){return String.fromCharCode(i&255,(i>>8)&255,(i>>16)&255,(i>>24)&255)}function m(ay,az,aw,aH){var ax=aw*aH*4;var aA=new Uint8Array(ay,az,ax);var av=new Uint8Array(ax);var aC=0;var au=0;for(var aE=0;aE<aH;aE++){for(var aG=0;aG<aw;aG++){var aD=aA[au];au++;var aB=aA[au];au++;var i=aA[au];au++;var aF=aA[au];au++;av[aC]=i;aC++;av[aC]=aB;aC++;av[aC]=aD;aC++;av[aC]=aF;aC++}}return av}var l=ar("DXT1");var j=ar("DXT3");var g=ar("DXT5");var b=31;var G=0;var ai=1;var aq=2;var al=3;var T=4;var r=7;var Z=20;var d=21;var N=22;var ah=23;var ao=24;var M=25;var K=26;var q=27;var u=28;var t=29;var p=30;var h=new Int32Array(L,0,b);if(h[G]!==J){console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header");return W}if(!h[Z]&at){console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code");return W}var R;var Q=h[d];var k=false;switch(Q){case l:R=8;W.format=THREE.RGB_S3TC_DXT1_Format;break;case j:R=16;W.format=THREE.RGBA_S3TC_DXT3_Format;break;case g:R=16;W.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(h[N]==32&&h[ah]&16711680&&h[ao]&65280&&h[M]&255&&h[K]&4278190080){k=true;R=64;W.format=THREE.RGBAFormat}else{console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",D(Q));return W}}W.mipmapCount=1;if(h[aq]&Y&&am!==false){W.mipmapCount=Math.max(1,h[r])}W.isCubemap=h[u]&ae?true:false;W.width=h[T];W.height=h[al];var ab=h[ai]+4;var a=W.width;var e=W.height;var C=W.isCubemap?6:1;for(var B=0;B<C;B++){for(var an=0;an<W.mipmapCount;an++){if(k){var S=m(L,ab,a,e);var A=S.length}else{var A=Math.max(4,a)/4*Math.max(4,e)/4*R;var S=new Uint8Array(L,ab,A)}var c={data:S,width:a,height:e};W.mipmaps.push(c);ab+=A;a=Math.max(a*0.5,1);e=Math.max(e*0.5,1)}a=W.width;e=W.height}return W},getNormalMap:function(q,E){var d=function(G,i){return[G[1]*i[2]-G[2]*i[1],G[2]*i[0]-G[0]*i[2],G[0]*i[1]-G[1]*i[0]]};var v=function(G,i){return[G[0]-i[0],G[1]-i[1],G[2]-i[2]]};var s=function(G){var i=Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);return[G[0]/i,G[1]/i,G[2]/i]};E=E|1;var r=q.width;var p=q.height;var e=document.createElement("canvas");e.width=r;e.height=p;var c=e.getContext("2d");c.drawImage(q,0,0);var F=c.getImageData(0,0,r,p).data;var A=c.createImageData(r,p);var k=A.data;for(var m=0;m<r;m++){for(var l=0;l<p;l++){var f=l-1<0?0:l-1;var h=l+1>p-1?p-1:l+1;var g=m-1<0?0:m-1;var j=m+1>r-1?r-1:m+1;var u=[];var D=[0,0,F[(l*r+m)*4]/255*E];u.push([-1,0,F[(l*r+g)*4]/255*E]);u.push([-1,-1,F[(f*r+g)*4]/255*E]);u.push([0,-1,F[(f*r+m)*4]/255*E]);u.push([1,-1,F[(f*r+j)*4]/255*E]);u.push([1,0,F[(l*r+j)*4]/255*E]);u.push([1,1,F[(h*r+j)*4]/255*E]);u.push([0,1,F[(h*r+m)*4]/255*E]);u.push([-1,1,F[(h*r+g)*4]/255*E]);var o=[];var B=u.length;for(var t=0;t<B;t++){var b=u[t];var a=u[(t+1)%B];b=v(b,D);a=v(a,D);o.push(s(d(b,a)))}var C=[0,0,0];for(var t=0;t<o.length;t++){C[0]+=o[t][0];C[1]+=o[t][1];C[2]+=o[t][2]}C[0]/=o.length;C[1]/=o.length;C[2]/=o.length;var n=(l*r+m)*4;k[n]=((C[0]+1)/2*255)|0;k[n+1]=((C[1]+1)/2*255)|0;k[n+2]=(C[2]*255)|0;k[n+3]=255}}c.putImageData(A,0,0);return e},generateDataTexture:function(c,l,d){var m=c*l;var f=new Uint8Array(3*m);var a=Math.floor(d.r*255);var h=Math.floor(d.g*255);var k=Math.floor(d.b*255);for(var e=0;e<m;e++){f[e*3]=a;f[e*3+1]=h;f[e*3+2]=k}var j=new THREE.DataTexture(f,c,l,THREE.RGBFormat);j.needsUpdate=true;return j}};THREE.SceneUtils={createMultiMaterialObject:function(e,b){var d=new THREE.Object3D();for(var c=0,a=b.length;c<a;c++){d.add(new THREE.Mesh(e,b[c]))}return d},detach:function(c,a,b){c.applyMatrix(a.matrixWorld);a.remove(c);b.add(c)},attach:function(d,c,a){var b=new THREE.Matrix4();b.getInverse(a.matrixWorld);d.applyMatrix(b);c.remove(d);a.add(d)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(d){var a=d.familyName.toLowerCase();var b=this;b.faces[a]=b.faces[a]||{};b.faces[a][d.cssFontWeight]=b.faces[a][d.cssFontWeight]||{};b.faces[a][d.cssFontWeight][d.cssFontStyle]=d;var c=b.faces[a][d.cssFontWeight][d.cssFontStyle]=d;return d},drawText:function(n){var a=[],e=[];var j,c,l=this.getFace(),g=this.size/l.resolution,h=0,m=String(n).split(""),d=m.length;var f=[];for(j=0;j<d;j++){var o=new THREE.Path();var k=this.extractGlyphPoints(m[j],l,g,h,o);h+=k.offset;f.push(k.path)}var b=h/2;return{paths:f,offset:b}},extractGlyphPoints:function(E,j,I,f,r){var J=[];var v,s,d,e,u,b,G,D,l,k,h,g,q,C,o,B,n,A,a,m=j.glyphs[E]||j.glyphs["?"];if(!m){return}if(m.o){e=m._cachedOutline||(m._cachedOutline=m.o.split(" "));b=e.length;G=I;D=I;for(v=0;v<b;){u=e[v++];switch(u){case"m":l=e[v++]*G+f;k=e[v++]*D;r.moveTo(l,k);break;case"l":l=e[v++]*G+f;k=e[v++]*D;r.lineTo(l,k);break;case"q":h=e[v++]*G+f;g=e[v++]*D;o=e[v++]*G+f;B=e[v++]*D;r.quadraticCurveTo(o,B,h,g);a=J[J.length-1];if(a){q=a.x;C=a.y;for(s=1,d=this.divisions;s<=d;s++){var p=s/d;var H=THREE.Shape.Utils.b2(p,q,o,h);var F=THREE.Shape.Utils.b2(p,C,B,g)}}break;case"b":h=e[v++]*G+f;g=e[v++]*D;o=e[v++]*G+f;B=e[v++]*-D;n=e[v++]*G+f;A=e[v++]*-D;r.bezierCurveTo(h,g,o,B,n,A);a=J[J.length-1];if(a){q=a.x;C=a.y;for(s=1,d=this.divisions;s<=d;s++){var p=s/d;var H=THREE.Shape.Utils.b3(p,q,o,n,h);var F=THREE.Shape.Utils.b3(p,C,B,A,g)}}break}}}return{offset:m.ha*I,path:r}}};THREE.FontUtils.generateShapes=function(i,j){j=j||{};var l=j.size!==undefined?j.size:100;var h=j.curveSegments!==undefined?j.curveSegments:4;var d=j.font!==undefined?j.font:"helvetiker";var g=j.weight!==undefined?j.weight:"normal";var a=j.style!==undefined?j.style:"normal";THREE.FontUtils.size=l;THREE.FontUtils.divisions=h;THREE.FontUtils.face=d;THREE.FontUtils.weight=g;THREE.FontUtils.style=a;var f=THREE.FontUtils.drawText(i);var k=f.paths;var c=[];for(var b=0,e=k.length;b<e;b++){Array.prototype.push.apply(c,k[b].toShapes())}return c};(function(c){var b=1e-10;var e=function(g,r){var f=g.length;if(f<3){return null}var D=[],p=[],j=[];var A,q,o;if(d(g)>0){for(q=0;q<f;q++){p[q]=q}}else{for(q=0;q<f;q++){p[q]=(f-1)-q}}var i=f;var h=2*i;for(q=i-1;i>2;){if((h--)<=0){console.log("Warning, unable to triangulate polygon!");if(r){return j}return D}A=q;if(i<=A){A=0}q=A+1;if(i<=q){q=0}o=q+1;if(i<=o){o=0}if(a(g,A,q,o,i,p)){var m,l,k,C,B;m=p[A];l=p[q];k=p[o];D.push([g[m],g[l],g[k]]);j.push([p[A],p[q],p[o]]);for(C=q,B=q+1;B<i;C++,B++){p[C]=p[B]}i--;h=2*i}}if(r){return j}return D};var d=function(g){var j=g.length;var f=0;for(var i=j-1,h=0;h<j;i=h++){f+=g[i].x*g[h].y-g[h].x*g[i].y}return f*0.5};var a=function(J,D,C,t,I,Q){var H;var A,r,O,M;var i,g,G,F;A=J[Q[D]].x;r=J[Q[D]].y;O=J[Q[C]].x;M=J[Q[C]].y;i=J[Q[t]].x;g=J[Q[t]].y;if(b>(((O-A)*(g-r))-((M-r)*(i-A)))){return false}var h,f,B,s,P,N;var l,k,L,K,o,m;var j,q,E;h=i-O;f=g-M;B=A-i;s=r-g;P=O-A;N=M-r;for(H=0;H<I;H++){if((H===D)||(H===C)||(H===t)){continue}G=J[Q[H]].x;F=J[Q[H]].y;l=G-A;k=F-r;L=G-O;K=F-M;o=G-i;m=F-g;E=h*K-f*L;j=P*k-N*l;q=B*m-s*o;if((E>=-b)&&(q>=-b)&&(j>=-b)){return false}}return true};c.Triangulate=e;c.Triangulate.area=d;return c})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(a){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)};THREE.Curve.prototype.getPoints=function(a){if(!a){a=5}var c,b=[];for(c=0;c<=a;c++){b.push(this.getPoint(c/a))}return b};THREE.Curve.prototype.getSpacedPoints=function(a){if(!a){a=5}var c,b=[];for(c=0;c<=a;c++){b.push(this.getPointAt(c/a))}return b};THREE.Curve.prototype.getLength=function(){var a=this.getLengths();return a[a.length-1]};THREE.Curve.prototype.getLengths=function(b){if(!b){b=(this.__arcLengthDivisions)?(this.__arcLengthDivisions):200}if(this.cacheArcLengths&&(this.cacheArcLengths.length==b+1)&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var a=[];var f,d=this.getPoint(0);var e,c=0;a.push(0);for(e=1;e<=b;e++){f=this.getPoint(e/b);c+=f.distanceTo(d);a.push(c);d=f}this.cacheArcLengths=a;return a};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(m,a){var b=this.getLengths();var e=0,j=b.length;var k;if(a){k=a}else{k=m*b[j-1]}var h=0,d=j-1,l;while(h<=d){e=Math.floor(h+(d-h)/2);l=b[e]-k;if(l<0){h=e+1;continue}else{if(l>0){d=e-1;continue}else{d=e;break}}}e=d;if(b[e]==k){var o=e/(j-1);return o}var f=b[e];var n=b[e+1];var c=n-f;var g=(k-f)/c;var o=(e+g)/(j-1);return o};THREE.Curve.prototype.getTangent=function(b){var g=0.0001;var d=b-g;var c=b+g;if(d<0){d=0}if(c>1){c=1}var f=this.getPoint(d);var e=this.getPoint(c);var a=e.clone().sub(f);return a.normalize()};THREE.Curve.prototype.getTangentAt=function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)};THREE.Curve.Utils={tangentQuadraticBezier:function(a,d,c,b){return 2*(1-a)*(c-d)+2*a*(b-c)},tangentCubicBezier:function(a,e,d,c,b){return -3*e*(1-a)*(1-a)+3*d*(1-a)*(1-a)-6*a*d*(1-a)+6*a*c*(1-a)-3*a*a*c+3*a*a*b},tangentSpline:function(i,h,g,f,d){var e=6*i*i-6*i;var b=3*i*i-4*i+1;var c=-6*i*i+6*i;var a=3*i*i-2*i;return e+b+c+a},interpolate:function(h,g,e,d,i){var f=(e-h)*0.5;var c=(d-g)*0.5;var b=i*i;var a=i*b;return(2*g-2*e+f+c)*a+(-3*g+3*e-2*f-c)*b+f*i+g}};THREE.Curve.create=function(a,b){a.prototype=Object.create(THREE.Curve.prototype);a.prototype.getPoint=b;return a};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.add=function(a){this.curves.push(a)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var b=this.curves[0].getPoint(0);var a=this.curves[this.curves.length-1].getPoint(1);if(!b.equals(a)){this.curves.push(new THREE.LineCurve(a,b))}};THREE.CurvePath.prototype.getPoint=function(c){var h=c*this.getLength();var g=this.getCurveLengths();var b=0,e,f;while(b<g.length){if(g[b]>=h){e=g[b]-h;f=this.curves[b];var a=1-e/f.getLength();return f.getPointAt(a);break}b++}return null};THREE.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var d=[],c=0;var b,a=this.curves.length;for(b=0;b<a;b++){c+=this.curves[b].getLength();d.push(c)}this.cacheLengths=d;return d};THREE.CurvePath.prototype.getBoundingBox=function(){var m=this.getPoints();var b,a,n;var f,e,d;b=a=Number.NEGATIVE_INFINITY;f=e=Number.POSITIVE_INFINITY;var c,g,l,h;var k=m[0] instanceof THREE.Vector3;h=k?new THREE.Vector3():new THREE.Vector2();for(g=0,l=m.length;g<l;g++){c=m[g];if(c.x>b){b=c.x}else{if(c.x<f){f=c.x}}if(c.y>a){a=c.y}else{if(c.y<e){e=c.y}}if(k){if(c.z>n){n=c.z}else{if(c.z<d){d=c.z}}}h.add(c)}var j={minX:f,minY:e,maxX:b,maxY:a,centroid:h.divideScalar(l)};if(k){j.maxZ=n;j.minZ=d}return j};THREE.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a,true);return this.createGeometry(b)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a,true);return this.createGeometry(b)};THREE.CurvePath.prototype.createGeometry=function(b){var c=new THREE.Geometry();for(var a=0;a<b.length;a++){c.vertices.push(new THREE.Vector3(b[a].x,b[a].y,b[a].z||0))}return c};THREE.CurvePath.prototype.addWrapPath=function(a){this.bends.push(a)};THREE.CurvePath.prototype.getTransformedPoints=function(c,e){var b=this.getPoints(c);var d,a;if(!e){e=this.bends}for(d=0,a=e.length;d<a;d++){b=this.getWrapPoints(b,e[d])}return b};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(c,e){var b=this.getSpacedPoints(c);var d,a;if(!e){e=this.bends}for(d=0,a=e.length;d<a;d++){b=this.getWrapPoints(b,e[d])}return b};THREE.CurvePath.prototype.getWrapPoints=function(f,l){var a=this.getBoundingBox();var d,g,b,j,h,k;for(d=0,g=f.length;d<g;d++){b=f[d];j=b.x;h=b.y;k=j/a.maxX;k=l.getUtoTmapping(k,j);var c=l.getPoint(k);var e=l.getNormalVector(k).multiplyScalar(h);b.x=c.x+e.x;b.y=c.y+e.y}return f};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.updateMatrixWorld=function(c){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||c){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;c=true}for(var b=0,a=this.children.length;b<a;b++){this.children[b].updateMatrixWorld(c)}};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3();THREE.Gyroscope.prototype.translationObject=new THREE.Vector3();THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion();THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion();THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3();THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3();THREE.Path=function(a){THREE.CurvePath.call(this);this.actions=[];if(a){this.fromPoints(a)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(b){this.moveTo(b[0].x,b[0].y);for(var a=1,c=b.length;a<c;a++){this.lineTo(b[a].x,b[a].y)}};THREE.Path.prototype.moveTo=function(a,c){var b=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:b})};THREE.Path.prototype.lineTo=function(a,g){var b=Array.prototype.slice.call(arguments);var e=this.actions[this.actions.length-1].args;var c=e[e.length-2];var d=e[e.length-1];var f=new THREE.LineCurve(new THREE.Vector2(c,d),new THREE.Vector2(a,g));this.curves.push(f);this.actions.push({action:THREE.PathActions.LINE_TO,args:b})};THREE.Path.prototype.quadraticCurveTo=function(e,b,g,f){var h=Array.prototype.slice.call(arguments);var a=this.actions[this.actions.length-1].args;var c=a[a.length-2];var i=a[a.length-1];var d=new THREE.QuadraticBezierCurve(new THREE.Vector2(c,i),new THREE.Vector2(e,b),new THREE.Vector2(g,f));this.curves.push(d);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:h})};THREE.Path.prototype.bezierCurveTo=function(e,c,k,j,g,f){var h=Array.prototype.slice.call(arguments);var a=this.actions[this.actions.length-1].args;var b=a[a.length-2];var i=a[a.length-1];var d=new THREE.CubicBezierCurve(new THREE.Vector2(b,i),new THREE.Vector2(e,c),new THREE.Vector2(k,j),new THREE.Vector2(g,f));this.curves.push(d);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:h})};THREE.Path.prototype.splineThru=function(g){var a=Array.prototype.slice.call(arguments);var d=this.actions[this.actions.length-1].args;var b=d[d.length-2];var c=d[d.length-1];var f=[new THREE.Vector2(b,c)];Array.prototype.push.apply(f,g);var e=new THREE.SplineCurve(f);this.curves.push(e);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:a})};THREE.Path.prototype.arc=function(h,f,g,d,a,b){var c=this.actions[this.actions.length-1].args;var e=c[c.length-2];var i=c[c.length-1];this.absarc(h+e,f+i,g,d,a,b)};THREE.Path.prototype.absarc=function(e,d,f,c,b,a){this.absellipse(e,d,f,f,c,b,a)};THREE.Path.prototype.ellipse=function(g,f,i,h,d,a,b){var c=this.actions[this.actions.length-1].args;var e=c[c.length-2];var j=c[c.length-1];this.absellipse(g+e,f+j,i,h,d,a,b)};THREE.Path.prototype.absellipse=function(f,e,j,g,c,a,b){var h=Array.prototype.slice.call(arguments);var d=new THREE.EllipseCurve(f,e,j,g,c,a,b);this.curves.push(d);var i=d.getPoint(1);h.push(i.x);h.push(i.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:h})};THREE.Path.prototype.getSpacedPoints=function(b,d){if(!b){b=40}var c=[];for(var a=0;a<b;a++){c.push(this.getPoint(a/b))}return c};THREE.Path.prototype.getPoints=function(S,Q){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(S,Q)}S=S||12;var E=[];var N,u,r,c,I;var F,C,R,v,T,A,a,B,b,M,H,L,K;for(N=0,u=this.actions.length;N<u;N++){r=this.actions[N];c=r.action;I=r.args;switch(c){case THREE.PathActions.MOVE_TO:E.push(new THREE.Vector2(I[0],I[1]));break;case THREE.PathActions.LINE_TO:E.push(new THREE.Vector2(I[0],I[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:F=I[2];C=I[3];T=I[0];A=I[1];if(E.length>0){b=E[E.length-1];a=b.x;B=b.y}else{b=this.actions[N-1].args;a=b[b.length-2];B=b[b.length-1]}for(M=1;M<=S;M++){H=M/S;L=THREE.Shape.Utils.b2(H,a,T,F);K=THREE.Shape.Utils.b2(H,B,A,C);E.push(new THREE.Vector2(L,K))}break;case THREE.PathActions.BEZIER_CURVE_TO:F=I[4];C=I[5];T=I[0];A=I[1];R=I[2];v=I[3];if(E.length>0){b=E[E.length-1];a=b.x;B=b.y}else{b=this.actions[N-1].args;a=b[b.length-2];B=b[b.length-1]}for(M=1;M<=S;M++){H=M/S;L=THREE.Shape.Utils.b3(H,a,T,R,F);K=THREE.Shape.Utils.b3(H,B,A,v,C);E.push(new THREE.Vector2(L,K))}break;case THREE.PathActions.CSPLINE_THRU:b=this.actions[N-1].args;var k=new THREE.Vector2(b[b.length-2],b[b.length-1]);var f=[k];var J=S*I[0].length;f=f.concat(I[0]);var P=new THREE.SplineCurve(f);for(M=1;M<=J;M++){E.push(P.getPointAt(M/J))}break;case THREE.PathActions.ARC:var o=I[0],m=I[1],p=I[2],O=I[3],G=I[4],h=!!I[5];var D=G-O;var l;var d=S*2;for(M=1;M<=d;M++){H=M/d;if(!h){H=1-H}l=O+H*D;L=o+p*Math.cos(l);K=m+p*Math.sin(l);E.push(new THREE.Vector2(L,K))}break;case THREE.PathActions.ELLIPSE:var o=I[0],m=I[1],q=I[2],s=I[3],O=I[4],G=I[5],h=!!I[6];var D=G-O;var l;var d=S*2;for(M=1;M<=d;M++){H=M/d;if(!h){H=1-H}l=O+H*D;L=o+q*Math.cos(l);K=m+s*Math.sin(l);E.push(new THREE.Vector2(L,K))}break}}var e=E[E.length-1];var g=1e-10;if(Math.abs(e.x-E[0].x)<g&&Math.abs(e.y-E[0].y)<g){E.splice(E.length-1,1)}if(Q){E.push(E[0])}return E};THREE.Path.prototype.toShapes=function(b){var d,h,l,c,f;var g=[],k=new THREE.Path();for(d=0,h=this.actions.length;d<h;d++){l=this.actions[d];f=l.args;c=l.action;if(c==THREE.PathActions.MOVE_TO){if(k.actions.length!=0){g.push(k);k=new THREE.Path()}}k[c].apply(k,f)}if(k.actions.length!=0){g.push(k)}if(g.length==0){return[]}var e,n,m,a=[];if(g.length==1){n=g[0];m=new THREE.Shape();m.actions=n.actions;m.curves=n.curves;a.push(m);return a}var j=!THREE.Shape.Utils.isClockWise(g[0].getPoints());j=b?!j:j;if(j){m=new THREE.Shape();for(d=0,h=g.length;d<h;d++){n=g[d];e=THREE.Shape.Utils.isClockWise(n.getPoints());e=b?!e:e;if(e){m.actions=n.actions;m.curves=n.curves;a.push(m);m=new THREE.Shape()}else{m.holes.push(n)}}}else{m=undefined;for(d=0,h=g.length;d<h;d++){n=g[d];e=THREE.Shape.Utils.isClockWise(n.getPoints());e=b?!e:e;if(e){if(m){a.push(m)}m=new THREE.Shape();m.actions=n.actions;m.curves=n.curves}else{m.holes.push(n)}}a.push(m)}return a};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.extrude=function(b){var a=new THREE.ExtrudeGeometry(this,b);return a};THREE.Shape.prototype.makeGeometry=function(a){var b=new THREE.ShapeGeometry(this,a);return b};THREE.Shape.prototype.getPointsHoles=function(c){var b,a=this.holes.length,d=[];for(b=0;b<a;b++){d[b]=this.holes[b].getTransformedPoints(c,this.bends)}return d};THREE.Shape.prototype.getSpacedPointsHoles=function(c){var b,a=this.holes.length,d=[];for(b=0;b<a;b++){d[b]=this.holes[b].getTransformedSpacedPoints(c,this.bends)}return d};THREE.Shape.prototype.extractAllPoints=function(a){return{shape:this.getTransformedPoints(a),holes:this.getPointsHoles(a)}};THREE.Shape.prototype.extractPoints=function(a){if(this.useSpacedPoints){return this.extractAllSpacedPoints(a)}return this.extractAllPoints(a)};THREE.Shape.prototype.extractAllSpacedPoints=function(a){return{shape:this.getTransformedSpacedPoints(a),holes:this.getSpacedPointsHoles(a)}};THREE.Shape.Utils={removeHoles:function(G,m){var k=G.concat();var E=k.concat();var B,c,t,P,D,u,F,i,N,s,r,q,Q,H,o,n,S,R,b,a,M=[];for(N=0;N<m.length;N++){r=m[N];Array.prototype.push.apply(E,r);q=Number.POSITIVE_INFINITY;for(s=0;s<r.length;s++){o=r[s];var e=[];for(H=0;H<k.length;H++){n=k[H];Q=o.distanceToSquared(n);e.push(Q);if(Q<q){q=Q;D=s;u=H}}}B=(u-1)>=0?u-1:k.length-1;t=(D-1)>=0?D-1:r.length-1;var f=[r[D],k[u],k[B]];var L=THREE.FontUtils.Triangulate.area(f);var C=[r[D],r[t],k[u]];var K=THREE.FontUtils.Triangulate.area(C);var l=1;var I=-1;var v=u,J=D;u+=l;D+=I;if(u<0){u+=k.length}u%=k.length;if(D<0){D+=r.length}D%=r.length;B=(u-1)>=0?u-1:k.length-1;t=(D-1)>=0?D-1:r.length-1;f=[r[D],k[u],k[B]];var O=THREE.FontUtils.Triangulate.area(f);C=[r[D],r[t],k[u]];var A=THREE.FontUtils.Triangulate.area(C);if((L+K)>(O+A)){u=v;D=J;if(u<0){u+=k.length}u%=k.length;if(D<0){D+=r.length}D%=r.length;B=(u-1)>=0?u-1:k.length-1;t=(D-1)>=0?D-1:r.length-1}else{}S=k.slice(0,u);R=k.slice(u);b=r.slice(D);a=r.slice(0,D);var j=[r[D],k[u],k[B]];var g=[r[D],r[t],k[u]];M.push(j);M.push(g);k=S.concat(b).concat(a).concat(R)}return{shape:k,isolatedPts:M,allpoints:E}},triangulateShape:function(d,c){var h=THREE.Shape.Utils.removeHoles(d,c);var l=h.shape,a=h.allpoints,o=h.isolatedPts;var b=THREE.FontUtils.Triangulate(l,false);var e,n,k,m,p,j,g={},q={};for(e=0,n=a.length;e<n;e++){p=a[e].x+":"+a[e].y;if(g[p]!==undefined){console.log("Duplicate point",p)}g[p]=e}for(e=0,n=b.length;e<n;e++){m=b[e];for(k=0;k<3;k++){p=m[k].x+":"+m[k].y;j=g[p];if(j!==undefined){m[k]=j}}}for(e=0,n=o.length;e<n;e++){m=o[e];for(k=0;k<3;k++){p=m[k].x+":"+m[k].y;j=g[p];if(j!==undefined){m[k]=j}}}return b.concat(o)},isClockWise:function(a){return THREE.FontUtils.Triangulate.area(a)<0},b2p0:function(b,c){var a=1-b;return a*a*c},b2p1:function(a,b){return 2*(1-a)*a*b},b2p2:function(a,b){return a*a*b},b2:function(a,d,c,b){return this.b2p0(a,d)+this.b2p1(a,c)+this.b2p2(a,b)},b3p0:function(b,c){var a=1-b;return a*a*a*c},b3p1:function(b,c){var a=1-b;return 3*a*a*b*c},b3p2:function(b,c){var a=1-b;return 3*a*b*b*c},b3p3:function(a,b){return a*a*a*b},b3:function(a,e,d,c,b){return this.b3p0(a,e)+this.b3p1(a,d)+this.b3p2(a,c)+this.b3p3(a,b)}};THREE.LineCurve=function(b,a){this.v1=b;this.v2=a};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.getPoint=function(b){var a=this.v2.clone().sub(this.v1);a.multiplyScalar(b).add(this.v1);return a};THREE.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)};THREE.LineCurve.prototype.getTangent=function(a){var b=this.v2.clone().sub(this.v1);return b.normalize()};THREE.QuadraticBezierCurve=function(a,c,b){this.v0=a;this.v1=c;this.v2=b};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.getPoint=function(c){var b,a;b=THREE.Shape.Utils.b2(c,this.v0.x,this.v1.x,this.v2.x);a=THREE.Shape.Utils.b2(c,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(b,a)};THREE.QuadraticBezierCurve.prototype.getTangent=function(c){var b,a;b=THREE.Curve.Utils.tangentQuadraticBezier(c,this.v0.x,this.v1.x,this.v2.x);a=THREE.Curve.Utils.tangentQuadraticBezier(c,this.v0.y,this.v1.y,this.v2.y);var d=new THREE.Vector2(b,a);d.normalize();return d};THREE.CubicBezierCurve=function(a,d,c,b){this.v0=a;this.v1=d;this.v2=c;this.v3=b};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.getPoint=function(c){var b,a;b=THREE.Shape.Utils.b3(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Shape.Utils.b3(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(b,a)};THREE.CubicBezierCurve.prototype.getTangent=function(c){var b,a;b=THREE.Curve.Utils.tangentCubicBezier(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Curve.Utils.tangentCubicBezier(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var d=new THREE.Vector2(b,a);d.normalize();return d};THREE.SplineCurve=function(a){this.points=(a==undefined)?[]:a};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.getPoint=function(d){var b=new THREE.Vector2();var h=[];var e=this.points,a,g,f;a=(e.length-1)*d;g=Math.floor(a);f=a-g;h[0]=g==0?g:g-1;h[1]=g;h[2]=g>e.length-2?e.length-1:g+1;h[3]=g>e.length-3?e.length-1:g+2;b.x=THREE.Curve.Utils.interpolate(e[h[0]].x,e[h[1]].x,e[h[2]].x,e[h[3]].x,f);b.y=THREE.Curve.Utils.interpolate(e[h[0]].y,e[h[1]].y,e[h[2]].y,e[h[3]].y,f);return b};THREE.EllipseCurve=function(f,e,g,a,d,c,b){this.aX=f;this.aY=e;this.xRadius=g;this.yRadius=a;this.aStartAngle=d;this.aEndAngle=c;this.aClockwise=b};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.getPoint=function(c){var d;var e=this.aEndAngle-this.aStartAngle;if(e<0){e+=Math.PI*2}if(e>Math.PI*2){e-=Math.PI*2}if(this.aClockwise===true){d=this.aEndAngle+(1-c)*(Math.PI*2-e)}else{d=this.aStartAngle+c*e}var b=this.aX+this.xRadius*Math.cos(d);var a=this.aY+this.yRadius*Math.sin(d);return new THREE.Vector2(b,a)};THREE.ArcCurve=function(e,d,f,c,b,a){THREE.EllipseCurve.call(this,e,d,f,f,c,b,a)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.LineCurve3=THREE.Curve.create(function(b,a){this.v1=b;this.v2=a},function(a){var b=new THREE.Vector3();b.subVectors(this.v2,this.v1);b.multiplyScalar(a);b.add(this.v1);return b});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(a,c,b){this.v0=a;this.v1=c;this.v2=b},function(c){var b,a,d;b=THREE.Shape.Utils.b2(c,this.v0.x,this.v1.x,this.v2.x);a=THREE.Shape.Utils.b2(c,this.v0.y,this.v1.y,this.v2.y);d=THREE.Shape.Utils.b2(c,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(b,a,d)});THREE.CubicBezierCurve3=THREE.Curve.create(function(a,d,c,b){this.v0=a;this.v1=d;this.v2=c;this.v3=b},function(c){var b,a,d;b=THREE.Shape.Utils.b3(c,this.v0.x,this.v1.x,this.v2.x,this.v3.x);a=THREE.Shape.Utils.b3(c,this.v0.y,this.v1.y,this.v2.y,this.v3.y);d=THREE.Shape.Utils.b3(c,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(b,a,d)});THREE.SplineCurve3=THREE.Curve.create(function(a){this.points=(a==undefined)?[]:a},function(l){var j=new THREE.Vector3();var d=[];var i=this.points,g,a,b;g=(i.length-1)*l;a=Math.floor(g);b=g-a;d[0]=a==0?a:a-1;d[1]=a;d[2]=a>i.length-2?i.length-1:a+1;d[3]=a>i.length-3?i.length-1:a+2;var k=i[d[0]],h=i[d[1]],f=i[d[2]],e=i[d[3]];j.x=THREE.Curve.Utils.interpolate(k.x,h.x,f.x,e.x,b);j.y=THREE.Curve.Utils.interpolate(k.y,h.y,f.y,e.y,b);j.z=THREE.Curve.Utils.interpolate(k.z,h.z,f.z,e.z,b);return j});THREE.ClosedSplineCurve3=THREE.Curve.create(function(a){this.points=(a==undefined)?[]:a},function(d){var b=new THREE.Vector3();var h=[];var e=this.points,a,g,f;a=(e.length-0)*d;g=Math.floor(a);f=a-g;g+=g>0?0:(Math.floor(Math.abs(g)/e.length)+1)*e.length;h[0]=(g-1)%e.length;h[1]=(g)%e.length;h[2]=(g+1)%e.length;h[3]=(g+2)%e.length;b.x=THREE.Curve.Utils.interpolate(e[h[0]].x,e[h[1]].x,e[h[2]].x,e[h[3]].x,f);b.y=THREE.Curve.Utils.interpolate(e[h[0]].y,e[h[1]].y,e[h[2]].y,e[h[3]].y,f);b.z=THREE.Curve.Utils.interpolate(e[h[0]].z,e[h[1]].z,e[h[2]].z,e[h[3]].z,f);return b});THREE.AnimationHandler=(function(){var c=[];var b={};var d={};d.update=function(g){for(var f=0;f<c.length;f++){c[f].update(g)}};d.addToUpdate=function(f){if(c.indexOf(f)===-1){c.push(f)}};d.removeFromUpdate=function(g){var f=c.indexOf(g);if(f!==-1){c.splice(f,1)}};d.add=function(f){if(b[f.name]!==undefined){console.log("THREE.AnimationHandler.add: Warning! "+f.name+" already exists in library. Overwriting.")}b[f.name]=f;a(f)};d.get=function(f){if(typeof f==="string"){if(b[f]){return b[f]}else{console.log("THREE.AnimationHandler.get: Couldn't find animation "+f);return null}}else{}};d.parse=function(g){var h=[];if(g instanceof THREE.SkinnedMesh){for(var f=0;f<g.bones.length;f++){h.push(g.bones[f])}}else{e(g,h)}return h};var e=function(f,g){g.push(f);for(var h=0;h<f.children.length;h++){e(f.children[h],g)}};var a=function(j){if(j.initialized===true){return}for(var l=0;l<j.hierarchy.length;l++){for(var i=0;i<j.hierarchy[l].keys.length;i++){if(j.hierarchy[l].keys[i].time<0){j.hierarchy[l].keys[i].time=0}if(j.hierarchy[l].keys[i].rot!==undefined&&!(j.hierarchy[l].keys[i].rot instanceof THREE.Quaternion)){var f=j.hierarchy[l].keys[i].rot;j.hierarchy[l].keys[i].rot=new THREE.Quaternion(f[0],f[1],f[2],f[3])}}if(j.hierarchy[l].keys.length&&j.hierarchy[l].keys[0].morphTargets!==undefined){var p={};for(var i=0;i<j.hierarchy[l].keys.length;i++){for(var g=0;g<j.hierarchy[l].keys[i].morphTargets.length;g++){var n=j.hierarchy[l].keys[i].morphTargets[g];p[n]=-1}}j.hierarchy[l].usedMorphTargets=p;for(var i=0;i<j.hierarchy[l].keys.length;i++){var o={};for(var n in p){for(var g=0;g<j.hierarchy[l].keys[i].morphTargets.length;g++){if(j.hierarchy[l].keys[i].morphTargets[g]===n){o[n]=j.hierarchy[l].keys[i].morphTargetsInfluences[g];break}}if(g===j.hierarchy[l].keys[i].morphTargets.length){o[n]=0}}j.hierarchy[l].keys[i].morphTargetsInfluences=o}}for(var i=1;i<j.hierarchy[l].keys.length;i++){if(j.hierarchy[l].keys[i].time===j.hierarchy[l].keys[i-1].time){j.hierarchy[l].keys.splice(i,1);i--}}for(var i=0;i<j.hierarchy[l].keys.length;i++){j.hierarchy[l].keys[i].index=i}}var q=parseInt(j.length*j.fps,10);j.JIT={};j.JIT.hierarchy=[];for(var l=0;l<j.hierarchy.length;l++){j.JIT.hierarchy.push(new Array(q))}j.initialized=true};d.LINEAR=0;d.CATMULLROM=1;d.CATMULLROM_FORWARD=2;return d}());THREE.Animation=function(a,b,c){this.root=a;this.data=THREE.AnimationHandler.get(b);this.hierarchy=THREE.AnimationHandler.parse(a);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.isPaused=true;this.loop=true;this.interpolationType=c!==undefined?c:THREE.AnimationHandler.LINEAR;this.points=[];this.target=new THREE.Vector3()};THREE.Animation.prototype.play=function(d,c){if(this.isPlaying===false){this.isPlaying=true;this.loop=d!==undefined?d:true;this.currentTime=c!==undefined?c:0;var g,b=this.hierarchy.length,e;for(g=0;g<b;g++){e=this.hierarchy[g];e.matrixAutoUpdate=true;if(e.animationCache===undefined){e.animationCache={};e.animationCache.prevKey={pos:0,rot:0,scl:0};e.animationCache.nextKey={pos:0,rot:0,scl:0};e.animationCache.originalMatrix=e instanceof THREE.Bone?e.skinMatrix:e.matrix}var f=e.animationCache.prevKey;var a=e.animationCache.nextKey;f.pos=this.data.hierarchy[g].keys[0];f.rot=this.data.hierarchy[g].keys[0];f.scl=this.data.hierarchy[g].keys[0];a.pos=this.getNextKeyWith("pos",g,1);a.rot=this.getNextKeyWith("rot",g,1);a.scl=this.getNextKeyWith("scl",g,1)}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){if(this.isPaused===true){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this)};THREE.Animation.prototype.update=function(l){if(this.isPlaying===false){return}var g=["pos","rot","scl"];var d;var v;var b;var m,c;var s,e;var u;var k;var j;var r=this.data.JIT.hierarchy;var o,q;var f,A,p;this.currentTime+=l*this.timeScale;q=this.currentTime;o=this.currentTime=this.currentTime%this.data.length;j=parseInt(Math.min(o*this.data.fps,this.data.length*this.data.fps),10);for(var n=0,a=this.hierarchy.length;n<a;n++){u=this.hierarchy[n];k=u.animationCache;for(var i=0;i<3;i++){d=g[i];s=k.prevKey[d];e=k.nextKey[d];if(e.time<=q){if(o<q){if(this.loop){s=this.data.hierarchy[n].keys[0];e=this.getNextKeyWith(d,n,1);while(e.time<o){s=e;e=this.getNextKeyWith(d,n,e.index+1)}}else{this.stop();return}}else{do{s=e;e=this.getNextKeyWith(d,n,e.index+1)}while(e.time<o)}k.prevKey[d]=s;k.nextKey[d]=e}u.matrixAutoUpdate=true;u.matrixWorldNeedsUpdate=true;v=(o-s.time)/(e.time-s.time);m=s[d];c=e[d];if(v<0||v>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+v+" on bone "+n);v=v<0?0:1}if(d==="pos"){b=u.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){b.x=m[0]+(c[0]-m[0])*v;b.y=m[1]+(c[1]-m[1])*v;b.z=m[2]+(c[2]-m[2])*v}else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",n,s.index-1)["pos"];this.points[1]=m;this.points[2]=c;this.points[3]=this.getNextKeyWith("pos",n,e.index+1)["pos"];v=v*0.33+0.33;f=this.interpolateCatmullRom(this.points,v);b.x=f[0];b.y=f[1];b.z=f[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){A=this.interpolateCatmullRom(this.points,v*1.01);this.target.set(A[0],A[1],A[2]);this.target.sub(b);this.target.y=0;this.target.normalize();p=Math.atan2(this.target.x,this.target.z);u.rotation.set(0,p,0)}}}}else{if(d==="rot"){THREE.Quaternion.slerp(m,c,u.quaternion,v)}else{if(d==="scl"){b=u.scale;b.x=m[0]+(c[0]-m[0])*v;b.y=m[1]+(c[1]-m[1])*v;b.z=m[2]+(c[2]-m[2])*v}}}}}};THREE.Animation.prototype.interpolateCatmullRom=function(n,b){var h=[],j=[],m,a,f,e,d,l,k,i,g;m=(n.length-1)*b;a=Math.floor(m);f=m-a;h[0]=a===0?a:a-1;h[1]=a;h[2]=a>n.length-2?a:a+1;h[3]=a>n.length-3?a:a+2;l=n[h[0]];k=n[h[1]];i=n[h[2]];g=n[h[3]];e=f*f;d=f*e;j[0]=this.interpolate(l[0],k[0],i[0],g[0],f,e,d);j[1]=this.interpolate(l[1],k[1],i[1],g[1],f,e,d);j[2]=this.interpolate(l[2],k[2],i[2],g[2],f,e,d);return j};THREE.Animation.prototype.interpolate=function(h,g,e,d,i,b,a){var f=(e-h)*0.5,c=(d-g)*0.5;return(2*(g-e)+f+c)*a+(-3*(g-e)-2*f-c)*b+f*i+g};THREE.Animation.prototype.getNextKeyWith=function(c,b,a){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){a=a<d.length-1?a:d.length-1}else{a=a%d.length}for(;a<d.length;a++){if(d[a][c]!==undefined){return d[a]}}return this.data.hierarchy[b].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(c,b,a){var d=this.data.hierarchy[b].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){a=a>0?a:0}else{a=a>=0?a:a+d.length}for(;a>=0;a--){if(d[a][c]!==undefined){return d[a]}}return this.data.hierarchy[b].keys[d.length-1]};THREE.KeyFrameAnimation=function(j,e,i){this.root=j;this.data=THREE.AnimationHandler.get(e);this.hierarchy=THREE.AnimationHandler.parse(j);this.currentTime=0;this.timeScale=0.001;this.isPlaying=false;this.isPaused=true;this.loop=true;this.JITCompile=i!==undefined?i:true;for(var g=0,c=this.hierarchy.length;g<c;g++){var k=this.data.hierarchy[g].keys,a=this.data.hierarchy[g].sids,d=this.hierarchy[g];if(k.length&&a){for(var l=0;l<a.length;l++){var b=a[l],f=this.getNextKeyWith(b,g,0);if(f){f.apply(b)}}d.matrixAutoUpdate=false;this.data.hierarchy[g].node.updateMatrix();d.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(c,b){if(!this.isPlaying){this.isPlaying=true;this.loop=c!==undefined?c:true;this.currentTime=b!==undefined?b:0;this.startTimeMs=b;this.startTime=10000000;this.endTime=-this.startTime;var e,a=this.hierarchy.length,d,g;for(e=0;e<a;e++){d=this.hierarchy[e];g=this.data.hierarchy[e];if(g.animationCache===undefined){g.animationCache={};g.animationCache.prevKey=null;g.animationCache.nextKey=null;g.animationCache.originalMatrix=d instanceof THREE.Bone?d.skinMatrix:d.matrix}var f=this.data.hierarchy[e].keys;if(f.length){g.animationCache.prevKey=f[0];g.animationCache.nextKey=f[1];this.startTime=Math.min(f[0].time,this.startTime);this.endTime=Math.max(f[f.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){if(this.isPaused){THREE.AnimationHandler.addToUpdate(this)}else{THREE.AnimationHandler.removeFromUpdate(this)}this.isPaused=!this.isPaused};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.removeFromUpdate(this);for(var b=0;b<this.data.hierarchy.length;b++){var d=this.hierarchy[b];var c=this.data.hierarchy[b];if(c.animationCache!==undefined){var a=c.animationCache.originalMatrix;if(d instanceof THREE.Bone){a.copy(d.skinMatrix);d.skinMatrix=a}else{a.copy(d.matrix);d.matrix=a}delete c.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(n){if(!this.isPlaying){return}var v,d;var A;var l;var g;var u=this.data.JIT.hierarchy;var q,t;var e;this.currentTime+=n*this.timeScale;t=this.currentTime;q=this.currentTime=this.currentTime%this.data.length;if(q<this.startTimeMs){q=this.currentTime=this.startTimeMs+q}g=parseInt(Math.min(q*this.data.fps,this.data.length*this.data.fps),10);e=q<t;if(e&&!this.loop){for(var o=0,a=this.hierarchy.length;o<a;o++){var j=this.data.hierarchy[o].keys,r=this.data.hierarchy[o].sids,b=j.length-1,f=this.hierarchy[o];if(j.length){for(var i=0;i<r.length;i++){var c=r[i],k=this.getPrevKeyWith(c,o,b);if(k){k.apply(c)}}this.data.hierarchy[o].node.updateMatrix();f.matrixWorldNeedsUpdate=true}}this.stop();return}if(q<this.startTime){return}for(var o=0,a=this.hierarchy.length;o<a;o++){A=this.hierarchy[o];l=this.data.hierarchy[o];var j=l.keys,m=l.animationCache;if(this.JITCompile&&u[o][g]!==undefined){if(A instanceof THREE.Bone){A.skinMatrix=u[o][g];A.matrixWorldNeedsUpdate=false}else{A.matrix=u[o][g];A.matrixWorldNeedsUpdate=true}}else{if(j.length){if(this.JITCompile&&m){if(A instanceof THREE.Bone){A.skinMatrix=m.originalMatrix}else{A.matrix=m.originalMatrix}}v=m.prevKey;d=m.nextKey;if(v&&d){if(d.time<=t){if(e&&this.loop){v=j[0];d=j[1];while(d.time<q){v=d;d=j[v.index+1]}}else{if(!e){var p=j.length-1;while(d.time<q&&d.index!==p){v=d;d=j[v.index+1]}}}m.prevKey=v;m.nextKey=d}if(d.time>=q){v.interpolate(d,q)}else{v.interpolate(d,d.time)}}this.data.hierarchy[o].node.updateMatrix();A.matrixWorldNeedsUpdate=true}}}if(this.JITCompile){if(u[0][g]===undefined){this.hierarchy[0].updateMatrixWorld(true);for(var o=0;o<this.hierarchy.length;o++){if(this.hierarchy[o] instanceof THREE.Bone){u[o][g]=this.hierarchy[o].skinMatrix.clone()}else{u[o][g]=this.hierarchy[o].matrix.clone()}}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(a,c,b){var d=this.data.hierarchy[c].keys;b=b%d.length;for(;b<d.length;b++){if(d[b].hasTarget(a)){return d[b]}}return d[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(a,c,b){var d=this.data.hierarchy[c].keys;b=b>=0?b:b+d.length;for(;b>=0;b--){if(d[b].hasTarget(a)){return d[b]}}return d[d.length-1]};THREE.CubeCamera=function(f,e,g){THREE.Object3D.call(this);var d=90,b=1;var c=new THREE.PerspectiveCamera(d,b,f,e);c.up.set(0,-1,0);c.lookAt(new THREE.Vector3(1,0,0));this.add(c);var j=new THREE.PerspectiveCamera(d,b,f,e);j.up.set(0,-1,0);j.lookAt(new THREE.Vector3(-1,0,0));this.add(j);var a=new THREE.PerspectiveCamera(d,b,f,e);a.up.set(0,0,1);a.lookAt(new THREE.Vector3(0,1,0));this.add(a);var i=new THREE.PerspectiveCamera(d,b,f,e);i.up.set(0,0,-1);i.lookAt(new THREE.Vector3(0,-1,0));this.add(i);var k=new THREE.PerspectiveCamera(d,b,f,e);k.up.set(0,-1,0);k.lookAt(new THREE.Vector3(0,0,1));this.add(k);var h=new THREE.PerspectiveCamera(d,b,f,e);h.up.set(0,-1,0);h.lookAt(new THREE.Vector3(0,0,-1));this.add(h);this.renderTarget=new THREE.WebGLRenderTargetCube(g,g,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(n,o){var m=this.renderTarget;var l=m.generateMipmaps;m.generateMipmaps=false;m.activeCubeFace=0;n.render(o,c,m);m.activeCubeFace=1;n.render(o,j,m);m.activeCubeFace=2;n.render(o,a,m);m.activeCubeFace=3;n.render(o,i,m);m.activeCubeFace=4;n.render(o,k,m);m.generateMipmaps=l;m.activeCubeFace=5;n.render(o,h,m)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CombinedCamera=function(h,a,e,g,b,f,d){THREE.Camera.call(this);this.fov=e;this.left=-h/2;this.right=h/2;this.top=a/2;this.bottom=-a/2;this.cameraO=new THREE.OrthographicCamera(h/-2,h/2,a/2,a/-2,f,d);this.cameraP=new THREE.PerspectiveCamera(e,h/a,g,b);this.zoom=1;this.toPerspective();var c=h/a};THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype);THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPerspectiveMode=true;this.inOrthographicMode=false};THREE.CombinedCamera.prototype.toOrthographic=function(){var d=this.fov;var b=this.cameraP.aspect;var f=this.cameraP.near;var e=this.cameraP.far;var g=(f+e)/2;var h=Math.tan(d/2)*g;var a=2*h;var i=a*b;var c=i/2;h/=this.zoom;c/=this.zoom;this.cameraO.left=-c;this.cameraO.right=c;this.cameraO.top=h;this.cameraO.bottom=-h;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPerspectiveMode=false;this.inOrthographicMode=true};THREE.CombinedCamera.prototype.setSize=function(b,a){this.cameraP.aspect=b/a;this.left=-b/2;this.right=b/2;this.top=a/2;this.bottom=-a/2};THREE.CombinedCamera.prototype.setFov=function(a){this.fov=a;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPerspectiveMode){this.toPerspective()}else{this.toPerspective();this.toOrthographic()}};THREE.CombinedCamera.prototype.setLens=function(c,b){if(b===undefined){b=24}var a=2*THREE.Math.radToDeg(Math.atan(b/(c*2)));this.setFov(a);return a};THREE.CombinedCamera.prototype.setZoom=function(a){this.zoom=a;if(this.inPerspectiveMode){this.toPerspective()}else{this.toOrthographic()}};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CircleGeometry=function(k,g,d,b){THREE.Geometry.call(this);this.radius=k=k||50;this.segments=g=g!==undefined?Math.max(3,g):8;this.thetaStart=d=d!==undefined?d:0;this.thetaLength=b=b!==undefined?b:Math.PI*2;var f,e=[],a=new THREE.Vector3(),o=new THREE.Vector2(0.5,0.5);this.vertices.push(a);e.push(o);for(f=0;f<=g;f++){var j=new THREE.Vector3();var h=d+f/g*b;j.x=k*Math.cos(h);j.y=k*Math.sin(h);this.vertices.push(j);e.push(new THREE.Vector2((j.x/k+1)/2,(j.y/k+1)/2))}var c=new THREE.Vector3(0,0,1);for(f=1;f<=g;f++){var p=f;var m=f+1;var l=0;this.faces.push(new THREE.Face3(p,m,l,[c.clone(),c.clone(),c.clone()]));this.faceVertexUvs[0].push([e[f].clone(),e[f+1].clone(),o.clone()])}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),k)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CubeGeometry=function(a,i,e,b,h,d){THREE.Geometry.call(this);var k=this;this.width=a;this.height=i;this.depth=e;this.widthSegments=b||1;this.heightSegments=h||1;this.depthSegments=d||1;var j=this.width/2;var g=this.height/2;var c=this.depth/2;f("z","y",-1,-1,this.depth,this.height,j,0);f("z","y",1,-1,this.depth,this.height,-j,1);f("x","z",1,1,this.width,this.depth,g,2);f("x","z",1,-1,this.width,this.depth,-g,3);f("x","y",1,-1,this.width,this.height,c,4);f("x","y",-1,-1,this.width,this.height,-c,5);function f(E,D,l,s,G,F,V,A){var C,q,p,K=k.widthSegments,I=k.heightSegments,r=G/2,o=F/2,t=k.vertices.length;if((E==="x"&&D==="y")||(E==="y"&&D==="x")){C="z"}else{if((E==="x"&&D==="z")||(E==="z"&&D==="x")){C="y";I=k.depthSegments}else{if((E==="z"&&D==="y")||(E==="y"&&D==="z")){C="x";K=k.depthSegments}}}var M=K+1,n=I+1,U=G/K,P=F/I,T=new THREE.Vector3();T[C]=V>0?1:-1;for(p=0;p<n;p++){for(q=0;q<M;q++){var m=new THREE.Vector3();m[E]=(q*U-r)*l;m[D]=(p*P-o)*s;m[C]=V;k.vertices.push(m)}}for(p=0;p<I;p++){for(q=0;q<K;q++){var S=q+M*p;var R=q+M*(p+1);var Q=(q+1)+M*(p+1);var O=(q+1)+M*p;var N=new THREE.Vector2(q/K,1-p/I);var L=new THREE.Vector2(q/K,1-(p+1)/I);var J=new THREE.Vector2((q+1)/K,1-(p+1)/I);var H=new THREE.Vector2((q+1)/K,1-p/I);var B=new THREE.Face3(S+t,R+t,O+t);B.normal.copy(T);B.vertexNormals.push(T.clone(),T.clone(),T.clone());B.materialIndex=A;k.faces.push(B);k.faceVertexUvs[0].push([N,L,H]);B=new THREE.Face3(R+t,Q+t,O+t);B.normal.copy(T);B.vertexNormals.push(T.clone(),T.clone(),T.clone());B.materialIndex=A;k.faces.push(B);k.faceVertexUvs[0].push([L.clone(),J,H.clone()])}}}this.computeCentroids();this.mergeVertices()};THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry=function(k,L,B,e,t,I){THREE.Geometry.call(this);this.radiusTop=k=k!==undefined?k:20;this.radiusBottom=L=L!==undefined?L:20;this.height=B=B!==undefined?B:100;this.radialSegments=e=e||8;this.heightSegments=t=t||1;this.openEnded=I=I!==undefined?I:false;var C=B/2;var p,o,g=[],q=[];for(o=0;o<=t;o++){var A=[];var K=[];var r=o/t;var f=r*(L-k)+k;for(p=0;p<=e;p++){var s=p/e;var G=new THREE.Vector3();G.x=f*Math.sin(s*Math.PI*2);G.y=-r*B+C;G.z=f*Math.cos(s*Math.PI*2);this.vertices.push(G);A.push(this.vertices.length-1);K.push(new THREE.Vector2(s,1-r))}g.push(A);q.push(K)}var E=(L-k)/B;var m,j;for(p=0;p<e;p++){if(k!==0){m=this.vertices[g[0][p]].clone();j=this.vertices[g[0][p+1]].clone()}else{m=this.vertices[g[1][p]].clone();j=this.vertices[g[1][p+1]].clone()}m.setY(Math.sqrt(m.x*m.x+m.z*m.z)*E).normalize();j.setY(Math.sqrt(j.x*j.x+j.z*j.z)*E).normalize();for(o=0;o<t;o++){var d=g[o][p];var c=g[o+1][p];var b=g[o+1][p+1];var a=g[o][p+1];var n=m.clone();var l=m.clone();var i=j.clone();var h=j.clone();var J=q[o][p].clone();var H=q[o+1][p].clone();var F=q[o+1][p+1].clone();var D=q[o][p+1].clone();this.faces.push(new THREE.Face3(d,c,a,[n,l,h]));this.faceVertexUvs[0].push([J,H,D]);this.faces.push(new THREE.Face3(c,b,a,[l.clone(),i,h.clone()]));this.faceVertexUvs[0].push([H.clone(),F,D.clone()])}}if(I===false&&k>0){this.vertices.push(new THREE.Vector3(0,C,0));for(p=0;p<e;p++){var d=g[0][p];var c=g[0][p+1];var b=this.vertices.length-1;var n=new THREE.Vector3(0,1,0);var l=new THREE.Vector3(0,1,0);var i=new THREE.Vector3(0,1,0);var J=q[0][p].clone();var H=q[0][p+1].clone();var F=new THREE.Vector2(H.x,0);this.faces.push(new THREE.Face3(d,c,b,[n,l,i]));this.faceVertexUvs[0].push([J,H,F])}}if(I===false&&L>0){this.vertices.push(new THREE.Vector3(0,-C,0));for(p=0;p<e;p++){var d=g[o][p+1];var c=g[o][p];var b=this.vertices.length-1;var n=new THREE.Vector3(0,-1,0);var l=new THREE.Vector3(0,-1,0);var i=new THREE.Vector3(0,-1,0);var J=q[o][p+1].clone();var H=q[o][p].clone();var F=new THREE.Vector2(H.x,1);this.faces.push(new THREE.Face3(d,c,b,[n,l,i]));this.faceVertexUvs[0].push([J,H,F])}}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry=function(a,b){if(typeof(a)==="undefined"){a=[];return}THREE.Geometry.call(this);a=a instanceof Array?a:[a];this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.addShapeList=function(b,d){var a=b.length;for(var e=0;e<a;e++){var c=b[e];this.addShape(c,d)}};THREE.ExtrudeGeometry.prototype.addShape=function(H,Q){var g=Q.amount!==undefined?Q.amount:100;var f=Q.bevelThickness!==undefined?Q.bevelThickness:6;var R=Q.bevelSize!==undefined?Q.bevelSize:f-2;var E=Q.bevelSegments!==undefined?Q.bevelSegments:3;var a=Q.bevelEnabled!==undefined?Q.bevelEnabled:true;var P=Q.curveSegments!==undefined?Q.curveSegments:12;var aa=Q.steps!==undefined?Q.steps:1;var r=Q.extrudePath;var V,u=false;var an=Q.material;var o=Q.extrudeMaterial;var G=Q.UVGenerator!==undefined?Q.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var Z=this.shapebb;var B,ad,ah,aw;if(r){V=r.getSpacedPoints(aa);u=true;a=false;B=Q.frames!==undefined?Q.frames:new THREE.TubeGeometry.FrenetFrames(r,aa,false);ad=new THREE.Vector3();ah=new THREE.Vector3();aw=new THREE.Vector3()}if(!a){E=0;f=0;R=0}var az,au,av;var ab=this;var N=[];var X=this.vertices.length;var F=H.extractPoints(P);var d=F.shape;var L=F.holes;var aj=!THREE.Shape.Utils.isClockWise(d);if(aj){d=d.reverse();for(au=0,av=L.length;au<av;au++){az=L[au];if(THREE.Shape.Utils.isClockWise(az)){L[au]=az.reverse()}}aj=false}var q=THREE.Shape.Utils.triangulateShape(d,L);var am=d;for(au=0,av=L.length;au<av;au++){az=L[au];d=d.concat(az)}function S(i,h,b){if(!h){console.log("die")}return h.clone().multiplyScalar(b).add(i)}var ay,ak,ag,ac,A,al=d.length,p,n=q.length,Y,c=am.length;var W=180/Math.PI;function J(i,h,b){return C(i,h,b)}function D(j,i,h){var t=Math.atan2(i.y-j.y,i.x-j.x);var s=Math.atan2(h.y-j.y,h.x-j.x);if(t>s){s+=Math.PI*2}var k=(t+s)/2;var aA=-Math.cos(k);var v=-Math.sin(k);var b=new THREE.Vector2(aA,v);return b}function C(aB,aA,t){var aG=THREE.ExtrudeGeometry.__v1,aD=THREE.ExtrudeGeometry.__v2,aF=THREE.ExtrudeGeometry.__v3,aC=THREE.ExtrudeGeometry.__v4,j=THREE.ExtrudeGeometry.__v5,i=THREE.ExtrudeGeometry.__v6,aI,aH,k,aE,aJ,h;aG.set(aB.x-aA.x,aB.y-aA.y);aD.set(aB.x-t.x,aB.y-t.y);aI=aG.normalize();aH=aD.normalize();aF.set(-aI.y,aI.x);aC.set(aH.y,-aH.x);j.copy(aB).add(aF);i.copy(aB).add(aC);if(j.equals(i)){return aC.clone()}j.copy(aA).add(aF);i.copy(t).add(aC);k=aI.dot(aC);aE=i.sub(j).dot(aC);if(k===0){console.log("Either infinite or no solutions!");if(aE===0){console.log("Its finite solutions.")}else{console.log("Too bad, no solutions.")}}aJ=aE/k;if(aJ<0){return D(aB,aA,t)}h=aI.multiplyScalar(aJ).add(j);return h.sub(aB).clone()}var aq=[];for(var at=0,U=am.length,ap=U-1,ao=at+1;at<U;at++,ap++,ao++){if(ap===U){ap=0}if(ao===U){ao=0}var M=am[at];var K=am[ap];var I=am[ao];aq[at]=J(am[at],am[ap],am[ao])}var T=[],af,e=aq.concat();for(au=0,av=L.length;au<av;au++){az=L[au];af=[];for(at=0,U=az.length,ap=U-1,ao=at+1;at<U;at++,ap++,ao++){if(ap===U){ap=0}if(ao===U){ao=0}af[at]=J(az[at],az[ap],az[ao])}T.push(af);e=e.concat(af)}for(ay=0;ay<E;ay++){ag=ay/E;ac=f*(1-ag);ak=R*(Math.sin(ag*Math.PI/2));for(at=0,U=am.length;at<U;at++){A=S(am[at],aq[at],ak);ae(A.x,A.y,-ac)}for(au=0,av=L.length;au<av;au++){az=L[au];af=T[au];for(at=0,U=az.length;at<U;at++){A=S(az[at],af[at],ak);ae(A.x,A.y,-ac)}}}ak=R;for(at=0;at<al;at++){A=a?S(d[at],e[at],ak):d[at];if(!u){ae(A.x,A.y,0)}else{ah.copy(B.normals[0]).multiplyScalar(A.x);ad.copy(B.binormals[0]).multiplyScalar(A.y);aw.copy(V[0]).add(ah).add(ad);ae(aw.x,aw.y,aw.z)}}var ai;for(ai=1;ai<=aa;ai++){for(at=0;at<al;at++){A=a?S(d[at],e[at],ak):d[at];if(!u){ae(A.x,A.y,g/aa*ai)}else{ah.copy(B.normals[ai]).multiplyScalar(A.x);ad.copy(B.binormals[ai]).multiplyScalar(A.y);aw.copy(V[ai]).add(ah).add(ad);ae(aw.x,aw.y,aw.z)}}}for(ay=E-1;ay>=0;ay--){ag=ay/E;ac=f*(1-ag);ak=R*Math.sin(ag*Math.PI/2);for(at=0,U=am.length;at<U;at++){A=S(am[at],aq[at],ak);ae(A.x,A.y,g+ac)}for(au=0,av=L.length;au<av;au++){az=L[au];af=T[au];for(at=0,U=az.length;at<U;at++){A=S(az[at],af[at],ak);if(!u){ae(A.x,A.y,g+ac)}else{ae(A.x,A.y+V[aa-1].y,V[aa-1].x+ac)}}}}O();ax();function O(){if(a){var b=0;var h=al*b;for(at=0;at<n;at++){p=q[at];m(p[2]+h,p[1]+h,p[0]+h,true)}b=aa+E*2;h=al*b;for(at=0;at<n;at++){p=q[at];m(p[0]+h,p[1]+h,p[2]+h,false)}}else{for(at=0;at<n;at++){p=q[at];m(p[2],p[1],p[0],true)}for(at=0;at<n;at++){p=q[at];m(p[0]+al*aa,p[1]+al*aa,p[2]+al*aa,false)}}}function ax(){var b=0;ar(am,b);b+=am.length;for(au=0,av=L.length;au<av;au++){az=L[au];ar(az,b);b+=az.length}}function ar(aC,h){var aA,v;at=aC.length;while(--at>=0){aA=at;v=at-1;if(v<0){v=aC.length-1}var aH=0,i=aa+E*2;for(aH=0;aH<i;aH++){var aB=al*aH;var t=al*(aH+1);var aG=h+aA+aB,aF=h+v+aB,aE=h+v+t,aD=h+aA+t;l(aG,aF,aE,aD,aC,aH,i,aA,v)}}}function ae(b,i,h){ab.vertices.push(new THREE.Vector3(b,i,h))}function m(i,h,s,k){i+=X;h+=X;s+=X;ab.faces.push(new THREE.Face3(i,h,s,null,null,an));var j=k?G.generateBottomUV(ab,H,Q,i,h,s):G.generateTopUV(ab,H,Q,i,h,s);ab.faceVertexUvs[0].push(j)}function l(aB,aA,t,s,h,j,aC,v,k){aB+=X;aA+=X;t+=X;s+=X;ab.faces.push(new THREE.Face3(aB,aA,s,null,null,o));ab.faces.push(new THREE.Face3(aA,t,s,null,null,o));var i=G.generateSideWallUV(ab,H,h,Q,aB,aA,t,s,j,aC,v,k);ab.faceVertexUvs[0].push([i[0],i[1],i[3]]);ab.faceVertexUvs[0].push([i[1],i[2],i[3]])}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(g,h,d,k,j,i){var a=g.vertices[k].x,l=g.vertices[k].y,f=g.vertices[j].x,e=g.vertices[j].y,c=g.vertices[i].x,b=g.vertices[i].y;return[new THREE.Vector2(a,l),new THREE.Vector2(f,e),new THREE.Vector2(c,b)]},generateBottomUV:function(f,c,a,e,d,b){return this.generateTopUV(f,c,a,e,d,b)},generateSideWallUV:function(f,m,b,t,B,A,v,u,a,n,s,r){var k=f.vertices[B].x,i=f.vertices[B].y,g=f.vertices[B].z,q=f.vertices[A].x,p=f.vertices[A].y,o=f.vertices[A].z,e=f.vertices[v].x,d=f.vertices[v].y,c=f.vertices[v].z,l=f.vertices[u].x,j=f.vertices[u].y,h=f.vertices[u].z;if(Math.abs(i-p)<0.01){return[new THREE.Vector2(k,1-g),new THREE.Vector2(q,1-o),new THREE.Vector2(e,1-c),new THREE.Vector2(l,1-h)]}else{return[new THREE.Vector2(i,1-g),new THREE.Vector2(p,1-o),new THREE.Vector2(d,1-c),new THREE.Vector2(j,1-h)]}}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2();THREE.ExtrudeGeometry.__v2=new THREE.Vector2();THREE.ExtrudeGeometry.__v3=new THREE.Vector2();THREE.ExtrudeGeometry.__v4=new THREE.Vector2();THREE.ExtrudeGeometry.__v5=new THREE.Vector2();THREE.ExtrudeGeometry.__v6=new THREE.Vector2();THREE.ShapeGeometry=function(a,b){THREE.Geometry.call(this);if(a instanceof Array===false){a=[a]}this.shapebb=a[a.length-1].getBoundingBox();this.addShapeList(a,b);this.computeCentroids();this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.addShapeList=function(b,c){for(var d=0,a=b.length;d<a;d++){this.addShape(b[d],c)}return this};THREE.ShapeGeometry.prototype.addShape=function(e,h){if(h===undefined){h={}}var d=h.curveSegments!==undefined?h.curveSegments:12;var q=h.material;var E=h.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:h.UVGenerator;var r=this.shapebb;var C,B,t,v;var p=this.vertices.length;var F=e.extractPoints(d);var j=F.shape;var m=F.holes;var o=!THREE.Shape.Utils.isClockWise(j);if(o){j=j.reverse();for(C=0,B=m.length;C<B;C++){t=m[C];if(THREE.Shape.Utils.isClockWise(t)){m[C]=t.reverse()}}o=false}var f=THREE.Shape.Utils.triangulateShape(j,m);var A=j;for(C=0,B=m.length;C<B;C++){t=m[C];j=j.concat(t)}var D,k=j.length;var n,J=f.length;var g,u=A.length;for(C=0;C<k;C++){D=j[C];this.vertices.push(new THREE.Vector3(D.x,D.y,0))}for(C=0;C<J;C++){n=f[C];var I=n[0]+p;var H=n[1]+p;var G=n[2]+p;this.faces.push(new THREE.Face3(I,H,G,null,null,q));this.faceVertexUvs[0].push(E.generateBottomUV(this,e,h,I,H,G))}};THREE.LatheGeometry=function(t,q,n,p){THREE.Geometry.call(this);q=q||12;n=n||0;p=p||2*Math.PI;var E=1/(t.length-1);var D=1/q;for(var u=0,l=q;u<=l;u++){var g=n+u*D*p;var G=Math.cos(g),m=Math.sin(g);for(var r=0,A=t.length;r<A;r++){var o=t[r];var C=new THREE.Vector3();C.x=G*o.x-m*o.y;C.y=m*o.x+G*o.y;C.z=o.z;this.vertices.push(C)}}var e=t.length;for(var u=0,l=q;u<l;u++){for(var r=0,A=t.length-1;r<A;r++){var k=r+e*u;var I=k;var H=k+e;var G=k+1+e;var F=k+1;var B=u*D;var h=r*E;var v=B+D;var f=h+E;this.faces.push(new THREE.Face3(I,H,F));this.faceVertexUvs[0].push([new THREE.Vector2(B,h),new THREE.Vector2(v,h),new THREE.Vector2(B,f)]);this.faces.push(new THREE.Face3(H,G,F));this.faceVertexUvs[0].push([new THREE.Vector2(v,h),new THREE.Vector2(v,f),new THREE.Vector2(B,f)])}}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry=function(p,o,e,n){THREE.Geometry.call(this);this.width=p;this.height=o;this.widthSegments=e||1;this.heightSegments=n||1;var h,f;var i=p/2;var g=o/2;var t=this.widthSegments;var q=this.heightSegments;var v=t+1;var m=q+1;var H=this.width/t;var C=this.height/q;var G=new THREE.Vector3(0,0,1);for(f=0;f<m;f++){for(h=0;h<v;h++){var l=h*H-i;var k=f*C-g;this.vertices.push(new THREE.Vector3(l,-k,0))}}for(f=0;f<q;f++){for(h=0;h<t;h++){var F=h+v*f;var E=h+v*(f+1);var D=(h+1)+v*(f+1);var B=(h+1)+v*f;var A=new THREE.Vector2(h/t,1-f/q);var u=new THREE.Vector2(h/t,1-(f+1)/q);var s=new THREE.Vector2((h+1)/t,1-(f+1)/q);var r=new THREE.Vector2((h+1)/t,1-f/q);var j=new THREE.Face3(F,E,B);j.normal.copy(G);j.vertexNormals.push(G.clone(),G.clone(),G.clone());this.faces.push(j);this.faceVertexUvs[0].push([A,u,r]);j=new THREE.Face3(E,D,B);j.normal.copy(G);j.vertexNormals.push(G.clone(),G.clone(),G.clone());this.faces.push(j);this.faceVertexUvs[0].push([u.clone(),s,r.clone()])}}this.computeCentroids()};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry=function(k,r,g,s,h,p){THREE.Geometry.call(this);k=k||0;r=r||50;h=h!==undefined?h:0;p=p!==undefined?p:Math.PI*2;g=g!==undefined?Math.max(3,g):8;s=s!==undefined?Math.max(3,s):8;var t,m,l=[],f=k,j=((r-k)/s);for(t=0;t<=s;t++){for(m=0;m<=g;m++){var u=new THREE.Vector3();var c=h+m/g*p;u.x=f*Math.cos(c);u.y=f*Math.sin(c);this.vertices.push(u);l.push(new THREE.Vector2((u.x/r+1)/2,(u.y/r+1)/2))}f+=j}var q=new THREE.Vector3(0,0,1);for(t=0;t<s;t++){var a=t*g;for(m=0;m<=g;m++){var c=m+a;var e=c+t;var d=c+g+t;var b=c+g+1+t;this.faces.push(new THREE.Face3(e,d,b,[q.clone(),q.clone(),q.clone()]));this.faceVertexUvs[0].push([l[e].clone(),l[d].clone(),l[b].clone()]);e=c+t;d=c+g+1+t;b=c+1+t;this.faces.push(new THREE.Face3(e,d,b,[q.clone(),q.clone(),q.clone()]));this.faceVertexUvs[0].push([l[e].clone(),l[d].clone(),l[b].clone()])}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),f)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry=function(f,e,r,t,B,g,A){THREE.Geometry.call(this);this.radius=f=f||50;this.widthSegments=e=Math.max(3,Math.floor(e)||8);this.heightSegments=r=Math.max(2,Math.floor(r)||6);this.phiStart=t=t!==undefined?t:0;this.phiLength=B=B!==undefined?B:Math.PI*2;this.thetaStart=g=g!==undefined?g:0;this.thetaLength=A=A!==undefined?A:Math.PI;var n,m,h=[],o=[];for(m=0;m<=r;m++){var s=[];var H=[];for(n=0;n<=e;n++){var q=n/e;var p=m/r;var E=new THREE.Vector3();E.x=-f*Math.cos(t+q*B)*Math.sin(g+p*A);E.y=f*Math.cos(g+p*A);E.z=f*Math.sin(t+q*B)*Math.sin(g+p*A);this.vertices.push(E);s.push(this.vertices.length-1);H.push(new THREE.Vector2(q,1-p))}h.push(s);o.push(H)}for(m=0;m<this.heightSegments;m++){for(n=0;n<this.widthSegments;n++){var d=h[m][n+1];var c=h[m][n];var b=h[m+1][n];var a=h[m+1][n+1];var l=this.vertices[d].clone().normalize();var k=this.vertices[c].clone().normalize();var j=this.vertices[b].clone().normalize();var i=this.vertices[a].clone().normalize();var G=o[m][n+1].clone();var F=o[m][n].clone();var D=o[m+1][n].clone();var C=o[m+1][n+1].clone();if(Math.abs(this.vertices[d].y)===this.radius){G.x=(G.x+F.x)/2;this.faces.push(new THREE.Face3(d,b,a,[l,j,i]));this.faceVertexUvs[0].push([G,D,C])}else{if(Math.abs(this.vertices[b].y)===this.radius){D.x=(D.x+C.x)/2;this.faces.push(new THREE.Face3(d,c,b,[l,k,j]));this.faceVertexUvs[0].push([G,F,D])}else{this.faces.push(new THREE.Face3(d,c,a,[l,k,i]));this.faceVertexUvs[0].push([G,F,C]);this.faces.push(new THREE.Face3(c,b,a,[k.clone(),j,i.clone()]));this.faceVertexUvs[0].push([F.clone(),D,C.clone()])}}}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),f)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TextGeometry=function(b,a){a=a||{};var c=THREE.FontUtils.generateShapes(b,a);a.amount=a.height!==undefined?a.height:50;if(a.bevelThickness===undefined){a.bevelThickness=10}if(a.bevelSize===undefined){a.bevelSize=8}if(a.bevelEnabled===undefined){a.bevelEnabled=false}THREE.ExtrudeGeometry.call(this,c,a)};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TorusGeometry=function(h,g,f,m,k){THREE.Geometry.call(this);var e=this;this.radius=h||100;this.tube=g||40;this.radialSegments=f||8;this.tubularSegments=m||6;this.arc=k||Math.PI*2;var D=new THREE.Vector3(),n=[],q=[];for(var r=0;r<=this.radialSegments;r++){for(var s=0;s<=this.tubularSegments;s++){var p=s/this.tubularSegments*this.arc;var o=r/this.radialSegments*Math.PI*2;D.x=this.radius*Math.cos(p);D.y=this.radius*Math.sin(p);var t=new THREE.Vector3();t.x=(this.radius+this.tube*Math.cos(o))*Math.cos(p);t.y=(this.radius+this.tube*Math.cos(o))*Math.sin(p);t.z=this.tube*Math.sin(o);this.vertices.push(t);n.push(new THREE.Vector2(s/this.tubularSegments,r/this.radialSegments));q.push(t.clone().sub(D).normalize())}}for(var r=1;r<=this.radialSegments;r++){for(var s=1;s<=this.tubularSegments;s++){var E=(this.tubularSegments+1)*r+s-1;var C=(this.tubularSegments+1)*(r-1)+s-1;var B=(this.tubularSegments+1)*(r-1)+s;var A=(this.tubularSegments+1)*r+s;var l=new THREE.Face3(E,C,A,[q[E],q[C],q[A]]);l.normal.add(q[E]);l.normal.add(q[C]);l.normal.add(q[A]);l.normal.normalize();this.faces.push(l);this.faceVertexUvs[0].push([n[E].clone(),n[C].clone(),n[A].clone()]);l=new THREE.Face3(C,B,A,[q[C],q[B],q[A]]);l.normal.add(q[C]);l.normal.add(q[B]);l.normal.add(q[A]);l.normal.normalize();this.faces.push(l);this.faceVertexUvs[0].push([n[C].clone(),n[B].clone(),n[A].clone()])}}this.computeCentroids()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry=function(s,r,m,B,F,E,e){THREE.Geometry.call(this);var g=this;this.radius=s||100;this.tube=r||40;this.radialSegments=m||64;this.tubularSegments=B||8;this.p=F||2;this.q=E||3;this.heightScale=e||1;this.grid=new Array(this.radialSegments);var o=new THREE.Vector3();var G=new THREE.Vector3();var T=new THREE.Vector3();for(var K=0;K<this.radialSegments;++K){this.grid[K]=new Array(this.tubularSegments);var D=K/this.radialSegments*2*this.p*Math.PI;var h=L(D,this.q,this.p,this.radius,this.heightScale);var f=L(D+0.01,this.q,this.p,this.radius,this.heightScale);o.subVectors(f,h);G.addVectors(f,h);T.crossVectors(o,G);G.crossVectors(T,o);T.normalize();G.normalize();for(var I=0;I<this.tubularSegments;++I){var C=I/this.tubularSegments*2*Math.PI;var l=-this.tube*Math.cos(C);var k=this.tube*Math.sin(C);var t=new THREE.Vector3();t.x=h.x+l*G.x+k*T.x;t.y=h.y+l*G.y+k*T.y;t.z=h.z+l*G.z+k*T.z;this.grid[K][I]=g.vertices.push(t)-1}}for(var K=0;K<this.radialSegments;++K){for(var I=0;I<this.tubularSegments;++I){var A=(K+1)%this.radialSegments;var H=(I+1)%this.tubularSegments;var S=this.grid[K][I];var R=this.grid[A][I];var Q=this.grid[A][H];var P=this.grid[K][H];var O=new THREE.Vector2(K/this.radialSegments,I/this.tubularSegments);var N=new THREE.Vector2((K+1)/this.radialSegments,I/this.tubularSegments);var M=new THREE.Vector2((K+1)/this.radialSegments,(I+1)/this.tubularSegments);var J=new THREE.Vector2(K/this.radialSegments,(I+1)/this.tubularSegments);this.faces.push(new THREE.Face3(S,R,P));this.faceVertexUvs[0].push([O,N,J]);this.faces.push(new THREE.Face3(R,Q,P));this.faceVertexUvs[0].push([N.clone(),M,J.clone()])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();function L(U,p,v,q,a){var j=Math.cos(U);var V=Math.sin(U);var i=p/v*U;var n=Math.cos(i);var d=q*(2+n)*0.5*j;var c=q*(2+n)*V*0.5;var b=a*q*Math.sin(i)*0.5;return new THREE.Vector3(d,c,b)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry=function(L,h,K,G,J){THREE.Geometry.call(this);this.path=L;this.segments=h||64;this.radius=K||1;this.radialSegments=G||8;this.closed=J||false;this.grid=[];var t=this,D,I,A,e=this.segments+1,E,C,B,O,N,M,H,F,o,n,s,f=new THREE.Vector3(),Q,P,r,g,Y,X,W,V,U,T,S,R;var p=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),q=p.tangents,m=p.normals,l=p.binormals;this.tangents=q;this.normals=m;this.binormals=l;function k(a,c,b){return t.vertices.push(new THREE.Vector3(a,c,b))-1}for(Q=0;Q<e;Q++){this.grid[Q]=[];H=Q/(e-1);s=L.getPointAt(H);D=q[Q];I=m[Q];A=l[Q];for(P=0;P<this.radialSegments;P++){F=P/this.radialSegments*2*Math.PI;o=-this.radius*Math.cos(F);n=this.radius*Math.sin(F);f.copy(s);f.x+=o*I.x+n*A.x;f.y+=o*I.y+n*A.y;f.z+=o*I.z+n*A.z;this.grid[Q][P]=k(f.x,f.y,f.z)}}for(Q=0;Q<this.segments;Q++){for(P=0;P<this.radialSegments;P++){r=(this.closed)?(Q+1)%this.segments:Q+1;g=(P+1)%this.radialSegments;Y=this.grid[Q][P];X=this.grid[r][P];W=this.grid[r][g];V=this.grid[Q][g];U=new THREE.Vector2(Q/this.segments,P/this.radialSegments);T=new THREE.Vector2((Q+1)/this.segments,P/this.radialSegments);S=new THREE.Vector2((Q+1)/this.segments,(P+1)/this.radialSegments);R=new THREE.Vector2(Q/this.segments,(P+1)/this.radialSegments);this.faces.push(new THREE.Face3(Y,X,V));this.faceVertexUvs[0].push([U,T,R]);this.faces.push(new THREE.Face3(X,W,V));this.faceVertexUvs[0].push([T.clone(),S,R.clone()])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.FrenetFrames=function(o,r,c){var f=new THREE.Vector3(),D=new THREE.Vector3(),p=new THREE.Vector3(),q=[],n=[],d=[],m=new THREE.Vector3(),t=new THREE.Matrix4(),b=r+1,e,E=0.0001,a,C,B,A,s,j,g;this.tangents=q;this.normals=n;this.binormals=d;for(s=0;s<b;s++){j=s/(b-1);q[s]=o.getTangentAt(j);q[s].normalize()}h();function l(i){n[0]=new THREE.Vector3();d[0]=new THREE.Vector3();if(i===undefined){i=new THREE.Vector3(0,0,1)}n[0].crossVectors(i,q[0]).normalize();d[0].crossVectors(q[0],n[0]).normalize()}function k(){var i=o.getTangentAt(E);n[0]=new THREE.Vector3().subVectors(i,q[0]).normalize();d[0]=new THREE.Vector3().crossVectors(q[0],n[0]);n[0].crossVectors(d[0],q[0]).normalize();d[0].crossVectors(q[0],n[0]).normalize()}function h(){n[0]=new THREE.Vector3();d[0]=new THREE.Vector3();a=Number.MAX_VALUE;C=Math.abs(q[0].x);B=Math.abs(q[0].y);A=Math.abs(q[0].z);if(C<=a){a=C;D.set(1,0,0)}if(B<=a){a=B;D.set(0,1,0)}if(A<=a){D.set(0,0,1)}m.crossVectors(q[0],D).normalize();n[0].crossVectors(q[0],m);d[0].crossVectors(q[0],n[0])}for(s=1;s<b;s++){n[s]=n[s-1].clone();d[s]=d[s-1].clone();m.crossVectors(q[s-1],q[s]);if(m.length()>E){m.normalize();e=Math.acos(THREE.Math.clamp(q[s-1].dot(q[s]),-1,1));n[s].applyMatrix4(t.makeRotationAxis(m,e))}d[s].crossVectors(q[s],n[s])}if(c){e=Math.acos(THREE.Math.clamp(n[0].dot(n[b-1]),-1,1));e/=(b-1);if(q[0].dot(m.crossVectors(n[0],n[b-1]))>0){e=-e}for(s=1;s<b;s++){n[s].applyMatrix4(t.makeRotationAxis(q[s],e*s));d[s].crossVectors(q[s],n[s])}}};THREE.PolyhedronGeometry=function(m,c,k,G){THREE.Geometry.call(this);k=k||1;G=G||0;var n=this;for(var A=0,u=m.length;A<u;A++){e(new THREE.Vector3(m[A][0],m[A][1],m[A][2]))}var s=[],r=this.vertices;var E=[];for(var A=0,u=c.length;A<u;A++){var h=r[c[A][0]];var g=r[c[A][1]];var b=r[c[A][2]];E[A]=new THREE.Face3(h.index,g.index,b.index,[h.clone(),g.clone(),b.clone()])}for(var A=0,u=E.length;A<u;A++){o(E[A],G)}for(var A=0,u=this.faceVertexUvs[0].length;A<u;A++){var q=this.faceVertexUvs[0][A];var F=q[0].x;var D=q[1].x;var C=q[2].x;var v=Math.max(F,Math.max(D,C));var t=Math.min(F,Math.min(D,C));if(v>0.9&&t<0.1){if(F<0.2){q[0].x+=1}if(D<0.2){q[1].x+=1}if(C<0.2){q[2].x+=1}}}for(var A=0,u=this.vertices.length;A<u;A++){this.vertices[A].multiplyScalar(k)}this.mergeVertices();this.computeCentroids();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3(),k);function e(f){var p=f.normalize().clone();p.index=n.vertices.push(p)-1;var l=B(f)/2/Math.PI+0.5;var i=d(f)/Math.PI+0.5;p.uv=new THREE.Vector2(l,1-i);return p}function j(H,p,l){var i=new THREE.Face3(H.index,p.index,l.index,[H.clone(),p.clone(),l.clone()]);i.centroid.add(H).add(p).add(l).divideScalar(3);n.faces.push(i);var f=B(i.centroid);n.faceVertexUvs[0].push([a(H.uv,H,f),a(p.uv,p,f),a(l.uv,l,f)])}function o(K,I){var M=Math.pow(2,I);var Q=Math.pow(4,I);var O=e(n.vertices[K.a]);var N=e(n.vertices[K.b]);var L=e(n.vertices[K.c]);var P=[];for(var H=0;H<=M;H++){P[H]=[];var J=e(O.clone().lerp(L,H/M));var f=e(N.clone().lerp(L,H/M));var R=M-H;for(var p=0;p<=R;p++){if(p==0&&H==M){P[H][p]=J}else{P[H][p]=e(J.clone().lerp(f,p/R))}}}for(var H=0;H<M;H++){for(var p=0;p<2*(M-H)-1;p++){var l=Math.floor(p/2);if(p%2==0){j(P[H][l+1],P[H+1][l],P[H][l])}else{j(P[H][l+1],P[H+1][l+1],P[H+1][l])}}}}function B(f){return Math.atan2(f.z,-f.x)}function d(f){return Math.atan2(-f.y,Math.sqrt((f.x*f.x)+(f.z*f.z)))}function a(i,f,l){if((l<0)&&(i.x===1)){i=new THREE.Vector2(i.x-1,i.y)}if((f.x===0)&&(f.z===0)){i=new THREE.Vector2(l/2/Math.PI+0.5,i.y)}return i.clone()}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry=function(b,e){this.radius=b;this.detail=e;var d=(1+Math.sqrt(5))/2;var c=[[-1,d,0],[1,d,0],[-1,-d,0],[1,-d,0],[0,-1,d],[0,1,d],[0,-1,-d],[0,1,-d],[d,0,-1],[d,0,1],[-d,0,-1],[-d,0,1]];var a=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,c,a,b,e)};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry=function(b,d){var c=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]];var a=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,c,a,b,d)};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry=function(b,d){var c=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]];var a=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,c,a,b,d)};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry=function(g,f,E){THREE.Geometry.call(this);var I=this.vertices;var e=this.faces;var k=this.faceVertexUvs[0];var s,h,q,o;var m,l;var n=E+1;var H=f+1;for(s=0;s<=E;s++){l=s/E;for(q=0;q<=f;q++){m=q/f;o=g(m,l);I.push(o)}}var G,F,D,C;var B,A,t,r;for(s=0;s<E;s++){for(q=0;q<f;q++){G=s*H+q;F=s*H+q+1;D=(s+1)*H+q+1;C=(s+1)*H+q;B=new THREE.Vector2(q/f,s/E);A=new THREE.Vector2((q+1)/f,s/E);t=new THREE.Vector2((q+1)/f,(s+1)/E);r=new THREE.Vector2(q/f,(s+1)/E);e.push(new THREE.Face3(G,F,C));k.push([B,A,r]);e.push(new THREE.Face3(F,D,C));k.push([A.clone(),t,r.clone()])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.AxisHelper=function(a){a=a||1;var c=new THREE.Geometry();c.vertices.push(new THREE.Vector3(),new THREE.Vector3(a,0,0),new THREE.Vector3(),new THREE.Vector3(0,a,0),new THREE.Vector3(),new THREE.Vector3(0,0,a));c.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var b=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,c,b,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.ArrowHelper=function(c,b,f,e){THREE.Object3D.call(this);if(e===undefined){e=16776960}if(f===undefined){f=1}this.position=b;var a=new THREE.Geometry();a.vertices.push(new THREE.Vector3(0,0,0));a.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(a,new THREE.LineBasicMaterial({color:e}));this.line.matrixAutoUpdate=false;this.add(this.line);var d=new THREE.CylinderGeometry(0,0.05,0.25,5,1);d.applyMatrix(new THREE.Matrix4().makeTranslation(0,0.875,0));this.cone=new THREE.Mesh(d,new THREE.MeshBasicMaterial({color:e}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(c);this.setLength(f)};THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.setDirection=function(){var a=new THREE.Vector3();var b;return function(c){if(c.y>0.99999){this.quaternion.set(0,0,0,1)}else{if(c.y<-0.99999){this.quaternion.set(1,0,0,0)}else{a.set(c.z,0,-c.x).normalize();b=Math.acos(c.y);this.quaternion.setFromAxisAngle(a,b)}}}}();THREE.ArrowHelper.prototype.setLength=function(a){this.scale.set(a,a,a)};THREE.ArrowHelper.prototype.setColor=function(a){this.line.material.color.setHex(a);this.cone.material.color.setHex(a)};THREE.BoxHelper=function(b){var a=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=a;var c=new THREE.Geometry();c.vertices.push(a[0],a[1],a[1],a[2],a[2],a[3],a[3],a[0],a[4],a[5],a[5],a[6],a[6],a[7],a[7],a[4],a[0],a[4],a[1],a[5],a[2],a[6],a[3],a[7]);THREE.Line.call(this,c,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);if(b!==undefined){this.update(b)}};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.update=function(c){var e=c.geometry;if(e.boundingBox===null){e.computeBoundingBox()}var d=e.boundingBox.min;var a=e.boundingBox.max;var b=this.vertices;b[0].set(a.x,a.y,a.z);b[1].set(d.x,a.y,a.z);b[2].set(d.x,d.y,a.z);b[3].set(a.x,d.y,a.z);b[4].set(a.x,a.y,d.z);b[5].set(d.x,a.y,d.z);b[6].set(d.x,d.y,d.z);b[7].set(a.x,d.y,d.z);this.geometry.computeBoundingSphere();this.geometry.verticesNeedUpdate=true;this.matrixAutoUpdate=false;this.matrixWorld=c.matrixWorld};THREE.BoundingBoxHelper=function(b,c){var a=c||8947848;this.object=b;this.box=new THREE.Box3();THREE.Mesh.call(this,new THREE.CubeGeometry(1,1,1),new THREE.MeshBasicMaterial({color:a,wireframe:true}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(e){var h=new THREE.Geometry();var f=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});var g={};var d=16755200;var k=16711680;var b=43775;var i=16777215;var c=3355443;j("n1","n2",d);j("n2","n4",d);j("n4","n3",d);j("n3","n1",d);j("f1","f2",d);j("f2","f4",d);j("f4","f3",d);j("f3","f1",d);j("n1","f1",d);j("n2","f2",d);j("n3","f3",d);j("n4","f4",d);j("p","n1",k);j("p","n2",k);j("p","n3",k);j("p","n4",k);j("u1","u2",b);j("u2","u3",b);j("u3","u1",b);j("c","t",i);j("p","c",c);j("cn1","cn2",c);j("cn3","cn4",c);j("cf1","cf2",c);j("cf3","cf4",c);function j(m,l,n){a(m,n);a(l,n)}function a(m,l){h.vertices.push(new THREE.Vector3());h.colors.push(new THREE.Color(l));if(g[m]===undefined){g[m]=[]}g[m].push(h.vertices.length-1)}THREE.Line.call(this,h,f,THREE.LinePieces);this.camera=e;this.matrixWorld=e.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=g;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.update=function(){var a=new THREE.Vector3();var b=new THREE.Camera();var c=new THREE.Projector();return function(){var g=this;var d=1,f=1;b.projectionMatrix.copy(this.camera.projectionMatrix);e("c",0,0,-1);e("t",0,0,1);e("n1",-d,-f,-1);e("n2",d,-f,-1);e("n3",-d,f,-1);e("n4",d,f,-1);e("f1",-d,-f,1);e("f2",d,-f,1);e("f3",-d,f,1);e("f4",d,f,1);e("u1",d*0.7,f*1.1,-1);e("u2",-d*0.7,f*1.1,-1);e("u3",0,f*2,-1);e("cf1",-d,0,1);e("cf2",d,0,1);e("cf3",0,-f,1);e("cf4",0,f,1);e("cn1",-d,0,-1);e("cn2",d,0,-1);e("cn3",0,-f,-1);e("cn4",0,f,-1);function e(j,h,o,n){a.set(h,o,n);c.unprojectVector(a,b);var m=g.pointMap[j];if(m!==undefined){for(var l=0,k=m.length;l<k;l++){g.geometry.vertices[m[l]].copy(a)}}}this.geometry.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(a,b){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;b=b||1;var d=new THREE.PlaneGeometry(b,b);var c=new THREE.MeshBasicMaterial({wireframe:true,fog:false});c.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Mesh(d,c);this.add(this.lightPlane);d=new THREE.Geometry();d.vertices.push(new THREE.Vector3());d.vertices.push(new THREE.Vector3());c=new THREE.LineBasicMaterial({fog:false});c.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(d,c);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var c=new THREE.Vector3();var b=new THREE.Vector3();var a=new THREE.Vector3();return function(){c.getPositionFromMatrix(this.light.matrixWorld);b.getPositionFromMatrix(this.light.target.matrixWorld);a.subVectors(b,c);this.lightPlane.lookAt(a);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(a);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.FaceNormalsHelper=function(e,k,c,j){this.object=e;this.size=k||1;var f=c||16776960;var a=j||1;var h=new THREE.Geometry();var b=this.object.geometry.faces;for(var g=0,d=b.length;g<d;g++){h.vertices.push(new THREE.Vector3());h.vertices.push(new THREE.Vector3())}THREE.Line.call(this,h,new THREE.LineBasicMaterial({color:f,linewidth:a}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3();this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.update=(function(a){var b=new THREE.Vector3();return function(h){this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var g=this.geometry.vertices;var d=this.object.geometry.faces;var f=this.object.matrixWorld;for(var j=0,e=d.length;j<e;j++){var k=d[j];b.copy(k.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var c=2*j;g[c].copy(k.centroid).applyMatrix4(f);g[c+1].addVectors(g[c],b)}this.geometry.verticesNeedUpdate=true;return this}}());THREE.GridHelper=function(c,e){var f=new THREE.Geometry();var d=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var b=-c;b<=c;b+=e){f.vertices.push(new THREE.Vector3(-c,0,b),new THREE.Vector3(c,0,b),new THREE.Vector3(b,0,-c),new THREE.Vector3(b,0,c));var a=b===0?this.color1:this.color2;f.colors.push(a,a,a,a)}THREE.Line.call(this,f,d,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.setColors=function(b,a){this.color1.set(b);this.color2.set(a);this.geometry.colorsNeedUpdate=true};THREE.HemisphereLightHelper=function(a,h,g,e){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color(),new THREE.Color()];var f=new THREE.SphereGeometry(h,4,2);f.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI/2));for(var c=0,b=8;c<b;c++){f.faces[c].color=this.colors[c<4?0:1]}var d=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(f,d);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var a=new THREE.Vector3();return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(a.getPositionFromMatrix(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();THREE.PointLightHelper=function(a,d){this.light=a;this.light.updateMatrixWorld();var c=new THREE.SphereGeometry(d,4,2);var b=new THREE.MeshBasicMaterial({wireframe:true,fog:false});b.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,c,b);this.matrixWorld=this.light.matrixWorld;this.matrixAutoUpdate=false};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SpotLightHelper=function(a){THREE.Object3D.call(this);this.light=a;this.light.updateMatrixWorld();this.matrixWorld=a.matrixWorld;this.matrixAutoUpdate=false;var c=new THREE.CylinderGeometry(0,1,1,8,1,true);c.applyMatrix(new THREE.Matrix4().makeTranslation(0,-0.5,0));c.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI/2));var b=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(c,b);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var a=new THREE.Vector3();var b=new THREE.Vector3();return function(){var c=this.light.distance?this.light.distance:10000;var d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c);a.getPositionFromMatrix(this.light.matrixWorld);b.getPositionFromMatrix(this.light.target.matrixWorld);this.cone.lookAt(b.sub(a));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(e,q,c,p){this.object=e;this.size=q||1;var f=c||16711680;var a=p||1;var o=new THREE.Geometry();var m=e.geometry.vertices;var b=e.geometry.faces;for(var k=0,d=b.length;k<d;k++){var n=b[k];for(var g=0,h=n.vertexNormals.length;g<h;g++){o.vertices.push(new THREE.Vector3());o.vertices.push(new THREE.Vector3())}}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:f,linewidth:a}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3();this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.update=(function(a){var b=new THREE.Vector3();return function(e){var t=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var o=this.geometry.vertices;var r=this.object.geometry.vertices;var c=this.object.geometry.faces;var p=this.object.matrixWorld;var s=0;for(var h=0,d=c.length;h<d;h++){var q=c[h];for(var f=0,g=q.vertexNormals.length;f<g;f++){var n=q[t[f]];var k=r[n];var m=q.vertexNormals[f];o[s].copy(k).applyMatrix4(p);b.copy(m).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);b.add(o[s]);s=s+1;o[s].copy(b);s=s+1}}this.geometry.verticesNeedUpdate=true;return this}}());THREE.VertexTangentsHelper=function(e,q,c,p){this.object=e;this.size=q||1;var f=c||255;var a=p||1;var o=new THREE.Geometry();var m=e.geometry.vertices;var b=e.geometry.faces;for(var k=0,d=b.length;k<d;k++){var n=b[k];for(var g=0,h=n.vertexTangents.length;g<h;g++){o.vertices.push(new THREE.Vector3());o.vertices.push(new THREE.Vector3())}}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:f,linewidth:a}),THREE.LinePieces);this.matrixAutoUpdate=false;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.update=(function(a){var b=new THREE.Vector3();return function(e){var t=["a","b","c","d"];this.object.updateMatrixWorld(true);var n=this.geometry.vertices;var q=this.object.geometry.vertices;var c=this.object.geometry.faces;var o=this.object.matrixWorld;var r=0;for(var h=0,d=c.length;h<d;h++){var p=c[h];for(var f=0,g=p.vertexTangents.length;f<g;f++){var m=p[t[f]];var k=q[m];var s=p.vertexTangents[f];n[r].copy(k).applyMatrix4(o);b.copy(s).transformDirection(o).multiplyScalar(this.size);b.add(n[r]);r=r+1;n[r].copy(b);r=r+1}}this.geometry.verticesNeedUpdate=true;return this}}());THREE.WireframeHelper=function(d){var a=[0,0],g={};var p=function(j,i){return j-i};var o=["a","b","c","d"];var m=new THREE.Geometry();var h=d.geometry.vertices;var b=d.geometry.faces;for(var f=0,c=b.length;f<c;f++){var k=b[f];for(var e=0;e<3;e++){a[0]=k[o[e]];a[1]=k[o[(e+1)%3]];a.sort(p);var n=a.toString();if(g[n]===undefined){m.vertices.push(h[a[0]]);m.vertices.push(h[a[1]]);g[n]=true}}}THREE.Line.call(this,m,new THREE.LineBasicMaterial({color:16777215}),THREE.LinePieces);this.matrixAutoUpdate=false;this.matrixWorld=d.matrixWorld};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(a){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare=function(d,b,e,c,a){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3();this.customUpdateCallback=undefined;if(d!==undefined){this.add(d,b,e,c,a)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.add=function(e,c,f,d,a,b){if(c===undefined){c=-1}if(f===undefined){f=0}if(b===undefined){b=1}if(a===undefined){a=new THREE.Color(16777215)}if(d===undefined){d=THREE.NormalBlending}f=Math.min(f,Math.max(0,f));this.lensFlares.push({texture:e,size:c,distance:f,x:0,y:0,z:0,scale:1,rotation:1,opacity:b,color:a,blending:d})};THREE.LensFlare.prototype.updateLensFlares=function(){var d,c=this.lensFlares.length;var b;var a=-this.positionScreen.x*2;var e=-this.positionScreen.y*2;for(d=0;d<c;d++){b=this.lensFlares[d];b.x=this.positionScreen.x+a*b.distance;b.y=this.positionScreen.y+e*b.distance;b.wantedRotation=b.x*Math.PI*0.25;b.rotation+=(b.wantedRotation-b.rotation)*0.25}};THREE.MorphBlendMesh=function(g,d){THREE.Mesh.call(this,g,d);this.animationsMap={};this.animationsList=[];var f=this.geometry.morphTargets.length;var b="__default";var c=0;var a=f-1;var e=f/1;this.createAnimation(b,c,a,e);this.setAnimationWeight(b,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.createAnimation=function(b,e,a,d){var c={startFrame:e,endFrame:a,length:a-e+1,fps:d,duration:(a-e)/d,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[b]=c;this.animationsList.push(c)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(c){var j=/([a-z]+)(\d+)/;var b,g={};var k=this.geometry;for(var d=0,l=k.morphTargets.length;d<l;d++){var m=k.morphTargets[d];var h=m.name.match(j);if(h&&h.length>1){var a=h[1];var f=h[2];if(!g[a]){g[a]={start:Infinity,end:-Infinity}}var e=g[a];if(d<e.start){e.start=d}if(d>e.end){e.end=d}if(!b){b=a}}}for(var a in g){var e=g[a];this.createAnimation(a,e.start,e.end,c)}this.firstAnimation=b};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];if(b){b.direction=1;b.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];if(b){b.direction=-1;b.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(a,c){var b=this.animationsMap[a];if(b){b.fps=c;b.duration=(b.end-b.start)/b.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(a,c){var b=this.animationsMap[a];if(b){b.duration=c;b.fps=(b.end-b.start)/b.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(a,c){var b=this.animationsMap[a];if(b){b.weight=c}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(a,c){var b=this.animationsMap[a];if(b){b.time=c}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(a){var c=0;var b=this.animationsMap[a];if(b){c=b.time}return c};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(a){var c=-1;var b=this.animationsMap[a];if(b){c=b.duration}return c};THREE.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];if(b){b.time=0;b.active=true}else{console.warn("animation["+a+"] undefined")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];if(b){b.active=false}};THREE.MorphBlendMesh.prototype.update=function(h){for(var c=0,a=this.animationsList.length;c<a;c++){var g=this.animationsList[c];if(!g.active){continue}var e=g.duration/g.length;g.time+=g.direction*h;if(g.mirroredLoop){if(g.time>g.duration||g.time<0){g.direction*=-1;if(g.time>g.duration){g.time=g.duration;g.directionBackwards=true}if(g.time<0){g.time=0;g.directionBackwards=false}}}else{g.time=g.time%g.duration;if(g.time<0){g.time+=g.duration}}var b=g.startFrame+THREE.Math.clamp(Math.floor(g.time/e),0,g.length-1);var f=g.weight;if(b!==g.currentFrame){this.morphTargetInfluences[g.lastFrame]=0;this.morphTargetInfluences[g.currentFrame]=1*f;this.morphTargetInfluences[b]=0;g.lastFrame=g.currentFrame;g.currentFrame=b}var d=(g.time%e)/e;if(g.directionBackwards){d=1-d}this.morphTargetInfluences[g.currentFrame]=d*f;this.morphTargetInfluences[g.lastFrame]=(1-d)*f}};THREE.LensFlarePlugin=function(){var c,d,a,e={};this.init=function(g){c=g.context;d=g;a=g.getPrecision();e.vertices=new Float32Array(8+8);e.faces=new Uint16Array(6);var f=0;e.vertices[f++]=-1;e.vertices[f++]=-1;e.vertices[f++]=0;e.vertices[f++]=0;e.vertices[f++]=1;e.vertices[f++]=-1;e.vertices[f++]=1;e.vertices[f++]=0;e.vertices[f++]=1;e.vertices[f++]=1;e.vertices[f++]=1;e.vertices[f++]=1;e.vertices[f++]=-1;e.vertices[f++]=1;e.vertices[f++]=0;e.vertices[f++]=1;f=0;e.faces[f++]=0;e.faces[f++]=1;e.faces[f++]=2;e.faces[f++]=0;e.faces[f++]=2;e.faces[f++]=3;e.vertexBuffer=c.createBuffer();e.elementBuffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,e.vertexBuffer);c.bufferData(c.ARRAY_BUFFER,e.vertices,c.STATIC_DRAW);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.elementBuffer);c.bufferData(c.ELEMENT_ARRAY_BUFFER,e.faces,c.STATIC_DRAW);e.tempTexture=c.createTexture();e.occlusionTexture=c.createTexture();c.bindTexture(c.TEXTURE_2D,e.tempTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGB,16,16,0,c.RGB,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);c.bindTexture(c.TEXTURE_2D,e.occlusionTexture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,16,16,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST);if(c.getParameter(c.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){e.hasVertexTexture=false;e.program=b(THREE.ShaderFlares.lensFlare,a)}else{e.hasVertexTexture=true;e.program=b(THREE.ShaderFlares.lensFlareVertexTexture,a)}e.attributes={};e.uniforms={};e.attributes.vertex=c.getAttribLocation(e.program,"position");e.attributes.uv=c.getAttribLocation(e.program,"uv");e.uniforms.renderType=c.getUniformLocation(e.program,"renderType");e.uniforms.map=c.getUniformLocation(e.program,"map");e.uniforms.occlusionMap=c.getUniformLocation(e.program,"occlusionMap");e.uniforms.opacity=c.getUniformLocation(e.program,"opacity");e.uniforms.color=c.getUniformLocation(e.program,"color");e.uniforms.scale=c.getUniformLocation(e.program,"scale");e.uniforms.rotation=c.getUniformLocation(e.program,"rotation");e.uniforms.screenPosition=c.getUniformLocation(e.program,"screenPosition")};this.render=function(C,v,r,f){var n=C.__webglFlares,E=n.length;if(!E){return}var A=new THREE.Vector3();var h=f/r,B=r*0.5,q=f*0.5;var o=16/f,F=new THREE.Vector2(o*h,o);var m=new THREE.Vector3(1,1,0),l=new THREE.Vector2(1,1);var D=e.uniforms,k=e.attributes;c.useProgram(e.program);c.enableVertexAttribArray(e.attributes.vertex);c.enableVertexAttribArray(e.attributes.uv);c.uniform1i(D.occlusionMap,0);c.uniform1i(D.map,1);c.bindBuffer(c.ARRAY_BUFFER,e.vertexBuffer);c.vertexAttribPointer(k.vertex,2,c.FLOAT,false,2*8,0);c.vertexAttribPointer(k.uv,2,c.FLOAT,false,2*8,8);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.elementBuffer);c.disable(c.CULL_FACE);c.depthMask(false);var t,s,u,g,p;for(t=0;t<E;t++){o=16/f;F.set(o*h,o);g=n[t];A.set(g.matrixWorld.elements[12],g.matrixWorld.elements[13],g.matrixWorld.elements[14]);A.applyMatrix4(v.matrixWorldInverse);A.applyProjection(v.projectionMatrix);m.copy(A);l.x=m.x*B+B;l.y=m.y*q+q;if(e.hasVertexTexture||(l.x>0&&l.x<r&&l.y>0&&l.y<f)){c.activeTexture(c.TEXTURE1);c.bindTexture(c.TEXTURE_2D,e.tempTexture);c.copyTexImage2D(c.TEXTURE_2D,0,c.RGB,l.x-8,l.y-8,16,16,0);c.uniform1i(D.renderType,0);c.uniform2f(D.scale,F.x,F.y);c.uniform3f(D.screenPosition,m.x,m.y,m.z);c.disable(c.BLEND);c.enable(c.DEPTH_TEST);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,e.occlusionTexture);c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,l.x-8,l.y-8,16,16,0);c.uniform1i(D.renderType,1);c.disable(c.DEPTH_TEST);c.activeTexture(c.TEXTURE1);c.bindTexture(c.TEXTURE_2D,e.tempTexture);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0);g.positionScreen.copy(m);if(g.customUpdateCallback){g.customUpdateCallback(g)}else{g.updateLensFlares()}c.uniform1i(D.renderType,2);c.enable(c.BLEND);for(s=0,u=g.lensFlares.length;s<u;s++){p=g.lensFlares[s];if(p.opacity>0.001&&p.scale>0.001){m.x=p.x;m.y=p.y;m.z=p.z;o=p.size*p.scale/f;F.x=o*h;F.y=o;c.uniform3f(D.screenPosition,m.x,m.y,m.z);c.uniform2f(D.scale,F.x,F.y);c.uniform1f(D.rotation,p.rotation);c.uniform1f(D.opacity,p.opacity);c.uniform3f(D.color,p.color.r,p.color.g,p.color.b);d.setBlending(p.blending,p.blendEquation,p.blendSrc,p.blendDst);d.setTexture(p.texture,1);c.drawElements(c.TRIANGLES,6,c.UNSIGNED_SHORT,0)}}}}c.enable(c.CULL_FACE);c.enable(c.DEPTH_TEST);c.depthMask(true)};function b(i,g){var h=c.createProgram();var f=c.createShader(c.FRAGMENT_SHADER);var k=c.createShader(c.VERTEX_SHADER);var j="precision "+g+" float;\n";c.shaderSource(f,j+i.fragmentShader);c.shaderSource(k,j+i.vertexShader);c.compileShader(f);c.compileShader(k);c.attachShader(h,f);c.attachShader(h,k);c.linkProgram(h);return h}};THREE.ShadowMapPlugin=function(){var a,k,n,e,b,l,m=new THREE.Frustum(),c=new THREE.Matrix4(),h=new THREE.Vector3(),o=new THREE.Vector3(),j=new THREE.Vector3();this.init=function(r){a=r.context;k=r;var p=THREE.ShaderLib.depthRGBA;var q=THREE.UniformsUtils.clone(p.uniforms);n=new THREE.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:q});e=new THREE.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:q,morphTargets:true});b=new THREE.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:q,skinning:true});l=new THREE.ShaderMaterial({fragmentShader:p.fragmentShader,vertexShader:p.vertexShader,uniforms:q,morphTargets:true,skinning:true});n._shadowPass=true;e._shadowPass=true;b._shadowPass=true;l._shadowPass=true};this.render=function(q,p){if(!(k.shadowMapEnabled&&k.shadowMapAutoUpdate)){return}this.update(q,p)};this.update=function(R,P){var O,C,N,Q,I,t,S,U,B,M,F,q,V,v,D,T=[],L=0,p=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);a.enable(a.CULL_FACE);a.frontFace(a.CCW);if(k.shadowMapCullFace===THREE.CullFaceFront){a.cullFace(a.FRONT)}else{a.cullFace(a.BACK)}k.setDepthTest(true);for(O=0,C=R.__lights.length;O<C;O++){v=R.__lights[O];if(!v.castShadow){continue}if((v instanceof THREE.DirectionalLight)&&v.shadowCascade){for(I=0;I<v.shadowCascadeCount;I++){var u;if(!v.shadowCascadeArray[I]){u=d(v,I);u.originalCamera=P;var K=new THREE.Gyroscope();K.position=v.shadowCascadeOffset;K.add(u);K.add(u.target);P.add(K);v.shadowCascadeArray[I]=u;console.log("Created virtualLight",u)}else{u=v.shadowCascadeArray[I]}g(v,I);T[L]=u;L++}}else{T[L]=v;L++}}for(O=0,C=T.length;O<C;O++){v=T[O];if(!v.shadowMap){var H=THREE.LinearFilter;if(k.shadowMapType===THREE.PCFSoftShadowMap){H=THREE.NearestFilter}var J={minFilter:H,magFilter:H,format:THREE.RGBAFormat};v.shadowMap=new THREE.WebGLRenderTarget(v.shadowMapWidth,v.shadowMapHeight,J);v.shadowMapSize=new THREE.Vector2(v.shadowMapWidth,v.shadowMapHeight);v.shadowMatrix=new THREE.Matrix4()}if(!v.shadowCamera){if(v instanceof THREE.SpotLight){v.shadowCamera=new THREE.PerspectiveCamera(v.shadowCameraFov,v.shadowMapWidth/v.shadowMapHeight,v.shadowCameraNear,v.shadowCameraFar)}else{if(v instanceof THREE.DirectionalLight){v.shadowCamera=new THREE.OrthographicCamera(v.shadowCameraLeft,v.shadowCameraRight,v.shadowCameraTop,v.shadowCameraBottom,v.shadowCameraNear,v.shadowCameraFar)}else{console.error("Unsupported light type for shadow");continue}}R.add(v.shadowCamera);if(R.autoUpdate===true){R.updateMatrixWorld()}}if(v.shadowCameraVisible&&!v.cameraHelper){v.cameraHelper=new THREE.CameraHelper(v.shadowCamera);v.shadowCamera.add(v.cameraHelper)}if(v.isVirtual&&u.originalCamera==P){i(P,v)}t=v.shadowMap;S=v.shadowMatrix;U=v.shadowCamera;U.position.getPositionFromMatrix(v.matrixWorld);j.getPositionFromMatrix(v.target.matrixWorld);U.lookAt(j);U.updateMatrixWorld();U.matrixWorldInverse.getInverse(U.matrixWorld);if(v.cameraHelper){v.cameraHelper.visible=v.shadowCameraVisible}if(v.shadowCameraVisible){v.cameraHelper.update()}S.set(0.5,0,0,0.5,0,0.5,0,0.5,0,0,0.5,0.5,0,0,0,1);S.multiply(U.projectionMatrix);S.multiply(U.matrixWorldInverse);c.multiplyMatrices(U.projectionMatrix,U.matrixWorldInverse);m.setFromMatrix(c);k.setRenderTarget(t);k.clear();D=R.__webglObjects;for(N=0,Q=D.length;N<Q;N++){q=D[N];V=q.object;q.render=false;if(V.visible&&V.castShadow){if(!(V instanceof THREE.Mesh||V instanceof THREE.ParticleSystem)||!(V.frustumCulled)||m.intersectsObject(V)){V._modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,V.matrixWorld);q.render=true}}}var s,A,E;for(N=0,Q=D.length;N<Q;N++){q=D[N];if(q.render){V=q.object;M=q.buffer;s=f(V);A=V.geometry.morphTargets.length>0&&s.morphTargets;E=V instanceof THREE.SkinnedMesh&&s.skinning;if(V.customDepthMaterial){F=V.customDepthMaterial}else{if(E){F=A?l:b}else{if(A){F=e}else{F=n}}}if(M instanceof THREE.BufferGeometry){k.renderBufferDirect(U,R.__lights,p,F,M,V)}else{k.renderBuffer(U,R.__lights,p,F,M,V)}}}D=R.__webglObjectsImmediate;for(N=0,Q=D.length;N<Q;N++){q=D[N];V=q.object;if(V.visible&&V.castShadow){V._modelViewMatrix.multiplyMatrices(U.matrixWorldInverse,V.matrixWorld);k.renderImmediateObject(U,R.__lights,p,n,V)}}}var r=k.getClearColor(),G=k.getClearAlpha();a.clearColor(r.r,r.g,r.b,G);a.enable(a.BLEND);if(k.shadowMapCullFace===THREE.CullFaceFront){a.cullFace(a.BACK)}};function d(q,s){var p=new THREE.DirectionalLight();p.isVirtual=true;p.onlyShadow=true;p.castShadow=true;p.shadowCameraNear=q.shadowCameraNear;p.shadowCameraFar=q.shadowCameraFar;p.shadowCameraLeft=q.shadowCameraLeft;p.shadowCameraRight=q.shadowCameraRight;p.shadowCameraBottom=q.shadowCameraBottom;p.shadowCameraTop=q.shadowCameraTop;p.shadowCameraVisible=q.shadowCameraVisible;p.shadowDarkness=q.shadowDarkness;p.shadowBias=q.shadowCascadeBias[s];p.shadowMapWidth=q.shadowCascadeWidth[s];p.shadowMapHeight=q.shadowCascadeHeight[s];p.pointsWorld=[];p.pointsFrustum=[];var v=p.pointsWorld,r=p.pointsFrustum;for(var u=0;u<8;u++){v[u]=new THREE.Vector3();r[u]=new THREE.Vector3()}var A=q.shadowCascadeNearZ[s];var t=q.shadowCascadeFarZ[s];r[0].set(-1,-1,A);r[1].set(1,-1,A);r[2].set(-1,1,A);r[3].set(1,1,A);r[4].set(-1,-1,t);r[5].set(1,-1,t);r[6].set(-1,1,t);r[7].set(1,1,t);return p}function g(q,s){var p=q.shadowCascadeArray[s];p.position.copy(q.position);p.target.position.copy(q.target.position);p.lookAt(p.target);p.shadowCameraVisible=q.shadowCameraVisible;p.shadowDarkness=q.shadowDarkness;p.shadowBias=q.shadowCascadeBias[s];var u=q.shadowCascadeNearZ[s];var t=q.shadowCascadeFarZ[s];var r=p.pointsFrustum;r[0].z=u;r[1].z=u;r[2].z=u;r[3].z=u;r[4].z=t;r[5].z=t;r[6].z=t;r[7].z=t}function i(t,q){var v=q.shadowCamera,r=q.pointsFrustum,u=q.pointsWorld;h.set(Infinity,Infinity,Infinity);o.set(-Infinity,-Infinity,-Infinity);for(var s=0;s<8;s++){var A=u[s];A.copy(r[s]);THREE.ShadowMapPlugin.__projector.unprojectVector(A,t);A.applyMatrix4(v.matrixWorldInverse);if(A.x<h.x){h.x=A.x}if(A.x>o.x){o.x=A.x}if(A.y<h.y){h.y=A.y}if(A.y>o.y){o.y=A.y}if(A.z<h.z){h.z=A.z}if(A.z>o.z){o.z=A.z}}v.left=h.x;v.right=o.x;v.top=o.y;v.bottom=h.y;v.updateProjectionMatrix()}function f(p){return p.material instanceof THREE.MeshFaceMaterial?p.material.materials[0]:p.material}};THREE.ShadowMapPlugin.__projector=new THREE.Projector();THREE.SpritePlugin=function(){var b,j,g;var h,c,i,a;var f,e,l;this.init=function(o){b=o.context;j=o;h=new Float32Array([-0.5,-0.5,0,0,0.5,-0.5,1,0,0.5,0.5,1,1,-0.5,0.5,0,1]);c=new Uint16Array([0,1,2,0,2,3]);i=b.createBuffer();a=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,i);b.bufferData(b.ARRAY_BUFFER,h,b.STATIC_DRAW);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a);b.bufferData(b.ELEMENT_ARRAY_BUFFER,c,b.STATIC_DRAW);f=d();e={position:b.getAttribLocation(f,"position"),uv:b.getAttribLocation(f,"uv")};l={uvOffset:b.getUniformLocation(f,"uvOffset"),uvScale:b.getUniformLocation(f,"uvScale"),rotation:b.getUniformLocation(f,"rotation"),scale:b.getUniformLocation(f,"scale"),color:b.getUniformLocation(f,"color"),map:b.getUniformLocation(f,"map"),opacity:b.getUniformLocation(f,"opacity"),modelViewMatrix:b.getUniformLocation(f,"modelViewMatrix"),projectionMatrix:b.getUniformLocation(f,"projectionMatrix"),fogType:b.getUniformLocation(f,"fogType"),fogDensity:b.getUniformLocation(f,"fogDensity"),fogNear:b.getUniformLocation(f,"fogNear"),fogFar:b.getUniformLocation(f,"fogFar"),fogColor:b.getUniformLocation(f,"fogColor"),alphaTest:b.getUniformLocation(f,"alphaTest")};var m=document.createElement("canvas");m.width=8;m.height=8;var n=m.getContext("2d");n.fillStyle="#ffffff";n.fillRect(0,0,m.width,m.height);g=new THREE.Texture(m);g.needsUpdate=true};this.render=function(q,A,u,s){var B=q.__webglSprites,t=B.length;if(!t){return}b.useProgram(f);b.enableVertexAttribArray(e.position);b.enableVertexAttribArray(e.uv);b.disable(b.CULL_FACE);b.enable(b.BLEND);b.bindBuffer(b.ARRAY_BUFFER,i);b.vertexAttribPointer(e.position,2,b.FLOAT,false,2*8,0);b.vertexAttribPointer(e.uv,2,b.FLOAT,false,2*8,8);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a);b.uniformMatrix4fv(l.projectionMatrix,false,A.projectionMatrix.elements);b.activeTexture(b.TEXTURE0);b.uniform1i(l.map,0);var r=0;var D=0;var m=q.fog;if(m){b.uniform3f(l.fogColor,m.color.r,m.color.g,m.color.b);if(m instanceof THREE.Fog){b.uniform1f(l.fogNear,m.near);b.uniform1f(l.fogFar,m.far);b.uniform1i(l.fogType,1);r=1;D=1}else{if(m instanceof THREE.FogExp2){b.uniform1f(l.fogDensity,m.density);b.uniform1i(l.fogType,2);r=2;D=2}}}else{b.uniform1i(l.fogType,0);r=0;D=0}var p,C,v,o,n=[];for(p=0;p<t;p++){C=B[p];v=C.material;if(C.visible===false){continue}C._modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,C.matrixWorld);C.z=-C._modelViewMatrix.elements[14]}B.sort(k);for(p=0;p<t;p++){C=B[p];if(C.visible===false){continue}v=C.material;b.uniform1f(l.alphaTest,v.alphaTest);b.uniformMatrix4fv(l.modelViewMatrix,false,C._modelViewMatrix.elements);n[0]=C.scale.x;n[1]=C.scale.y;if(q.fog&&v.fog){o=D}else{o=0}if(r!==o){b.uniform1i(l.fogType,o);r=o}b.uniform2f(l.uvScale,v.uvScale.x,v.uvScale.y);b.uniform2f(l.uvOffset,v.uvOffset.x,v.uvOffset.y);b.uniform1f(l.opacity,v.opacity);b.uniform3f(l.color,v.color.r,v.color.g,v.color.b);b.uniform1f(l.rotation,v.rotation);b.uniform2fv(l.scale,n);j.setBlending(v.blending,v.blendEquation,v.blendSrc,v.blendDst);j.setDepthTest(v.depthTest);j.setDepthWrite(v.depthWrite);if(v.map&&v.map.image&&v.map.image.width){j.setTexture(v.map,0)}else{j.setTexture(g,0)}b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0)}b.enable(b.CULL_FACE)};function d(){var n=b.createProgram();var o=b.createShader(b.VERTEX_SHADER);var m=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(o,["precision "+j.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));b.shaderSource(m,["precision "+j.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));b.compileShader(o);b.compileShader(m);b.attachShader(n,o);b.attachShader(n,m);b.linkProgram(n);return n}function k(n,m){if(n.z!==m.z){return m.z-n.z}else{return m.id-n.id}}};THREE.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var a,f,i,d,b,g,h=new THREE.Frustum(),c=new THREE.Matrix4();this.init=function(l){a=l.context;f=l;var j=THREE.ShaderLib.depthRGBA;var k=THREE.UniformsUtils.clone(j.uniforms);i=new THREE.ShaderMaterial({fragmentShader:j.fragmentShader,vertexShader:j.vertexShader,uniforms:k});d=new THREE.ShaderMaterial({fragmentShader:j.fragmentShader,vertexShader:j.vertexShader,uniforms:k,morphTargets:true});b=new THREE.ShaderMaterial({fragmentShader:j.fragmentShader,vertexShader:j.vertexShader,uniforms:k,skinning:true});g=new THREE.ShaderMaterial({fragmentShader:j.fragmentShader,vertexShader:j.vertexShader,uniforms:k,morphTargets:true,skinning:true});i._shadowPass=true;d._shadowPass=true;b._shadowPass=true;g._shadowPass=true};this.render=function(k,j){if(!this.enabled){return}this.update(k,j)};this.update=function(H,F){var E,s,D,G,B,r,C,v,l,I,p,t,k=null;a.clearColor(1,1,1,1);a.disable(a.BLEND);f.setDepthTest(true);if(H.autoUpdate===true){H.updateMatrixWorld()}F.matrixWorldInverse.getInverse(F.matrixWorld);c.multiplyMatrices(F.projectionMatrix,F.matrixWorldInverse);h.setFromMatrix(c);f.setRenderTarget(this.renderTarget);f.clear();t=H.__webglObjects;for(D=0,G=t.length;D<G;D++){l=t[D];I=l.object;l.render=false;if(I.visible){if(!(I instanceof THREE.Mesh||I instanceof THREE.ParticleSystem)||!(I.frustumCulled)||h.intersectsObject(I)){I._modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,I.matrixWorld);l.render=true}}}var o,q,u;for(D=0,G=t.length;D<G;D++){l=t[D];if(l.render){I=l.object;C=l.buffer;if(I instanceof THREE.ParticleSystem&&!I.customDepthMaterial){continue}o=e(I);if(o){f.setMaterialFaces(I.material)}q=I.geometry.morphTargets.length>0&&o.morphTargets;u=I instanceof THREE.SkinnedMesh&&o.skinning;if(I.customDepthMaterial){v=I.customDepthMaterial}else{if(u){v=q?g:b}else{if(q){v=d}else{v=i}}}if(C instanceof THREE.BufferGeometry){f.renderBufferDirect(F,H.__lights,k,v,C,I)}else{f.renderBuffer(F,H.__lights,k,v,C,I)}}}t=H.__webglObjectsImmediate;for(D=0,G=t.length;D<G;D++){l=t[D];I=l.object;if(I.visible){I._modelViewMatrix.multiplyMatrices(F.matrixWorldInverse,I.matrixWorld);f.renderImmediateObject(F,H.__lights,k,i,I)}}var m=f.getClearColor(),A=f.getClearAlpha();a.clearColor(m.r,m.g,m.b,A);a.enable(a.BLEND)};function e(j){return j.material instanceof THREE.MeshFaceMaterial?j.material.materials[0]:j.material}};THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}};