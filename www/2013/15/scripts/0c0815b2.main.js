var SoundsMatrix,__bind=function(a,b){return function(){return a.apply(b,arguments)}};SoundsMatrix=function(){function a(){this.onSoundLoad=__bind(this.onSoundLoad,this),this.toggleSoundAt=__bind(this.toggleSoundAt,this),this.loadSound=__bind(this.loadSound,this);var a,b,c;for(this.width=64,this.height=0,this.matrix=[],a=b=0,c=this.width;c>=0?c>b:b>c;a=c>=0?++b:--b)this.matrix[a]=[];this.onLoad=new Signal,this.onProgress=new Signal,this.sounds=[],this.soundIds={},this.soundsLoaded=0,window.DEBUG&&(this.CELL_SIZE=10,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.width*this.CELL_SIZE,this.canvas.style.position="absolute",this.canvas.style.top=this.canvas.style.left=0,document.body.appendChild(this.canvas))}return a.prototype.COLORS=["red","green","blue","yellow","pink","cyan","magenta","gold","red","green","blue","yellow","pink","cyan","magenta","gold"],a.prototype.loadSound=function(a,b){var c,d,e;if(null==b&&(b=.5),null==this.soundIds[a]){for(0===a.indexOf("drum")&&(b=.7),this.sounds.push(new Howl({urls:["sounds/"+a+".mp3","sounds/"+a+".ogg"],volume:b,onload:this.onSoundLoad})),this.soundIds[a]=this.height,this.height=this.sounds.length,c=d=0,e=this.width;e>=0?e>d:d>e;c=e>=0?++d:--d)this.matrix[c][this.height-1]=!1;return window.DEBUG&&(this.canvas.height=this.height*this.CELL_SIZE),null}},a.prototype.toggleSoundAt=function(a,b){var c,d,e,f;for(d=this.soundIds[a],e=0,f=b.length;f>e;e++)c=b[e],this.matrix[c][d]=!this.matrix[c][d];return null},a.prototype.update=function(a){var b,c,d,e,f,g,h,i,j;if(d=floor(a*this.width),d!==this.playbackPosition){for(this.playbackPosition=d,b=e=0,h=this.height;h>=0?h>e:e>h;b=h>=0?++e:--e)this.matrix[this.playbackPosition][b]&&this.sounds[b].play();if(window.DEBUG)for(this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="rgba(0, 0, 0, .5)",this.ctx.fillRect(a*this.canvas.width,0,this.CELL_SIZE,this.canvas.height),b=f=0,i=this.width;i>=0?i>f:f>i;b=i>=0?++f:--f)for(c=g=0,j=this.height;j>=0?j>g:g>j;c=j>=0?++g:--g)this.matrix[b][c]&&(this.ctx.fillStyle=this.COLORS[c],this.ctx.fillRect(b*this.CELL_SIZE,c*this.CELL_SIZE,this.CELL_SIZE,this.CELL_SIZE));return null}},a.prototype.onSoundLoad=function(){var a;return this.soundsLoaded++,a=this.soundsLoaded/this.sounds.length,this.onProgress.dispatch(a),1===a&&this.onLoad.dispatch(),null},a}();var GlowObject,__bind=function(a,b){return function(){return a.apply(b,arguments)}};GlowObject=function(){function a(a){var b;this.mesh=a,this.prepareNormalPass=__bind(this.prepareNormalPass,this),this.prepareGlowPass=__bind(this.prepareGlowPass,this),this.updateMaterial=__bind(this.updateMaterial,this),b=this.mesh.material.color||this.mesh.material.materials[0].color||0,this.material=new THREE.MeshPhongMaterial({color:b,shading:THREE.FlatShading}),null!=this.mesh.material.materials?this.mesh.material.materials[0]=this.material:this.mesh.material=this.material,this.emissiveColor=new THREE.Color(0),this.glowEmissiveColor=this.material.color.clone()}return a.prototype.updateMaterial=function(){return this.emissiveColor=this.material.emissive.clone(),this.glowEmissiveColor=this.material.color.clone(),null},a.prototype.prepareGlowPass=function(){return this.material.emissive.set(this.glowEmissiveColor),null},a.prototype.prepareNormalPass=function(){return this.material.emissive.set(this.emissiveColor),null},a}();var InteractiveObject,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};InteractiveObject=function(a){function b(a){this.collide=__bind(this.collide,this),this.update=__bind(this.update,this),b.__super__.constructor.call(this,a),this.object=new THREE.Object3D,this.name=this.mesh.name,this.collidableObjects=[],this.object.add(this.mesh)}return __extends(b,a),b.prototype.update=function(){return null},b.prototype.collide=function(){return null},b}(GlowObject);var SwitchableObject,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};SwitchableObject=function(a){function b(a){this.collide=__bind(this.collide,this),b.__super__.constructor.call(this,a),this.soundPositions=[],SoundsMatrix.loadSound(this.name)}return __extends(b,a),b.prototype.collide=function(){return b.__super__.collide.call(this),this.activated=!this.activated,SoundsMatrix.toggleSoundAt(this.name,this.soundPositions),null},b}(InteractiveObject);var Pad,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Pad=function(a){function b(a){this.collide=__bind(this.collide,this),this.update=__bind(this.update,this);var c,d,e,f,g,h,i;for(e=new THREE.Mesh(new THREE.PlaneGeometry(1,1,1,1)),e.name=a.name,b.__super__.constructor.call(this,e),this.x=a.x,this.y=a.y,d=f=0;8>f;d=++f)this.soundPositions.push(8*d+this.x);for(this.color=(new THREE.Color).setHSL(.25*this.y+.15+random(.1),1,.75),this.material=this.mesh.material=new THREE.MeshPhongMaterial({color:1118481,blending:THREE.AdditiveBlending,transparent:!0,vertexColors:THREE.FaceColors}),i=this.mesh.geometry.faces,g=0,h=i.length;h>g;g++)c=i[g],c.color.set(this.color),c.color.r+=random(-.2,.2),c.color.g+=random(-.2,.2),c.color.b+=random(-.2,.2);this.updateMaterial(),this.mesh.scale.x=this.mesh.scale.y=.95,this.collidableObjects=[this.mesh]}return __extends(b,a),b.prototype.update=function(){return SoundsMatrix.playbackPosition%8===this.x?this.activated?this.glowEmissiveColor.set(4473924):(this.glowEmissiveColor.set(1118481),this.emissiveColor.set(1118481)):(this.glowEmissiveColor.set(0),this.activated||this.emissiveColor.set(0)),null},b.prototype.collide=function(){return b.__super__.collide.call(this),this.mesh.material.color.set(this.activated?this.color:1118481),this.emissiveColor.set(this.activated?4473924:0),this.activated&&TweenLite.from(this.mesh.scale,.1,{x:.01,y:.01}),null},b}(SwitchableObject);var Chimney,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Chimney=function(a){function b(a){this.collide=__bind(this.collide,this),this.deactivate=__bind(this.deactivate,this),this.activate=__bind(this.activate,this),this.update=__bind(this.update,this);var c,d,e,f,g,h,i,j,k,l,m,n,o;for(b.__super__.constructor.call(this,a),c=(new THREE.Color).setHSL((this.name.match(/[0-9]/)[0]-1)/60,1,.75),a.material=this.material=new THREE.MeshPhongMaterial({vertexColors:THREE.FaceColors,color:c}),n=a.geometry.faces,j=0,l=n.length;l>j;j++)d=n[j],d.color.set(c),d.color.r+=random(-.5,.5),d.color.g+=random(-.5,.5),d.color.b+=random(-.5,.5);for(this.glowEmissiveColor.set(0),this.emissiveColor.set(0),this.soundPlaying=!1,e=new THREE.Geometry,f=0;20>f;)i=new THREE.Vector3(.8*Math.random()-.4,.8*Math.random()-.4,.8*Math.random()-.4),e.vertices.push(i),f++;for(f=0;f<e.vertices.length-2;){for(g=f+1;g<e.vertices.length-1;){for(h=g+1;h<e.vertices.length;)Math.random()<.1&&e.faces.push(new THREE.Face3(f,g,h)),h++;g++}f++}for(e.computeFaceNormals(),o=e.faces,k=0,m=o.length;m>k;k++)d=o[k],d.color.set(c),d.color.r+=random(-.2,.8),d.color.g+=random(-.2,.8),d.color.b+=random(-.2,.8);this.smoke=new THREE.Mesh(e,this.material.clone()),this.smoke.material.emissive.set(8947848),this.smoke.position=this.mesh.position.clone(),this.smoke.position.y-=1,this.object.add(this.smoke),this.collidableObjects=[this.mesh],this.soundPositions=[0,16,32,48]}return __extends(b,a),b.prototype.update=function(){var a,b,c,d,e,f,g;if(SoundsMatrix.playbackPosition%16===0&&(this.activated&&!this.soundPlaying?(this.activate(),this.soundPlaying=!0):!this.activated&&this.soundPlaying&&(this.deactivate(),this.soundPlaying=!1)),this.soundPlaying)for(f=this.smoke.geometry.vertices,b=0,d=f.length;d>b;b++)a=f[b],a.y+=(10-a.y)*random(.2),a.y>8&&(a.y=0);else for(g=this.smoke.geometry.vertices,c=0,e=g.length;e>c;c++)a=g[c],a.y+=.5*(0-a.y);return this.smoke.geometry.verticesNeedUpdate=!0,null},b.prototype.activate=function(){},b.prototype.deactivate=function(){return this.emissiveColor.set(0),this.glowEmissiveColor.set(0)},b.prototype.collide=function(){return b.__super__.collide.call(this),this.activated?(this.emissiveColor.set(8947848),this.glowEmissiveColor.set(8947848)):(this.emissiveColor.set(0),this.glowEmissiveColor.set(0)),null},b}(SwitchableObject);var Ground,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Ground=function(a){function b(a){b.__super__.constructor.call(this,a),this.glowEmissiveColor.set(3355443)}return __extends(b,a),b}(GlowObject);var Deer,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Deer=function(a){function b(a){this.reset=__bind(this.reset,this),this.update=__bind(this.update,this),this.run=__bind(this.run,this);var c,d,e,f;for(b.__super__.constructor.call(this,a),this.isRunning=!1,this.speed=0,this.angleOffset=0,this.mesh.material.vertexColors=THREE.FaceColors,this.mesh.material.morphTargets=!0,this.mesh.material.morphNormals=!0,this.mesh.material.transparent=!0,this.mesh.scale.set(.025,.025,.025),f=this.mesh.geometry.faces,d=0,e=f.length;e>d;d++)c=f[d],c.color.r=random(.2,1),c.color.g=random(.2,1),c.color.b=random(.2,1);this.mesh.geometry.faces,this.object.position.set(0,.4,-40),this.light=new THREE.PointLight(16777215,1,20),this.object.add(this.light),this.reset()}return __extends(b,a),b.prototype.run=function(a){return this.isRunning?void 0:(this.speed=random(1.5,2),this.angleOffset=random(-.03,.03),TweenLite.to(this.mesh.material,.5,{opacity:1}),TweenLite.to(this.light,.5,{intensity:1}),this.light.color.set(a),this.emissiveColor.set(a),this.glowEmissiveColor.set(a),this.isRunning=!0,null)},b.prototype.update=function(){return this.isRunning&&(this.mesh.updateAnimation(World.dt*this.speed),this.object.position.z>0&&(this.object.rotation.y+=this.angleOffset*this.speed),this.object.position.z+=Math.cos(this.object.rotation.y)*this.speed*.2,this.object.position.x+=Math.sin(this.object.rotation.y)*this.speed*.2,this.object.position.distanceTo(World.scene.camera.position)>60&&this.reset()),null},b.prototype.reset=function(){return this.isRunning=!1,this.object.position.set(0,.4,-40),this.object.rotation.y=0,this.mesh.material.opacity=0,this.light.intensity=0},b}(InteractiveObject);var House,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};House=function(a){function b(a){var c,d,e,f,g,h;for(b.__super__.constructor.call(this,a),this.material.color.set(16764108),this.glowEmissiveColor.set(1118481),e=[this.material,new THREE.MeshBasicMaterial({color:8943360,side:THREE.BackSide})],h=a.geometry.faces,f=0,g=h.length;g>f;f++)d=h[f],c=d.clone(),c.materialIndex=1,a.geometry.faces.push(c);a.material=new THREE.MeshFaceMaterial(e)}return __extends(b,a),b}(GlowObject);var Sky,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Sky=function(a){function b(){var a;a=new THREE.Mesh(new THREE.PlaneGeometry(200,100,1,1)),a.position.z=-50,b.__super__.constructor.call(this,a),a.material.map=new THREE.ImageUtils.loadTexture("images/background.jpg"),a.material.specular.set(0),this.emissiveColor=16777215,this.glowEmissiveColor=16777215,this.color=13421823,this.collidableObjects=[this.mesh]}return __extends(b,a),b}(InteractiveObject);var Corridor,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Corridor=function(a){function b(a){this.onCameraTweenComplete=__bind(this.onCameraTweenComplete,this),this.onCameraTweenUpdate=__bind(this.onCameraTweenUpdate,this),this.collide=__bind(this.collide,this),this.update=__bind(this.update,this);var c,d,e,f;for(b.__super__.constructor.call(this,a),this.sound=new Howl({urls:["sounds/deer.mp3"],volume:.5}),this.color=(new THREE.Color).setHSL(random(),1,.75),this.deers=[],this.glowObjects=[],e=window.HQ?5:3,d=f=0;e>=0?e>f:f>e;d=e>=0?++f:--f)c=new Deer(new THREE.MorphAnimMesh(World.scene.deerGeometry)),this.deers.push(c),this.object.add(c.object),this.glowObjects.push(c);this.cameraFov=World.scene.camera.fov,this.collidableObjects=[this.mesh]}return __extends(b,a),b.prototype.update=function(a){var b,c,d,e;for(e=this.deers,c=0,d=e.length;d>c;c++)b=e[c],b.update(a);return null},b.prototype.collide=function(){return this.deers[0].isRunning?void 0:(this.deers[0].run(this.color),this.sound.play(),this.deers.push(this.deers.shift()),this.color.setHSL(random(),1,.75),null)},b.prototype.onCameraTweenUpdate=function(){return World.scene.camera.updateProjectionMatrix(),null},b.prototype.onCameraTweenComplete=function(){return TweenLite.to(World.scene.camera,6,{fov:this.cameraFov,onUpdate:this.onCameraTweenUpdate,ease:Cubic.easeInOut}),null},b}(InteractiveObject);var Tree,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Tree=function(a){function b(a){this.collide=__bind(this.collide,this);var c,d,e,f;for(b.__super__.constructor.call(this,a),this.material=a.material=new THREE.MeshPhongMaterial({vertexColors:THREE.FaceColors}),f=a.geometry.faces,d=0,e=f.length;e>d;d++)c=f[d],c.color.setHex(random(16777215));this.glowEmissiveColor.set(0),this.emissiveColor.set(0),this.collidableObjects=[a],this.soundPositions=[0,32]}return __extends(b,a),b.prototype.collide=function(){return b.__super__.collide.call(this),this.emissiveColor.set(this.activated?16777215:0),this.glowEmissiveColor.set(this.activated?16777215:0),null},b}(SwitchableObject);var BackgroundTrees,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};BackgroundTrees=function(a){function b(a){b.__super__.constructor.call(this,a),this.glowEmissiveColor.set(3355443)}return __extends(b,a),b}(GlowObject);var Roof,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Roof=function(a){function b(a){b.__super__.constructor.call(this,a),this.emissiveColor.set(1118481),this.glowEmissiveColor.set(3355443)}return __extends(b,a),b}(GlowObject);var Scene,__bind=function(a,b){return function(){return a.apply(b,arguments)}};Scene=function(){function a(a){this.resize=__bind(this.resize,this),this.draw=__bind(this.draw,this),this.update=__bind(this.update,this),this.onClick=__bind(this.onClick,this),this.initComposers=__bind(this.initComposers,this),this.addSpecialObject=__bind(this.addSpecialObject,this),this.createPads=__bind(this.createPads,this),this.sceneLoaded=__bind(this.sceneLoaded,this),this.deerLoaded=__bind(this.deerLoaded,this);var b;this.interactiveObjects=[],this.collidableObjects=[],this.glowObjects=[],this.renderer=new THREE.WebGLRenderer({canvas:a}),this.onLoad=new Signal,this.camera=new THREE.PerspectiveCamera(50,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.z=16,this.camera.position.y=3,this.camera.fov=50,this.lookAtVector=new THREE.Vector3(0,3,0),this.snowballs=[],b=new THREE.JSONLoader,b.load("models/elk_life.js",this.deerLoaded)}return a.prototype.objectsClass={house:House,roof:Roof,tree:Tree,backgroundtrees:BackgroundTrees,corridor:Corridor,chimney1:Chimney,chimney2:Chimney,chimney3:Chimney,chimney4:Chimney,chimney5:Chimney,chimney6:Chimney,chimney7:Chimney,chimney8:Chimney,chimney9:Chimney,ground:Ground},a.prototype.deerLoaded=function(a){var b;return this.deerGeometry=a,a.computeMorphNormals(),b=new THREE.SceneLoader,b.load("models/house3.js",this.sceneLoaded)},a.prototype.sceneLoaded=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(this.scene=a.scene,this.controls=new THREE.TrackballControls(this.camera),this.raycaster=new THREE.Raycaster,this.projector=new THREE.Projector,this.scene.rotation.set(0,0,0),this.scene.matrixAutoUpdate=!0,i=[],o=this.scene.children,j=0,m=o.length;m>j;j++)b=o[j],b instanceof THREE.Mesh&&i.push(b);for(k=0,n=i.length;n>k;k++)f=i[k],null!=this.objectsClass[f.name]&&(h=new this.objectsClass[f.name](f),null!=h.onLoad?h.onLoad.add(this.addSpecialObject):this.addSpecialObject(h),null!=h.light&&this.scene.add(h.light));for(e=new THREE.PointLight(15658751,.2),e.position.x=10,e.position.z=10,e.position.y=10,this.scene.add(e),e=new THREE.PointLight(15658751,.1),e.position.x=-10,e.position.z=10,e.position.y=10,this.scene.add(e),d=window.HQ?5:3,c=l=0;d>=0?d>l:l>d;c=d>=0?++l:--l)g=new Snowball,this.snowballs.push(g),this.scene.add(g.object);return this.addSpecialObject(new Sky),this.createPads(),this.initComposers(),this.onLoad.dispatch(),World.onMouseDown.add(this.onClick),null},a.prototype.createPads=function(){var a,b,c,d,e,f,g,h,i,j;for(e=new THREE.Object3D,f=new THREE.Object3D,a=0,b=g=0;4>g;b=++g)for(a=(new THREE.Color).setHSL(random(),1,.5),c=h=0;8>h;c=++h)d=this.addSpecialObject(new Pad({x:c,y:b,color:a,name:"drum"+(b+1)})),d.object.position.x=c-3.5,d.object.position.y=b+.5,e.add(d.object);for(b=i=0;4>i;b=++i)for(a=(new THREE.Color).setHSL(random(),1,.5),c=j=0;8>j;c=++j)d=this.addSpecialObject(new Pad({x:c,y:b,color:a,name:"tone"+(b+1)})),d.object.position.x=c-3.5,d.object.position.y=b+.5,f.add(d.object);return f.position.z=e.position.z=.1,e.position.x=-6,f.position.x=6,this.scene.add(e),this.scene.add(f)},a.prototype.addSpecialObject=function(a){var b,c,d,e,f,g,h,i;if(a instanceof InteractiveObject&&this.interactiveObjects.push(a),a instanceof GlowObject&&this.glowObjects.push(a),null!=a.collidableObjects)for(h=a.collidableObjects,d=0,f=h.length;f>d;d++)b=h[d],this.collidableObjects.push(b);else a.mesh&&this.collidableObjects.push(a.mesh);if(null!=a.glowObjects)for(i=a.glowObjects,e=0,g=i.length;g>e;e++)c=i[e],this.glowObjects.push(c);return this.scene.add(a.object),a},a.prototype.initComposers=function(){var a,b,c,d,e,f,g;return f={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1},this.composer1=new THREE.EffectComposer(this.renderer,new THREE.WebGLRenderTarget(600,400,f)),g=new THREE.RenderPass(this.scene,this.camera),this.composer1.addPass(g),c=new THREE.ShaderPass(THREE.BrightnessContrastShader),c.uniforms.contrast.value=.8,this.composer1.addPass(c),b=new THREE.BloomPass(2),this.composer1.addPass(b),d=new THREE.ShaderPass(THREE.CopyShader),this.composer1.addPass(d),this.composer2=new THREE.EffectComposer(this.renderer),g=new THREE.RenderPass(this.scene,this.camera),this.composer2.addPass(g),a=new THREE.ShaderPass(AdditiveBlendShader),a.uniforms.tDiffuse2.value=this.composer1.renderTarget2,this.composer2.addPass(a),e=new THREE.ShaderPass(THREE.FXAAShader),e.uniforms.resolution.value.set(1/window.innerWidth,1/window.innerHeight),e.renderToScreen=!0,this.composer2.addPass(e),null},a.prototype.onClick=function(){var a,b,c,d,e,f,g;if(d=new THREE.Vector3(World.mouse.x/(.5*World.width)-1,-World.mouse.y/(.5*World.height)+1,1),this.projector.unprojectVector(d,this.camera),this.raycaster.set(this.camera.position,d.sub(this.camera.position).normalize()),b=this.raycaster.intersectObjects(this.collidableObjects)[0]){for(a=null,g=this.interactiveObjects,e=0,f=g.length;f>e;e++)c=g[e],-1!==c.collidableObjects.indexOf(b.object)&&(a=c);return this.snowballs[0]["throw"](b,a),this.snowballs.push(this.snowballs.shift()),null}},a.prototype.update=function(a){var b,c,d,e;for(e=this.interactiveObjects,c=0,d=e.length;d>c;c++)b=e[c],b.update(a);return null},a.prototype.draw=function(){var a,b,c,d,e,f,g;for(f=this.glowObjects,b=0,d=f.length;d>b;b++)a=f[b],a.prepareGlowPass();for(this.composer1.render(),g=this.glowObjects,c=0,e=g.length;e>c;c++)a=g[c],a.prepareNormalPass();return this.composer2.render(),null},a.prototype.resize=function(){return this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.initComposers(),null},a}();var Snowball,__bind=function(a,b){return function(){return a.apply(b,arguments)}};Snowball=function(){function a(){this.blow=__bind(this.blow,this),this["throw"]=__bind(this["throw"],this);var a,b;this.object=new THREE.Object3D,this.object.position.set(0,1,16),this.isThrown=!1,a=new THREE.SphereGeometry(.1,4,4),b=new THREE.MeshBasicMaterial({color:new THREE.Color(16777215),transparent:!0}),this.light=new THREE.PointLight(0,1,10),this.mesh=new THREE.Mesh(a,b),this.object.add(this.mesh),this.object.add(this.light)}return a.prototype["throw"]=function(a,b){var c;return this.intersect=a,this.interactiveObject=b,this.isThrown?void 0:(null!=this.tween&&this.tween.kill(),null!=this.tween2&&this.tween2.kill(),null!=this.tween3&&this.tween3.kill(),this.object.position.set(0,1,16),this.light.distance=10,c=.03*this.intersect.distance,this.tween=TweenLite.to(this.object.position,c,{x:this.intersect.point.x,y:this.intersect.point.y,z:this.intersect.point.z,easing:Linear.EaseIn,onComplete:this.blow}),null!=this.interactiveObject&&this.interactiveObject instanceof SwitchableObject?(this.light.color.set(this.interactiveObject.color||this.interactiveObject.mesh.material.color),this.mesh.material.color.set(this.interactiveObject.color||this.interactiveObject.mesh.material.color),this.tween2=TweenLite.to(this.light,.1,{distance:15,delay:c-.1,ease:Quad.easeIn}),this.tween3=TweenLite.to(this.light.color,.2,{r:0,g:0,b:0,delay:c,ease:Quad.easeIn})):(null!=this.interactiveObject&&null!=this.interactiveObject.color?this.light.color.set(this.interactiveObject.color):this.light.color.setHSL(random(),1,.5),this.mesh.material.color.set(this.light.color),this.tween2=TweenLite.to(this.light.color,.2,{r:0,g:0,b:0,delay:c-.2,ease:Quad.easeOut})),null!=this.interactiveObject&&"corridor"===this.interactiveObject.name&&(this.tween2.kill(),this.tween2=TweenLite.to(this.light.color,.6,{r:0,g:0,b:0,delay:c-.8,ease:Quad.easeOut}),TweenLite.to(this.mesh.material.color,.6,{r:0,g:0,b:0,delay:c-.8,ease:Quad.easeOut})),this.isThrown=!0)},a.prototype.blow=function(){return null!=this.interactiveObject&&this.interactiveObject instanceof InteractiveObject&&this.interactiveObject.collide(this.intersect),this.isThrown=!1,null},a}(),window.Signal=signals.Signal,window.SoundsMatrix=new SoundsMatrix,window.World=Sketch.create({type:Sketch.WEBGL,autostart:!1}),World.onMouseDown=new Signal,World.setup=function(){return this.scene=new Scene(this.canvas),this.scene.onLoad.add(World.onSceneLoad.bind(this)),SoundsMatrix.onLoad.add(World.onSoundsLoad.bind(this)),SoundsMatrix.onProgress.add(World.onSoundsProgress.bind(this))},World.onSceneLoad=function(){return this.sceneLoaded=!0,this.soundsLoaded?this.start():void 0},World.onSoundsLoad=function(){return this.soundsLoaded=!0,this.sceneLoaded?(document.getElementsByClassName("loader")[0].classList.add("hide"),this.canvas.classList.add("show"),this.start()):void 0},World.onSoundsProgress=function(a){return document.getElementsByClassName("percentage")[0].style.width=Math.floor(100*a)+"%"},World.update=function(){var a;return a=this.millis%15e3/15e3,SoundsMatrix.update(a),this.scene.update(a)},World.draw=function(){return this.scene.draw()},World.resize=function(){return this.scene.resize()},World.mousedown=function(){return this.onMouseDown.dispatch()};